/*!
*  filename: ej2-richtexteditor.umd.min.js
*  version : 27.1.48
*  Copyright Syncfusion Inc. 2001 - 2023. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-navigations"),require("@syncfusion/ej2-splitbuttons"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-inputs"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-dropdowns"),require("@syncfusion/ej2-filemanager")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-navigations","@syncfusion/ej2-splitbuttons","@syncfusion/ej2-popups","@syncfusion/ej2-inputs","@syncfusion/ej2-buttons","@syncfusion/ej2-dropdowns","@syncfusion/ej2-filemanager"],t):t((e=e||self).ej={},e.ej2Base,e.ej2Navigations,e.ej2Splitbuttons,e.ej2Popups,e.ej2Inputs,e.ej2Buttons,e.ej2Dropdowns,e.ej2Filemanager)}(this,function(c,j,A,I,U,P,H,q,z){"use strict";var _="tableclass",V="load",Q="initial-load",W="content-changed",n="initial-end",K="iframe-click",o="destroy",G="toolbarClick",X="toolbar-refresh",Y="refresh-begin",J="toolbar-updated",$="bind-on-end",Z="html-toolbar-click",ee="markdown-toolbar-click",l="model-changed",te="tableModulekeyUp",ne="keyUp",h="keyDown",ie="onImport",oe="onExport",re="mouseUp",se="toolbarCreated",ae="toolbarRenderComplete",le="enableFullScreen",de="disableFullScreen",ce="dropDownSelect",he="beforeDropDownItemRender",pe="execCommandCallBack",ue="image-toolbar-action",me="audio-toolbar-action",ge="video-toolbar-action",fe="link-toolbar-action",be="resize",ye="resizeStart",ve="resizing",Ce="resizeStop",Ne="insertLink",Ee="unLink",Se="editLink",Te="openLink",Oe="actionBegin",Le="actionComplete",we="updatedToolbarStatus",ke="updateToolbarItem",xe="insertImage",De="insertAudio",Me="insertVideo",Be="insertCompleted",Re="insertImgLink",Ae="imgAltText",Ie="delete",Ue="delete",Pe="delete",He="caption",je="imageSize",Fe="videoSize",qe="sourceCode",ze="updateSource",_e="beforeDropDownOpen",Ve="selection-save",Qe="selection-restore",We="count",Ke="mouseDown",Ge="sourceCodeMouseDown",Xe="editAreaClick",Ye="scroll",Je="contentscroll",$e="colorPickerChanged",Ze="tableColorPickerChanged",et="focusChange",tt="selectAll",nt="selectRange",it="getSelectedHtml",ot="renderInlineToolbar",rt="paste-content",st="rtl-mode",at="createTable",lt="docClick",dt="table-toolbar-action",ct="checkUndoStack",ht="readOnlyMode",pt="pasteClean",ut="enterHandler",mt="beforeDialogOpen",gt="clearDialogObj",ft="dialogOpen",bt="beforeDialogClose",yt="dialogClose",vt="beforeQuickToolbarOpen",Ct="quickToolbarOpen",Nt="quickToolbarClose",Et="imageSelected",St="imageUploading",Tt="imageUploadSuccess",Ot="imageUploadFailed",Lt="imageRemoving",wt="fileSelected",kt="fileUploading",xt="fileUploadSuccess",Dt="fileUploadFailed",Mt="fileRemoving",Bt="afterImageDelete",Rt="afterMediaDelete",At="drop",It="xhtmlValidation",Ut="beforeImageUpload",Pt="beforeFileUpload",Ht="resizeInitialized",jt="renderFileManager",Ft="beforeImageDrop",qt="dynamicModule",zt="beforePasteCleanup",_t="afterPasteCleanup",Vt="updateTbItemsStatus",Qt="showLinkDialog",Wt="closeLinkDialog",Kt="showImageDialog",Gt="showAudioDialog",Xt="showVideoDialog",Yt="closeImageDialog",Jt="closeAudioDialog",$t="closeVideoDialog",Zt="showTableDialog",en="closeTableDialog",tn="bindCssClass",nn="formatPainterClick",on="formatPainterDoubleClick",rn="emojiPicker",sn="destroyTooltip",an="hidePopup",ln="cleanupResizeElements",dn="afterKeyDown",cn="updateValueOnIdle",hn="documentClickClosedBy",pn="showColorPicker",un="closeTooltip",mn="autoResize",gn="address:empty, article:empty, aside:empty, blockquote:empty,\n details:empty, dd:empty, div:empty, dl:empty, dt:empty, fieldset:empty, footer:empty,form:empty, h1:empty,\n h2:empty, h3:empty, h4:empty, h5:empty, h6:empty, header:empty, hgroup:empty, li:empty, main:empty, nav:empty,\n noscript:empty, output:empty, p:empty, pre:empty, section:empty, td:empty, th:empty",fn="a:empty, abbr:empty, acronym:empty, b:empty, bdi:empty, bdo:empty, big:empty, button:empty,\ncanvas:empty, cite:empty, code:empty, data:empty, datalist:empty, del:empty, dfn:empty, em:empty, font:empty, i:empty, iframe:empty,\nins:empty, kbd:empty, label:empty, map:empty, mark:empty, meter:empty, noscript:empty, object:empty, output:empty, picture:empty, progress:empty,\nq:empty, ruby:empty, s:empty, samp:empty, script:empty, select:empty, slot:empty, small:empty, span:empty, strong:empty, strike:empty, sub:empty, sup:empty, svg:empty,\ntemplate:empty, textarea:empty, time:empty, u:empty, tt:empty, var:empty, wbr:empty",bn=["px","em","rem","pt","cm","mm","in","pc","vw","vh","vmin","vmax"],yn={px:{px:1,em:.0625,rem:.0625,pt:.75,cm:.0264583,mm:.0026458,in:.0104167,pc:.0625,vw:.00625,vh:.00625,vmin:.00625,vmax:.00625},em:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},rem:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},pt:{px:1.33333,em:.0833333,rem:.0833333,pt:1,cm:.0352778,mm:.0035278,in:.0138889,pc:.0416667,vw:.00416667,vh:.00416667,vmin:.00416667,vmax:.00416667},cm:{px:37.7953,em:2.3622,rem:2.3622,pt:28.3465,cm:1,mm:.1,in:.393701,pc:.148148,vw:.0377953,vh:.0377953,vmin:.0377953,vmax:.0377953},mm:{px:3.77953,em:.23622,rem:.23622,pt:2.83465,cm:10,mm:1,in:.0393701,pc:.0148148,vw:.00377953,vh:.00377953,vmin:.00377953,vmax:.00377953},in:{px:96,em:6,rem:6,pt:72,cm:2.54,mm:25.4,in:1,pc:.375,vw:.09375,vh:.09375,vmin:.09375,vmax:.09375},pc:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:1,vw:.0625,vh:.0625,vmin:.0625,vmax:.0625},vw:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vh:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmin:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmax:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1}},vn="onHandleFontsizeChange",Cn="e-richtexteditor",Nn="e-rtl",En="e-disabled",Sn="rte-iframe-script-sheet",Tn="rte-iframe-style-sheet",On="e-rte-container",Ln="e-rte-toolbar",wn="e-rte-tb-fixed",kn="e-rte-tb-float",xn="e-rte-inline",Dn="e-rte-tb-expand",Mn="e-rte-full-screen",Bn="e-rte-quick-toolbar",Rn="e-rte-text-quicktoolbar",An="e-rte-pop",In="e-tb-static",Un="e-rte-quick-popup",Pn="e-quick-dropdown",Hn="e-rte-image-popup",jn="e-rte-text-popup",Fn="e-rte-inline-popup",qn="e-rte-inline-dropdown",zn="e-rte-dropdown-popup",_n="e-rte-dropdown-icons",Vn="e-rte-dropdown-items",Qn="e-rte-dropdown-btn",Wn="e-rte-content",Kn="e-toolbar-item",Gn="e-toolbar-wrapper",Xn="e-show",Yn="e-hide",Jn="e-visible",$n="e-focused",Zn="e-remove-white-space",ei="e-imgright",ti="e-imgleft",ni="e-imgcenter",ii="e-imgbreak",oi="e-audio-break",ri="e-clickelem",si="e-video-clickelem",ai="e-audio-wrap",li="e-video-wrap",di="e-video-break",ci="e-img-caption",hi="e-rte-img-caption",pi="e-caption-inline",ui="e-imginline",mi="e-audio-inline",gi="e-video-inline",fi="e-rte-character-count",bi="e-warning",yi="e-error",vi="e-icons",Ci="e-active",Ni="e-expand-open",Ei="e-rte-elements",Si="e-tbar-btn",Ti="e-rte-horizontal-separator",Oi="e-tbar-ios-fixed",Li="e-rte-list-primary-content",wi="e-rte-numberformatlist-dropdown",ki="e-rte-bulletformatlist-dropdown",xi="e-formats-tbar-btn",Di="e-font-name-tbar-btn",Mi="e-font-size-tbar-btn",Bi="e-alignment-tbar-btn",Ri="e-rte-fontcolor-element",Ai="e-rte-backgroundcolor-element",Ii="e-rte-color-content",Ui="e-rte-fontcolor-dropdown",Pi="e-rte-backgroundcolor-dropdown",Hi="e-rte-square-palette",ji="e-rte-fontcolor-colorpicker",Fi="e-rte-backgroundcolor-colorpicker",qi="e-rte-readonly",zi="e-cell-select",_i="e-cell-select-end",Vi="e-multi-cells-select",Qi="e-dashed-border",Wi="e-alternate-border",Ki="e-column-resize",Gi="e-row-resize",Xi="e-table-box",Yi="e-rte-hidden",Ji="e-rte-keepformat",$i="e-rte-removeformat",Zi="e-rte-plainformat",eo="e-rte-pasteok",to="e-rte-pastecancel",no="e-rte-dialog-minheight",io="e-resize-handle",oo="e-south-east",ro="e-rte-image",so="e-resize",ao="e-img-focus",lo="e-audio-focus",co="e-video-focus",ho="e-rte-drag-image",po="e-rte-upload-popup",uo="e-popup-open",mo="e-img-resize",go="e-droparea",fo="e-img-inner",bo="e-upload-files",yo="e-rte-dialog-upload",vo="e-rte-resize",Co="e-custom-tile",No="e-nocolor-item",Eo="e-rte-table-border",So="e-rte-table-resize",To="e-rte-fixed-tb-expand",Oo="e-rte-toolbar-enabled",Lo="e-south-west",wo="e-rte-srctextarea",ko=["Enter","ArrowRight","ArrowLeft"],xo=((e=c.RenderType||(c.RenderType={}))[e.Toolbar=0]="Toolbar",e[e.Content=1]="Content",e[e.Popup=2]="Popup",e[e.LinkToolbar=3]="LinkToolbar",e[e.TextToolbar=4]="TextToolbar",e[e.ImageToolbar=5]="ImageToolbar",e[e.AudioToolbar=6]="AudioToolbar",e[e.VideoToolbar=7]="VideoToolbar",e[e.InlineToolbar=8]="InlineToolbar",e[e.TableToolbar=9]="TableToolbar",(e=c.ToolbarType||(c.ToolbarType={})).Expand="Expand",e.MultiRow="MultiRow",e.Scrollable="Scrollable",(e=c.DialogType||(c.DialogType={})).InsertLink="InsertLink",e.InsertImage="InsertImage",e.InsertAudio="InsertAudio",e.InsertVideo="InsertVideo",e.InsertTable="InsertTable",(e=c.ImageInputSource||(c.ImageInputSource={})).Uploaded="Uploaded",e.Dropped="Dropped",e.Pasted="Pasted",["alignments","formats","fontname","fontsize","fontcolor","backgroundcolor","align","display","audiolayoutoption","videolayoutoption","videoalign","tablerows","tablecolumns","tablecell","tablecellhorizontalalign","tablecellverticalalign","styles","numberformatlist","bulletformatlist"]),Do={alignments:{id:"Alignments",icon:"e-alignments",tooltip:"Alignments",command:"Alignments",subCommand:"Alignments"},justifyleft:{id:"JustifyLeft",icon:"e-justify-left",tooltip:"JustifyLeft",command:"Alignments",subCommand:"JustifyLeft"},justifycenter:{id:"JustifyCenter",icon:"e-justify-center",tooltip:"JustifyCenter",command:"Alignments",subCommand:"JustifyCenter"},justifyright:{id:"JustifyRight",icon:"e-justify-right",tooltip:"JustifyRight",command:"Alignments",subCommand:"JustifyRight"},justifyfull:{id:"JustifyFull",icon:"e-justify-full",tooltip:"JustifyFull",command:"Alignments",subCommand:"JustifyFull"},fontname:{id:"FontName",icon:"e-font-name",tooltip:"Font Name",command:"Font",subCommand:"FontName"},fontsize:{id:"FontSize",icon:"e-font-size",tooltip:"Font Size",command:"Font",subCommand:"FontSize"},fontcolor:{id:"FontColor",icon:"e-rte-font-color",tooltip:"Font Color",command:"Font",subCommand:"FontColor",value:"#ff0000ff"},backgroundcolor:{id:"BackgroundColor",icon:"e-background-color",tooltip:"Background Color",command:"Font",subCommand:"BackgroundColor",value:"#ffff00ff"},importword:{id:"ImportWord",icon:"e-rte-import-doc",tooltip:"Import from Word",command:"Import",subCommand:"ImportWord"},exportword:{id:"ExportWord",icon:"e-rte-export-doc",tooltip:"Export to Word",command:"Export",subCommand:"ExportWord"},exportpdf:{id:"ExportPdf",icon:"e-rte-export-pdf",tooltip:"Export to PDF",command:"Export",subCommand:"ExportPdf"},bold:{id:"Bold",icon:"e-bold",tooltip:"Bold",command:"Style",subCommand:"Bold"},italic:{id:"Italic",icon:"e-italic",tooltip:"Italic",command:"Style",subCommand:"Italic"},underline:{id:"Underline",icon:"e-underline",tooltip:"Underline",command:"Style",subCommand:"Underline"},strikethrough:{id:"StrikeThrough",icon:"e-strike-through",tooltip:"StrikeThrough",command:"Style",subCommand:"StrikeThrough"},clearformat:{id:"ClearFormat",icon:"e-clear-format",tooltip:"Clear Format",command:"Clear",subCommand:"ClearFormat"},clearall:{id:"ClearAll",icon:"e-clear-all",tooltip:"Clear All",command:"Clear",subCommand:"ClearAll"},cut:{id:"Cut",icon:"e-cut",tooltip:"Cut",command:"ClipBoard",subCommand:"Cut"},copy:{id:"Copy",icon:"e-copy",tooltip:"Copy",command:"ClipBoard",subCommand:"Copy"},paste:{id:"Paste",icon:"e-paste",tooltip:"Paste",command:"ClipBoard",subCommand:"Paste"},unorderedlist:{id:"UnorderedList",icon:"e-unorder-list",tooltip:"Bulleted List",command:"Lists",subCommand:"UL"},orderedlist:{id:"OrderedList",icon:"e-order-list",tooltip:"Numbered List",command:"Lists",subCommand:"OL"},numberformatlist:{id:"NumberFormatList",icon:"e-order-list",tooltip:"Number Format List",command:"NumberFormatList",subCommand:"NumberFormatList"},bulletformatlist:{id:"BulletFormatList",icon:"e-unorder-list",tooltip:"Bullet Format List",command:"BulletFormatList",subCommand:"BulletFormatList"},indent:{id:"Indent",icon:"e-indent",tooltip:"Increase Indent",command:"Indents",subCommand:"Indent"},outdent:{id:"Outdent",icon:"e-outdent",tooltip:"Decrease Indent",command:"Indents",subCommand:"Outdent"},undo:{id:"Undo",icon:"e-undo",tooltip:"Undo",command:"Actions",subCommand:"Undo"},redo:{id:"Redo",icon:"e-redo",tooltip:"Redo",command:"Actions",subCommand:"Redo"},superscript:{id:"SuperScript",icon:"e-super-script",tooltip:"Superscript",command:"Effects",subCommand:"SuperScript"},subscript:{id:"SubScript",icon:"e-sub-script",tooltip:"Subscript",command:"Effects",subCommand:"SubScript"},createlink:{id:"CreateLink",icon:"e-create-link",tooltip:"Insert Hyperlink",command:"Links",subCommand:"CreateLink"},openlink:{id:"OpenLink",icon:"e-open-link",tooltip:"Open Link",command:"Links",subCommand:"OpenLink"},editlink:{id:"EditLink",icon:"e-edit-link",tooltip:"Edit Link",command:"Links",subCommand:"EditLink"},removelink:{id:"RemoveLink",icon:"e-remove-link",tooltip:"Remove Link",command:"Links",subCommand:"RemoveLink"},image:{id:"Image",icon:"e-image",tooltip:"Insert Image",command:"Images",subCommand:"Image"},audio:{id:"Audio",icon:"e-audio",tooltip:"Insert Audio",command:"Audios",subCommand:"Audio"},video:{id:"Video",icon:"e-video",tooltip:"Insert Video",command:"Videos",subCommand:"Video"},filemanager:{id:"FileManager",icon:"e-rte-file-manager",tooltip:"File Manager",command:"Files",subCommand:"File"},createtable:{id:"CreateTable",icon:"e-create-table",tooltip:"Create Table",command:"Table",subCommand:"CreateTable"},removetable:{id:"removeTable",icon:"e-remove-table",tooltip:"Remove Table",command:"removeTable",subCommand:"removeTable"},replace:{id:"Replace",icon:"e-replace",tooltip:"Replace",command:"Images",subCommand:"Replace"},audioreplace:{id:"AudioReplace",icon:"e-audio-replace",tooltip:"Audio Replace",command:"Audios",subCommand:"AudioReplace"},audioremove:{id:"AudioRemove",icon:"e-audio-remove",tooltip:"Audio Remove",command:"Audios",subCommand:"AudioRemove"},audiolayoutoption:{id:"AudioLayoutOption",icon:"e-audio-display",tooltip:"Audio LayoutOption",command:"Audios",subCommand:"AudioLayoutOption"},videoreplace:{id:"VideoReplace",icon:"e-video-replace",tooltip:"Video Replace",command:"Videos",subCommand:"VideoReplace"},videoalign:{id:"VideoAlign",icon:"e-video-align",tooltip:"Video Align",command:"Videos",subCommand:"VideoAlign"},videoremove:{id:"VideoRemove",icon:"e-video-remove",tooltip:"Video Remove",command:"Videos",subCommand:"VideoRemove"},videolayoutoption:{id:"VideoLayoutOption",icon:"e-video-display",tooltip:"Video LayoutOption",command:"Videos",subCommand:"VideoLayoutOption"},videodimension:{id:"VideoDimension",icon:"e-video-dimension",tooltip:"Video Dimension",command:"Videos",subCommand:"VideoDimension"},align:{id:"Align",icon:"e-align",tooltip:"Align",command:"Images",subCommand:"Align"},caption:{id:"Caption",icon:"e-caption",tooltip:"Image Caption",command:"Images",subCommand:"Caption"},remove:{id:"Remove",icon:"e-remove",tooltip:"Remove",command:"Images",subCommand:"Remove"},openimagelink:{id:"OpenImageLink",icon:"e-open-link",tooltip:"Open Link",command:"Images",subCommand:"OpenImageLink"},editimagelink:{id:"EditImageLink",icon:"e-edit-link",tooltip:"Edit Link",command:"Images",subCommand:"EditImageLink"},removeimagelink:{id:"RemoveImageLink",icon:"e-remove-link",tooltip:"Remove Link",command:"Images",subCommand:"RemoveImageLink"},insertlink:{id:"InsertLink",icon:"e-insert-link",tooltip:"Insert Link",command:"Images",subCommand:"InsertLink"},display:{id:"Display",icon:"e-display",tooltip:"Display",command:"Images",subCommand:"Display"},alttext:{id:"AltText",icon:"e-alt-text",tooltip:"Alternative Text",command:"Images",subCommand:"AltText"},dimension:{id:"Dimension",icon:"e-img-dimension",tooltip:"Change Size",command:"Images",subCommand:"Dimension"},fullscreen:{id:"Maximize",icon:"e-maximize",tooltip:"Maximize",command:"View",subCommand:"Maximize"},maximize:{id:"Maximize",icon:"e-maximize",tooltip:"Maximize",command:"FullScreen",subCommand:"Maximize"},minimize:{id:"Minimize",icon:"e-minimize",tooltip:"Minimize",command:"FullScreen",subCommand:"Minimize"},lowercase:{id:"LowerCase",icon:"e-lower-case",tooltip:"Lower Case",command:"Casing",subCommand:"LowerCase"},uppercase:{id:"UpperCase",icon:"e-upper-case",tooltip:"Upper Case",command:"Casing",subCommand:"UpperCase"},print:{id:"Print",icon:"e-print",tooltip:"Print",command:"Print",subCommand:"Print"},formats:{id:"Formats",icon:"e-formats",tooltip:"Formats",command:"Formats",subCommand:"Formats"},sourcecode:{id:"SourceCode",icon:"e-source-code",tooltip:"Code View (Ctrl+Shift+H)",command:"SourceCode",subCommand:"SourceCode"},preview:{id:"Preview",icon:"e-preview",tooltip:"Preview (Ctrl+Shift+H)",command:"Preview",subCommand:"Preview"},viewside:{id:"ViewSide",icon:"e-view-side",tooltip:"ViewSide",command:"ViewSide",subCommand:"ViewSide"},insertcode:{id:"InsertCode",icon:"e-preformat-code",tooltip:"Insert Code",command:"Formats",subCommand:"Pre"},blockquote:{id:"Blockquote",icon:"e-blockquote",tooltip:"Blockquote",command:"Formats",subCommand:"blockquote"},tableheader:{id:"TableHeader",icon:"e-table-header",tooltip:"Table Header",command:"Table",subCommand:"TableHeader"},tableremove:{id:"TableRemove",icon:"e-table-remove",tooltip:"Table Remove",command:"Table",subCommand:"TableRemove"},tablerows:{id:"TableRows",icon:"e-table-rows",tooltip:"Table Rows",command:"Table",subCommand:"TableRows"},tablecolumns:{id:"TableColumns",icon:"e-table-columns",tooltip:"Table Columns",command:"Table",subCommand:"TableColumns"},tablecell:{id:"TableCell",icon:"e-table-cell",tooltip:"Table Cell",command:"Table",subCommand:"TableCell"},tablecellbackground:{id:"TableCellBackground",icon:"e-table-cell-background",tooltip:"Table Cell Background",command:"Table",subCommand:"TableCellBackground"},tablecellhorizontalalign:{id:"TableCellHorizontalAlign",icon:"e-table-cell-horizontalAlign",tooltip:"Table Cell HorizontalAlign",command:"Table",subCommand:"TableCellHorizontalAlign"},tablecellverticalalign:{id:"TableCellVerticalAlign",icon:"e-table-cell-verticalAlign",tooltip:"Table Cell VerticalAlign",command:"Table",subCommand:"TableCellVerticalAlign"},tableeditproperties:{id:"TableEditProperties",icon:"e-table-edit-properties",tooltip:"Table Edit Properties",command:"Table",subCommand:"TableEditProperties"},styles:{id:"Styles",icon:"e-table-styles",tooltip:"Styles",command:"Table",subCommand:"Styles"},formatpainter:{id:"FormatPainter",icon:"e-rte-format-painter",tooltip:"Format Painter",command:"FormatPainter",subCommand:"FormatPainter"},emojipicker:{id:"EmojiPicker",icon:"e-emoji",tooltip:"Emoji Icon",command:"EmojiPicker",subCommand:"EmojiPicker"},inlinecode:{id:"inlineCode",icon:"e-inline-code",tooltip:"inlineCode",command:"Style",subCommand:"InlineCode"}},Mo=[{locale:"alignmentsDropDownLeft",value:"JustifyLeft"},{locale:"alignmentsDropDownCenter",value:"JustifyCenter"},{locale:"alignmentsDropDownRight",value:"JustifyRight"},{locale:"alignmentsDropDownJustify",value:"JustifyFull"}],Bo=[{iconCss:"e-icons e-justify-left",text:"Align Left",command:"Alignments",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",text:"Align Center",command:"Alignments",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",text:"Align Right",command:"Alignments",subCommand:"JustifyRight"},{iconCss:"e-icons e-justify-full",text:"Align Justify",command:"Alignments",subCommand:"JustifyFull"}],Ro=[{iconCss:"e-icons e-justify-left",command:"Images",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",command:"Images",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",command:"Images",subCommand:"JustifyRight"}],Ao=[{iconCss:"e-icons e-justify-left",command:"Videos",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",command:"Videos",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",command:"Videos",subCommand:"JustifyRight"}],Io=[{locale:"imageDisplayDropDownInline",value:"Inline"},{locale:"imageDisplayDropDownBreak",value:"Break"}],Uo=[{locale:"audioLayoutOptionDropDownInline",value:"Inline"},{locale:"audioLayoutOptionDropDownBreak",value:"Break"}],Po=[{locale:"videoLayoutOptionDropDownInline",value:"Inline"},{locale:"videoLayoutOptionDropDownBreak",value:"Break"}],Ho=[{text:"Inline",cssClass:"e-inline",command:"Images",subCommand:"Inline"},{text:"Break",cssClass:"e-break",command:"Images",subCommand:"Break"}],jo=[{text:"Inline",cssClass:"e-audio-inline",command:"Audios",subCommand:"Inline"},{text:"Break",cssClass:"e-audio-break",command:"Audios",subCommand:"Break"}],Fo=[{text:"Inline",cssClass:"e-video-inline",command:"Videos",subCommand:"Inline"},{text:"Break",cssClass:"e-video-break",command:"Videos",subCommand:"Break"}],qo=[{iconCss:"e-icons e-cell-merge",text:"Merge cells",command:"Table",subCommand:"Merge"},{iconCss:"e-icons e-cell-horizontal-split",text:"Horizontal split",command:"Table",subCommand:"HorizontalSplit"},{iconCss:"e-icons e-cell-vertical-split",text:"Vertical split",command:"Table",subCommand:"VerticalSplit"}],zo=[{locale:"tableInsertRowDropDownBefore",value:"InsertRowBefore"},{locale:"tableInsertRowDropDownAfter",value:"InsertRowAfter"},{locale:"tableInsertRowDropDownDelete",value:"DeleteRow"}],_o=[{iconCss:"e-icons e-insert-row-before",text:"Insert row before",command:"Table",subCommand:"InsertRowBefore"},{iconCss:"e-icons e-insert-row-after",text:"Insert row after",command:"Table",subCommand:"InsertRowAfter"},{iconCss:"e-icons e-delete-row",text:"Delete row",command:"Table",subCommand:"DeleteRow"}],Vo=[{locale:"tableInsertColumnDropDownLeft",value:"InsertColumnLeft"},{locale:"tableInsertColumnDropDownRight",value:"InsertColumnRight"},{locale:"tableInsertColumnDropDownDelete",value:"DeleteColumn"}],Qo=[{iconCss:"e-icons e-insert-column-left",text:"Insert column left",command:"Table",subCommand:"InsertColumnLeft"},{iconCss:"e-icons e-insert-column-right",text:"Insert column right",command:"Table",subCommand:"InsertColumnRight"},{iconCss:"e-icons e-delete-column",text:"Delete column",command:"Table",subCommand:"DeleteColumn"}],Wo=[{locale:"tableVerticalAlignDropDownTop",value:"AlignTop"},{locale:"tableVerticalAlignDropDownMiddle",value:"AlignMiddle"},{locale:"tableVerticalAlignDropDownBottom",value:"AlignBottom"}],Ko=[{iconCss:"e-icons e-align-top",text:"Align Top",command:"Table",subCommand:"AlignTop"},{iconCss:"e-icons e-align-middle",text:"Align Middle",command:"Table",subCommand:"AlignMiddle"},{iconCss:"e-icons e-align-bottom",text:"Align Bottom",command:"Table",subCommand:"AlignBottom"}],Go=[{locale:"tableStylesDropDownDashedBorder",value:"Dashed"},{locale:"tableStylesDropDownAlternateRows",value:"Alternate"}],Xo=[{text:"Dashed Borders",cssClass:"e-dashed-borders",command:"Table",subCommand:"Dashed"},{text:"Alternate Rows",cssClass:"e-alternate-rows",command:"Table",subCommand:"Alternate"}],e=["Bold","Italic","Underline","|","Formats","Alignments","Blockquote","OrderedList","UnorderedList","|","CreateLink","Image","|","SourceCode","Undo","Redo"],Yo=[{cssClass:"e-default",text:"Default",command:"Font",subCommand:"FontName",value:""},{cssClass:"e-segoe-ui",text:"Segoe UI",command:"Font",subCommand:"FontName",value:"Segoe UI"},{cssClass:"e-arial",text:"Arial",command:"Font",subCommand:"FontName",value:"Arial,Helvetica,sans-serif"},{cssClass:"e-georgia",text:"Georgia",command:"Font",subCommand:"FontName",value:"Georgia,serif"},{cssClass:"e-impact",text:"Impact",command:"Font",subCommand:"FontName",value:"Impact,Charcoal,sans-serif"},{cssClass:"e-tahoma",text:"Tahoma",command:"Font",subCommand:"FontName",value:"Tahoma,Geneva,sans-serif"},{cssClass:"e-times-new-roman",text:"Times New Roman",command:"Font",subCommand:"FontName",value:"Times New Roman,Times,serif"},{cssClass:"e-verdana",text:"Verdana",command:"Font",subCommand:"FontName",value:"Verdana,Geneva,sans-serif"}],Jo=[{text:"Default",value:""},{text:"8 pt",value:"8pt"},{text:"10 pt",value:"10pt"},{text:"12 pt",value:"12pt"},{text:"14 pt",value:"14pt"},{text:"18 pt",value:"18pt"},{text:"24 pt",value:"24pt"},{text:"36 pt",value:"36pt"}],$o=[{cssClass:"e-paragraph",text:"Paragraph",command:"Formats",subCommand:"P",value:"P"},{cssClass:"e-h1",text:"Heading 1",command:"Formats",subCommand:"H1",value:"H1"},{cssClass:"e-h2",text:"Heading 2",command:"Formats",subCommand:"H2",value:"H2"},{cssClass:"e-h3",text:"Heading 3",command:"Formats",subCommand:"H3",value:"H3"},{cssClass:"e-h4",text:"Heading 4",command:"Formats",subCommand:"H4",value:"H4"},{cssClass:"e-code",text:"preformatted",command:"Formats",subCommand:"Pre",value:"Pre"}],Zo={Custom:["","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},er={Custom:["","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},tr=[{text:"None",command:"Lists",subCommand:"NumberFormatList",value:"none"},{text:"Number",command:"Lists",subCommand:"NumberFormatList",value:"decimal"},{text:"Lower Greek",command:"Lists",subCommand:"NumberFormatList",value:"lowerGreek"},{text:"Lower Roman",command:"Lists",subCommand:"NumberFormatList",value:"lowerRoman"},{text:"Upper Alpha",command:"Lists",subCommand:"NumberFormatList",value:"upperAlpha"},{text:"Lower Alpha",command:"Lists",subCommand:"NumberFormatList",value:"lowerAlpha"},{text:"Upper Roman",command:"Lists",subCommand:"NumberFormatList",value:"upperRoman"}],nr=[{text:"None",command:"Lists",subCommand:"BulletFormatList",value:"none"},{text:"Disc",command:"Lists",subCommand:"BulletFormatList",value:"disc"},{text:"Circle",command:"Lists",subCommand:"BulletFormatList",value:"circle"},{text:"Square",command:"Lists",subCommand:"BulletFormatList",value:"square"}];function ir(e,t,n){for(var i=0;t.length>i;i++)if(t[i].value===n.subCommand)return e.localeObj.getConstant(t[i].locale);return n.text}var or={"Insert Link":"Ctrl+K","Insert Image":"Ctrl+Shift+I","Create Table":"Ctrl+Shift+E",Undo:"Ctrl+Z",Redo:"Ctrl+Y",Copy:"Ctrl+C",Cut:"Ctrl+X",Paste:"Ctrl+V",Bold:"Ctrl+B",Italic:"Ctrl+I",Underline:"Ctrl+U",Strikethrough:"Ctrl+Shift+S","Upper Case":"Ctrl+Shift+U","Lower Case":"Ctrl+Shift+L",Superscript:"Ctrl+Shift+=",Subscript:"Ctrl+=","Code View":"Ctrl+Shift+H",Maximize:"Ctrl+Shift+F",Minimize:"Esc","Clear Format":"Ctrl+Shift+R","Numbered List":"Ctrl+Shift+O","Bulleted List":"Ctrl+Alt+O","Number Format List":"Ctrl+Shift+O","Bullet Format List":"Ctrl+Alt+O","Insert Audio":"Ctrl+Shift+A","Insert Video":"Ctrl+Alt+V","Increase Indent":"Ctrl+]","Decrease Indent":"Ctrl+[","Decrease Fontsize":"Ctrl+Shift+<","Increase Fontsize":"Ctrl+Shift+>","Justify Center":"Ctrl+E","Justify Full":"Ctrl+J","Justify Left":"Ctrl+L","Justify Right":"Ctrl+R","Format Painter":"Alt+Shift+C, Alt+Shift+V",inlineCode:"ctrl+`"},rr=[{name:"Smilies & People",code:"1F600",iconCss:"e-emoji",icons:[{code:"1F600",desc:"Grinning face"},{code:"1F603",desc:"Grinning face with big eyes"},{code:"1F604",desc:"Grinning face with smiling eyes"},{code:"1F606",desc:"Grinning squinting face"},{code:"1F605",desc:"Grinning face with sweat"},{code:"1F602",desc:"Face with tears of joy"},{code:"1F923",desc:"Rolling on the floor laughing"},{code:"1F60A",desc:"Smiling face with smiling eyes"},{code:"1F607",desc:"Smiling face with halo"},{code:"1F642",desc:"Slightly smiling face"},{code:"1F643",desc:"Upside-down face"},{code:"1F60D",desc:"Smiling face with heart-eyes"},{code:"1F618",desc:"Face blowing a kiss"},{code:"1F61B",desc:"Face with tongue"},{code:"1F61C",desc:"Winking face with tongue"},{code:"1F604",desc:"Grinning face with smiling eyes"},{code:"1F469",desc:"Woman"},{code:"1F468",desc:"Man"},{code:"1F467",desc:"Girl"},{code:"1F466",desc:"Boy"},{code:"1F476",desc:"Baby"},{code:"1F475",desc:"Old woman"},{code:"1F474",desc:"Old man"},{code:"1F46E",desc:"Police officer"},{code:"1F477",desc:"Construction worker"},{code:"1F482",desc:"Guard"},{code:"1F575",desc:"Detective"},{code:"1F9D1",desc:"Cook"}]},{name:"Animals & Nature",code:"1F435",iconCss:"e-animals",icons:[{code:"1F436",desc:"Dog face"},{code:"1F431",desc:"Cat face"},{code:"1F42D",desc:"Mouse face"},{code:"1F439",desc:"Hamster face"},{code:"1F430",desc:"Rabbit face"},{code:"1F98A",desc:"Fox face"},{code:"1F43B",desc:"Bear face"},{code:"1F43C",desc:"Panda face"},{code:"1F428",desc:"Koala"},{code:"1F42F",desc:"Tiger face"},{code:"1F981",desc:"Lion face"},{code:"1F42E",desc:"Cow face"},{code:"1F437",desc:"Pig face"},{code:"1F43D",desc:"Pig nose"},{code:"1F438",desc:"Frog face"},{code:"1F435",desc:"Monkey face"},{code:"1F649",desc:"Hear-no-evil monkey"},{code:"1F64A",desc:"Speak-no-evil monkey"},{code:"1F412",desc:"Monkey"},{code:"1F414",desc:"Chicken"},{code:"1F427",desc:"Penguin"},{code:"1F426",desc:"Bird"},{code:"1F424",desc:"Baby chick"},{code:"1F986",desc:"Duck"},{code:"1F985",desc:"Eagle"}]},{name:"Food & Drink",code:"1F347",iconCss:"e-food-and-drinks",icons:[{code:"1F34E",desc:"Red apple"},{code:"1F34C",desc:"Banana"},{code:"1F347",desc:"Grapes"},{code:"1F353",desc:"Strawberry"},{code:"1F35E",desc:"Bread"},{code:"1F950",desc:"Croissant"},{code:"1F955",desc:"Carrot"},{code:"1F354",desc:"Hamburger"},{code:"1F355",desc:"Pizza"},{code:"1F32D",desc:"Hot dog"},{code:"1F35F",desc:"French fries"},{code:"1F37F",desc:"Popcorn"},{code:"1F366",desc:"Soft ice cream"},{code:"1F367",desc:"Shaved ice"},{code:"1F36A",desc:"Cookie"},{code:"1F382",desc:"Birthday cake"},{code:"1F370",desc:"Shortcake"},{code:"1F36B",desc:"Chocolate bar"},{code:"1F369",desc:"Donut"},{code:"1F36E",desc:"Custard"},{code:"1F36D",desc:"Lollipop"},{code:"1F36C",desc:"Candy"},{code:"1F377",desc:"Wine glass"},{code:"1F37A",desc:"Beer mug"},{code:"1F37E",desc:"Bottle with popping cork"}]},{name:"Activities",code:"1F383",iconCss:"e-activities",icons:[{code:"26BD",desc:"Soccer ball"},{code:"1F3C0",desc:"Basketball"},{code:"1F3C8",desc:"American football"},{code:"26BE",desc:"Baseball"},{code:"1F3BE",desc:"Tennis"},{code:"1F3D0",desc:"Volleyball"},{code:"1F3C9",desc:"Rugby football"},{code:"1F3B1",desc:"Pool 8 ball"},{code:"1F3D3",desc:"Ping pong"},{code:"1F3F8",desc:"Badminton"},{code:"1F94A",desc:"Boxing glove"},{code:"1F3CA",desc:"Swimmer"},{code:"1F3CB",desc:"Weightlifter"},{code:"1F6B4",desc:"Bicyclist"},{code:"1F6F9",desc:"Skateboard"},{code:"1F3AE",desc:"Video game"},{code:"1F579",desc:"Joystick"},{code:"1F3CF",desc:"Cricket"},{code:"1F3C7",desc:"Horse racing"},{code:"1F3AF",desc:"Direct hit"},{code:"1F3D1",desc:"Field hockey"},{code:"1F3B0",desc:"Slot machine"},{code:"1F3B3",desc:"Bowling"},{code:"1F3B2",desc:"Game die"},{code:"265F",desc:"Chess pawn"}]},{name:"Travel & Places",code:"1F30D",iconCss:"e-travel-and-places",icons:[{code:"2708",desc:"Airplane"},{code:"1F697",desc:"Automobile"},{code:"1F695",desc:"Taxi"},{code:"1F6B2",desc:"Bicycle"},{code:"1F68C",desc:"Bus"},{code:"1F682",desc:"Locomotive"},{code:"1F6F3",desc:"Passenger ship"},{code:"1F680",desc:"Rocket"},{code:"1F681",desc:"Helicopter"},{code:"1F6A2",desc:"Ship"},{code:"1F3DF",desc:"Stadium"},{code:"1F54C",desc:"Mosque"},{code:"26EA",desc:"Church"},{code:"1F6D5",desc:"Hindu Temple"},{code:"1F3D4",desc:"Snow-capped mountain"},{code:"1F3EB",desc:"School"},{code:"1F30B",desc:"Volcano"},{code:"1F3D6",desc:"Beach with umbrella"},{code:"1F3DD",desc:"Desert island"},{code:"1F3DE",desc:"National park"},{code:"1F3F0",desc:"Castle"},{code:"1F5FC",desc:"Tokyo tower"},{code:"1F5FD",desc:"Statue of liberty"},{code:"26E9",desc:"Shinto shrine"},{code:"1F3EF",desc:"Japanese castle"},{code:"1F3A2",desc:"Roller coaster"}]},{name:"Objects",code:"1F507",iconCss:"e-objects",icons:[{code:"1F4A1",desc:"Light bulb"},{code:"1F526",desc:"Flashlight"},{code:"1F4BB",desc:"Laptop computer"},{code:"1F5A5",desc:"Desktop computer"},{code:"1F5A8",desc:"Printer"},{code:"1F4F7",desc:"Camera"},{code:"1F4F8",desc:"Camera with flash"},{code:"1F4FD",desc:"Film projector"},{code:"1F3A5",desc:"Movie camera"},{code:"1F4FA",desc:"Television"},{code:"1F4FB",desc:"Radio"},{code:"1F50B",desc:"Battery"},{code:"231A",desc:"Watch"},{code:"1F4F1",desc:"Mobile phone"},{code:"260E",desc:"Telephone"},{code:"1F4BE",desc:"Floppy disk"},{code:"1F4BF",desc:"Optical disk"},{code:"1F4C0",desc:"Digital versatile disc"},{code:"1F4BD",desc:"Computer disk"},{code:"1F3A7",desc:"Headphone"},{code:"1F3A4",desc:"Microphone"},{code:"1F3B6",desc:"Multiple musical notes"},{code:"1F4DA",desc:"Books"}]},{name:"Symbols",code:"1F3E7",iconCss:"e-symbols",icons:[{code:"274C",desc:"Cross mark"},{code:"2714",desc:"Check mark"},{code:"26A0",desc:"Warning sign"},{code:"1F6AB",desc:"Prohibited"},{code:"2139",desc:"Information"},{code:"267B",desc:"Recycling symbol"},{code:"1F6AD",desc:"No smoking"},{code:"1F4F5",desc:"No mobile phones"},{code:"1F6AF",desc:"No littering"},{code:"1F6B3",desc:"No bicycles"},{code:"1F6B7",desc:"No pedestrians"},{code:"2795",desc:"Plus"},{code:"2796",desc:"Minus"},{code:"2797",desc:"Divide"},{code:"2716",desc:"Multiplication"},{code:"1F4B2",desc:"Dollar banknote"},{code:"1F4AC",desc:"Speech balloon"},{code:"2755",desc:"White exclamation mark"},{code:"2754",desc:"White question mark"},{code:"2764",desc:"Heart"}]}],sr={alignments:"Alignments",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",fontName:"Font Name",fontSize:"Font Size",fontColor:"Font Color",backgroundColor:"Background Color",importWord:"Import from Word",exportWord:"Export to Word",exportPdf:"Export to PDF",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",clearFormat:"Clear Format",clearAll:"Clear All",cut:"Cut",copy:"Copy",paste:"Paste",unorderedList:"Bulleted List",orderedList:"Numbered List",indent:"Increase Indent",outdent:"Decrease Indent",undo:"Undo",redo:"Redo",superscript:"Superscript",subscript:"Subscript",createLink:"Insert Link",openLink:"Open Link",editLink:"Edit Link",removeLink:"Remove Link",image:"Insert Image",audio:"Insert Audio",video:"Insert Video",replace:"Replace",numberFormatList:"Number Format List",bulletFormatList:"Bullet Format List",audioReplace:"Replace",videoReplace:"Replace",videoAlign:"Align",videoDimension:"Dimension",audioRemove:"Remove",videoRemove:"Remove",audioLayoutOption:"Layout option",videoLayoutOption:"Layout option",align:"Align",caption:"Caption",remove:"Remove",insertLink:"Insert Link",display:"Display",altText:"Alternative text",dimension:"Change Size",fullscreen:"Maximize",maximize:"Maximize",minimize:"Minimize",lowerCase:"Lower Case",upperCase:"Upper Case",print:"Print",formats:"Formats",sourcecode:"Code View",preview:"Preview",viewside:"ViewSide",insertCode:"Insert Code",blockquote:"Blockquote",linkText:"Display text",linkTooltipLabel:"Title",linkWebUrl:"Web address",linkTitle:"Enter a title",linkurl:"https://example.com",linkOpenInNewWindow:"Open link in new window",linkHeader:"Insert Link",dialogInsert:"Insert",dialogCancel:"Cancel",dialogUpdate:"Update",imageHeader:"Insert Image",audioHeader:"Insert Audio",videoHeader:"Insert Video",imageLinkHeader:"You can also provide a link from the web",audioLinkHeader:"You can also provide a link from the web",videoLinkHeader:"Web URL",embedVideoLinkHeader:"Media Embed URL",mdimageLink:"Please provide a URL for your image",imageUploadMessage:"Drop image here or browse to upload",audioUploadMessage:"Drop an audio file or browse to upload",videoUploadMessage:"Drop a video file or browse to upload",imageDeviceUploadMessage:"Click here to upload",audioDeviceUploadMessage:"Click here to upload",videoDeviceUploadMessage:"Click here to upload",imageAlternateText:"Alternate Text",alternateHeader:"Alternative Text",browse:"Browse",imageUrl:"https://example.com/image.png",audioUrl:"https://example.com/audio.mp3",videoUrl:"https://example.com/video.mp4",webUrl:"Web URL",embedUrl:"Embed Code",imageCaption:"Caption",imageSizeHeader:"Image Size",videoSizeHeader:"Video Size",imageHeight:"Height",imageWidth:"Width",videoHeight:"Height",videoWidth:"Width",textPlaceholder:"Enter text",inserttablebtn:"Insert Table",tabledialogHeader:"Insert Table",tableWidth:"Width",cellpadding:"Cell Padding",cellspacing:"Cell Spacing",columns:"Number of columns",rows:"Number of rows",tableRows:"Row",tableColumns:"Column",tableCellHorizontalAlign:"Table Cell Horizontal Align",tableCellVerticalAlign:"Vertical Align",createTable:"Create Table",removeTable:"Remove Table",tableHeader:"Header Row",tableRemove:"Delete Table",tableCellBackground:"Table Cell Background",tableEditProperties:"Table Edit Properties",styles:"Styles",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteColumn:"Delete Column",insertRowBefore:"Insert Row Before",insertRowAfter:"Insert Row After",deleteRow:"Delete Row",tableEditHeader:"Edit Table",TableHeadingText:"Heading",TableColText:"Col",imageInsertLinkHeader:"Insert Link",editImageHeader:"Edit Image",editAudioHeader:"Edit Audio",editVideoHeader:"Edit Video",alignmentsDropDownLeft:"Align Left",alignmentsDropDownCenter:"Align Center",alignmentsDropDownRight:"Align Right",alignmentsDropDownJustify:"Align Justify",imageDisplayDropDownInline:"Inline",imageDisplayDropDownBreak:"Break",audioLayoutOptionDropDownInline:"Inline",audioLayoutOptionDropDownBreak:"Break",videoLayoutOptionDropDownInline:"Inline",videoLayoutOptionDropDownBreak:"Break",tableInsertRowDropDownBefore:"Insert row before",tableInsertRowDropDownAfter:"Insert row after",tableInsertRowDropDownDelete:"Delete row",tableInsertColumnDropDownLeft:"Insert column left",tableInsertColumnDropDownRight:"Insert column right",tableInsertColumnDropDownDelete:"Delete column",tableVerticalAlignDropDownTop:"Align Top",tableVerticalAlignDropDownMiddle:"Align Middle",tableVerticalAlignDropDownBottom:"Align Bottom",tableStylesDropDownDashedBorder:"Dashed Borders",tableStylesDropDownAlternateRows:"Alternate Rows",pasteFormat:"Paste Format",pasteFormatContent:"Choose the formatting action",plainText:"Plain Text",cleanFormat:"Clean",keepFormat:"Keep",pasteDialogOk:"OK",pasteDialogCancel:"Cancel",fileManager:"File Manager",fileDialogHeader:"File Browser",formatsDropDownParagraph:"Paragraph",formatsDropDownCode:"Preformatted",formatsDropDownQuotation:"Blockquote",formatsDropDownHeading1:"Heading 1",formatsDropDownHeading2:"Heading 2",formatsDropDownHeading3:"Heading 3",formatsDropDownHeading4:"Heading 4",fontNameSegoeUI:"Segoe UI",fontNameArial:"Arial",fontNameGeorgia:"Georgia",fontNameImpact:"Impact",fontNameTahoma:"Tahoma",fontNameTimesNewRoman:"Times New Roman",fontNameVerdana:"Verdana",numberFormatListNumber:"Number",numberFormatListLowerAlpha:"Lower Alpha",numberFormatListUpperAlpha:"Upper Alpha",numberFormatListLowerRoman:"Lower Roman",numberFormatListUpperRoman:"Upper Roman",numberFormatListLowerGreek:"Lower Greek",bulletFormatListDisc:"Disc",bulletFormatListCircle:"Circle",bulletFormatListSquare:"Square",numberFormatListNone:"None",bulletFormatListNone:"None",formatPainter:"Format Painter",emojiPicker:"Emoji Picker",embeddedCode:"Embedded code",pasteEmbeddedCodeHere:"Paste embedded code here",emojiPickerTypeToFind:"Type to find",emojiPickerNoResultFound:"No results found",emojiPickerTrySomethingElse:"Try something else",linkAriaLabel:"Open in new window",unsupportedImage:"Unsupported file format",mergecells:"Merge cells",verticalsplit:"Vertical split",horizontalsplit:"Horizontal split",inlinecode:"Inline Code",slashMenuItemHeadingOneText:"Heading 1",slashMenuItemHeadingOneDescription:"Use this for a top level heading or title.",slashMenuItemHeadingTwoText:"Heading 2",slashMenuItemHeadingTwoDescription:"Use this for key sections.",slashMenuItemHeadingThreeText:"Heading 3",slashMenuItemHeadingThreeDescription:"Use this for sub sections and group headings.",slashMenuItemHeadingFourText:"Heading 4",slashMenuItemHeadingFourDescription:"Use this for the key points of the sub topics.",slashMenuItemParagraphText:"Paragraph",slashMenuItemParagraphDescription:"Writing with paragraphs.",slashMenuItemBlockquoteText:"Blockquote",slashMenuItemBlockquoteDescription:"Create a quote or citation.",slashMenuItemOrderedListText:"Ordered List",slashMenuItemOrderedListDescription:"Create an ordered list.",slashMenuItemUnorderedListText:"Unordered List",slashMenuItemUnorderedListDescription:"Create an unordered list.",slashMenuItemCodeText:"CodeBlock",slashMenuItemCodeDescription:"Create a preformatted code block.",slashMenuItemTableText:"Table",slashMenuItemTableDescription:"Insert a table.",slashMenuItemLinkText:"Link",slashMenuItemLinkDescription:"Insert a link.",slashMenuItemImageText:"Image",slashMenuItemImageDescription:"Insert an image.",slashMenuItemAudioText:"Audio",slashMenuItemAudioDescription:"Insert an audio.",slashMenuItemVideoText:"Video",slashMenuItemVideoDescription:"Insert a video.",slashMenuItemEmojiText:"Emojipicker",slashMenuItemEmojiDescription:"Use emojis to express ideas and emoticons."},ar={alignments:"alignments",justifyleft:"justifyLeft",justifycenter:"justifyCenter",justifyright:"justifyRight",justifyfull:"justifyFull",fontname:"fontName",fontsize:"fontSize",fontcolor:"fontColor",backgroundcolor:"backgroundColor",importword:"importWord",exportword:"exportWord",exportpdf:"exportPdf",bold:"bold",italic:"italic",underline:"underline",strikethrough:"strikethrough",clearformat:"clearFormat",clearall:"clearAll",cut:"cut",copy:"copy",paste:"paste",unorderedlist:"unorderedList",orderedlist:"orderedList",indent:"indent",outdent:"outdent",numberformatlist:"numberFormatList",bulletformatlist:"bulletFormatList",undo:"undo",redo:"redo",filemanager:"fileManager",superscript:"superscript",subscript:"subscript",createlink:"createLink",openlink:"openLink",editlink:"editLink",removelink:"removeLink",openimagelink:"openLink",editimagelink:"editLink",removeimagelink:"removeLink",image:"image",audio:"audio",video:"video",replace:"replace",audioreplace:"audioReplace",videoreplace:"videoReplace",videoalign:"videoAlign",videodimension:"videoDimension",audioremove:"audioRemove",videoremove:"videoRemove",audiolayoutoption:"audioLayoutOption",videolayoutoption:"videoLayoutOption",align:"align",caption:"caption",remove:"remove",insertlink:"insertLink",display:"display",alttext:"alternateHeader",dimension:"dimension",fullscreen:"fullscreen",maximize:"maximize",minimize:"minimize",lowercase:"lowerCase",uppercase:"upperCase",print:"print",formats:"formats",sourcecode:"sourcecode",preview:"preview",viewside:"viewside",insertcode:"insertCode",blockquote:"blockquote",tablerows:"tableRows",tablecolumns:"tableColumns",tablecellhorizontalalign:"tableCellHorizontalAlign",tablecellverticalalign:"tableCellVerticalAlign",createtable:"createTable",removetable:"removeTable",tableheader:"tableHeader",tableremove:"tableRemove",tablecellbackground:"tableCellBackground",tableeditproperties:"tableEditProperties",styles:"styles",insertcolumnleft:"insertColumnLeft",insertcolumnright:"insertColumnRight",deletecolumn:"deleteColumn",aligntop:"AlignTop",alignmiddle:"AlignMiddle",alignbottom:"AlignBottom",insertrowbefore:"insertRowBefore",insertrowafter:"insertRowAfter",deleterow:"deleteRow",formatpainter:"formatPainter",emojipicker:"emojiPicker",embeddedCode:"Embedded code",pasteEmbeddedCodeHere:"Paste embedded code here",emojiPickerTypeToFind:"Type to find",emojiPickerNoResultFound:"No results found",emojiPickerTrySomethingElse:"Try something else",imageLinkAriaLabel:"Open in new window",inlinecode:"inlinecode"},lr=[{locale:"fontNameSegoeUI",value:"Segoe UI"},{locale:"fontNameArial",value:"Arial,Helvetica,sans-serif"},{locale:"fontNameGeorgia",value:"Georgia,serif"},{locale:"fontNameImpact",value:"Impact,Charcoal,sans-serif"},{locale:"fontNameTahoma",value:"Tahoma,Geneva,sans-serif"},{locale:"fontNameTimesNewRoman",value:"Times New Roman,Times,serif"},{locale:"fontNameVerdana",value:"Verdana,Geneva,sans-serif"}],dr=[{locale:"formatsDropDownParagraph",value:"P"},{locale:"formatsDropDownCode",value:"Pre"},{locale:"formatsDropDownHeading1",value:"H1"},{locale:"formatsDropDownHeading2",value:"H2"},{locale:"formatsDropDownHeading3",value:"H3"},{locale:"formatsDropDownHeading4",value:"H4"}],cr=[{locale:"numberFormatListNone",value:"none"},{locale:"numberFormatListNumber",value:"decimal"},{locale:"numberFormatListLowerAlpha",value:"lower-alpha"},{locale:"numberFormatListUpperAlpha",value:"upper-alpha"},{locale:"numberFormatListLowerRoman",value:"lower-roman"},{locale:"numberFormatListUpperRoman",value:"upper-roman"},{locale:"numberFormatListLowerGreek",value:"lower-greek"}],hr=[{locale:"bulletFormatListNone",value:"none"},{locale:"bulletFormatListDisc",value:"disc"},{locale:"bulletFormatListCircle",value:"circle"},{locale:"bulletFormatListSquare",value:"square"}],pr=new Map([["Heading 1",{text:"slashMenuItemHeadingOneText",description:"slashMenuItemHeadingOneDescription"}],["Heading 2",{text:"slashMenuItemHeadingTwoText",description:"slashMenuItemHeadingTwoDescription"}],["Heading 3",{text:"slashMenuItemHeadingThreeText",description:"slashMenuItemHeadingThreeDescription"}],["Heading 4",{text:"slashMenuItemHeadingFourText",description:"slashMenuItemHeadingFourDescription"}],["Paragraph",{text:"slashMenuItemParagraphText",description:"slashMenuItemParagraphDescription"}],["Blockquote",{text:"slashMenuItemBlockquoteText",description:"slashMenuItemBlockquoteDescription"}],["OrderedList",{text:"slashMenuItemOrderedListText",description:"slashMenuItemOrderedListDescription"}],["UnorderedList",{text:"slashMenuItemUnorderedListText",description:"slashMenuItemUnorderedListDescription"}],["CodeBlock",{text:"slashMenuItemCodeText",description:"slashMenuItemCodeDescription"}],["Table",{text:"slashMenuItemTableText",description:"slashMenuItemTableDescription"}],["Link",{text:"slashMenuItemLinkText",description:"slashMenuItemLinkDescription"}],["Image",{text:"slashMenuItemImageText",description:"slashMenuItemImageDescription"}],["Audio",{text:"slashMenuItemAudioText",description:"slashMenuItemAudioDescription"}],["Video",{text:"slashMenuItemVideoText",description:"slashMenuItemVideoDescription"}],["Emojipicker",{text:"slashMenuItemEmojiText",description:"slashMenuItemEmojiDescription"}]]),ur=["Undo","Redo"],mr=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","strike","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"];function gr(n,e){var i=-1;return e.some(function(e,t){return"string"==typeof e&&n===e.toLocaleLowerCase()&&(i=t,!0)}),i}function p(e,t){var n=!1;return n=e.classList.contains(t)?!0:n}function fr(e,t,n,i){for(var o,r,s=0;s<e.length;s++){if("value"===n&&e[s].value.toLocaleLowerCase()===t.toLocaleLowerCase()){o=e[s];break}if("text"===n&&e[s].text.toLocaleLowerCase()===t.toLocaleLowerCase()){o=e[s];break}if("subCommand"===n&&e[s].subCommand.toLocaleLowerCase()===t.toLocaleLowerCase()){o=e[s];break}}if(!j.isNullOrUndefined(o))switch(i){case"text":r=o.text;break;case"value":r=o.value;break;case"iconCss":r=o.iconCss}return r}function br(){var e=!1;return e=j.Browser.isDevice&&j.Browser.isIos?!0:e}function yr(e){return j.isNullOrUndefined(e)?"":e}function vr(e,t,n){return n?window.pageYOffset+t.getBoundingClientRect().top+e.clientY:e.pageY}function Cr(e,t){return t.getService("rteLocale").getConstant(ar[""+e])}function Nr(e,t,n){Pr(n);for(var i=e.dropDownModule,o=e.args,r=0,s=Object.keys(e.args);r<s.length;r++)for(var a=s[r],l=0;l<e.tbItems.length;l++){var d=e.tbItems[l].subCommand,c=d&&d.toLocaleLowerCase();if(d&&c===a||"UL"===d&&"unorderedlist"===a||"OL"===d&&"orderedlist"===a||"pre"===c&&"insertcode"===a||"NumberFormatList"===d&&"numberFormatList"===a||"BulletFormatList"===d&&"bulletFormatList"===a)if("boolean"==typeof o[""+a])!0===o[""+a]?j.addClass([e.tbElements[l]],[Ci]):j.removeClass([e.tbElements[l]],[Ci]);else if(("string"==typeof o[""+a]||null===o[""+a])&&-1<=gr(a,e.parent.toolbarSettings.items)){var h,p,u,m,g=o[""+a]||"",f="";switch(a){case"formats":j.isNullOrUndefined(i.formatDropDown)||t||!j.isNullOrUndefined(i.formatDropDown)&&i.formatDropDown.isDestroyed||(h=e.parent.format.types,p=j.isNullOrUndefined(e.parent.format.default)?h[0].text:e.parent.format.default,f="empty"===g?"":fr(h,g,"subCommand","text"),i.formatDropDown.content='<span style="display: inline-flex;width:'+e.parent.format.width+'" ><span class="e-rte-dropdown-btn-text'+(j.isNullOrUndefined(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+(j.isNullOrUndefined(f)?p:f)+"</span></span>",i.formatDropDown.dataBind());break;case"alignments":j.isNullOrUndefined(i.alignDropDown)||!j.isNullOrUndefined(i.alignDropDown)&&i.alignDropDown.isDestroyed||(f=fr(Bo,g,"subCommand","iconCss"),i.alignDropDown.iconCss=j.isNullOrUndefined(f)?"e-icons e-justify-left":f,i.alignDropDown.dataBind());break;case"fontname":j.isNullOrUndefined(i.fontNameDropDown)||t||!j.isNullOrUndefined(i.fontNameDropDown)&&i.fontNameDropDown.isDestroyed||(h=e.parent.fontFamily.items,f="empty"===g?"":fr(h,g,"value","text"),p=j.isNullOrUndefined(e.parent.fontFamily.default)?h[0].text:e.parent.fontFamily.default,u="Default"===(j.isNullOrUndefined(f)?p:f)?n.serviceLocator.getService("rteLocale").getConstant("fontName"):j.isNullOrUndefined(f)?p:f,i.fontNameDropDown.content='<span style="display: inline-flex;width:'+e.parent.fontFamily.width+'" ><span class="e-rte-dropdown-btn-text'+(j.isNullOrUndefined(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+u+"</span></span>",i.fontNameDropDown.dataBind());break;case"fontsize":j.isNullOrUndefined(i.fontSizeDropDown)||!j.isNullOrUndefined(i.fontSizeDropDown)&&i.fontSizeDropDown.isDestroyed||(u=e.parent.fontSize.items,m=j.isNullOrUndefined(e.parent.fontSize.default)?u[0].text:e.parent.fontSize.default,m=fr(u,""===g?m.replace(/\s/g,""):g,m.replace(/\s/g,"")===u[0].text&&""===g?"text":"value","text"),f="empty"===g?"":"Default"===m?n.serviceLocator.getService("rteLocale").getConstant("fontSize"):m,i.fontSizeDropDown.content='<span style="display: inline-flex;width:'+e.parent.fontSize.width+'" ><span class="e-rte-dropdown-btn-text'+(j.isNullOrUndefined(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+yr(f)+"</span></span>",i.fontSizeDropDown.dataBind());break;case"bulletFormatList":case"numberFormatList":""!==g?j.addClass([e.tbElements[l]],[Ci]):j.removeClass([e.tbElements[l]],[Ci])}}}}function Er(e){return"object"==typeof e?e:[e]}function Sr(e,t){for(var n=[],i=0;i<e.length;i++)for(var o=0;o<t.length;o++)if("Separator"!==t[o].type){if(("OrderedList"===e[i]||"NumberFormatList"===e[i])&&"OL"===t[o].subCommand){n.push(o);break}if(("UnorderedList"===e[i]||"BulletFormatList"===e[i])&&"UL"===t[o].subCommand){n.push(o);break}if("InsertCode"===e[i]&&"Pre"===t[o].subCommand){n.push(o);break}if("Blockquote"===e[i]&&"blockquote"===t[o].subCommand){n.push(o);break}if("FileManager"===e[i]&&"File"===t[o].subCommand){n.push(o);break}if("object"==typeof e[i]&&"Custom"===e[i].command){n.push(i);break}if(e[i]===t[o].subCommand){n.push(o);break}}return n}function Tr(e,t){for(var n=0,i=Sr(Er(ur),e.toolbarObj.items),o=j.selectAll("."+Kn,e.toolbarObj.element),r=0,s=Object.keys(t);r<s.length;r++){var a=s[r],l=o[i[n]];l&&e.toolbarObj.enableItems(l,t[""+a]),n++}}function Or(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}function Lr(e){var t=j.createElement("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)}function wr(e,t){var n=[];for(t=t.firstChild;t;t=t.nextSibling)3===t.nodeType?n.push(t):n=n.concat(wr(e,t));return n}function kr(e){for(var t={},n=Object.keys(e),i=0;i<Object.keys(e).length;i++)t[n[i].toLocaleLowerCase()]=e[n[i]];return t}function xr(e,t){var n;return null!==e&&""!==e?(n=t.enableHtmlEncode?Dr(Rr(e),t):Dr(e,t),t.setProperties({value:n},!0)):n="DIV"===t.enterKey?t.enableHtmlEncode?"&lt;div&gt;&lt;br/&gt;&lt;/div&gt;":"<div><br/></div>":"BR"===t.enterKey?t.enableHtmlEncode?"&lt;br/&gt;":"<br/>":t.enableHtmlEncode?"&lt;p&gt;&lt;br/&gt;&lt;/p&gt;":"<p><br/></p>",n}function Dr(e,t){var n=document.createElement("div"),i=document.createElement("div"),o=n.childNodes;if(n.innerHTML=e,n.setAttribute("class","tempDiv"),0<o.length){for(var r=void 0,s=void 0,a=void 0;n.firstChild;){for(var l=n.querySelectorAll(gn),d=0;d<l.length;d++)l[d].innerHTML="<br>";for(var c=n.querySelectorAll("p"),d=0;d<c.length;d++)0===c[d].textContent.trim().length&&1===c[d].childNodes.length&&"#text"===c[d].childNodes[0].nodeName&&j.isNullOrUndefined(c[d].childNodes[0].textContent.match(/\u00a0/g))&&(c[d].innerHTML="<br>");for(var h=n.querySelectorAll(fn),d=0;d<h.length;d++)h[d].innerHTML="&ZeroWidthSpace;";"BR"!==t.enterKey&&("#text"===n.firstChild.nodeName&&(n.firstChild.textContent.indexOf("\n")<0||""!==n.firstChild.textContent.trim())||0<=mr.indexOf(n.firstChild.nodeName.toLocaleLowerCase()))?((r?s:(a="DIV"===t.enterKey?j.createElement("div"):j.createElement("p"),i.appendChild(a),a)).appendChild(n.firstChild),s=a,r=!0):"#text"===n.firstChild.nodeName&&("\n"===n.firstChild.textContent||0<=n.firstChild.textContent.indexOf("\n")&&""===n.firstChild.textContent.trim())?j.detach(n.firstChild):(i.appendChild(n.firstChild),r=!1)}for(var p=i.querySelectorAll("img"),d=0;d<p.length;d++)p[d].classList.contains("e-rte-image-unsupported")||(p[d].classList.contains(ro)||p[d].classList.add(ro),p[d].classList.contains(ui))||p[d].classList.contains(ii)||p[d].classList.contains("e-imgleft")||p[d].classList.contains("e-imgright")||p[d].classList.contains("e-imgcenter")||p[d].classList.add(ui)}return i.innerHTML}function Mr(e){e="DIV"===e.enterKey?e.enableHtmlEncode?"&lt;div&gt;&lt;br/&gt;&lt;/div&gt;":"<div><br/></div>":"BR"===e.enterKey?e.enableHtmlEncode?"&lt;br/&gt;":"<br/>":e.enableHtmlEncode?"&lt;p&gt;&lt;br/&gt;&lt;/p&gt;":"<p><br/></p>";return e}function Br(e){return"<p><br></p>"===e||"&lt;p&gt;&lt;br&gt;&lt;/p&gt;"===e||"<div><br></div>"===e||"&lt;div&gt;&lt;br&gt;&lt;/div&gt;"===e||"<br>"===e||"&lt;br&gt;"===e||""===e}function Rr(e){return e.replace(/&amp;/g,"&").replace(/&amp;lt;/g,"<").replace(/&lt;/g,"<").replace(/&amp;gt;/g,">").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;nbsp;/g," ").replace(/&quot;/g,"")}function Ar(e,t){var n;return t.enableHtmlSanitizer&&((n=j.SanitizeHtmlHelper.beforeSanitize()).selectors.tags[2]&&-1<n.selectors.tags[2].indexOf("iframe")&&(n.selectors.tags[2]="iframe:not(.e-rte-embed-url)"),j.extend(n,n,{cancel:!1,helper:null}),t.trigger("beforeSanitizeHtml",n),n.cancel&&!j.isNullOrUndefined(n.helper)?e=n.helper(e):n.cancel||(e=j.SanitizeHtmlHelper.serializeValue(n,e))),e}function Ir(e){for(var e=e.split(","),t=e[0].match(/:(.*?);/)[1],n=atob(e[1]),i=n.length,o=new Uint8Array(i);i--;)o[i]=n.charCodeAt(i);return new Blob([o],{type:t})}function Ur(e,t,n){for(var i=0;t.length>i;i++)if(t[i].value===n.value||t[i].value===n.subCommand)return e.localeObj.getConstant(t[i].locale);return n.text}function Pr(n){Yo.forEach(function(e,t){Yo[t].text=Ur(n,lr,Yo[t])}),$o.forEach(function(e,t){$o[t].text=Ur(n,dr,$o[t])}),tr.forEach(function(e,t){tr[t].text=Ur(n,cr,tr[t])}),nr.forEach(function(e,t){nr[t].text=Ur(n,hr,nr[t])})}jr.prototype.renderPanel=function(){var e=this.parent,t=this.parent.createElement("div",{className:"e-rte-content",id:this.parent.getID()+"rte-view"}),n=xr(e.value,e);this.editableElement=this.parent.createElement("div",{className:"e-content",id:this.parent.getID()+"_rte-edit-view",attrs:{contenteditable:"true"},innerHTML:n}),t.appendChild(this.editableElement),this.setPanel(t),e.rootContainer.appendChild(t)},jr.prototype.getPanel=function(){return this.contentPanel},jr.prototype.getEditPanel=function(){return this.editableElement},jr.prototype.getText=function(){var e=this.getEditPanel().innerText;return"\n"===e?"":e},jr.prototype.setPanel=function(e){this.contentPanel=e},jr.prototype.getDocument=function(){return this.getEditPanel().ownerDocument};var Hr=jr;function jr(e){this.parent=e}qr.prototype.render=function(){this.parent;this.contentRenderer=this.renderer.getRenderer(c.RenderType.Content),this.contentRenderer.renderPanel()},qr.prototype.refresh=function(e){this.parent.notify((e=void 0===e?{requestType:"refresh"}:e).requestType+"-begin",e)},qr.prototype.destroy=function(){j.isNullOrUndefined(this.parent)||(this.removeEventListener(),this.locator.destroy(),this.renderer.destroy())},qr.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(l,this.refresh,this),this.parent.on(ne,this.keyUp,this))},qr.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(l,this.refresh),this.parent.off(ne,this.keyUp))},qr.prototype.keyUp=function(e){if("HTML"===this.parent.editorMode)switch(e.args.which){case 46:case 8:var t=this.parent.contentModule.getEditPanel().childNodes;0!==t.length&&(1!==t.length||0!==t[0].childNodes.length||"BR"!==t[0].tagName&&("P"!==t[0].tagName&&"DIV"!==t[0].tagName||""!==t[0].textContent))||(t=this.parent.contentModule.getEditPanel(),"DIV"===this.parent.enterKey?t.innerHTML="<div><br/></div>":"BR"===this.parent.enterKey?t.innerHTML="<br/>":t.innerHTML="<p><br/></p>",this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),t.childNodes[0],0))}};var Fr=qr;function qr(e,t){this.parent=e,this.locator=t,this.renderer=this.locator.getService("rendererFactory"),this.addEventListener()}i.prototype.getFormattedNode=function(e,t,n){e=this.getFormatParent(e,t,n);return null!==e&&e!==n?e:null},i.prototype.getFormatParent=function(e,t,n){for(;(e=e.parentNode)&&e!==n&&!this.isFormattedNode(e,t););return e},i.prototype.isFormattedNode=function(e,t){switch(t){case"bold":return i.isBold(e);case"italic":return i.isItalic(e);case"underline":return i.isUnderline(e);case"strikethrough":return i.isStrikethrough(e);case"superscript":return i.isSuperscript(e);case"subscript":return i.isSubscript(e);case"fontcolor":return this.isFontColor(e);case"fontname":return this.isFontName(e);case"fontsize":return this.isFontSize(e);case"backgroundcolor":return this.isBackgroundColor(e);case"inlinecode":return i.isCode(e);default:return!1}},i.isBold=function(e){return-1!==["strong","b"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"bold"!==e.style.fontWeight)},i.isItalic=function(e){return-1!==["em","i"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"italic"!==e.style.fontStyle)},i.isUnderline=function(e){return-1!==["u"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"underline"!==e.style.textDecoration&&"underline"!==e.style.textDecorationLine)},i.isStrikethrough=function(e){return-1!==["del","strike","s"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"line-through"!==e.style.textDecoration&&"line-through"!==e.style.textDecorationLine)},i.isSuperscript=function(e){return-1!==["sup"].indexOf(e.nodeName.toLowerCase())},i.isSubscript=function(e){return-1!==["sub"].indexOf(e.nodeName.toLowerCase())},i.prototype.isFontColor=function(e){var t=e.style&&e.style.color;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.prototype.isBackgroundColor=function(e){var t=e.style&&e.style.backgroundColor;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.prototype.isFontSize=function(e){var t=e.style&&e.style.fontSize;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.prototype.isFontName=function(e){var t=e.style&&e.style.fontFamily;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.isCode=function(e){return-1!==["code"].indexOf(e.nodeName.toLowerCase())},i.inlineTags=["a","abbr","acronym","b","bdo","big","cite","code","dfn","em","font","i","kbd","label","q","samp","small","span","strong","sub","sup","tt","u","var","del"];var zr=i;function i(){}var _r="INSERT-IMAGE",Vr="INSERT-AUDIO",Qr="INSERT-VIDEO",Wr="INSERT-TABLE",Kr="INSERT-LINK",Gr="INSERT-ROW",Xr="INSERT-COLUMN",Yr="DELETE-ROW",Jr="DELETE-COLUMN",$r="REMOVE-TABLE",Zr="TABLE-HEADER",es="TABLE_VERTICAL_ALIGN",ts="TABLE_MERGE",ns="TABLE_VERTICAL_SPLIT",is="TABLE_HORIZONTAL_SPLIT",os="TABLE_MOVE",rs="alignment-type",ss="indent-type",as="p",ls=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul","video","body"],ds=["td","th"],cs=["table","tbody","td","tfoot","th","thead","tr"],hs="selection-type",ps="inserthtml-type",us="insert-text-type",ms="clear-type",gs=["area","base","br","embed","hr","img","input","param","source","track","wbr","iframe","td","table"],fs=["word","excel","onenote"],bs=(t.prototype.saveInstance=function(e,t){return this.range=e.cloneRange(),this.rootNode=this.documentFromRange(e),this.body=t,this.startContainer=this.getNodeArray(e.startContainer,!0),this.endContainer=this.getNodeArray(e.endContainer,!1),this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.html=this.body.innerHTML,this},t.prototype.documentFromRange=function(e){return 9===e.startContainer.nodeType?e.startContainer:e.startContainer.ownerDocument},t.prototype.getRange=function(e){var t=this.get(e),t=t&&0<t.rangeCount?t.getRangeAt(t.rangeCount-1):e.createRange();return t.startContainer!==e||t.endContainer!==e||t.startOffset||t.endOffset||(t.setStart(e.body,0),t.collapse(!0)),t},t.prototype.get=function(e){return e.defaultView.getSelection()},t.prototype.save=function(e,t){return e=e?e.cloneRange():this.getRange(t),this.saveInstance(e,t.body)},t.prototype.getIndex=function(e){var t=0;if(e=e.previousSibling||"BR"!==e.tagName?e.previousSibling:e)for(e.nodeType;e;)t++,e.nodeType,e=e.previousSibling;return t},t.prototype.isChildNode=function(e,t){for(var n=0;n<t.childNodes.length;n++)if(-1<e.indexOf(t.childNodes[n]))return!0;return!1},t.prototype.getNode=function(e,t,n){return t===e&&(3===e.nodeType||!e.firstChild||-1!==n.indexOf(e.firstChild)||this.isChildNode(n,e))||3===e.nodeType&&e.previousSibling===t&&"IMG"===t.nodeName?null:-1===n.indexOf(e.firstChild)&&e.firstChild&&!this.isChildNode(n,e)?e.firstChild:e.nextSibling||e.parentNode||null},t.prototype.getNodeCollection=function(e){var t=e.startContainer.childNodes[e.startOffset]||e.startContainer,n=e.endContainer.childNodes[0<e.endOffset?e.endOffset-1:e.endOffset]||e.endContainer;if((t===n||"BR"===t.nodeName&&t===e.endContainer.childNodes[e.endOffset])&&0===t.childNodes.length)return[t];if(e.startOffset===e.endOffset&&0!==e.startOffset&&"PRE"===e.startContainer.nodeName)return["BR"===t.nodeName||"#text"===t.nodeName?t:t.childNodes[0]];for(var i=[];-1===i.indexOf(t)&&i.push(t),t=this.getNode(t,n,i););return i},t.prototype.getParentNodeCollection=function(e){return this.getParentNodes(this.getNodeCollection(e),e)},t.prototype.getParentNodes=function(e,t){e=e.reverse();for(var n=0;n<e.length;n++)-1!==e.indexOf(e[n].parentNode)||3===e[n].nodeType&&t.startContainer!==t.endContainer&&t.startContainer.parentNode!==t.endContainer.parentNode?(e.splice(n,1),n--):3===e[n].nodeType&&(e[n]=e[n].parentNode);return e},t.prototype.getSelectionNodeCollection=function(e){return this.getSelectionNodes(this.getNodeCollection(e))},t.prototype.getSelectionNodeCollectionBr=function(e){return this.getSelectionNodesBr(this.getNodeCollection(e))},t.prototype.getSelectionNodes=function(e){e=e.reverse();for(var t=new RegExp("","g"),n=0;n<e.length;n++)(3!==e[n].nodeType||""===e[n].textContent.trim()||1===e[n].textContent.length&&e[n].textContent.match(t))&&(e.splice(n,1),n--);return e.reverse()},t.prototype.getSelectionNodesBr=function(e){e=e.reverse();for(var t=new RegExp("","g"),n=0;n<e.length;n++)"BR"!==e[n].nodeName&&(3!==e[n].nodeType||""===e[n].textContent.trim()||1===e[n].textContent.length&&e[n].textContent.match(t))&&(e.splice(n,1),n--);return e.reverse()},t.prototype.getInsertNodeCollection=function(e){return this.getInsertNodes(this.getNodeCollection(e))},t.prototype.getInsertNodes=function(e){e=e.reverse();for(var t=0;t<e.length;t++)(0!==e[t].childNodes.length&&3!==e[t].nodeType||3===e[t].nodeType&&""===e[t].textContent)&&(e.splice(t,1),t--);return e.reverse()},t.prototype.getNodeArray=function(e,t,n){var i=[];for(t?this.startNodeName=[]:this.endNodeName=[];e!==(n||this.rootNode)&&!j.isNullOrUndefined(e);)(t?this.startNodeName:this.endNodeName).push(e.nodeName.toLowerCase()),i.push(this.getIndex(e)),e=e.parentNode;return i},t.prototype.setRangePoint=function(e,t,n,i){for(var o=this.rootNode,r=n.length;r--;)o=o&&o.childNodes[n[r]];return o&&0<=i&&"html"!==o.nodeName&&(3===o.nodeType&&"&nbsp;"===o.nodeValue.replace(/\u00a0/g,"&nbsp;")&&(i=o.textContent.length),e[t?"setStart":"setEnd"](o,i)),e},t.prototype.restore=function(){var e=this.range.cloneRange(),e=this.setRangePoint(e,!0,this.startContainer,this.startOffset);return e=this.setRangePoint(e,!1,this.endContainer,this.endOffset),this.selectRange(this.rootNode,e),e},t.prototype.selectRange=function(e,t){this.setRange(e,t),this.save(t,e)},t.prototype.setRange=function(e,t){e=this.get(e);e.removeAllRanges(),e.addRange(t)},t.prototype.setSelectionText=function(e,t,n,i,o){var r=e.createRange();r.setStart(t,i),r.setEnd(n,o),this.setRange(e,r)},t.prototype.setSelectionContents=function(e,t){var n=e.createRange();n.selectNode(t),this.setRange(e,n)},t.prototype.setSelectionNode=function(e,t){var n=e.createRange();n.selectNodeContents(t),this.setRange(e,n)},t.prototype.getSelectedNodes=function(e){return this.getNodeCollection(this.getRange(e))},t.prototype.Clear=function(e){this.get(e).removeAllRanges()},t.prototype.insertParentNode=function(e,t,n){n.surroundContents(t),this.selectRange(e,n)},t.prototype.setCursorPoint=function(e,t,n){var i=e.createRange(),e=e.defaultView.getSelection();i.setStart(t,n),i.collapse(!0),e.removeAllRanges(),e.addRange(i)},t);function t(){this.startNodeName=[],this.endNodeName=[]}var ys=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","strike","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"];function vs(){var e=!1;return e=j.Browser.isDevice&&j.Browser.isIos?!0:e}function Cs(e,t){"BODY"!==e.nodeName||j.isNullOrUndefined(t)||(e=top.window.document.querySelector(t),j.isNullOrUndefined(e))||e.contentWindow.focus()}function Ns(){return{bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,unorderedlist:!1,numberFormatList:!1,bulletFormatList:!1,underline:!1,alignments:null,backgroundcolor:null,fontcolor:null,fontname:null,fontsize:null,formats:null,createlink:!1,insertcode:!1,blockquote:!1,inlinecode:!1}}function Es(e,t){var n,i,o,r,s=("BODY"===t.nodeName?t.ownerDocument.defaultView.frameElement:t).closest(".e-richtexteditor"),a=s.style.height;0===e.getSelection().rangeCount||(r=(n=(e="#text"===(e=e.getSelection().getRangeAt(0)).startContainer.nodeName?e.startContainer.parentElement:e.startContainer).getBoundingClientRect()).top,n=n.bottom,i=s.getBoundingClientRect(),o=0<s.querySelectorAll(".e-count-enabled, .e-resize-enabled").length,"BODY"===t.nodeName?"auto"===a?window.innerHeight<r&&e.scrollIntoView(!1):r>t.getBoundingClientRect().height&&e.scrollIntoView({block:"nearest",inline:"nearest"}):"auto"===a?window.innerHeight<r&&e.scrollIntoView({block:"end",inline:"nearest"}):n>i.bottom&&(s.querySelector(".e-rte-content").scrollTop+=n-i.bottom+(o?20:0)),a=t.closest('div[style*="overflow-y: scroll"]'),j.isNullOrUndefined(a))||n>(r=a.getBoundingClientRect()).bottom&&(a.scrollTop+=n-r.bottom)}function Ss(e,t,n){for(var i=0;i<t.length;i++)0===i?e.splice(n+i,1,t[i]):e.splice(n+i,0,t[i])}function g(e,t){j.removeClass(e,t);for(var n=0;n<e.length;n++)0===e[n].classList.length&&e[n].getAttribute("class")&&e[n].removeAttribute("class")}var Ts=Ns(),Os=(Ls.get=function(e,t,n,i,o,r){for(var s=JSON.parse(JSON.stringify(Ts)),a=JSON.parse(JSON.stringify(Ts)),l=new bs,d=l.getRange(e),c=r?[r]:d.collapsed?l.getNodeCollection(d):l.getSelectionNodeCollectionBr(d),h=c.length,p=!1,u=0;u<c.length;u++){for(;3===c[u].nodeType&&3===d.startContainer.nodeType&&c[u].parentNode&&c[u].parentNode.lastElementChild&&"BR"!==c[u].parentNode.lastElementChild.nodeName&&0===this.getImmediateBlockNode(c[u].parentNode).textContent.replace(/\u200B/g,"").length&&0===d.startContainer.textContent.replace(/\u200B/g,"").length&&0===l.get(e).toString().replace(/\u200B/g,"").length;)c[u]=c[u].parentNode.lastElementChild.firstChild,p=!0;p&&c[u]&&(l.setCursorPoint(e,c[u],c[u].textContent.length),p=!1),("BR"!==c[u].nodeName&&3!==c[u].nodeType||1<h&&3===c[u].nodeType&&""===c[u].textContent.trim())&&(c.splice(u,1),u--)}for(u=0;u<c.length;u++)s=this.getFormatParent(e,s,c[u],t,n,i,o),(0===u&&s.bold||!s.bold)&&(a.bold=s.bold),(0===u&&s.insertcode||!s.insertcode)&&(a.insertcode=s.insertcode),(0===u&&s.blockquote||!s.blockquote)&&(a.blockquote=s.blockquote),(0===u&&s.italic||!s.italic)&&(a.italic=s.italic),(0===u&&s.underline||!s.underline)&&(a.underline=s.underline),(0===u&&s.strikethrough||!s.strikethrough)&&(a.strikethrough=s.strikethrough),(0===u&&s.superscript||!s.superscript)&&(a.superscript=s.superscript),(0===u&&s.subscript||!s.subscript)&&(a.subscript=s.subscript),(0===u&&s.fontcolor||!s.fontcolor)&&(a.fontcolor=s.fontcolor),0===u&&s.fontname?a.fontname=s.fontname:a.fontname=s.fontname===a.fontname?s.fontname:"empty",0===u&&s.fontsize?a.fontsize=s.fontsize:a.fontsize=s.fontsize===a.fontsize?s.fontsize:"empty",(0===u&&s.backgroundcolor||!s.backgroundcolor)&&(a.backgroundcolor=s.backgroundcolor),(0===u&&s.orderedlist||!s.orderedlist)&&(a.orderedlist=s.orderedlist),(0===u&&s.unorderedlist||!s.unorderedlist)&&(a.unorderedlist=s.unorderedlist),(0===u&&s.alignments||!s.alignments)&&(a.alignments=s.alignments),0===u&&s.formats?a.formats=s.formats:a.formats=s.formats===a.formats?s.formats:"empty",(0===u&&s.createlink||!s.createlink)&&(a.createlink=s.createlink),(0===u&&s.numberFormatList||!s.numberFormatList)&&(a.numberFormatList=s.numberFormatList),(0===u&&s.bulletFormatList||!s.bulletFormatList)&&(a.bulletFormatList=s.bulletFormatList),(0===u&&s.inlinecode||!s.inlinecode)&&(a.inlinecode=s.inlinecode),s=JSON.parse(JSON.stringify(Ts));return a},Ls.getImmediateBlockNode=function(e){for(;(e=e.parentNode)&&ls.indexOf(e.nodeName.toLocaleLowerCase())<0;);return e},Ls.getFormatParent=function(e,t,n,i,o,r,s){var a=!1,l=!1;if(i.contains(n)||3===n.nodeType&&3!==i.nodeType&&i.contains(n.parentNode))for(;((t=this.isFormattedNode(e,t,n,a,l,o,r,s)).orderedlist||t.unorderedlist)&&(a=!0),(t.bulletFormatList||t.numberFormatList)&&(l=!0),(n=n.parentNode)&&n!==i;);return t},Ls.isFormattedNode=function(e,t,n,i,o,r,s,a){if(t.bold||(t.bold=zr.isBold(n)),t.italic||(t.italic=zr.isItalic(n)),t.underline||(t.underline=zr.isUnderline(n)),t.strikethrough||(t.strikethrough=zr.isStrikethrough(n)),t.superscript||(t.superscript=zr.isSuperscript(n)),t.subscript||(t.subscript=zr.isSubscript(n)),t.fontcolor||(t.fontcolor=this.isFontColor(e,n)),t.fontname||(t.fontname=this.isFontName(e,n,a)),t.fontsize||(t.fontsize=this.isFontSize(e,n,s)),t.backgroundcolor||(t.backgroundcolor=this.isBackgroundColor(n)),t.orderedlist||i||(t.orderedlist=this.isOrderedList(n)),t.unorderedlist||i||(t.unorderedlist=this.isUnorderedList(n)),t.alignments||(t.alignments=this.isAlignment(n)),t.formats||(t.formats=this.isFormats(n,r),"pre"===t.formats&&(t.insertcode=!0)),!t.blockquote){a=void 0;if(!j.isNullOrUndefined(r))if(-1<r.indexOf("blockquote"))t.formats=this.isFormats(n,r),a=t.formats;else{r.push("blockquote");for(var a=this.isFormats(n,r),l=r.length-1;0<=l;l--)"blockquote"===r[l]&&r.splice(l,1)}"blockquote"===a&&(t.blockquote=!0)}return t.createlink||(t.createlink=this.isLink(n)),t.numberFormatList||o||(t.numberFormatList=this.isNumberFormatList(n)),t.bulletFormatList||o||(t.bulletFormatList=this.isBulletFormatList(n)),t.inlinecode||(t.inlinecode=zr.isCode(n)),t},Ls.isFontColor=function(e,t){var n=t.style&&t.style.color;return null!==(n=null!=n&&""!==n||3===t.nodeType?n:this.getComputedStyle(e,t,"color"))&&""!==n&&void 0!==n?n:null},Ls.isLink=function(e){return"a"===e.nodeName.toLocaleLowerCase()},Ls.isBackgroundColor=function(e){e=e.style&&e.style.backgroundColor;return null!==e&&""!==e&&void 0!==e?e:null},Ls.isFontSize=function(e,t,n){var i=t.style&&t.style.fontSize;return null!==(i=null!=i&&""!==i||3===t.nodeType||!t.parentElement.classList.contains("e-content")?i:this.getComputedStyle(e,t,"font-size"))&&""!==i&&void 0!==i&&(null==n||-1<n.indexOf(i))?i:null},Ls.isFontName=function(e,t,n){var i=t.style&&t.style.fontFamily,o=(null!=i&&""!==i||3===t.nodeType||(i=this.getComputedStyle(e,t,"font-family")),null);return null!==i&&""!==i&&void 0!==i&&(null==n||n.filter(function(e,t){var n=new RegExp(i,"i");(e.replace(/"/g,"").replace(/ /g,"").toLowerCase()===i.replace(/"/g,"").replace(/ /g,"").toLowerCase()||e.split(",")[0]&&!j.isNullOrUndefined(e.split(",")[0].trim().match(n))&&e.split(",")[0].trim()===e.split(",")[0].trim().match(n)[0])&&(o=t)})&&null!==o)?null!==o?n[o]:i.replace(/"/g,""):null},Ls.isOrderedList=function(e){return"ol"===e.nodeName.toLocaleLowerCase()},Ls.isUnorderedList=function(e){return"ul"===e.nodeName.toLocaleLowerCase()},Ls.isAlignment=function(e){e=e.style&&e.style.textAlign;return"left"===e?"justifyleft":"center"===e?"justifycenter":"right"===e?"justifyright":"justify"===e?"justifyfull":null},Ls.isFormats=function(e,t){return null==t&&-1<ls.indexOf(e.nodeName.toLocaleLowerCase())||null!=t&&-1<t.indexOf(e.nodeName.toLocaleLowerCase())?e.nodeName.toLocaleLowerCase():null},Ls.getComputedStyle=function(e,t,n){return e.defaultView.getComputedStyle(t,null).getPropertyValue(n)},Ls.isNumberFormatList=function(e){var t=e.style&&e.style.listStyleType;return"lower-alpha"===t?"Lower Alpha":"number"===t?"Number":"upper-alpha"===t?"Upper Alpha":"lower-roman"===t?"Lower Roman":"upper-roman"===t?"Upper Roman":"lower-greek"===t?"Lower Greek":"none"===t?"None":!!this.isOrderedList(e)||null},Ls.isBulletFormatList=function(e){var t=e.style&&e.style.listStyleType;return"circle"===t?"Circle":"square"===t?"Square":"none"===t?"None":"disc"===t?"Disc":!!this.isUnorderedList(e)||null},Ls);function Ls(){}r.prototype.wireEvent=function(){this.parent.on(o,this.destroy,this),this.parent.on(sn,this.destroyTooltip,this),this.parent.on(un,this.closeTooltip,this)},r.prototype.destroyTooltip=function(){var e,t=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument();j.isNullOrUndefined(t.querySelector(".e-tooltip-wrap"))||j.isNullOrUndefined(t.querySelector("[data-tooltip-id]"))||(t=t.querySelector("[data-tooltip-id]"),e=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0}),t.dispatchEvent(e))},r.prototype.unWireEvent=function(){this.parent.off(o,this.destroy),this.parent.off(sn,this.destroyTooltip),this.parent.off(un,this.closeTooltip)},r.prototype.toolbarBeforeCreate=function(e){"Extended"===this.mode&&(e.enableCollision=!1)},r.prototype.toolbarCreated=function(){this.parent.notify(se,this)},r.prototype.toolbarClicked=function(e){this.parent.enabled&&(this.parent.trigger("toolbarClick",e),this.parent.readonly&&!j.isNullOrUndefined(e.item)||this.parent.notify(G,e))},r.prototype.dropDownSelected=function(e){this.parent.notify(ce,{element:e.element,item:e.item,originalEvent:e.event}),this.destroyTooltip()},r.prototype.beforeDropDownItemRender=function(e){!this.parent.readonly&&this.parent.enabled&&this.parent.notify(he,e)},r.prototype.tooltipBeforeRender=function(e){if(!j.isNullOrUndefined(e.target.getAttribute("title"))){var t=void 0;switch(e.target.getAttribute("title")){case"Minimize":t=this.l10n.getConstant("minimize"),e.target.setAttribute("title",t+" (Esc)");break;case"Maximize":t=this.l10n.getConstant("maximize"),e.target.setAttribute("title",t+" (Ctrl+Shift+F)")}}e.target.querySelector(".e-active")&&(e.cancel=!0,j.isNullOrUndefined(e.target.getAttribute("title"))||this.closeTooltip({target:e.target,isTitle:!0}))},r.prototype.dropDownOpen=function(e){var t,n;!(-1<e.element.parentElement.getAttribute("id").indexOf("TableCell"))||j.isNullOrUndefined(e.element.parentElement.querySelector(".e-cell-merge"))||j.isNullOrUndefined(e.element.parentElement.querySelector(".e-cell-horizontal-split"))&&j.isNullOrUndefined(e.element.parentElement.querySelector(".e-cell-vertical-split"))||(t=e.element.querySelectorAll("li"),1===(n=this.parent.inputElement.querySelectorAll(".e-cell-select")).length?(j.addClass([t[0]],"e-disabled"),j.removeClass([t[1],t[2]],"e-disabled")):1<n.length&&(Array.from(n).every(function(e){return e.tagName.toLowerCase()===n[0].tagName.toLowerCase()})?j.removeClass([t[0]],"e-disabled"):j.addClass([t[0]],"e-disabled"),j.addClass([t[1],t[2]],"e-disabled"))),this.parent.notify(Ve,e)},r.prototype.dropDownClose=function(e){this.parent.notify(Qe,e)},r.prototype.renderToolbar=function(e){this.setPanel(e.target),this.renderPanel(),this.mode=e.overflowMode,e.rteToolbarObj.toolbarObj=new A.Toolbar({items:e.items,width:"100%",overflowMode:e.overflowMode,beforeCreate:this.toolbarBeforeCreate.bind(this),created:this.toolbarCreated.bind(this),clicked:this.toolbarClicked.bind(this),enablePersistence:e.enablePersistence,enableRtl:e.enableRtl,cssClass:e.cssClass}),e.rteToolbarObj.toolbarObj.isStringTemplate=!0,e.rteToolbarObj.toolbarObj.createElement=this.parent.createElement,e.rteToolbarObj.toolbarObj.appendTo(e.target),this.parent.showTooltip&&"toolbar"===e.type&&(this.tooltip=new U.Tooltip({target:"#"+this.parent.getID()+"_toolbar_wrapper [title]",showTipPointer:!0,openDelay:400,opensOn:"Hover",beforeRender:this.tooltipBeforeRender.bind(this),beforeOpen:this.tooltipBeforeOpen.bind(this),cssClass:this.parent.getCssClass(),windowCollision:!0,position:"BottomCenter"}),this.tooltip.appendTo(e.target.parentElement))},r.prototype.tooltipBeforeOpen=function(e){e.element&&e.element.setAttribute("data-rte-id",this.parent.getID())},r.prototype.renderDropDownButton=function(e){var t,m=this,g=(e.element.classList.add(Qn),t=e.cssClass+" "+Ei+" "+Si,this.parent.inlineMode.enable&&j.Browser.isDevice&&(t=t+" "+qn),this),f=new I.DropDownButton({items:e.items,iconCss:e.iconCss,cssClass:t,content:e.content,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,select:this.dropDownSelected.bind(this),beforeOpen:function(e){if(g.parent.readonly||!g.parent.enabled)e.cancel=!0;else{if("Markdown"!==g.parent.editorMode){var t=g.parent.getRange().startContainer.parentElement,n=t.closest("table"),i=t.closest("tr");if(!j.isNullOrUndefined(n)&&n.classList.contains("e-dashed-border"))for(var o=0;o<e.element.childNodes.length;o++)e.element.childNodes[o].classList.contains("e-dashed-borders")&&j.addClass([e.element.childNodes[o]],"e-active");else if(!j.isNullOrUndefined(n)&&!n.classList.contains("e-dashed-border")&&n.classList.contains("e-alternate-rows")&&""!==window.getComputedStyle(i).backgroundColor)for(o=0;o<e.element.childNodes.length;o++)e.element.childNodes[o].classList.contains("e-alternate-rows")&&j.addClass([e.element.childNodes[o]],"e-active");for(var r=g.parent.getRange().startContainer;r!==g.parent.inputElement&&!j.isNullOrUndefined(r.parentElement);){"#text"===r.nodeName&&(r=r.parentElement);var s=window.getComputedStyle(r).textAlign;if("Alignments"===e.items[0].command){if("Align Left"===e.items[0].text&&"left"===s||"start"===s){j.addClass([e.element.childNodes[0]],"e-active");break}if("Align Center"===e.items[1].text&&"center"===s){j.addClass([e.element.childNodes[1]],"e-active");break}if("Align Right"===e.items[2].text&&"right"===s){j.addClass([e.element.childNodes[2]],"e-active");break}if("Align Justify"===e.items[3].text&&"justify"===s){j.addClass([e.element.childNodes[3]],"e-active");break}}r=r.parentElement}n=t.closest("img"),i=n||t.querySelector("img");if("Images"!==e.items[0].command||j.isNullOrUndefined(i)||(o=void 0,i.classList.contains("e-imgleft")||i.classList.contains("e-imginline")?o=0:i.classList.contains("e-imgcenter")||i.classList.contains("e-imgbreak")?o=1:i.classList.contains("e-imgright")&&(o=2),j.isNullOrUndefined(e.element.childNodes[o]))||j.addClass([e.element.childNodes[o]],"e-active"),"Formats"===e.items[0].command||"Font"===e.items[0].command)for(var a=[],l=[],d=!1,c=(m.parent.format.types.forEach(function(e){l.push(e.value.toLocaleLowerCase())}),m.parent.fontFamily.items.forEach(function(e){a.push(e.value)}),Os.get(m.parent.contentModule.getDocument(),m.parent.contentModule.getEditPanel(),l,null,a)),o=0;o<e.element.childNodes.length;o++)(h=m.parent.createElement("div")).innerHTML=f.content.trim(),!d&&(""!==h.textContent.trim()&&e.element.childNodes[o].textContent.trim()===h.textContent.trim()||"Formats"===e.items[0].command&&!j.isNullOrUndefined(c.formats)&&m.parent.format.types[o].value.toLowerCase()===c.formats.toLowerCase()&&e.element.childNodes[o].classList.contains(m.parent.format.types[o].cssClass)||"FontName"===e.items[0].subCommand&&"Font"===e.items[0].command&&!j.isNullOrUndefined(c.fontname)&&!j.isNullOrUndefined(m.parent.fontFamily.items[o])&&m.parent.fontFamily.items[o].value.toLowerCase()===c.fontname.toLowerCase()&&e.element.childNodes[o].classList.contains(m.parent.fontFamily.items[o].cssClass)||"FontName"===e.items[0].subCommand&&""===m.parent.fontFamily.items[o].value&&j.isNullOrUndefined(c.fontname)&&e.element.childNodes[o].classList.contains(m.parent.fontFamily.items[o].cssClass)||"FontSize"===e.items[0].subCommand&&"Default"===e.element.childNodes[o].textContent&&"Font Size"===h.textContent&&""===m.parent.fontSize.items[o].value&&!j.isNullOrUndefined(c.fontsize))?e.element.childNodes[o].classList.contains("e-active")||(j.addClass([e.element.childNodes[o]],"e-active"),d=!0):j.removeClass([e.element.childNodes[o]],"e-active")}else if("Markdown"===g.parent.editorMode&&"Formats"===e.items[0].command)for(var h,p=[],d=!1,u=(m.parent.format.types.forEach(function(e){p.push(e.value.toLocaleLowerCase())}),e.element.childNodes),o=0;o<u.length;o++)(h=m.parent.createElement("div")).innerHTML=f.content.trim(),d||""===h.textContent.trim()||u[o].textContent.trim()!==h.textContent.trim()?j.removeClass([u[o]],"e-active"):u[o].classList.contains("e-active")||(j.addClass([u[o]],"e-active"),d=!0);g.parent.notify(_e,e)}},close:this.dropDownClose.bind(this),open:this.dropDownOpen.bind(this),beforeItemRender:this.beforeDropDownItemRender.bind(this)});return f.isStringTemplate=!0,f.createElement=g.parent.createElement,f.appendTo(e.element),e.element.tabIndex=-1,document.getElementById(f.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),f},r.prototype.mouseOutHandler=function(){var e;j.isNullOrUndefined(this.tooltipTargetEle)&&(e=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument(),this.tooltipTargetEle=e.querySelector("[data-title]")),this.tooltipTargetEle.setAttribute("title",this.tooltipTargetEle.getAttribute("data-title")),this.tooltipTargetEle.removeAttribute("data-title"),j.EventHandler.remove(this.tooltipTargetEle,"mouseout",this.mouseOutHandler)},r.prototype.closeTooltip=function(e){var t;e.isTitle?(this.tooltipTargetEle=e.target,this.tooltipTargetEle.setAttribute("data-title",this.tooltipTargetEle.getAttribute("title")),this.tooltipTargetEle.removeAttribute("title"),j.EventHandler.add(this.tooltipTargetEle,"mouseout",this.mouseOutHandler,this)):(t=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument(),this.tooltipTargetEle=j.closest(e.target,"[data-tooltip-id]"),j.isNullOrUndefined(this.tooltipTargetEle)||!this.parent.showTooltip||j.isNullOrUndefined(t.querySelector(".e-tooltip-wrap"))||(this.destroyTooltip(),this.tooltipTargetEle.setAttribute("data-title",this.tooltipTargetEle.getAttribute("title")),this.tooltipTargetEle.removeAttribute("title"),j.EventHandler.add(this.tooltipTargetEle,"mouseout",this.mouseOutHandler,this)))},r.prototype.renderListDropDown=function(e){var o=this,r=this,t=Ei+" "+Si+(this.parent.inlineMode?" "+qn:""),n=(t+=" "+("NumberFormatList"===e.itemName?wi:ki),r.parent.createElement("span",{className:Li})),i=r.parent.createElement("span",{className:e.cssClass}),s=(n.appendChild(i),new I.DropDownButton({items:e.items,cssClass:t,content:e.content,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,select:this.dropDownSelected.bind(this),beforeOpen:function(e){if("Markdown"!==r.parent.editorMode){var t=r.parent.getRange().startContainer.parentElement.closest("LI"),t=j.isNullOrUndefined(t)?null:t.parentElement;if(j.isNullOrUndefined(t)||"OL"!==t.nodeName&&"UL"!==t.nodeName)j.addClass([e.element.childNodes[0]],"e-active");else if("UL"===t.nodeName&&"NumberFormatList"===e.items[0].subCommand)j.addClass([e.element.childNodes[0]],"e-active");else if("OL"===t.nodeName&&"BulletFormatList"===e.items[0].subCommand)j.addClass([e.element.childNodes[0]],"e-active");else for(var n="decimal"===(n=t.style.listStyleType.split("-").join("").toLocaleLowerCase())?"number":n,i=0;i<e.element.childNodes.length;i++){if(n===e.element.childNodes[i].innerHTML.split(" ").join("").toLocaleLowerCase()){j.addClass([e.element.childNodes[i]],"e-active");break}if(""===n&&"None"!==e.element.childNodes[i].innerHTML){j.addClass([e.element.childNodes[i]],"e-active");break}}}o.closeTooltip({target:e.event.target}),r.parent.readonly||!r.parent.enabled||(r.parent.notify(Qe,{}),t=e.event?e.event.target:null,r.currentElement=s.element,r.currentDropdown=s,e.event&&"click"===e.event.type&&(t.classList.contains(Li)||t.parentElement.classList.contains(Li)))?e.cancel=!0:r.parent.notify(_e,e)},close:this.dropDownClose.bind(this),open:this.dropDownOpen.bind(this),beforeItemRender:this.beforeDropDownItemRender.bind(this)}));return s.isStringTemplate=!0,s.createElement=r.parent.createElement,s.appendTo(e.element),e.element.tabIndex=-1,e.element.setAttribute("role","button"),document.getElementById(s.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),1===e.element.childElementCount&&s.element.insertBefore(n,s.element.querySelector(".e-caret")),e.element.tabIndex=-1,s.element.removeAttribute("type"),s.element.onmousedown=function(){r.parent.notify(Ve,{})},s.element.onkeydown=function(){r.parent.notify(Ve,{})},s},r.prototype.paletteSelection=function(e,t){var e=e.element.querySelector(".e-control.e-colorpicker"),e=[].slice.call(j.selectAll(".e-tile",e.parentElement)),n=(j.removeClass(e,"e-selected"),t.querySelector("."+Ei).style.borderBottomColor);e.filter(function(e){e.style.backgroundColor===n&&j.addClass([e],"e-selected")})},r.prototype.renderColorPickerDropDown=function(o,e,n,t){var r,i=this,s=this,a=Ei+" "+Si+(this.parent.inlineMode?" "+qn:""),l=(a=(a+=" "+("backgroundcolor"===e?Pi:Ui))+this.parent.getCssClass(!0),s.parent.createElement("span",{className:Ii})),d=s.parent.createElement("span",{className:o.cssClass}),t=j.isNullOrUndefined(t)?s.parent.backgroundColor.default:t,c=(d.style.borderBottomColor="backgroundcolor"===e?t:s.parent.fontColor.default,l.appendChild(d),new I.DropDownButton({target:n.element.parentElement,cssClass:a,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,beforeOpen:function(e){var t,n,i;s.parent.readonly||!s.parent.enabled?e.cancel=!0:(t=e.event?e.event.target:null,s.currentElement=c.element,s.currentDropdown=c,s.paletteSelection(e,s.currentElement),e.event&&"click"===e.event.type&&(t.classList.contains(Ii)||t.parentElement.classList.contains(Ii))?(e.cancel=!0,t=(t.classList.contains(Ei)?t:t.querySelector("."+Ei)).style.borderBottomColor,s.parent.notify(Qe,{}),n=(r=s.parent.formatter.editorManager.nodeSelection.getRange(s.parent.contentModule.getDocument())).startContainer.parentNode,i=j.closest(r.startContainer.parentNode,"table"),("TD"===r.startContainer.nodeName||"TH"===r.startContainer.nodeName||j.closest(r.startContainer.parentNode,"td,th")||s.parent.iframeSettings.enable&&!p(n.ownerDocument.querySelector("body"),"e-lib"))&&r.collapsed&&"BackgroundColor"===o.subCommand&&j.closest(i,"."+Cn)?s.parent.notify(Ze,{item:{command:o.command,subCommand:o.subCommand,value:t}}):s.parent.notify($e,{item:{command:o.command,subCommand:o.subCommand,value:t}})):(n=e.element.querySelector(".e-control.e-colorpicker"),(i=j.getInstance(n,P.ColorPicker)).showButtons=!e.element.querySelector(".e-color-palette"),i.dataBind(),e.element.onclick=function(e){e.target.classList.contains("e-cancel")&&c.toggle()}))},open:function(e){i.setColorPickerContentWidth(n);var t=e.element.querySelector(".e-control.e-colorpicker"),t=e.element.querySelector(".e-color-palette")?t.parentElement.querySelector(".e-palette"):t.parentElement.querySelector("e-handler");t&&t.focus(),i.pickerRefresh(e)},beforeClose:function(e){var t=e.event?e.event.target:null;e.event&&"click"===e.event.type&&(t.classList.contains(Ii)||t.parentElement.classList.contains(Ii))&&(e=(t.classList.contains(Ei)?t:t.querySelector("."+Ei)).style.borderBottomColor,("TD"===(r=s.parent.formatter.editorManager.nodeSelection.getRange(s.parent.contentModule.getDocument())).startContainer.nodeName||"TH"===r.startContainer.nodeName||j.closest(r.startContainer.parentNode,"td,th"))&&r.collapsed?s.parent.notify(Ze,{item:{command:o.command,subCommand:o.subCommand,value:e}}):s.parent.notify($e,{item:{command:o.command,subCommand:o.subCommand,value:e}}))},close:function(){s.parent.notify(Qe,{})}}));return c.isStringTemplate=!0,c.createElement=s.parent.createElement,o.element.setAttribute("role","button"),c.appendTo(o.element),document.getElementById(c.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),c.element.insertBefore(l,c.element.querySelector(".e-caret")),o.element.tabIndex=-1,c.element.removeAttribute("type"),c.element.onmousedown=function(){s.parent.notify(Ve,{})},c.element.onkeydown=function(){s.parent.notify(Ve,{})},c},r.prototype.pickerRefresh=function(e){"Picker"===this.parent.backgroundColor.mode&&((e=e.element.parentElement).style.width=(e.offsetWidth+5).toString()+"px",j.getInstance(e,U.Popup).refreshPosition(e),e.style.width=(e.offsetWidth-5).toString()+"px")},r.prototype.setColorPickerContentWidth=function(e){var t,e=e.element.nextSibling;"0px"===e.style.width&&(e.style.width="",t=parseInt(getComputedStyle(e).borderBottomWidth,10),e.style.width=j.formatUnit(e.children[0].offsetWidth+t+t))},r.prototype.renderColorPicker=function(i,n){var o=this,r=this,s=new P.ColorPicker({enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,inline:!0,value:null,cssClass:("backgroundcolor"===n?Fi:ji)+" "+i.cssClass+" e-rte-picker-init",created:function(){var e=("backgroundcolor"===n?r.parent.backgroundColor:r.parent.fontColor).default,t=("backgroundcolor"===n?Fi:ji)+" "+i.cssClass;s.setProperties({value:e,cssClass:t})},mode:("backgroundcolor"===n?r.parent.backgroundColor:r.parent.fontColor).mode,modeSwitcher:("backgroundcolor"===n?r.parent.backgroundColor:r.parent.fontColor).modeSwitcher,presetColors:("backgroundcolor"===n?this.parent.backgroundColor:this.parent.fontColor).colorCode,columns:("backgroundcolor"===n?this.parent.backgroundColor:this.parent.fontColor).columns,beforeTileRender:function(e){if(e.element.classList.add(Hi),e.element.classList.add(Co),!j.isNullOrUndefined(o.parent.cssClass))for(var t=o.parent.getCssClass().split(" "),n=0;n<t.length;n++)""!==t[n].trim()&&e.element.classList.add(t[n]);""===e.value&&e.element.classList.add(No)},change:function(e){var t=e.currentValue.rgba,t=(e.item={command:i.command,subCommand:i.subCommand,value:t},r.parent.notify(Qe,{}),r.currentElement.querySelector("."+Ei).style.borderBottomColor=t,r.parent.formatter.editorManager.nodeSelection.getRange(r.parent.contentModule.getDocument())),n=j.closest(t.startContainer.parentNode,"table");("TD"===t.startContainer.nodeName||"TH"===t.startContainer.nodeName||"BODY"===t.startContainer.nodeName||j.closest(t.startContainer.parentNode,"td,th"))&&t.collapsed&&"BackgroundColor"===i.subCommand&&j.closest(n,"."+Cn)?r.parent.notify(Ze,e):r.parent.notify($e,e),r.currentDropdown.toggle()},beforeModeSwitch:function(e){""===s.value&&s.setProperties({value:"Picker"===e.mode?"#008000ff":""},!0),s.showButtons="Palette"!==e.mode}});return s.isStringTemplate=!0,s.createElement=this.parent.createElement,s.appendTo(document.getElementById(i.target)),s},r.prototype.renderPanel=function(){this.getPanel().classList.add(Ln)},r.prototype.getPanel=function(){return this.toolbarPanel},r.prototype.setPanel=function(e){this.toolbarPanel=e},r.prototype.destroy=function(){if(!this.isDestroyed){if(this.tooltip&&!this.tooltip.isDestroyed){this.tooltip.destroy();for(var e=document.querySelectorAll('[data-rte-id="'+this.parent.getID()+'"]'),t=0;t<e.length;t++){var n=e[t];this.parent.getID()===n.getAttribute("data-rte-id")&&j.detach(n)}}this.unWireEvent(),this.mode=null,this.toolbarPanel=null,this.currentElement=null,this.currentDropdown=null,this.tooltip=null,this.tooltipTargetEle=null,this.isDestroyed=!0}};var ws=r;function r(e,t){this.parent=e,this.isDestroyed=!1,t&&(this.l10n=t.getService("rteLocale")),this.wireEvent()}s.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(Ne,this.linkDialog,this),this.parent.on(Qt,this.showDialog,this),this.parent.on(Wt,this.closeDialog,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(Be,this.showLinkQuickToolbar,this),this.parent.on(gt,this.clearDialogObj,this),this.parent.on(fe,this.onToolbarAction,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(Ee,this.removeLink,this),this.parent.on(Se,this.editLink,this),this.parent.on(Te,this.openLink,this),this.parent.on(Xe,this.editAreaClickHandler,this),this.parent.on(tn,this.setCssClass,this),this.parent.on(o,this.destroy,this))},s.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"OpenLink":this.parent.notify(Te,e);break;case"EditLink":this.parent.notify(Se,e);break;case"RemoveLink":this.parent.notify(Ee,e)}},s.prototype.removeEventListener=function(){this.parent.off(Ne,this.linkDialog),this.parent.off(Qt,this.showDialog),this.parent.off(Wt,this.closeDialog),this.parent.off(h,this.onKeyDown),this.parent.off(Be,this.showLinkQuickToolbar),this.parent.off(gt,this.clearDialogObj),this.parent.off(fe,this.onToolbarAction),this.parent.off(Ee,this.removeLink),this.parent.off(K,this.onIframeMouseDown),this.parent.off(Se,this.editLink),this.parent.off(Te,this.openLink),this.parent.off(Xe,this.editAreaClickHandler),this.parent.off(tn,this.setCssClass),this.parent.off(o,this.destroy)},s.prototype.onIframeMouseDown=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},s.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},s.prototype.setCssClass=function(e){this.updateCss(this.checkBoxObj,e),this.updateCss(this.dialogObj,e)},s.prototype.showLinkQuickToolbar=function(e){var t,n,i,o,r,s,a,l,d,c;j.isNullOrUndefined(e.args)||"enter"===e.args.action||"space"===e.args.action||(d=l=void 0,"Links"!==e.type)||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.linkQTBar)||(this.quickToolObj=this.parent.quickToolbarModule,t=this.parent.element.getBoundingClientRect().top,n=this.parent.element.getBoundingClientRect().left,i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),[].forEach.call(e.elements,function(e,t){0===t&&(o="#text"===e.nodeName?e.parentNode:e)}),d=e.isNotify?(a=this.parent.toolbarModule.getToolbarElement(),r=o.getBoundingClientRect().top,c=o.getBoundingClientRect().left,s=r-t,a=a?a.offsetHeight+this.parent.toolbarModule.getExpandTBarPopHeight():0,l=this.parent.iframeSettings.enable?n+c:o.getBoundingClientRect().left,window.pageYOffset+(this.parent.iframeSettings.enable?t+a+r:t+s)):(c=void 0,c=e.args.touches?e.args.changedTouches[0]:e.args,l=this.parent.iframeSettings.enable?window.pageXOffset+n+c.clientX:c.pageX,this.parent.iframeSettings.enable?window.pageYOffset+t+c.clientY:c.pageY),this.quickToolObj.linkQTBar&&this.quickToolObj.linkQTBar.showPopup(l,d,i.endContainer,"link"))},s.prototype.hideLinkQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.linkQTBar&&document.body.contains(this.quickToolObj.linkQTBar.element)&&this.quickToolObj.linkQTBar.hidePopup()},s.prototype.editAreaClickHandler=function(e){var t,n,i;this.parent.readonly?this.hideLinkQuickToolbar():(i=e.args,t=this.parent.quickToolbarSettings.showOnRightClick,2===i.which||t&&1===i.which||!t&&3===i.which||"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.linkQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,t=i.target,t=this.getAnchorNode(t),this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),n=this.quickToolObj.linkQTBar.element.classList.contains("e-rte-pop"),"A"===t.nodeName&&0<t.childNodes.length&&"IMG"!==t.childNodes[0].nodeName&&"IMG"!==e.args.target.nodeName&&!j.isNullOrUndefined(j.closest(this.parent.getRange().startContainer.parentElement,"A"))&&!j.isNullOrUndefined(j.closest(this.parent.getRange().endContainer.parentElement,"A"))?n||(!1===e.args.ctrlKey?this.showLinkQuickToolbar({args:i,isNotify:!1,type:"Links",elements:[i.target]}):(n=(t=this.parent.formatter.editorManager.nodeSelection).getRange(this.parent.contentModule.getDocument()),i={args:{item:{subCommand:"OpenLink",command:"Links",name:""},originalEvent:e.args},selectNode:t.getNodeCollection(n),selectParent:t.getParentNodeCollection(n),selection:t.save(n,this.parent.contentModule.getDocument())},this.parent.notify(Te,i))):this.hideLinkQuickToolbar()))},s.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"insert-link":this.openDialog(!0,e),t.preventDefault()}},s.prototype.openDialog=function(e,t){var n,i,o;e||this.parent.contentModule.getEditPanel().focus(),"HTML"===this.parent.editorMode?(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),i=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i),e={args:t?t.args:{item:{command:"Links",subCommand:"CreateLink"},originalEvent:void 0,name:e?null:"showDialog"},selectNode:o,selection:n,selectParent:i},this.linkDialog(e)):(o=this.parent.contentModule.getEditPanel(),this.parent.formatter.editorManager.markdownSelection.save(o.selectionStart,o.selectionEnd),this.linkDialog({args:{item:{command:"Links",subCommand:"Link"},originalEvent:t&&t.args},member:"link",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),module:"Markdown",name:"insertLink"}))},s.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},s.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},s.prototype.clearDialogObj=function(){this.dialogObj&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},s.prototype.linkDialog=function(e,t){var n,i,o,r,s,a,l,d,c,h,p=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):"HTML"===this.parent.editorMode&&0<e.selectParent.length&&!j.isNullOrUndefined(e.selectParent[0].classList)&&e.selectParent[0].classList.contains("e-rte-anchor")&&j.isNullOrUndefined(t)?this.editLink(e):(l=this.i10n.getConstant("linkWebUrl"),o=this.i10n.getConstant("linkText"),a=this.i10n.getConstant("linkTooltipLabel"),i=this.i10n.getConstant("linkurl"),r=this.i10n.getConstant("textPlaceholder"),s=this.i10n.getConstant("linkTitle"),n=this.parent.createElement("div",{className:"e-rte-link-dialog"+this.parent.getCssClass(!0),id:this.rteID+"_rtelink"}),this.parent.rootContainer.appendChild(n),h=this.parent.createElement("div",{className:"e-rte-linkcontent"+this.parent.getCssClass(!0),id:this.rteID+"_linkContent"}),a="HTML"===this.parent.editorMode?"<label>"+a+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" spellcheck="false" placeholder = "'+s+'"aria-label="'+this.i10n.getConstant("linkTitle")+'" class="e-input e-rte-linkTitle'+this.parent.getCssClass(!0)+'"></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="checkbox" class="e-rte-linkTarget'+this.parent.getCssClass(!0)+'"  data-role ="none"></div>':"",s=Lr('<div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+l+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" spellcheck="false" placeholder="'+i+'"aria-label="'+this.i10n.getConstant("linkWebUrl")+'" class="e-input e-rte-linkurl'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+o+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"> <input type="text" data-role ="none" spellcheck="false" class="e-input e-rte-linkText'+this.parent.getCssClass(!0)+'"aria-label="'+this.i10n.getConstant("linkText")+'" placeholder="'+r+'"></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'">'+a),h.appendChild(s),l=h.querySelector(".e-rte-linkTarget"),i=h.querySelector(".e-rte-linkurl"),o=h.querySelector(".e-rte-linkText"),r=h.querySelector(".e-rte-linkTitle"),a=this.i10n.getConstant("linkOpenInNewWindow"),this.checkBoxObj=new H.CheckBox({label:a,checked:!0,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass()}),this.checkBoxObj.isStringTemplate=!0,this.checkBoxObj.createElement=this.parent.createElement,this.checkBoxObj.appendTo(l),s="HTML"===this.parent.editorMode?e.selection.getRange(this.parent.contentModule.getDocument()).toString():e.text,a=this.i10n.getConstant("dialogInsert"),l=this.i10n.getConstant("dialogCancel"),d=e.selection,c={selfLink:this,selection:e.selection,selectParent:e.selectParent,args:e.args},h={header:this.i10n.getConstant("linkHeader"),content:h,cssClass:Ei+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"310px",isModal:j.Browser.isDevice,buttons:[{click:this.insertlink.bind(c),buttonModel:{content:a,cssClass:"e-flat e-insertLink"+this.parent.getCssClass(!0),isPrimary:!0}},{click:this.cancelDialog.bind(c),buttonModel:{cssClass:"e-flat"+this.parent.getCssClass(!0),content:l}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){p.parent.isBlur=!1,e&&e.event.returnValue&&("HTML"===p.parent.editorMode?d.restore():p.parent.formatter.editorManager.markdownSelection.restore(p.parent.contentModule.getEditPanel())),p.dialogObj.destroy(),j.detach(p.dialogObj.element);e=p.dialogObj;p.dialogRenderObj.close(e),p.dialogObj=null}},this.dialogObj=this.dialogRenderObj.render(h),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(n),n.style.maxHeight="inherit",j.isNullOrUndefined(this.dialogObj)||(j.isNullOrUndefined(t)||(i.value=t.url,o.value=t.text,r.value=t.title,t.target?this.checkBoxObj.checked=!0:this.checkBoxObj.checked=!1,this.dialogObj.header=t.header,this.dialogObj.element.querySelector(".e-insertLink").textContent=t.btnText),this.checkUrl(!1),("HTML"===this.parent.editorMode&&j.isNullOrUndefined(t)&&(!j.isNullOrUndefined(s)&&""!==s&&0===e.selection.range.startOffset||e.selection.range.startOffset!==e.selection.range.endOffset)||"Markdown"===e.module)&&(o.value=s),this.parent.element.ownerDocument.addEventListener("mousedown",this.mouseDown),this.quickToolObj&&(this.hideLinkQuickToolbar(),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup()))},s.prototype.insertlink=function(e){var t,n,i,o=this.selfLink.dialogObj.element,r=o.querySelector(".e-rte-linkurl").value,s=o.querySelector(".e-rte-linkText").value,o=("HTML"===this.selfLink.parent.editorMode&&(t=o.querySelector(".e-rte-linkTitle").value),this.selfLink.checkBoxObj.checked?"_blank":null),a=this.selfLink.checkBoxObj.checked?this.selfLink.i10n.getConstant("linkAriaLabel"):null;""===(r="Markdown"===this.selfLink.parent.editorMode&&""===r?"http://":r)?this.selfLink.checkUrl(!0):(this.selfLink.isUrl(r)?this.selfLink.checkUrl(!1):(s="Markdown"===this.selfLink.parent.editorMode?""!==s?s:"":""===s?r:s,this.selfLink.parent.enableAutoUrl||(r=-1<r.indexOf("http")?r:"http://"+r)),"HTML"===(n=this.selfLink).parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+n.parent.contentModule.getPanel().id+"']"))&&(n.parent.contentModule.getEditPanel().focus(),j.Browser.isIE&&n.parent.iframeSettings.enable&&this.selection.restore(),i=n.parent.formatter.editorManager.nodeSelection.getRange(n.parent.contentModule.getDocument()),this.selection=n.parent.formatter.editorManager.nodeSelection.save(i,n.parent.contentModule.getDocument()),this.selectParent=n.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i)),i={url:r,text:s,title:t,target:o,ariaLabel:a,selection:this.selection,selectParent:this.selectParent},document.body.contains(n.dialogObj.element)&&this.selfLink.dialogObj.hide({returnValue:!1}),vs()&&n.parent.iframeSettings.enable&&j.select("iframe",n.parent.element).contentWindow.focus(),"HTML"===n.parent.editorMode&&this.selection.restore(),0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),s=j.isNullOrUndefined(this.args)||"KeyK"!==this.args.code?this.args:(r=this.args,j.extend(this.args,{item:{command:"Links",subCommand:"CreateLink"},originalEvent:r},!0),{item:{command:"Links",subCommand:"CreateLink"},originalEvent:r}),this.selfLink.parent.formatter.process(this.selfLink.parent,s,!j.isNullOrUndefined(this.args)&&this.args.originalEvent,i),this.selfLink.parent.contentModule.getEditPanel().focus())},s.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},s.prototype.checkUrl=function(e){var t=this.dialogObj.element.querySelector(".e-rte-linkurl");e?(j.addClass([t],"e-error"),t.setSelectionRange(0,t.value.length),t.focus()):j.removeClass([t],"e-error")},s.prototype.removeLink=function(e){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var t=this.getAnchorNode(e.selectParent[0]);this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,selectParent:e.selectParent,selection:e.selection,text:t.innerText,subCommand:e.args.item.subCommand}),(vs()&&this.parent.iframeSettings.enable?j.select("iframe",this.parent.element).contentWindow:this.parent.contentModule.getEditPanel()).focus(),this.hideLinkQuickToolbar()},s.prototype.openLink=function(e){var t=this.getAnchorNode(e.selectParent[0]);!t.classList.contains("e-rte-anchor")&&"A"!==t.tagName||this.parent.formatter.process(this.parent,e.args,e.args,{url:t.href,text:t.innerText,target:""===t.target?"_self":"_blank",selectNode:e.selectNode,subCommand:e.args.item.subCommand})},s.prototype.getAnchorNode=function(e){var t=j.closest(e,"a");return t||e},s.prototype.editLink=function(e){var t=this.getAnchorNode(e.selectNode[0]),n=this.getAnchorNode(e.selectParent[0]);!(n="A"===t.nodeName?t:n).classList.contains("e-rte-anchor")&&"A"!==n.tagName||(t=this.i10n.getConstant("dialogUpdate"),n={url:n.getAttribute("href"),text:n.innerText,title:n.title,target:n.target,header:this.i10n.getConstant("editLink"),btnText:t},this.linkDialog(e,n))},s.prototype.cancelDialog=function(e){var t,n;this.selfLink.parent.isBlur=!1,this.selfLink.dialogObj.hide({returnValue:!0}),vs()?this.selection.restore():(t=window.scrollX,n=window.scrollY,this.selfLink.parent.contentModule.getEditPanel().focus(),window.scrollTo(t,n))},s.prototype.onDocumentClick=function(e){var t=e.target;!j.isNullOrUndefined(this.dialogObj)&&(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||(this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)||this.parent.inlineMode.enable&&!j.closest(t,"#"+this.dialogObj.element.id))&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_CreateLink")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_CreateLink"))&&(this.parent.notify(hn,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.element.ownerDocument.removeEventListener("mousedown",this.mouseDown),this.mouseDown=null,this.parent.isBlur=!0,Or(this.parent.element,"focusout"))},s.prototype.destroy=function(){this.isDestroyed||(this.parent.element.ownerDocument.removeEventListener("mousedown",this.mouseDown),this.mouseDown=null,this.removeEventListener(),this.isDestroyed=!0)},s.prototype.getModuleName=function(){return"link"};var ks=s;function s(e,t){this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.addEventListener(),this.serviceLocator=t,this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.isDestroyed=!1,this.mouseDown=this.onDocumentClick.bind(this)}var xs={h6:"###### ",h5:"##### ",h4:"#### ",h3:"### ",h2:"## ",h1:"# ",blockquote:"> ",pre:"```\n",p:""},Ds={Bold:"**",Italic:"*",StrikeThrough:"~~",InlineCode:"`",SubScript:"<sub>",SuperScript:"<sup>",UpperCase:"A-Z",LowerCase:"a-z"},Ms={OL:"1. ",UL:"- "},Bs={"toolbar-focus":"alt+f10",escape:"escape",backspace:"backspace","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-audio":"ctrl+shift+a","insert-video":"ctrl+alt+v","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",underline:"ctrl+u",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=",indents:"ctrl+]",outdents:"ctrl+[","html-source":"ctrl+shift+h","full-screen":"ctrl+shift+f","decrease-fontsize":"ctrl+shift+<","increase-fontsize":"ctrl+shift+>","justify-center":"ctrl+e","justify-full":"ctrl+j","justify-left":"ctrl+l","justify-right":"ctrl+r","clear-format":"ctrl+shift+r","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o",space:"space",enter:"enter",tab:"tab",delete:"delete","format-copy":"alt+shift+c","format-paste":"alt+shift+v",inlinecode:"ctrl+`"},Rs={"toolbar-focus":"alt+f10",escape:"27","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=","full-screen":"ctrl+shift+f","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o"},As={b:["strong"],strong:["b"],i:["emp","cite"],emp:["i","cite"],cite:["i","emp"]},Is=["BR","IMG"],Us={topLeft:[-1,-1],topRight:[1,-1],botRight:[1,1],botLeft:[-1,1]},Ps=["ArrowUp","ArrowDown","Enter","Tab","Escape"],Hs=(a.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(h,this.onKeyDown,this),this.parent.on(ne,this.onKeyUp,this),this.parent.on(xe,this.insertImage,this),this.parent.on(Kt,this.showDialog,this),this.parent.on(Yt,this.closeDialog,this),this.parent.on(be,this.onWindowResize,this),this.parent.on(Be,this.showImageQuickToolbar,this),this.parent.on(gt,this.clearDialogObj,this),this.parent.on(ue,this.onToolbarAction,this),this.parent.on(He,this.caption,this),this.parent.on(Ie,this.deleteImg,this),this.parent.on(Re,this.insertImgLink,this),this.parent.on(Ae,this.insertAltText,this),this.parent.on(Xe,this.editAreaClickHandler,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(je,this.imageSize,this),this.parent.on(ce,this.alignmentSelect,this),this.parent.on(n,this.afterRender,this),this.parent.on(qt,this.afterRender,this),this.parent.on(rt,this.imagePaste,this),this.parent.on(tn,this.setCssClass,this),this.parent.on(o,this.destroy,this))},a.prototype.removeEventListener=function(){var e;this.parent.isDestroyed||(this.parent.off(h,this.onKeyDown),this.parent.off(ne,this.onKeyUp),this.parent.off(be,this.onWindowResize),this.parent.off(xe,this.insertImage),this.parent.off(Kt,this.showDialog),this.parent.off(Yt,this.closeDialog),this.parent.off(Be,this.showImageQuickToolbar),this.parent.off(gt,this.clearDialogObj),this.parent.off(He,this.caption),this.parent.off(ue,this.onToolbarAction),this.parent.off(Ie,this.deleteImg),this.parent.off(Re,this.insertImgLink),this.parent.off(Ae,this.insertAltText),this.parent.off(Xe,this.editAreaClickHandler),this.parent.off(K,this.onIframeMouseDown),this.parent.off(je,this.imageSize),this.parent.off(ce,this.alignmentSelect),this.parent.off(n,this.afterRender),this.parent.off(qt,this.afterRender),this.parent.off(rt,this.imagePaste),this.parent.off(tn,this.setCssClass),this.parent.off(o,this.destroy),(e=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement).removeEventListener("drop",this.drop,!0),e.removeEventListener("dragstart",this.drag,!0),e.removeEventListener("dragenter",this.enter,!0),e.removeEventListener("dragover",this.start,!0),this.drop=null,this.drag=null,this.enter=null,this.start=null,j.isNullOrUndefined(this.contentModule))||(j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.imageClick),this.parent.formatter.editorManager.observer.off(ct,this.undoStack),this.parent.insertImageSettings.resize&&(j.EventHandler.remove(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null,j.EventHandler.remove(this.contentModule.getEditPanel(),"cut",this.onCutHandler),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing)))},a.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},a.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)||j.removeClass([this.popupObj.element],e.oldCssClass),j.addClass([this.popupObj.element],e.cssClass)),this.updateCss(this.checkBoxObj,e),this.updateCss(this.widthNum,e),this.updateCss(this.heightNum,e),this.updateCss(this.uploadObj,e),this.updateCss(this.dialogObj,e)},a.prototype.onIframeMouseDown=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},a.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),j.EventHandler.add(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.imageClick,this),this.parent.insertImageSettings.resize&&(j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick),j.EventHandler.add(this.contentModule.getEditPanel(),"cut",this.onCutHandler,this));var e=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement;e.addEventListener("drop",this.drop,!0),e.addEventListener("dragstart",this.drag,!0),e.addEventListener("dragenter",this.enter,!0),e.addEventListener("dragover",this.start,!0)},a.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text,o=(n.appendChild(i.cloneNode(!0)),n.querySelectorAll("img"));if(n.querySelector(".e-img-resize")&&0<o.length){for(var r=0;r<o.length;r++)o[r].style.outline="";j.detach(n.querySelector(".e-img-resize"));for(var s=n.cloneNode(!0),a=document.createDocumentFragment();s.firstChild;)a.appendChild(s.firstChild);this.parent.formatter.getUndoRedoStack()[t].text=a}}},a.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.imgEle.parentElement&&(this.imgEle.parentElement.style.cursor="auto"),j.Browser.isDevice&&j.removeClass([e.target.parentElement],"e-mob-span"),this.parent.trigger(Ce,{event:e,requestType:"images"}),this.parent.formatter.editorManager.observer.on(ct,this.undoStack,this),this.parent.formatter.saveData()},a.prototype.resizeStart=function(e,t){var n=this;if(!this.parent.readonly){var i=t||e.target;if(this.prevSelectedImgEle=this.imgEle,"IMG"===i.tagName&&(this.parent.preventDefaultResize(e),t=i,this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&j.detach(this.imgResizeDiv),this.imageResize(t)),i.classList.contains("e-rte-imageboxmark")){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.imageQTBar.hidePopup();for(var o=["topLeft","topRight","botLeft","botRight"],r=0;r<o.length;r++){var s=o[r];if(i.classList.contains("e-rte-"+s)){this.resizeBtnStat[s]=!0,this.currentResizeHandler=s,this.aspectRatio=this.findAspectRatio(this.imgEle);break}}j.Browser.isDevice&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&!this.imgResizeDiv.classList.contains("e-mob-span")?j.addClass([this.imgResizeDiv],"e-mob-span"):this.parent.trigger(ye,{event:e,requestType:"images"},function(e){e.cancel&&n.cancelResizeAction()}),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing,this),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd,this)}}},a.prototype.imageClick=function(e){j.Browser.isDevice&&("IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName||"IMG"===e.target.tagName?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),"IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName&&e.preventDefault()},a.prototype.onCutHandler=function(){this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&this.cancelResizeAction()},a.prototype.imageResize=function(e){this.resizeBtnInit(),this.imgEle=e,j.addClass([this.imgEle],"e-resize"),this.imgResizeDiv=this.parent.createElement("span",{className:"e-img-resize"+this.parent.getCssClass(!0),id:this.rteID+"_imgResize"}),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-topLeft"+this.parent.getCssClass(!0),styles:"cursor: nwse-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-topRight"+this.parent.getCssClass(!0),styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-botLeft"+this.parent.getCssClass(!0),styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-botRight"+this.parent.getCssClass(!0),styles:"cursor: nwse-resize"})),j.Browser.isDevice&&j.addClass([this.imgResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.imgResizePos(e,this.imgResizeDiv),this.resizeImgDupPos(e),this.contentModule.getEditPanel().appendChild(this.imgResizeDiv)},a.prototype.getPointX=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageX},a.prototype.getPointY=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageY},a.prototype.imgResizePos=function(e,t){var n=this.calcPos(e),i=n.top,n=n.left,o=e.getBoundingClientRect().width,r=e.getBoundingClientRect().height,e=j.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,s=j.Browser.isDevice?0:2;t.querySelector(".e-rte-botLeft").style.left=n-e+"px",t.querySelector(".e-rte-botLeft").style.top=r-e+i+"px",t.querySelector(".e-rte-botRight").style.left=o-(e-s)+n+"px",t.querySelector(".e-rte-botRight").style.top=r-e+i+"px",t.querySelector(".e-rte-topRight").style.left=o-(e-s)+n+"px",t.querySelector(".e-rte-topRight").style.top=i-e+"px",t.querySelector(".e-rte-topLeft").style.left=n-e+"px",t.querySelector(".e-rte-topLeft").style.top=i-e+"px"},a.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,o=(e.offsetParent&&(e.offsetParent.classList.contains("e-img-caption")||-1<["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName))?j.closest(e,"#"+this.parent.getID()+"_rte-edit-view"):e.offsetParent)||i.documentElement;o&&(o===i.body||o===i.documentElement)&&"static"===o.style.position;)o=o.parentNode;return o&&o!==e&&1===o.nodeType&&(n=o.getBoundingClientRect()),e.offsetParent&&e.offsetParent.classList.contains("e-img-caption")?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},a.prototype.setAspectRatio=function(e,t,n){var i,o,r,s;j.isNullOrUndefined(e.width)||(i=e.width,o=e.height,r=this.parent.insertImageSettings.resizeByPercent?"%":"px",s=""===e.style.width&&""===e.style.height,i===o||s?(this.setImageWidth(e,t,r),this.parent.insertImageSettings.resizeByPercent?this.removeImageHeight(e):this.setImageHeight(e,n,r)):""!==e.style.width&&""!==e.style.height?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):(this.setImageWidth(e,t,r),this.setImageHeight(e,n,r)):""!==e.style.width?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):this.setImageWidth(e,t,r):""!==e.style.height&&(this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):this.setImageHeight(e,n,r)))},a.prototype.setImageWidth=function(e,t,n){e.style.width=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("width",t.toString())},a.prototype.setImageHeight=function(e,t,n){e.style.height=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("height",t.toString())},a.prototype.removeImageHeight=function(e){e.style.height="",e.removeAttribute("height")},a.prototype.getImageDimension=function(e,t){return this.parent.insertImageSettings.resizeByPercent?(t=t.parentElement,this.pixToPerc(e,t)):e},a.prototype.pixToPerc=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},a.prototype.imgDupMouseMove=function(t,n,e){var i=this;this.parent.trigger(ve,{event:e,requestType:"images"},function(e){e.cancel?i.cancelResizeAction():parseInt(i.parent.insertImageSettings.minWidth,10)>=parseInt(t,10)||parseInt(i.parent.getInsertImgMaxWidth(),10)<=parseInt(t,10)&&j.isNullOrUndefined(i.imgEle.style.width)||!i.parent.insertImageSettings.resizeByPercent&&(parseInt(i.parent.insertImageSettings.minHeight,10)>=parseInt(n,10)||parseInt(i.parent.insertImageSettings.maxHeight,10)<=parseInt(n,10))||(i.imgEle.parentElement.style.cursor="pointer",i.setAspectRatio(i.imgEle,parseInt(t,10),parseInt(n,10)),i.resizeImgDupPos(i.imgEle),i.imgResizePos(i.imgEle,i.imgResizeDiv))})},a.prototype.resizing=function(e){var t,n,i,o,r,s,a;this.parent?(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)&&(t=this.getPointX(e),n=this.getPointY(e),a=this.getResizeFactor(this.currentResizeHandler),i=t-this.pageX,o=n-this.pageY,s=this.imgEle.clientWidth,r=this.imgEle.clientHeight,s=(s=i*a[0]+s)<16?16:s,a=(a=o*a[1]+r)<16?16:a,Math.abs(i)>Math.abs(o)?(a=Math.round(s/this.aspectRatio),s=Math.round(a*this.aspectRatio)):(s=Math.round(a*this.aspectRatio),a=Math.round(s/this.aspectRatio)),this.pageX=t,this.pageY=n,this.imgDupMouseMove(s+"px",a+"px",e)):this.cancelResizeAction()},a.prototype.getResizeFactor=function(e){return Us[e]},a.prototype.findAspectRatio=function(e){return e.clientWidth/e.clientHeight},a.prototype.cancelResizeAction=function(){j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.imgEle&&this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&(j.detach(this.imgResizeDiv),this.imgEle.style.outline="",this.imgResizeDiv=null,this.pageX=null,this.pageY=null,this.currentResizeHandler=null,this.aspectRatio=null)},a.prototype.resizeImgDupPos=function(e){this.imgDupPos={width:""!==e.style.width&&this.parent.insertImageSettings&&!this.parent.insertImageSettings.resizeByPercent?this.imgEle.style.width:e.width+"px",height:""!==e.style.height?this.imgEle.style.height:e.height+"px"}},a.prototype.resizeBtnInit=function(){return this.aspectRatio=null,this.currentResizeHandler=null,this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},a.prototype.onToolbarAction=function(e){switch(vs()&&this.parent.notify(Qe,{}),e.args.item.subCommand){case"Replace":this.parent.fileManagerSettings.enable?this.parent.notify(jt,e):this.parent.notify(xe,e);break;case"Caption":this.parent.notify(He,e);break;case"InsertLink":this.parent.notify(Re,e);break;case"AltText":this.parent.notify(Ae,e);break;case"Remove":this.parent.notify(Ie,e);break;case"Dimension":this.parent.notify(je,e);break;case"OpenImageLink":this.openImgLink(e);break;case"EditImageLink":this.editImgLink(e);break;case"RemoveImageLink":this.removeImgLink(e)}},a.prototype.openImgLink=function(e){var t=""===e.selectParent[0].parentNode.target?"_self":"_blank";this.parent.formatter.process(this.parent,e.args,e.args,{url:e.selectParent[0].parentNode.href,target:t,selectNode:e.selectNode,subCommand:e.args.item.subCommand})},a.prototype.editImgLink=function(e){var t=e.selectParent[0].parentNode,n=this.i10n.getConstant("dialogUpdate"),t={url:t.href,target:t.target,header:"Edit Link",btnText:n};this.insertImgLink(e,t)},a.prototype.removeImgLink=function(e){j.Browser.isIE&&this.contentModule.getEditPanel().focus(),e.selection.restore();var t=!(!this.contentModule.getEditPanel().contains(this.captionEle)||!j.select("a",this.captionEle)),n=t?[this.captionEle]:[e.selectNode[0].parentElement];this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:e.selectNode[0],selectParent:n,selection:e.selection,subCommand:e.args.item.subCommand}),this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.isNullOrUndefined(e.selectParent)||j.removeClass([e.selectParent[0]],"e-img-focus")),t&&j.select(".e-img-inner",this.captionEle).focus()},a.prototype.onKeyDown=function(e){var t,n,i,o,r,s,a,l=e.args;this.deletedImg=[];if(!(r="HTML"===this.parent.editorMode?(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===t.endContainer&&t.startOffset===t.endOffset:r)&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(l.which)<0)for(var d=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),c=0;c<d.length;c++)"IMG"===d[c].nodeName&&this.deletedImg.push(d[c]);switch("HTML"===this.parent.editorMode&&(8===l.which&&"Backspace"===l.code||46===l.which&&"Delete"===l.code)&&(e=t.startContainer===t.endContainer&&t.startOffset===t.endOffset,8===l.which&&"Backspace"===l.code&&e?this.checkImageBack(t):46===l.which&&"Delete"===l.code&&e&&this.checkImageDel(t)),j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===l.code||(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),o=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),l.ctrlKey)||!l.key||1!==l.key.length&&"enter"!==l.action||j.isNullOrUndefined(o[0])||"IMG"!==o[0].tagName||!o[0].parentElement||(this.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),j.removeClass([o[0]],"e-img-focus"),this.quickToolObj&&this.quickToolObj.imageQTBar&&this.quickToolObj.imageQTBar.hidePopup()),!l.ctrlKey||89!==l.keyCode&&90!==l.keyCode||"Markdown"!==this.parent.editorMode&&this.undoStack({subCommand:90===l.keyCode?"undo":"redo"}),8!==l.keyCode&&46!==l.keyCode||(i&&"IMG"===i[0].nodeName&&i.length<1&&(j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),l.preventDefault(),this.deleteImg({selectNode:i,selection:n,selectParent:o,args:{item:{command:"Images",subCommand:"Remove"},originalEvent:l}},l.keyCode)),this.parent.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle()),"Backspace"===l.code&&(l.action="backspace"),l.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":"Markdown"!==this.parent.editorMode&&(3===t.startContainer.nodeType?"Backspace"===l.code?t.startContainer.previousElementSibling&&0===t.startOffset&&t.startContainer.previousElementSibling.classList.contains(ci)&&t.startContainer.previousElementSibling.classList.contains(pi)&&j.detach(t.startContainer.previousElementSibling):t.startContainer.nextElementSibling&&t.endContainer.textContent.length===t.endOffset&&t.startContainer.nextElementSibling.classList.contains(ci)&&t.startContainer.nextElementSibling.classList.contains(pi)&&j.detach(t.startContainer.nextElementSibling):1===t.startContainer.nodeType&&(t.startContainer.querySelector("."+ci+"."+pi)?j.detach(t.startContainer.querySelector("."+ci+"."+pi)):t.startContainer.querySelector("."+ci+"."+ii)?j.detach(t.startContainer.querySelector("."+ci+"."+ii)):t.startContainer.classList.contains("e-img-wrap")&&j.closest(t.startContainer,"."+ci)&&(s=t.startContainer.parentElement.parentElement,j.detach(j.closest(t.startContainer,"."+ci)),s)&&""===s.textContent.trim()&&((a=this.parent.createElement("br")).classList.add("e-rte-image-remove-focus"),s.appendChild(a))));break;case"insert-image":j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),this.openDialog(!0,l,n,i,o),l.preventDefault()}l.ctrlKey&&"a"===l.key&&this.handleSelectAll()},a.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll("."+ao);j.removeClass(e,ao)},a.prototype.openDialog=function(e,t,n,i,o){var r,s,i=e||j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=n,s=i,o):(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n));"HTML"===this.parent.editorMode?this.insertImage({args:{item:{command:"Images",subCommand:"Image"},originalEvent:t,name:e?null:"showDialog"},selectNode:s,selection:r,selectParent:i}):this.insertImage({args:{item:{command:"Images",subCommand:"Image"},originalEvent:t,name:e?null:"showDialog"},member:"image",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),module:"Markdown",name:"insertImage"})},a.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},a.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},a.prototype.onKeyUp=function(){if(!j.isNullOrUndefined(this.deletedImg)&&0<this.deletedImg.length)for(var e=Array.from(this.deletedImg).length-1;0<=e;e--){var t={element:this.deletedImg[e],src:this.deletedImg[e].getAttribute("src")};this.parent.trigger(Bt,t),this.deletedImg.splice(e,1)}},a.prototype.checkImageBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||j.isNullOrUndefined(e.startContainer.previousSibling)||"IMG"!==e.startContainer.previousSibling.nodeName?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])||"IMG"!==e.startContainer.childNodes[e.startOffset-1].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedImg.push(e.startContainer.previousSibling)},a.prototype.checkImageDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||j.isNullOrUndefined(e.startContainer.nextSibling)||"IMG"!==e.startContainer.nextSibling.nodeName?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])||"IMG"!==e.startContainer.childNodes[e.startOffset].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset]):this.deletedImg.push(e.startContainer.nextSibling)},a.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Images"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),i={args:e,selectNode:n="IMG"===n[0].nodeName?n:[this.imgEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":this.alignImage(i);break;case"Inline":this.inline(i);break;case"Break":this.break(i)}this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.removeClass([n[0]],"e-img-focus")),this.cancelResizeAction()}},a.prototype.imageWithLinkQTBarItemUpdate=function(){for(var e=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item"),t=0;t<e.length;t++)e[t].getAttribute("title")===this.i10n.getConstant("openLink")||e[t].getAttribute("title")===this.i10n.getConstant("editLink")||e[t].getAttribute("title")===this.i10n.getConstant("removeLink")?(j.addClass([e[t]],"e-link-groups"),e[t].style.display="none"):"Insert Link"===e[t].getAttribute("title")?e[t].style.display="":e[t].classList.contains("e-rte-horizontal-separator")&&j.detach(e[t]);var n=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item:not(.e-link-groups)");this.quickToolObj.imageQTBar.addQTBarItem(["-"],Math.round(n.length/2))},a.prototype.showImageQuickToolbar=function(e){var t,n,i,o,r=this;"Images"!==e.type||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar)||j.isNullOrUndefined(e.args)||(this.quickToolObj=this.parent.quickToolbarModule,t=e.args,n=e.elements,[].forEach.call(e.elements,function(e,t){0===t&&(n=e)}),n&&!j.closest(n,"a")&&this.imageWithLinkQTBarItemUpdate(),"IMG"===n.nodeName&&j.addClass([n],["e-img-focus"]),i=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+t.clientY:t.pageY,this.parent.quickToolbarModule.imageQTBar&&(e.isNotify?this.imageQTPopupTime=setTimeout(function(){r.parent.formatter.editorManager.nodeSelection.Clear(r.contentModule.getDocument()),r.parent.formatter.editorManager.nodeSelection.setSelectionContents(r.contentModule.getDocument(),n),r.quickToolObj.imageQTBar.showPopup(t.pageX,i,n),r.resizeStart(e.args,n)},400):(o=n.getBoundingClientRect(),this.quickToolObj.imageQTBar.showPopup(o.left,o.top,n,"Image"))))},a.prototype.hideImageQuickToolbar=function(){j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-img-focus"))||(j.removeClass([this.contentModule.getEditPanel().querySelector(".e-img-focus")],"e-img-focus"),this.quickToolObj&&this.quickToolObj.imageQTBar&&document.body.contains(this.quickToolObj.imageQTBar.element)&&this.quickToolObj.imageQTBar.hidePopup())},a.prototype.editAreaClickHandler=function(e){if(this.parent.readonly)this.hideImageQuickToolbar();else{var t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick;if(2===t.which||n&&1===t.which||!n&&3===t.which)n&&1===t.which&&!j.isNullOrUndefined(t.target)&&"IMG"===t.target.tagName&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),t.target));else if("HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.imageQTBar){this.quickToolObj=this.parent.quickToolbarModule;var n=t.target,i=(this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),this.quickToolObj.imageQTBar.element.classList.contains("e-rte-pop"));if("IMG"===n.nodeName&&this.parent.quickToolbarModule){if(!i){this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n),vs()&&this.parent.notify(Ve,e),j.addClass([n],"e-img-focus");var o=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item");if(j.closest(n,"a")){for(var r=0;r<o.length;r++)o[r].getAttribute("title")===this.i10n.getConstant("openLink")||o[r].getAttribute("title")===this.i10n.getConstant("editLink")||o[r].getAttribute("title")===this.i10n.getConstant("removeLink")?(o[r].style.display="",j.removeClass([o[r]],"e-link-groups")):"Insert Link"===o[r].getAttribute("title")?o[r].style.display="none":o[r].classList.contains("e-rte-horizontal-separator")&&(o[r],j.detach(o[r]));i=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item:not(.e-link-groups)");this.quickToolObj.imageQTBar.addQTBarItem(["-"],Math.round(i.length/2))}else j.closest(n,"a")||this.imageWithLinkQTBarItemUpdate();this.showImageQuickToolbar({args:t,type:"Images",elements:[t.target]})}}else this.hideImageQuickToolbar()}}},a.prototype.insertImgLink=function(e,t){var n,i,o,r,s,a,l=this;"IMG"!==e.selectNode[0].nodeName||(this.imagDialog(e),j.isNullOrUndefined(this.dialogObj))||(n=this.parent.createElement("div",{className:"e-img-linkwrap"+this.parent.getCssClass(!0)}),s=this.i10n.getConstant("linkurl"),s=Lr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" class="e-input e-img-link'+this.parent.getCssClass(!0)+'" spellcheck="false" placeholder="'+s+'"/></div><div class="e-rte-label"></div><div class="e-rte-field"><input type="checkbox" class="e-rte-linkTarget'+this.parent.getCssClass(!0)+'"  data-role ="none"></div>'),n.appendChild(s),s=n.querySelector(".e-rte-linkTarget"),i=n.querySelector(".e-img-link"),r=this.i10n.getConstant("linkOpenInNewWindow"),this.checkBoxObj=new H.CheckBox({label:r,checked:!0,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),change:function(e){o=e.checked?"_blank":null}}),this.checkBoxObj.isStringTemplate=!0,this.checkBoxObj.createElement=this.parent.createElement,this.checkBoxObj.appendTo(s),o="_blank",r=this.i10n.getConstant("imageLinkAriaLabel"),s=this.i10n.getConstant("dialogUpdate"),a={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode,selectParent:e.selectParent,link:i,target:o,ariaLabel:r},this.dialogObj.setProperties({width:"290px",header:this.parent.localeObj.getConstant("imageInsertLinkHeader"),content:n,buttons:[{click:function(e){l.insertlink(a)},buttonModel:{content:s,cssClass:"e-flat e-update-link"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-link-dialog"}),j.isNullOrUndefined(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),j.isNullOrUndefined(t)||(i.value=t.url,this.checkBoxObj.checked=!!t.target,this.dialogObj.header=t.header),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},a.prototype.insertAltText=function(e){var t,n,i,o,r,s,a=this;"IMG"!==e.selectNode[0].nodeName||(this.imagDialog(e),o=this.i10n.getConstant("altText"),j.isNullOrUndefined(this.dialogObj))||(t=this.parent.createElement("div",{className:"e-img-altwrap"+this.parent.getCssClass(!0)}),n=this.i10n.getConstant("alternateHeader"),i=this.i10n.getConstant("dialogUpdate"),r=null===e.selectNode[0].getAttribute("alt")?"":e.selectNode[0].getAttribute("alt"),(o=Lr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" spellcheck="false"  class="e-input e-img-alt'+this.parent.getCssClass(!0)+'" placeholder="'+o+'"/></div>')).querySelector("input").setAttribute("value",r),t.appendChild(o),r=t.querySelector(".e-img-alt"),s={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode,alt:r},this.dialogObj.setProperties({width:"290px",header:n,content:t,buttons:[{click:function(e){a.insertAlt(s)},buttonModel:{content:i,cssClass:"e-flat e-update-alt"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-alt-dialog"}),j.isNullOrUndefined(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},a.prototype.insertAlt=function(e){var t;j.isNullOrUndefined(e.alt)||(e.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t=e.alt.value,this.parent.formatter.process(this.parent,e.args,e.args,{altText:t,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.dialogObj.hide({returnValue:!1}))},a.prototype.insertlink=function(e){var t,n;"IMG"===e.selectNode[0].nodeName&&(""===(n=e.link.value)?(j.addClass([e.link],"e-error"),e.link.setSelectionRange(0,n.length),e.link.focus()):(this.isUrl(n)?j.removeClass([e.link],"e-error"):n="http://"+n,"HTML"===(t=e.selfImage).parent.editorMode&&e.selection.restore(),0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),"A"===e.selectNode[0].parentElement.nodeName?(t.parent.formatter.process(t.parent,e.args,e.args,{url:n,target:t.checkBoxObj.checked?"_blank":null,ariaLabel:t.checkBoxObj.checked?this.i10n.getConstant("imageLinkAriaLabel"):null,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),t.dialogObj.hide({returnValue:!0})):(t.parent.formatter.process(t.parent,e.args,e.args,{url:n,target:t.checkBoxObj.checked?"_blank":null,ariaLabel:t.checkBoxObj.checked?this.i10n.getConstant("imageLinkAriaLabel"):null,selectNode:e.selectNode,subCommand:e.args.item.subCommand,selection:e.selection}),(n=j.closest(e.selectNode[0],".e-img-caption"))&&j.select(".e-img-inner",n).focus(),n&&j.select(".e-img-inner",n).focus(),t.dialogObj.hide({returnValue:!1}))))},a.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},a.prototype.deleteImg=function(e,t){if("IMG"===e.selectNode[0].nodeName){var n={element:e.selectNode[0],src:e.selectNode[0].getAttribute("src")},i=(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.range.startContainer);if("SPAN"===e.selection.range.startContainer.nodeName&&i.classList.contains("e-img-wrap")&&i.parentElement.classList.contains("e-img-caption"))if(i=i.parentElement,j.isNullOrUndefined(i.previousSibling)){if(!j.isNullOrUndefined(i.nextSibling)){for(var o=i.nextSibling;"#text"!==o.nodeName&&"BR"!==o.nodeName;)o=o.firstChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),o,0)}}else{for(var r=i.previousSibling;"#text"!==r.nodeName&&"BR"!==r.nodeName;)r=r.lastChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),r,"BR"!==r.nodeName?r.textContent.length:0)}else e.selection.restore();this.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,captionClass:ci,subCommand:e.args.item.subCommand}),this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&this.quickToolObj.imageQTBar.hidePopup(),this.cancelResizeAction(),j.isNullOrUndefined(t)&&this.parent.trigger(Bt,n)}},a.prototype.caption=function(e){var t,n,i,o,r=e.selectNode[0];"IMG"===r.nodeName&&(e.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.cancelResizeAction(),j.addClass([r],"e-rte-image"),t=e.args.item?e.args.item.subCommand:"Caption",j.isNullOrUndefined(j.closest(r,"."+ci))?(this.captionEle=this.parent.createElement("span",{className:ci+" "+hi+this.parent.getCssClass(!0),attrs:{contenteditable:"false",draggable:"false",style:"width:"+this.parent.insertImageSettings.width}}),n=this.parent.createElement("span",{className:"e-img-wrap"+this.parent.getCssClass(!0)}),i=this.parent.createElement("span",{className:"e-img-inner"+this.parent.getCssClass(!0),attrs:{contenteditable:"true"}}),"A"===(o=e.selectNode[0].parentElement).tagName&&o.setAttribute("contenteditable","true"),n.appendChild("A"===o.tagName?o:e.selectNode[0]),n.appendChild(i),o=this.i10n.getConstant("imageCaption"),i.innerHTML=o,this.captionEle.appendChild(n),r.classList.contains(ui)&&j.addClass([this.captionEle],pi),r.classList.contains(ii)&&j.addClass([this.captionEle],ii),r.classList.contains(ti)&&j.addClass([this.captionEle],ti),r.classList.contains(ei)&&j.addClass([this.captionEle],ei),r.classList.contains(ni)&&j.addClass([this.captionEle],ni),this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:this.captionEle,selectNode:e.selectNode,subCommand:t}),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),i.childNodes[0],i.childNodes[0],0,i.childNodes[0].textContent.length)):(j.detach(j.closest(r,"."+ci)),j.Browser.isIE&&(this.contentModule.getEditPanel().focus(),e.selection.restore()),"A"===r.parentElement.tagName?this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:r.parentElement,selectNode:e.selectNode,subCommand:t}):this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:r,selectNode:e.selectNode,subCommand:t})),this.quickToolObj)&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.removeClass([r],"e-img-focus"))},a.prototype.imageSize=function(e){var t,n,i,o,r=this;"IMG"!==e.selectNode[0].nodeName||(this.imagDialog(e),j.isNullOrUndefined(this.dialogObj))||(t=this.i10n.getConstant("imageSizeHeader"),n=this.i10n.getConstant("dialogUpdate"),i=this.imgsizeInput(e),o={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode},this.dialogObj.setProperties({width:"290px",header:t,content:i,buttons:[{click:function(e){r.insertSize(o)},buttonModel:{content:n,cssClass:"e-flat e-update-size"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-size-dialog"}),j.isNullOrUndefined(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},a.prototype.break=function(e){var t;"IMG"===e.selectNode[0].nodeName&&(t=e.args.item.subCommand,this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t}))},a.prototype.inline=function(e){var t;"IMG"===e.selectNode[0].nodeName&&(t=e.args.item.subCommand,this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t}))},a.prototype.alignImage=function(e){var t=e.args.item.subCommand;this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})},a.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),j.detach(this.uploadObj.element),this.uploadObj=null),this.checkBoxObj&&!this.checkBoxObj.isDestroyed&&(this.checkBoxObj.destroy(),j.detach(this.checkBoxObj.element),this.checkBoxObj=null),this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.destroy(),j.detach(this.popupObj.element),this.popupObj=null),this.widthNum&&!this.widthNum.isDestroyed&&(this.widthNum.destroy(),j.detach(this.widthNum.element),this.widthNum=null),this.heightNum&&!this.heightNum.isDestroyed&&(this.heightNum.destroy(),j.detach(this.heightNum.element),this.heightNum=null),this.browseButton&&!this.browseButton.isDestroyed&&(this.browseButton.destroy(),j.detach(this.browseButton.element),this.browseButton=null),this.dialogObj&&!this.dialogObj.isDestroyed&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},a.prototype.imagDialog=function(e){var t,n,i,o,r,s,a=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-img-dialog"+this.parent.getCssClass(!0),id:this.rteID+"_image"}),this.parent.rootContainer.appendChild(t),r=this.i10n.getConstant("dialogInsert"),s=this.i10n.getConstant("dialogCancel"),i=this.i10n.getConstant("imageHeader"),n=e.selection,o={selfImage:this,selection:e.selection,args:e.args,selectParent:e.selectParent},i={header:i,cssClass:Ei+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",isModal:j.Browser.isDevice,buttons:[{click:this.insertImageUrl.bind(o),buttonModel:{content:r,cssClass:"e-flat e-insertImage"+this.parent.getCssClass(!0),isPrimary:!0,disabled:"Markdown"!==this.parent.editorMode}},{click:this.cancelDialog.bind(this),buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:s}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){e&&"user action"!==e.closedBy&&0<a.uploadObj.filesData.length&&a.uploadObj.remove(),a.parent.isBlur=!1,e&&!j.isNullOrUndefined(e.event)&&e.event.returnValue&&("HTML"===a.parent.editorMode?n.restore():a.parent.formatter.editorManager.markdownSelection.restore(a.parent.contentModule.getEditPanel())),a.clearDialogObj(),a.dialogRenderObj.close(e)}},o=this.parent.createElement("div",{className:"e-img-content"+this.parent.getCssClass(!0)}),(j.isNullOrUndefined(this.parent.insertImageSettings.path)||"Markdown"!==this.parent.editorMode)&&"HTML"!==this.parent.editorMode||o.appendChild(this.imgUpload(e)),r=this.parent.createElement("div",{className:"e-linkheader"+this.parent.getCssClass(!0)}),s=this.i10n.getConstant("imageLinkHeader"),"HTML"===this.parent.editorMode?r.innerHTML=s:r.innerHTML=this.i10n.getConstant("mdimageLink"),o.appendChild(r),o.appendChild(this.imageUrlPopup(e)),e.selectNode&&"IMG"===e.selectNode[0].nodeName?(i.header=this.parent.localeObj.getConstant("editImageHeader"),i.content=o,i.buttons[0].buttonModel.cssClass=i.buttons[0].buttonModel.cssClass+" e-updateImage"):i.content=o,this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),j.isNullOrUndefined(this.dialogObj)||(e.selectNode&&"IMG"===e.selectNode[0].nodeName&&"insertImage"===e.name&&(this.dialogObj.element.querySelector(".e-insertImage").textContent=this.parent.localeObj.getConstant("dialogUpdate")),t.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.imageQTBar&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.isNullOrUndefined(e.selectParent)||j.removeClass([e.selectParent[0]],"e-img-focus")),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup()))},a.prototype.cancelDialog=function(){this.parent.isBlur=!1,0<this.uploadObj.filesData.length&&this.uploadObj.remove(),this.dialogObj.hide({returnValue:!0})},a.prototype.onDocumentClick=function(e){var t=e.target;if(!j.isNullOrUndefined(this.contentModule.getEditPanel())&&("IMG"===t.nodeName&&(this.imgEle=t),this.parent)){if("#document"!==t.nodeName&&(this.parent.currentTarget=e.target),j.isNullOrUndefined(this.dialogObj)||!(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_Image")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Image"))||e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(hn,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Or(this.parent.element,"focusout")),this.parent.iframeSettings.enable&&!j.isNullOrUndefined(this.parent.currentTarget)&&"IMG"===this.parent.currentTarget.nodeName||"IMG"===e.target.tagName||!this.imgResizeDiv||this.quickToolObj&&this.quickToolObj.imageQTBar&&this.quickToolObj.imageQTBar.element.contains(e.target)||!this.contentModule.getEditPanel().contains(this.imgResizeDiv)||this.cancelResizeAction(),!this.contentModule.getEditPanel().querySelector(".e-img-resize")||this.parent.iframeSettings.enable&&"IMG"===this.parent.currentTarget.nodeName||("IMG"!==t.tagName&&this.removeResizeEle(),"IMG"===t.tagName||j.isNullOrUndefined(this.imgEle)?j.isNullOrUndefined(this.prevSelectedImgEle)||this.prevSelectedImgEle===t||(this.prevSelectedImgEle.style.outline=""):this.imgEle.style.outline=""),"IMG"!==t.tagName)for(var n=this.contentModule.getEditPanel().querySelectorAll("img"),i=0;i<n.length;i++)j.removeClass([n[i]],"e-img-focus"),j.removeClass([n[i]],"e-resize");this.parent.inlineMode.enable&&t&&this.dialogObj&&!j.closest(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide()}},a.prototype.removeResizeEle=function(){j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),j.detach(this.contentModule.getEditPanel().querySelector(".e-img-resize"))},a.prototype.onWindowResize=function(){j.isNullOrUndefined(this.contentModule)||j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-img-resize"))||this.cancelResizeAction()},a.prototype.imageUrlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"imgUrl"+this.parent.getCssClass(!0)}),i=this.i10n.getConstant("imageUrl");return this.inputUrl=this.parent.createElement("input",{className:"e-input e-img-url"+this.parent.getCssClass(!0),attrs:{placeholder:i,spellcheck:"false","aria-label":this.i10n.getConstant("imageLinkHeader")}}),this.inputUrl.addEventListener("input",function(){j.isNullOrUndefined(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),e.selectNode&&"IMG"===e.selectNode[0].nodeName&&(i=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),this.inputUrl.value=e.selectNode[0].src.match(i)?e.selectNode[0].src:""),n.appendChild(this.inputUrl),n},a.prototype.insertImageUrl=function(e){var t=this.selfImage,n=(t.isImgUploaded=!1,t.inputUrl.value);e.target&&"BUTTON"===e.target.nodeName&&e.target.classList.contains("e-updateImage")&&(e=this.selectNode&&this.selectNode[0]&&"IMG"===this.selectNode[0].nodeName?this.selectNode[0]:null,t.parent.trigger(Bt,{element:e,src:n})),"Markdown"===t.parent.editorMode&&""===n&&(n="http://"),0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),j.isNullOrUndefined(t.uploadUrl)||""===t.uploadUrl.url?""!==n&&("HTML"===t.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+t.contentModule.getPanel().id+"']"))&&(t.contentModule.getEditPanel().focus(),e=t.parent.formatter.editorManager.nodeSelection.getRange(t.contentModule.getDocument()),this.selection=t.parent.formatter.editorManager.nodeSelection.save(e,t.contentModule.getDocument()),this.selectParent=t.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(e)),e=j.isNullOrUndefined(n.match(e=/[\w-]+.(jpg|png|jpeg|gif)/g))||"HTML"!==t.parent.editorMode?"":n.match(e)[0],n={cssClass:"inline"===t.parent.insertImageSettings.display?ui:ii,url:n,selection:this.selection,altText:e,selectParent:this.selectParent,width:{width:t.parent.insertImageSettings.width,minWidth:t.parent.insertImageSettings.minWidth,maxWidth:t.parent.getInsertImgMaxWidth()},height:{height:t.parent.insertImageSettings.height,minHeight:t.parent.insertImageSettings.minHeight,maxHeight:t.parent.insertImageSettings.maxHeight}},t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,n),t.dialogObj.hide({returnValue:!1})):(t.uploadUrl.cssClass="inline"===t.parent.insertImageSettings.display?ui:ii,t.dialogObj.hide({returnValue:!1}),t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,t.uploadUrl),t.uploadUrl.url="",t.contentModule.getEditPanel().querySelector(".e-img-resize")&&(t.imgEle.style.outline="",t.removeResizeEle()))},a.prototype.imgsizeInput=function(e){var t=this,e=e.selectNode[0],n=this.i10n.getConstant("imageHeight"),i=this.i10n.getConstant("imageWidth"),o=this.parent.createElement("div",{className:"e-img-sizewrap"+this.parent.getCssClass(!0)}),r=!j.isNullOrUndefined(this.changedWidthValue)||"auto"!==e.style.width.toString()&&""===e.style.width?j.isNullOrUndefined(this.changedWidthValue)?parseInt(e.getClientRects()[0].width.toString(),10).toString():this.changedWidthValue:e.style.width,s=!j.isNullOrUndefined(this.changedHeightValue)||"auto"!==e.style.height.toString()&&""===e.style.height?j.isNullOrUndefined(this.changedHeightValue)?parseInt(e.getClientRects()[0].height.toString(),10).toString():this.changedHeightValue:e.style.height;""===e.style.width&&(r="auto"),""===e.style.height&&(s="auto"),this.changedWidthValue=null,this.changedHeightValue=null;e=Lr('<div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+i+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" id="imgwidth" class="e-img-width'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+n+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"> <input type="text" id="imgheight" class="e-img-height'+this.parent.getCssClass(!0)+'"/></div>');return e.getElementById("imgwidth").setAttribute("value",r),e.getElementById("imgheight").setAttribute("value",s),o.appendChild(e),this.widthNum=new P.TextBox({value:j.formatUnit(r),enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),input:function(e){t.inputWidthValue=j.formatUnit(t.inputValue(e.value))}}),this.widthNum.createElement=this.parent.createElement,this.widthNum.appendTo(o.querySelector("#imgwidth")),this.heightNum=new P.TextBox({value:j.formatUnit(s),enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),input:function(e){t.inputHeightValue=j.formatUnit(t.inputValue(e.value))}}),this.heightNum.createElement=this.parent.createElement,this.heightNum.appendTo(o.querySelector("#imgheight")),o},a.prototype.inputValue=function(e){return"auto"===e||-1!==e.indexOf("%")||-1!==e.indexOf("px")||e.match(/(\d+)/)?e:"auto"},a.prototype.insertSize=function(e){e.selection.restore();var t=e.selfImage,n=(0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),t.dialogObj.element),i=(this.changedWidthValue=this.inputWidthValue,this.changedHeightValue=this.inputHeightValue,n.querySelector(".e-img-width").value),n=n.parentElement.querySelector(".e-img-height").value;t.parent.formatter.process(this.parent,e.args,e.args,{width:i,height:n,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.imgResizeDiv&&t.imgResizePos(e.selectNode[0],this.imgResizeDiv),t.dialogObj.hide({returnValue:!0})},a.prototype.insertImage=function(e){this.imagDialog(e),j.isNullOrUndefined(this.dialogObj)||(this.dialogObj.element.style.maxHeight="inherit",e=this.dialogObj.element.querySelector(".e-img-content"),(!j.isNullOrUndefined(this.parent.insertImageSettings.path)&&"Markdown"===this.parent.editorMode||"HTML"===this.parent.editorMode?document.getElementById(this.rteID+"_insertImage"):e.querySelector(".e-img-url")).focus())},a.prototype.imgUpload=function(e){var i,o,r,s=this,a=this,t=a.parent.iframeSettings.enable,t=(o="HTML"===a.parent.editorMode&&(!t&&j.isNullOrUndefined(j.closest(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||t&&!p(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))?(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)):(i=e.selection,e.selectParent),this.parent.createElement("div",{className:"e-img-uploadwrap e-droparea"+this.parent.getCssClass(!0)})),e=this.i10n.getConstant("imageDeviceUploadMessage"),n=this.i10n.getConstant("imageUploadMessage"),l=this.parent.createElement("span",{className:"e-droptext"+this.parent.getCssClass(!0)}),e=this.parent.createElement("span",{className:"e-rte-upload-text"+this.parent.getCssClass(!0),innerHTML:j.Browser.isDevice?e:n}),n=(l.appendChild(e),this.parent.createElement("button",{className:"e-browsebtn"+this.parent.getCssClass(!0),id:this.rteID+"_insertImage",attrs:{autofocus:"true",type:"button"}})),e=(l.appendChild(n),t.appendChild(l),this.i10n.getConstant("browse")),e=(this.browseButton=new H.Button({content:e,enableRtl:this.parent.enableRtl}),this.browseButton.isStringTemplate=!0,this.browseButton.createElement=this.parent.createElement,this.browseButton.appendTo(n),j.Browser.isDevice?l:n),n=(j.EventHandler.add(e,"click",this.fileSelect,this),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"},className:this.parent.getCssClass()})),d=(t.appendChild(n),null);return this.uploadObj=new P.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},dropArea:l,multiple:!1,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),selected:function(e){a.isImgUploaded=!0,e.filesData,s.parent.trigger(Et,e,function(e){var n;e.cancel||(s.checkExtension(e.filesData[0]),r=e.filesData[0].name.replace(/\.[a-zA-Z0-9]+$/,""),"HTML"===s.parent.editorMode&&j.isNullOrUndefined(s.parent.insertImageSettings.path)&&((n=new FileReader).addEventListener("load",function(e){var t="Base64"===s.parent.insertImageSettings.saveFormat?n.result:URL.createObjectURL(Ir(n.result));a.uploadUrl={url:t,selection:i,altText:r,selectParent:o,width:{width:a.parent.insertImageSettings.width,minWidth:a.parent.insertImageSettings.minWidth,maxWidth:a.parent.getInsertImgMaxWidth()},height:{height:a.parent.insertImageSettings.height,minHeight:a.parent.insertImageSettings.minHeight,maxHeight:a.parent.insertImageSettings.maxHeight}},a.inputUrl.setAttribute("disabled","true"),j.isNullOrUndefined(a.parent.insertImageSettings.saveUrl)&&s.isAllowedTypes&&!j.isNullOrUndefined(s.dialogObj)&&s.dialogObj.getButtons(0).element.removeAttribute("disabled")}),n.readAsDataURL(e.filesData[0].rawFile)))})},beforeUpload:function(e){s.parent.trigger(Ut,e)},uploading:function(e){s.parent.isServerRendered||s.parent.trigger(St,e)},success:function(e){e.detectImageSource=c.ImageInputSource.Uploaded,s.parent.trigger(Tt,e,function(e){var t;j.isNullOrUndefined(s.parent.insertImageSettings.path)||(t=s.parent.insertImageSettings.path+e.file.name,j.isNullOrUndefined(d)||"upload"!==e.operation||s.uploadObj.remove(d),a.uploadUrl={url:t,selection:i,altText:r,selectParent:o,width:{width:a.parent.insertImageSettings.width,minWidth:a.parent.insertImageSettings.minWidth,maxWidth:a.parent.getInsertImgMaxWidth()},height:{height:a.parent.insertImageSettings.height,minHeight:a.parent.insertImageSettings.minHeight,maxHeight:a.parent.insertImageSettings.maxHeight}},a.inputUrl.setAttribute("disabled","true"),d=e.file),"upload"!==e.operation||j.isNullOrUndefined(s.dialogObj)||s.dialogObj.getButtons(0).element.removeAttribute("disabled")})},failure:function(e){s.parent.trigger(Ot,e)},removing:function(e){s.parent.trigger(Lt,e,function(e){a.isImgUploaded=!1,s.dialogObj.getButtons(0).element.disabled=!0,a.inputUrl.removeAttribute("disabled"),a.uploadUrl&&(a.uploadUrl.url="")})}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(n),t},a.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&e.type&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},a.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},a.prototype.dragStart=function(t){if("IMG"!==t.target.nodeName)return!0;this.parent.trigger(Oe,t,function(e){e.cancel?t.preventDefault():(t.dataTransfer.effectAllowed="copyMove",t.target.classList.add(ho))})},a.prototype.dragEnter=function(e){e.dataTransfer.dropEffect="copy",e.preventDefault()},a.prototype.dragOver=function(e){if(!("edge"===j.Browser.info.name&&-1<e.dataTransfer.items[0].type.split("/")[0].indexOf("image")||j.Browser.isIE&&"Files"===e.dataTransfer.types[0]))return!0;e.preventDefault()},a.prototype.dragDrop=function(e){var i=this;this.parent.trigger(Ft,e,function(e){var t,n=i.parent.inputElement.ownerDocument.querySelector("."+ho),n=n&&"IMG"===n.tagName||0<e.dataTransfer.files.length;!e.cancel&&n?j.closest(e.target,"#"+i.parent.getID()+"_toolbar")||"false"===i.parent.inputElement.contentEditable?e.preventDefault():(i.parent.element.querySelector("."+mo)&&j.detach(i.imgResizeDiv),e.preventDefault(),t=void 0,i.contentModule.getDocument().caretRangeFromPoint?t=i.contentModule.getDocument().caretRangeFromPoint(e.clientX,e.clientY):e.rangeParent?(t=i.contentModule.getDocument().createRange()).setStart(e.rangeParent,e.rangeOffset):t=i.getDropRange(e.clientX,e.clientY),i.parent.notify(nt,{range:t}),i.parent.element.querySelector("."+go)||i.insertDragImage(e)):n&&e.preventDefault()})},a.prototype.getDropRange=function(e,t){var n=this.contentModule.getDocument().createRange(),t=(this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(),n),this.contentModule.getDocument().elementFromPoint(e,t)),i=0<t.childNodes.length?t.childNodes[0]:t,o=0;if("<br>"===this.parent.inputElement.firstChild.innerHTML)n.setStart(i,o),n.setEnd(i,o);else for(;n.setStart(i,++o),n.setEnd(i,o+1),n.getBoundingClientRect().left<e&&o<i.length-1;);return n},a.prototype.insertDragImage=function(n){var i=this,e=(n.preventDefault(),this.parent.element.querySelector(uo)),o=(this.parent.notify(At,{args:n}),e&&e.classList.add(Yn),this.parent.inputElement.ownerDocument.querySelector("."+ho)),t={requestType:"Images",name:"ImageDragAndDrop",cancel:!1,originalEvent:n};if(0<n.dataTransfer.files.length&&null===o){if(!(1<n.dataTransfer.files.length))for(var r=n.dataTransfer.files,e=r[0].name,s=e.substring(e.lastIndexOf(".")),a=this.parent.insertImageSettings.allowedTypes,l=0;l<a.length;l++)s.toLocaleLowerCase()===a[l].toLowerCase()&&(this.parent.insertImageSettings.saveUrl?this.onSelect(n):this.parent.trigger(Oe,t,function(e){e.cancel?e.originalEvent.preventDefault():(e={args:n,text:"",file:r[0]},n.preventDefault(),i.imagePaste(e))}))}else this.parent.trigger(Oe,t,function(e){var t;e.cancel?e.originalEvent.preventDefault():(e=i.parent.formatter.editorManager.nodeSelection.getRange(i.parent.contentModule.getDocument()),o&&"IMG"===o.tagName&&(o.nextElementSibling&&o.nextElementSibling.classList.contains(fo)?e.insertNode(o.parentElement.parentElement):e.insertNode(o),o.classList.remove(ho),t={elements:[o]},o.addEventListener("load",function(){i.parent.trigger(Le,t)}),i.parent.formatter.editorManager.nodeSelection.Clear(i.contentModule.getDocument()),i.resizeStart(n,o),i.hideImageQuickToolbar()))})},a.prototype.onSelect=function(n){var i=this,t=this,o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.createElement("ul",{className:bo}),e=(this.parent.rootContainer.appendChild(r),{name:n.dataTransfer.files[0].name,size:n.dataTransfer.files[0].size,status:"",statusCode:"",type:n.dataTransfer.files[0].type,rawFile:n.dataTransfer.files[0],validationMessages:{}}),s=this.parent.createElement("IMG"),e=(s.style.opacity="0.5",s.classList.add(ro),s.classList.add(ui),s.classList.add(so),e.rawFile),a=new FileReader,l=(a.addEventListener("load",function(){var e=URL.createObjectURL(Ir(a.result));s.src="Blob"===t.parent.insertImageSettings.saveFormat?e:a.result}),e&&a.readAsDataURL(e),this.parent.formatter.editorManager.nodeSelection.save(o,this.parent.contentModule.getDocument())),l={cssClass:"inline"===this.parent.insertImageSettings.display?ui:ii,url:this.parent.insertImageSettings.path+e.name,selection:l,altText:e.name.replace(/\.[a-zA-Z0-9]+$/,""),width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.parent.getInsertImgMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}};this.parent.trigger(Oe,{requestType:"Image",name:"ImageDragAndDrop",cancel:!1,originalEvent:n,itemCollection:l},function(e){var t;e.cancel?e.originalEvent.preventDefault():(e=e.itemCollection,(t=j.createElement("img",{className:e.cssClass,attrs:{src:e.url,alt:e.altText}})).style.opacity="0.5",t.classList.add(ro),t.classList.add(ui),t.classList.add(so),o.insertNode(t),i.uploadMethod(n,t),t.addEventListener("load",function(e){i.parent.trigger(Le,{requestType:"Image",name:"InsertDropImage",elements:[t],event:e,editorMode:"HTML"})}),j.detach(r))})},a.prototype.uploadMethod=function(n,i){var o=this,r=!1,e=this,t=this.parent.createElement("div"),s=(this.parent.rootContainer.appendChild(t),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}})),a=this.parent.iframeSettings.enable?-50:-90,t=(this.popupObj=new U.Popup(t,{relateTo:i,height:"85px",width:"300px",offsetY:a,content:s,viewPortElement:this.parent.element,position:{X:"center",Y:"top"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){o.parent.isBlur=!1,o.popupObj.destroy(),j.detach(o.popupObj.element),o.popupObj=null,o.parent.inlineMode.enable||o.parent.toolbarModule.baseToolbar.toolbarObj.disable(!1)}}),this.popupObj.element.style.display="none",j.addClass([this.popupObj.element],uo),j.addClass([this.popupObj.element],po),j.isNullOrUndefined(this.parent.cssClass)||j.addClass([this.popupObj.element],this.parent.cssClass.replace(/\s+/g," ").trim().split(" ")),this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())),a=1e6<n.dataTransfer.files[0].size?300:100;this.imageDragPopupTime=setTimeout(function(){e.refreshPopup(i)},a),this.uploadObj=new P.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},cssClass:yo+this.parent.getCssClass(!0),dropArea:this.parent.element,allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),removing:function(){o.parent.inputElement.contentEditable="true",r=!1,j.detach(i),o.popupObj.close()},canceling:function(){o.parent.inputElement.contentEditable="true",r=!1,j.detach(i),o.popupObj.close(),o.quickToolObj.imageQTBar.hidePopup(),o.uploadCancelTime=setTimeout(function(){o.uploadObj.destroy()},900)},beforeUpload:function(e){o.parent.trigger(Ut,e),o.parent.inlineMode.enable||o.parent.toolbarModule.baseToolbar.toolbarObj.disable(!0)},uploading:function(e){o.parent.isServerRendered||(r=!0,o.parent.trigger(St,e,function(e){e.cancel?(j.isNullOrUndefined(i)||j.detach(i),j.isNullOrUndefined(o.popupObj.element)||j.detach(o.popupObj.element)):o.parent.inputElement.contentEditable="false"}))},selected:function(e){r&&(e.cancel=!0)},failure:function(e){r=!1,o.parent.inputElement.contentEditable="true";var t={args:n,type:"Images",isNotify:void 0,elements:i};o.uploadFailureTime=setTimeout(function(){o.uploadFailure(i,t,e)},900)},success:function(e){var t;"cancel"!==e.operation&&(r=!1,o.parent.inputElement.contentEditable="true",t={args:n,type:"Images",isNotify:void 0,elements:i},o.uploadSuccessTime=setTimeout(function(){o.uploadSuccess(i,n,t,e)},900))}}),this.uploadObj.appendTo(this.popupObj.element.childNodes[0]),this.popupObj.element.querySelector(".e-rte-dialog-upload .e-file-select-wrap").style.display="none",t.selectNodeContents(i),this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(),t)},a.prototype.refreshPopup=function(e){var t=this.parent.iframeSettings.enable?this.parent.element.offsetTop+e.offsetTop:e.offsetTop;this.parent.element.offsetTop+this.parent.element.offsetHeight<t?(this.popupObj.relateTo=this.parent.inputElement,this.popupObj.offsetY=this.parent.iframeSettings.enable?-30:-65,this.popupObj.element.style.display="block"):this.popupObj&&(this.popupObj.refreshPosition(e),this.popupObj.element.style.display="block")},a.prototype.uploadFailure=function(e,t,n){j.detach(e),this.popupObj&&this.popupObj.close(),this.parent.trigger(Ot,n),this.uploadObj.destroy()},a.prototype.uploadSuccess=function(n,e,t,i){var o=this;n.style.opacity="1",n.classList.add(ao),i.element=n,i.detectImageSource=c.ImageInputSource.Dropped,this.parent.trigger(Tt,i,function(e){var t;j.isNullOrUndefined(o.parent.insertImageSettings.path)||(t=o.parent.insertImageSettings.path+e.file.name,n.src=t,n.setAttribute("alt",e.file.name))}),this.popupObj&&(this.popupObj.close(),this.uploadObj.destroy()),this.showImageQuickToolbar(t),this.resizeStart(e,n)},a.prototype.imagePaste=function(n){var i,o,r=this;0!==n.text.length||j.isNullOrUndefined(n.file)||(i=this,o=new FileReader,n.args.preventDefault(),o.addEventListener("load",function(e){var t={cssClass:"inline"===i.parent.insertImageSettings.display?ui:ii,url:"Base64"!==r.parent.insertImageSettings.saveFormat&&j.isNullOrUndefined(n.callBack)?URL.createObjectURL(Ir(o.result)):o.result,width:{width:i.parent.insertImageSettings.width,minWidth:i.parent.insertImageSettings.minWidth,maxWidth:i.parent.getInsertImgMaxWidth()},height:{height:i.parent.insertImageSettings.height,minHeight:i.parent.insertImageSettings.minHeight,maxHeight:i.parent.insertImageSettings.maxHeight}};j.isNullOrUndefined(n.callBack)?(i.parent.formatter.process(i.parent,{item:{command:"Images",subCommand:"Image"}},n.args,t),r.showPopupToolBar(n,t)):n.callBack(t)}),o.readAsDataURL(n.file))},a.prototype.showPopupToolBar=function(e,t){var n=this,t='img[src="'+t.url+'"]',i=this.parent.inputElement.querySelector(t),o=(this.parent.quickToolbarModule.createQTBar("Image","MultiRow",this.parent.quickToolbarSettings.image,c.RenderType.ImageToolbar),{args:e.args,type:"Images",isNotify:void 0,elements:i});i&&(this.showImageQTbarTime=setTimeout(function(){n.showImageQuickToolbar(o),n.resizeStart(e.args,i)},0))},a.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedImgEle=void 0,j.isNullOrUndefined(this.imageQTPopupTime)||(clearTimeout(this.imageQTPopupTime),this.imageQTPopupTime=null),j.isNullOrUndefined(this.imageDragPopupTime)||(clearTimeout(this.imageDragPopupTime),this.imageDragPopupTime=null),j.isNullOrUndefined(this.uploadCancelTime)||(clearTimeout(this.uploadCancelTime),this.uploadCancelTime=null),j.isNullOrUndefined(this.uploadFailureTime)||(clearTimeout(this.uploadFailureTime),this.uploadFailureTime=null),j.isNullOrUndefined(this.showImageQTbarTime)||(clearTimeout(this.showImageQTbarTime),this.showImageQTbarTime=null),j.isNullOrUndefined(this.uploadSuccessTime)||(clearTimeout(this.uploadSuccessTime),this.uploadSuccessTime=null),this.removeEventListener(),this.clearDialogObj(),this.cancelResizeAction(),this.isDestroyed=!0)},a.prototype.getModuleName=function(){return"image"},a);function a(e,t){this.isImgUploaded=!1,this.isAllowedTypes=!0,this.pageX=null,this.pageY=null,this.deletedImg=[],this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.drop=this.dragDrop.bind(this),this.drag=this.dragOver.bind(this),this.enter=this.dragEnter.bind(this),this.start=this.dragStart.bind(this),this.docClick=this.onDocumentClick.bind(this),this.isDestroyed=!1}d.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(h,this.onKeyDown,this),this.parent.on(ne,this.onKeyUp,this),this.parent.on(De,this.insertingAudio,this),this.parent.on(n,this.afterRender,this),this.parent.on(qt,this.afterRender,this),this.parent.on(Gt,this.showDialog,this),this.parent.on(Jt,this.closeDialog,this),this.parent.on(me,this.onToolbarAction,this),this.parent.on(ce,this.alignmentSelect,this),this.parent.on(Ue,this.deleteAudio,this),this.parent.on(Xe,this.editAreaClickHandler,this),this.parent.on(Be,this.showAudioQuickToolbar,this),this.parent.on(o,this.destroy,this),this.parent.on(K,this.closeDialog,this))},d.prototype.removeEventListener=function(){this.parent.off(h,this.onKeyDown),this.parent.off(ne,this.onKeyUp),this.parent.off(De,this.insertingAudio),this.parent.off(n,this.afterRender),this.parent.off(qt,this.afterRender),this.parent.off(Gt,this.showDialog),this.parent.off(Jt,this.closeDialog),this.parent.off(me,this.onToolbarAction),this.parent.off(ce,this.alignmentSelect),this.parent.off(Ue,this.deleteAudio),this.parent.off(Xe,this.editAreaClickHandler),this.parent.off(Be,this.showAudioQuickToolbar),this.parent.off(o,this.destroy),this.parent.off(K,this.closeDialog),j.isNullOrUndefined(this.contentModule)||(j.EventHandler.remove(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.touchStart),j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.audioClick),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null)},d.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.touchStart,this),j.EventHandler.add(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.audioClick,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick)},d.prototype.checkAudioBack=function(e){"#text"===e.startContainer.nodeName&&0===e.startOffset&&!j.isNullOrUndefined(e.startContainer.previousSibling)&&this.isAudioElem(e.startContainer.previousSibling)?this.deletedAudio.push(e.startContainer.previousSibling):"#text"!==e.startContainer.nodeName&&!j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset-1])&&this.deletedAudio.push(e.startContainer.childNodes[e.startOffset-1])},d.prototype.checkAudioDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||j.isNullOrUndefined(e.startContainer.nextSibling)||"AUDIO"!==e.startContainer.nextSibling.nodeName?"#text"!==e.startContainer.nodeName&&!j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset])&&this.deletedAudio.push(e.startContainer.childNodes[e.startOffset]):this.deletedAudio.push(e.startContainer.nextSibling)},d.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text;n.appendChild(i.cloneNode(!0))}},d.prototype.touchStart=function(e,t){this.parent.readonly||(this.prevSelectedAudEle=this.audEle)},d.prototype.onToolbarAction=function(e){switch(vs()&&this.parent.notify(Qe,{}),e.args.item.subCommand){case"AudioReplace":this.parent.notify(De,e);break;case"AudioRemove":this.parent.notify(Ue,e)}},d.prototype.onKeyUp=function(e){if(!j.isNullOrUndefined(this.deletedAudio)&&0<this.deletedAudio.length)for(var t=0;t<this.deletedAudio.length;t++){var n={element:this.deletedAudio[t].querySelector("audio"),src:this.deletedAudio[t].querySelector("source").getAttribute("src")};this.parent.trigger(Rt,n)}},d.prototype.onKeyDown=function(e){var t,n,i,o,r,s=e.args;this.deletedAudio=[];if(!(n="HTML"===this.parent.editorMode?(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===i.endContainer&&i.startOffset===i.endOffset:n)&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(s.which)<0)for(var a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),l=0;l<a.length;l++)this.isAudioElem(a[l])&&this.deletedAudio.push(a[l]);switch("HTML"===this.parent.editorMode&&(8===s.which&&"Backspace"===s.code||46===s.which&&"Delete"===s.code)&&(e=i.startContainer===i.endContainer&&i.startOffset===i.endOffset,8===s.which&&"Backspace"===s.code&&e?this.checkAudioBack(i):46===s.which&&"Delete"===s.code&&e&&this.checkAudioDel(i)),j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===s.code||(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i),!s.ctrlKey&&s.key&&(1===s.key.length||"enter"===s.action)&&this.isAudioElem(r[0])&&r[0].parentElement&&(n=r[0].parentElement.childNodes[0],this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),n,n,n.textContent.length,n.textContent.length),j.removeClass([r[0]],lo),this.quickToolObj.audioQTBar.hidePopup())),!s.ctrlKey||89!==s.keyCode&&90!==s.keyCode||this.undoStack({subCommand:90===s.keyCode?"undo":"redo"}),8!==s.keyCode&&46!==s.keyCode||o&&this.isAudioElem(o[0])&&o.length<1&&(j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),s.preventDefault(),this.deleteAudio({selectNode:o,selection:t,selectParent:r,args:{item:{command:"Audios",subCommand:"AudioRemove"},originalEvent:s}},s.keyCode)),s.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":for(l=0;l<this.deletedAudio.length;l++){var d=this.deletedAudio[l].src;this.audioRemovePost(d)}"Markdown"!==this.parent.editorMode&&(3===i.startContainer.nodeType?"Backspace"===s.code?i.startContainer.previousElementSibling&&0===i.startOffset&&i.startContainer.previousElementSibling.classList.contains(ai)&&j.detach(i.startContainer.previousElementSibling):i.startContainer.nextElementSibling&&i.endContainer.textContent.length===i.endOffset&&i.startContainer.nextElementSibling.classList.contains(ai)&&j.detach(i.startContainer.nextElementSibling):1===i.startContainer.nodeType&&i.startContainer.classList&&(i.startContainer.classList.contains(ai)||i.startContainer.classList.contains(ri)||i.startContainer.classList.contains(si))&&j.detach(i.startContainer));break;case"insert-audio":j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),this.openDialog(!0,s,t,o,r),s.preventDefault()}s.ctrlKey&&"a"===s.key&&this.handleSelectAll()},d.prototype.handleSelectAll=function(){var e=this.parent.inputElement.querySelectorAll("."+lo);j.removeClass(e,lo)},d.prototype.openDialog=function(e,t,n,i,o){var r,s,i=e||j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=n,s=i,o):(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n));"HTML"===this.parent.editorMode&&this.insertAudio({args:{item:{command:"Audios",subCommand:"Audio"},originalEvent:t,name:e?null:"showDialog"},selectNode:s,selection:r,selectParent:i})},d.prototype.showDialog=function(){this.openDialog(!1)},d.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},d.prototype.deleteAudio=function(e,t){var n;this.isAudioElem(e.selectNode[0])&&(this.audEle&&(3===e.selectNode[0].nodeType?e.selectNode[0]=this.audEle:this.isAudioElem(e.selectNode[0])&&(e.selectNode[0]=e.selectNode[0].classList.contains(ai)?e.selectNode[0]:e.selectNode[0].parentElement)),n={element:e.selectNode[0].querySelector("audio"),src:e.selectNode[0].querySelector("source").getAttribute("src")},0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.restore(),this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.audioRemovePost(n.src),this.quickToolObj&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup(),j.isNullOrUndefined(t))&&this.parent.trigger(Rt,n)},d.prototype.audioRemovePost=function(e){var t=this,n="";j.isNullOrUndefined(this.parent.insertAudioSettings.removeUrl)||""===this.parent.insertAudioSettings.removeUrl||(n=-1<e.indexOf("http://")||-1<e.indexOf("https://")?e:new URL(e,document.baseURI).href,this.removingAudioName=n.replace(/^.*[\\/]/,""),(e=new XMLHttpRequest).addEventListener("readystatechange",function(){4===this.readyState&&200===this.status&&t.triggerPost(this.response)}),e.open("GET",n),e.responseType="blob",e.send())},d.prototype.triggerPost=function(e){var t,n=this.parent.insertAudioSettings.removeUrl;j.isNullOrUndefined(n)||""===n||(e=new File([e],this.removingAudioName),n=new j.Ajax(n,"POST",!0,null),(t=new FormData).append("UploadFiles",e),n.send(t))},d.prototype.audioClick=function(e){j.Browser.isDevice&&(this.isAudioElem(e.target)?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),this.isAudioElem(e.target)&&(this.audEle=e.target.querySelector("audio"),e.preventDefault())},d.prototype.onDocumentClick=function(e){var t=e.target;j.isNullOrUndefined(this.contentModule.getEditPanel())||(this.isAudioElem(t)&&(this.audEle=t.querySelector("audio")),j.isNullOrUndefined(this.dialogObj)||!(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_Audio")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Audio"))||e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(hn,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Or(this.parent.element,"focusout")),this.contentModule.getEditPanel().querySelector("."+lo)&&(this.isAudioElem(e.target)||j.isNullOrUndefined(this.audEle)?j.isNullOrUndefined(this.prevSelectedAudEle)||this.prevSelectedAudEle===t||(this.prevSelectedAudEle.style.outline=""):this.audEle.style.outline=""),this.parent.inlineMode.enable&&t&&this.dialogObj&&!j.closest(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide())},d.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Audios"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=(this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),{args:e,selectNode:n=[this.audEle]});switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"Inline":this.inline(i);break;case"Break":this.break(i)}this.quickToolObj&&document.body.contains(this.quickToolObj.audioQTBar.element)&&(this.quickToolObj.audioQTBar.hidePopup(),j.removeClass([n[0]],lo))}},d.prototype.break=function(e){var t;"AUDIO"===e.selectNode[0].nodeName&&(t=e.args.item&&e.args.item.subCommand?e.args.item.subCommand:"Break",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},d.prototype.inline=function(e){var t;"AUDIO"===e.selectNode[0].nodeName&&(t=e.args.item&&e.args.item.subCommand?e.args.item.subCommand:"Inline",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},d.prototype.editAreaClickHandler=function(e){var t,n,i;this.parent.readonly?this.hideAudioQuickToolbar():(t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick,2===t.which||n&&1===t.which||!n&&3===t.which?n&&1===t.which&&!j.isNullOrUndefined(t.target)&&this.isAudioElem(t.target)&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),t.target)):"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.audioQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,n=t.target,this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),i=this.quickToolObj.audioQTBar.element.classList.contains("e-rte-pop"),this.isAudioElem(n)&&this.parent.quickToolbarModule?i||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n),vs()&&this.parent.notify(Ve,e),n.querySelector("audio").style.outline="2px solid #4a90e2",this.showAudioQuickToolbar({args:t,type:"Audios",elements:[t.target]})):this.hideAudioQuickToolbar()))},d.prototype.isAudioElem=function(e){return!(!e||3===e.nodeType||"BR"===e.nodeName||!e.classList||!e.classList.contains(ai)&&!e.classList.contains(ri))},d.prototype.showAudioQuickToolbar=function(e){var t,n,i=this;"Audios"!==e.type||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.audioQTBar)||j.isNullOrUndefined(e.args)||(this.quickToolObj=this.parent.quickToolbarModule,t=e.args,n=e.elements,[].forEach.call(e.elements,function(e,t){0===t&&(n=e)}),this.isAudioElem(n)&&(j.addClass([n.querySelector("audio")],[lo]),n.querySelector("audio").style.outline="2px solid #4a90e2"),this.parent.quickToolbarModule.audioQTBar&&(e.isNotify?this.showPopupTime=setTimeout(function(){i.parent.formatter.editorManager.nodeSelection.Clear(i.contentModule.getDocument()),i.parent.formatter.editorManager.nodeSelection.setSelectionContents(i.contentModule.getDocument(),n),i.quickToolObj.audioQTBar.showPopup(t.pageX-50,n.getBoundingClientRect().top+34,n)},400):this.quickToolObj.audioQTBar.showPopup(t.pageX-50,n.getBoundingClientRect().top+34,n)))},d.prototype.hideAudioQuickToolbar=function(){j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector("."+lo))||(j.removeClass([this.contentModule.getEditPanel().querySelector("."+lo)],lo),j.isNullOrUndefined(this.audEle)||(this.audEle.style.outline=""),this.quickToolObj&&this.quickToolObj.audioQTBar&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup())},d.prototype.insertingAudio=function(e){this.insertAudio(e),j.isNullOrUndefined(this.dialogObj)||(this.dialogObj.element.style.maxHeight="inherit",e=this.dialogObj.element.querySelector(".e-audio-content"),(j.isNullOrUndefined(this.parent.insertAudioSettings.path)&&"HTML"!==this.parent.editorMode?e.querySelector(".e-audio-url"):document.getElementById(this.rteID+"_insertAudio")).focus())},d.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),j.detach(this.uploadObj.element),this.uploadObj=null),this.button&&!this.button.isDestroyed&&(this.button.destroy(),j.detach(this.button.element),this.button=null),this.dialogObj&&!this.dialogObj.isDestroyed&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},d.prototype.insertAudio=function(e){var t,n,i,o,r,s,a=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-audio-dialog",id:this.rteID+"_audio"}),this.parent.rootContainer.appendChild(t),r=this.i10n.getConstant("dialogInsert"),s=this.i10n.getConstant("dialogCancel"),i=this.i10n.getConstant("audioHeader"),n=e.selection,o={selfAudio:this,selection:e.selection,args:e.args,selectParent:e.selectParent},i={header:i,cssClass:Ei,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",isModal:j.Browser.isDevice,buttons:[{click:this.insertAudioUrl.bind(o),buttonModel:{content:r,cssClass:"e-flat e-insertAudio",isPrimary:!0,disabled:!0}},{click:function(e){a.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel",content:s}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){a.isAudioUploaded&&(a.dialogObj.element.querySelector(".e-file-abort-btn")?a.dialogObj.element.querySelector(".e-file-abort-btn").click():a.uploadObj.remove()),a.parent.isBlur=!1,e&&!j.isNullOrUndefined(e.event)&&e.event.returnValue&&"HTML"===a.parent.editorMode&&n.restore(),a.clearDialogObj(),a.dialogRenderObj.close(e)}},o=this.parent.createElement("div",{className:"e-audio-content"}),j.isNullOrUndefined(this.parent.insertAudioSettings.path)&&"HTML"!==this.parent.editorMode||o.appendChild(this.audioUpload(e)),r=this.parent.createElement("div",{className:"e-audioheader"}),s=this.i10n.getConstant("audioLinkHeader"),"HTML"===this.parent.editorMode&&(r.innerHTML=s),o.appendChild(r),o.appendChild(this.audioUrlPopup(e)),e.selectNode&&1===e.selectNode[0].nodeType&&this.isAudioElem(e.selectNode[0])&&(i.header=this.parent.localeObj.getConstant("editAudioHeader")),i.content=o,this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),e.selectNode&&1===e.selectNode[0].nodeType&&this.isAudioElem(e.selectNode[0])&&"insertAudio"===e.name&&(this.dialogObj.element.querySelector(".e-insertAudio").textContent=this.parent.localeObj.getConstant("dialogUpdate")),t.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.audioQTBar&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup(),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())},d.prototype.audioUrlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"audioUrl"}),i=this.i10n.getConstant("audioUrl");return this.inputUrl=this.parent.createElement("input",{className:"e-input e-audio-url",attrs:{placeholder:i,spellcheck:"false","aria-label":this.i10n.getConstant("audioLinkHeader")}}),this.inputUrl.addEventListener("input",function(){j.isNullOrUndefined(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),e.selectNode&&this.isAudioElem(e.selectNode[0])&&(i=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),e=e.selectNode[0].querySelector("source"),this.inputUrl.value=e.src.match(i)?e.src:""),n.appendChild(this.inputUrl),n},d.prototype.audioUpload=function(e){var i,o,r,s=this,a=this,t=a.parent.iframeSettings.enable,t=(o="HTML"===a.parent.editorMode&&(!t&&j.isNullOrUndefined(j.closest(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||t&&!p(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))?(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)):(i=e.selection,e.selectParent),this.parent.createElement("div",{className:"e-aud-uploadwrap e-droparea"})),n=this.i10n.getConstant("audioDeviceUploadMessage"),l=this.i10n.getConstant("audioUploadMessage"),d=this.parent.createElement("span",{className:"e-droptext"}),n=this.parent.createElement("span",{className:"e-rte-upload-text",innerHTML:j.Browser.isDevice?n:l}),l=(d.appendChild(n),this.parent.createElement("button",{className:"e-browsebtn",id:this.rteID+"_insertAudio",attrs:{autofocus:"true",type:"button"}})),n=(d.appendChild(l),t.appendChild(d),this.i10n.getConstant("browse")),n=(this.button=new H.Button({content:n,enableRtl:this.parent.enableRtl}),this.button.isStringTemplate=!0,this.button.createElement=this.parent.createElement,this.button.appendTo(l),j.Browser.isDevice?d:l),l=(j.EventHandler.add(n,"click",this.fileSelect,this),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}}));return t.appendChild(l),this.uploadObj=new P.Uploader({asyncSettings:{saveUrl:this.parent.insertAudioSettings.saveUrl,removeUrl:this.parent.insertAudioSettings.removeUrl},dropArea:d,multiple:!1,enableRtl:this.parent.enableRtl,allowedExtensions:this.parent.insertAudioSettings.allowedTypes.toString(),selected:function(e){a.isAudioUploaded=!0,e.filesData,s.parent.trigger(wt,e,function(e){var n;e.cancel||(s.checkExtension(e.filesData[0]),r=e.filesData[0].name,"HTML"===s.parent.editorMode&&j.isNullOrUndefined(s.parent.insertAudioSettings.path)&&((n=new FileReader).addEventListener("load",function(e){var t="Base64"===s.parent.insertAudioSettings.saveFormat?n.result:URL.createObjectURL(Ir(n.result));a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o},a.inputUrl.setAttribute("disabled","true"),j.isNullOrUndefined(a.parent.insertAudioSettings.saveUrl)&&s.isAllowedTypes&&!j.isNullOrUndefined(s.dialogObj)&&s.dialogObj.getButtons(0).element.removeAttribute("disabled")}),n.readAsDataURL(e.filesData[0].rawFile)))})},beforeUpload:function(e){s.parent.trigger(Pt,e)},uploading:function(e){s.parent.isServerRendered||s.parent.trigger(kt,e)},success:function(e){s.parent.trigger(xt,e,function(e){var t;j.isNullOrUndefined(s.parent.insertAudioSettings.path)||(t=s.parent.insertAudioSettings.path+e.file.name,a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o},a.inputUrl.setAttribute("disabled","true")),"upload"!==e.operation||j.isNullOrUndefined(s.dialogObj)||s.dialogObj.getButtons(0).element.removeAttribute("disabled")})},failure:function(e){s.parent.trigger(Dt,e)},removing:function(){s.parent.trigger(Mt,e,function(e){a.isAudioUploaded=!1,s.dialogObj.getButtons(0).element.disabled=!0,a.inputUrl.removeAttribute("disabled"),a.uploadUrl&&(a.uploadUrl.url="")})}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(l),t},d.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},d.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},d.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0}),this.isAudioUploaded&&this.uploadObj.removing()},d.prototype.insertAudioUrl=function(e){var t,n=this.selfAudio,i=(n.isAudioUploaded=!1,n.inputUrl.value);0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),j.isNullOrUndefined(n.uploadUrl)||""===n.uploadUrl.url?""!==i&&("HTML"===n.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+n.contentModule.getPanel().id+"']"))&&(n.contentModule.getEditPanel().focus(),t=n.parent.formatter.editorManager.nodeSelection.getRange(n.contentModule.getDocument()),this.selection=n.parent.formatter.editorManager.nodeSelection.save(t,n.contentModule.getDocument()),this.selectParent=n.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)),t="HTML"===n.parent.editorMode?i.split("/")[i.split("/").length-1]:"",i={cssClass:"Inline"===n.parent.insertAudioSettings.layoutOption?mi:oi,url:i,selection:this.selection,fileName:t,selectParent:this.selectParent},n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,i),n.dialogObj.hide({returnValue:!1})):(n.uploadUrl.cssClass="Inline"===n.parent.insertAudioSettings.layoutOption?mi:oi,n.dialogObj.hide({returnValue:!1}),n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,n.uploadUrl),n.uploadUrl.url="")},d.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedAudEle=void 0,this.showPopupTime&&(clearTimeout(this.showPopupTime),this.showPopupTime=null),this.removeEventListener(),this.clearDialogObj(),this.isDestroyed=!0)},d.prototype.getModuleName=function(){return"audio"};var js=d;function d(e,t){this.isAudioUploaded=!1,this.isAllowedTypes=!0,this.deletedAudio=[],this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.docClick=this.onDocumentClick.bind(this),this.isDestroyed=!1}u.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(h,this.onKeyDown,this),this.parent.on(ne,this.onKeyUp,this),this.parent.on(Me,this.insertingVideo,this),this.parent.on(n,this.afterRender,this),this.parent.on(qt,this.afterRender,this),this.parent.on(be,this.onWindowResize,this),this.parent.on(Xt,this.showDialog,this),this.parent.on($t,this.closeDialog,this),this.parent.on(ce,this.alignmentSelect,this),this.parent.on(Pe,this.deleteVideo,this),this.parent.on(ge,this.onToolbarAction,this),this.parent.on(Xe,this.editAreaClickHandler,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(Fe,this.videoSize,this),this.parent.on(Be,this.showVideoQuickToolbar,this),this.parent.on(gt,this.clearDialogObj,this),this.parent.on(o,this.destroy,this))},u.prototype.removeEventListener=function(){this.parent.off(h,this.onKeyDown),this.parent.off(ne,this.onKeyUp),this.parent.off(Me,this.insertingVideo),this.parent.off(be,this.onWindowResize),this.parent.off(n,this.afterRender),this.parent.off(qt,this.afterRender),this.parent.off(Xt,this.showDialog),this.parent.off($t,this.closeDialog),this.parent.off(ce,this.alignmentSelect),this.parent.off(Pe,this.deleteVideo),this.parent.off(ge,this.onToolbarAction),this.parent.off(Xe,this.editAreaClickHandler),this.parent.off(K,this.onIframeMouseDown),this.parent.off(Fe,this.videoSize),this.parent.off(Be,this.showVideoQuickToolbar),this.parent.off(gt,this.clearDialogObj),this.parent.off(o,this.destroy),j.isNullOrUndefined(this.contentModule)||(j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.videoClick),this.parent.formatter.editorManager.observer.off(ct,this.undoStack),this.parent.insertVideoSettings.resize&&(j.EventHandler.remove(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null,j.EventHandler.remove(this.contentModule.getEditPanel(),"cut",this.onCutHandler),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing)))},u.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),j.EventHandler.add(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.videoClick,this),this.parent.insertVideoSettings.resize&&(j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick),j.EventHandler.add(this.contentModule.getEditPanel(),"cut",this.onCutHandler,this))},u.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),j.detach(this.uploadObj.element),this.uploadObj=null),this.webUrlBtn&&!this.webUrlBtn.isDestroyed&&(this.webUrlBtn.destroy(),j.detach(this.webUrlBtn.element),this.webUrlBtn=null),this.embedUrlBtn&&!this.embedUrlBtn.isDestroyed&&(this.embedUrlBtn.destroy(),j.detach(this.embedUrlBtn.element),this.embedUrlBtn=null),this.widthNum&&!this.widthNum.isDestroyed&&(this.widthNum.destroy(),j.detach(this.widthNum.element),this.widthNum=null),this.heightNum&&!this.heightNum.isDestroyed&&(this.heightNum.destroy(),j.detach(this.heightNum.element),this.heightNum=null),this.button&&!this.button.isDestroyed&&(this.button.destroy(),j.detach(this.button.element),this.heightNum=null),this.dialogObj&&this.dialogObj.element&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},u.prototype.onKeyUp=function(e){if(!j.isNullOrUndefined(this.deletedVid)&&0<this.deletedVid.length)for(var t=0;t<this.deletedVid.length;t++){var n={element:this.deletedVid[t],src:"IFRAME"!==this.deletedVid[t].tagName?this.deletedVid[t].querySelector("source").getAttribute("src"):this.deletedVid[t].src};this.parent.trigger(Rt,n)}},u.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text,o=(n.appendChild(i.cloneNode(!0)),n.querySelectorAll("video"));if(n.querySelector(".e-vid-resize")&&0<o.length){for(var r=0;r<o.length;r++)o[r].style.outline="";j.detach(n.querySelector(".e-vid-resize"));for(var s=n.cloneNode(!0),a=document.createDocumentFragment();s.firstChild;)a.appendChild(s.firstChild);this.parent.formatter.getUndoRedoStack()[t].text=a}}},u.prototype.onIframeMouseDown=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},u.prototype.videoSize=function(e){var t,n,i,o,r=this;"VIDEO"!==e.selectNode[0].nodeName&&!this.isEmbedVidElem(e.selectNode[0])||(this.insertVideo(e),j.isNullOrUndefined(this.dialogObj))||(t=this.i10n.getConstant("videoSizeHeader"),n=this.i10n.getConstant("dialogUpdate"),i=this.vidsizeInput(e),o={args:e.args,selfVideo:this,selection:e.selection,selectNode:e.selectNode},this.dialogObj.setProperties({width:"290px",header:t,content:i,buttons:[{click:function(e){r.insertSize(o)},buttonModel:{content:n,cssClass:"e-flat e-update-size",isPrimary:!0}}]}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},u.prototype.vidsizeInput=function(e){var t=this,e=e.selectNode[0],n=this.i10n.getConstant("videoHeight"),i=this.i10n.getConstant("videoWidth"),o=this.parent.createElement("div",{className:"e-video-sizewrap"}),r=!j.isNullOrUndefined(this.changedWidthValue)||"auto"!==e.style.width.toString()&&""===e.style.width?j.isNullOrUndefined(this.changedWidthValue)?parseInt(e.getClientRects()[0].width.toString(),10).toString():this.changedWidthValue:e.style.width,e=!j.isNullOrUndefined(this.changedHeightValue)||"auto"!==e.style.height.toString()&&""===e.style.height?j.isNullOrUndefined(this.changedHeightValue)?parseInt(e.getClientRects()[0].height.toString(),10).toString():this.changedHeightValue:e.style.height;this.changedWidthValue=null,this.changedHeightValue=null;i=Lr('<div class="e-rte-label"><label>'+i+'</label></div><div class="e-rte-field"><input type="text" id="vidwidth" class="e-vid-width" value='+r+' /></div><div class="e-rte-label"><label>'+n+'</label></div><div class="e-rte-field"> <input type="text" id="vidheight" class="e-vid-height" value='+e+" /></div>");return o.appendChild(i),this.widthNum=new P.TextBox({value:j.formatUnit(r),enableRtl:this.parent.enableRtl,input:function(e){t.inputWidthValue=j.formatUnit(e.value)}}),this.widthNum.createElement=this.parent.createElement,this.widthNum.appendTo(o.querySelector("#vidwidth")),this.heightNum=new P.TextBox({value:j.formatUnit(e),enableRtl:this.parent.enableRtl,input:function(e){t.inputHeightValue=j.formatUnit(e.value)}}),this.heightNum.createElement=this.parent.createElement,this.heightNum.appendTo(o.querySelector("#vidheight")),o},u.prototype.insertSize=function(e){e.selection.restore();var t=e.selfVideo,n=(0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),t.dialogObj.element),i=(this.changedWidthValue=this.inputWidthValue,this.changedHeightValue=this.inputHeightValue,n.querySelector(".e-vid-width").value),n=n.parentElement.querySelector(".e-vid-height").value;t.parent.formatter.process(this.parent,e.args,e.args,{width:i,height:n,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.vidResizeDiv&&(e.selectNode[0]="VIDEO"===e.selectNode[0].tagName||"IFRAME"===e.selectNode[0].tagName?e.selectNode[0]:e.selectNode[0].querySelector("iframe"),t.vidResizePos(e.selectNode[0],this.vidResizeDiv)),t.dialogObj.hide({returnValue:!0})},u.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.videoEle.parentElement.style.cursor="auto",j.Browser.isDevice&&j.removeClass([e.target.parentElement],"e-mob-span");this.parent.trigger(Ce,{event:e,requestType:"videos"}),this.getPointX(e),this.parent.iframeSettings.enable?(window.pageYOffset,this.parent.element.getBoundingClientRect().top,e.clientY):e.pageY;this.parent.formatter.editorManager.observer.on(ct,this.undoStack,this),this.parent.formatter.saveData()},u.prototype.resizeStart=function(e,t){var n,i=this;this.parent.readonly||(t=t||(this.isEmbedVidElem(e.target)?e.target.querySelector("iframe"):e.target),this.prevSelectedVidEle=this.videoEle,"VIDEO"!==t.tagName&&"IFRAME"!==t.tagName||(this.parent.preventDefaultResize(e),n=t,this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&j.detach(this.vidResizeDiv),this.videoResize(n)),t.classList.contains("e-rte-videoboxmark")&&(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.videoQTBar.hidePopup(),t.classList.contains("e-rte-topLeft")&&(this.resizeBtnStat.topLeft=!0),t.classList.contains("e-rte-topRight")&&(this.resizeBtnStat.topRight=!0),t.classList.contains("e-rte-botLeft")&&(this.resizeBtnStat.botLeft=!0),t.classList.contains("e-rte-botRight")&&(this.resizeBtnStat.botRight=!0),j.Browser.isDevice&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&!this.vidResizeDiv.classList.contains("e-mob-span")?j.addClass([this.vidResizeDiv],"e-mob-span"):this.parent.trigger(ye,{event:e,requestType:"videos"},function(e){e.cancel&&i.cancelResizeAction()}),this.isResizeBind)&&(j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing,this),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd,this),this.isResizeBind=!1))},u.prototype.videoClick=function(e){j.Browser.isDevice&&("VIDEO"===e.target.tagName||this.isEmbedVidElem(e.target)?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),"VIDEO"!==e.target.tagName&&!this.isEmbedVidElem(e.target)||e.preventDefault()},u.prototype.onCutHandler=function(){this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&this.cancelResizeAction()},u.prototype.videoResize=function(e){this.resizeBtnInit(),this.videoEle=e,j.addClass([this.videoEle],"e-resize"),this.vidResizeDiv=this.parent.createElement("span",{className:"e-vid-resize",id:this.rteID+"_vidResize"}),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-topLeft",styles:"cursor: nwse-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-topRight",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-botLeft",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-botRight",styles:"cursor: nwse-resize"})),j.Browser.isDevice&&j.addClass([this.vidResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.vidResizePos(e,this.vidResizeDiv),this.resizeVidDupPos(e),this.contentModule.getEditPanel().appendChild(this.vidResizeDiv)},u.prototype.getPointX=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageX},u.prototype.getPointY=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageY},u.prototype.vidResizePos=function(e,t){var n,i,o,r,s;j.isNullOrUndefined(t)||(n=(i=this.calcPos(e)).top,i=i.left,o=(0!==e.width&&"auto"!==e.width&&"NaN"!==e.width?e:e.getBoundingClientRect()).width,r=(0!==e.height&&"auto"!==e.height&&"NaN"!==e.height?e:e.getBoundingClientRect()).height,e=j.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,s=j.Browser.isDevice?0:2,t.querySelector(".e-rte-botLeft").style.left=i-e+"px",t.querySelector(".e-rte-botLeft").style.top=parseInt(r.toString(),10)-e+n+"px",t.querySelector(".e-rte-botRight").style.left=parseInt(o.toString(),10)-(e-s)+i+"px",t.querySelector(".e-rte-botRight").style.top=parseInt(r.toString(),10)-e+n+"px",t.querySelector(".e-rte-topRight").style.left=parseInt(o.toString(),10)-(e-s)+i+"px",t.querySelector(".e-rte-topRight").style.top=n-e+"px",t.querySelector(".e-rte-topLeft").style.left=i-e+"px",t.querySelector(".e-rte-topLeft").style.top=n-e+"px")},u.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,o=(e.offsetParent&&(e.offsetParent.classList.contains("e-video-clickelem")||-1<["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName))?j.closest(e,"#"+this.parent.getID()+"_rte-edit-view"):e.offsetParent)||i.documentElement;o&&(o===i.body||o===i.documentElement)&&"static"===o.style.position;)o=o.parentNode;return o&&o!==e&&1===o.nodeType&&(n=o.getBoundingClientRect()),e&&1===e.nodeType&&"IFRAME"===e.tagName?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},u.prototype.setAspectRatio=function(e,t,n,i){var o,r,s,a,l=getComputedStyle(e);j.isNullOrUndefined(l)||(o=RegExp,s=""!==l.width?l.width.match(new o("^\\d+(\\.\\d*)?%$","g"))?parseFloat(l.width):parseInt(l.width,10):(""!==e.style.width?e.style:e).width,a=""!==l.height?parseInt(l.height,10):(""!==e.style.height?e.style:e).height,s=s.toString().match(new o("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(s.toString()):parseInt(s.toString(),10),(a=a.toString().match(new o("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(a.toString()):parseInt(a.toString(),10))<s?(e.style.minWidth=0===this.parent.insertVideoSettings.minWidth?"200px":j.formatUnit(this.parent.insertVideoSettings.minWidth),e.style.minHeight=0===this.parent.insertVideoSettings.minHeight?"90px":j.formatUnit(this.parent.insertVideoSettings.minHeight),this.parent.insertVideoSettings.resizeByPercent?this.updateVidEleWidth(e,s,a,t,n):""===e.style.width&&""!==e.style.height||""===l.width&&""!==l.height?e.style.height=n+"px":""!==e.style.width&&""===e.style.height||""!==l.width&&""===l.height?(r=s/a*n+s/a<this.parent.inputElement.getBoundingClientRect().right-32?s/a*n+s/a:this.parent.inputElement.getBoundingClientRect().right-32,e.style.width=r.toString()+"px"):""!==e.style.width||""!==l.width?(r=s/a*n<this.parent.inputElement.getBoundingClientRect().right-32?s/a*n:this.parent.inputElement.getBoundingClientRect().right-32,e.style.width=r+"px",e.style.height=n+"px"):e.setAttribute("width",parseInt((s/a*n+s/a).toString(),10).toString())):s<a?this.parent.insertVideoSettings.resizeByPercent?this.updateVidEleWidth(e,s,a,t,n):""!==l.width||""!==e.style.width?(e.style.width=t+"px",e.style.height=a/s*t+"px"):e.setAttribute("width",(this.resizeBtnStat.botRight?this.getPointX(i.event)-e.getBoundingClientRect().left:t).toString()):this.parent.insertVideoSettings.resizeByPercent?(e.style.width=this.pixToPerc(t,e.previousElementSibling||e.parentElement)+"%",e.style.height=null,e.removeAttribute("height")):(e.style.width=t+"px",e.style.height=t+"px"))},u.prototype.updateVidEleWidth=function(e,t,n,i,o){var r;0!==parseInt(""+e.getBoundingClientRect().width,10)&&0!==parseInt(""+t,10)?(r=(e.offsetWidth+this.mouseX)/e.offsetWidth*("NaN"===parseFloat(e.style.width).toString()?e.offsetWidth/parseFloat(getComputedStyle(this.parent.element).width)*100:parseFloat(e.style.width)),e.style.width=(3<r?r:3)+"%"):e.style.width=n<t?this.pixToPerc(t/n*o,e.previousElementSibling||e.parentElement)+"%":this.pixToPerc(i/n*o,e.previousElementSibling||e.parentElement)+"%",e.style.height=null,e.removeAttribute("height")},u.prototype.pixToPerc=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},u.prototype.vidDupMouseMove=function(t,n,e){var i=this,o={event:e,requestType:"videos"};this.parent.trigger(ve,o,function(e){e.cancel?i.cancelResizeAction():parseInt(i.parent.insertVideoSettings.minWidth,10)>=parseInt(t,10)||parseInt(i.parent.getInsertVidMaxWidth(),10)<=parseInt(t,10)&&j.isNullOrUndefined(i.videoEle.style.width)||!i.parent.insertVideoSettings.resizeByPercent&&(parseInt(i.parent.insertVideoSettings.minHeight,10)>=parseInt(n,10)||parseInt(i.parent.insertVideoSettings.maxHeight,10)<=parseInt(n,10))||(i.videoEle.parentElement.style.cursor="pointer",i.setAspectRatio(i.videoEle,parseInt(t,10),parseInt(n,10),o),i.resizeVidDupPos(i.videoEle),i.vidResizePos(i.videoEle,i.vidResizeDiv))})},u.prototype.resizing=function(e){this.videoEle.offsetWidth>=this.parent.getInsertVidMaxWidth()&&(this.videoEle.style.maxHeight=this.videoEle.offsetHeight+"px");var t=this.getPointX(e),n=this.getPointY(e),i=this.resizeBtnStat.botLeft||this.resizeBtnStat.topLeft?-(t-this.pageX):t-this.pageX,o=this.resizeBtnStat.topLeft||this.resizeBtnStat.topRight?-(n-this.pageY):n-this.pageY,r=parseInt(this.vidDupPos.width,10)+i,o=parseInt(this.vidDupPos.height,10)+o;this.pageX=t,this.pageY=n,this.mouseX=i,(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)&&this.vidDupMouseMove(r+"px",o+"px",e)},u.prototype.cancelResizeAction=function(){this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.videoEle&&this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&(j.detach(this.vidResizeDiv),this.videoEle.style.outline="",this.vidResizeDiv=null,this.pageX=null,this.pageY=null)},u.prototype.resizeVidDupPos=function(e){this.vidDupPos={width:""!==e.style.width&&this.parent.insertVideoSettings&&!this.parent.insertVideoSettings.resizeByPercent?this.videoEle.style.width:"auto"!==e.width&&0!==e.width&&"NaN"!==e.width?e.width+"px":parseInt(getComputedStyle(e).width,10)+"px",height:""!==e.style.height?this.videoEle.style.height:"auto"!==e.height&&0!==e.height&&"NaN"!==e.height?e.height+"px":parseInt(getComputedStyle(e).height,10)+"px"}},u.prototype.resizeBtnInit=function(){return this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},u.prototype.onToolbarAction=function(e){switch(vs()&&this.parent.notify(Qe,{}),e.args.item.subCommand){case"VideoReplace":this.parent.notify(Me,e);break;case"VideoRemove":this.parent.notify(Pe,e);break;case"VideoDimension":this.parent.notify(Fe,e)}},u.prototype.onKeyDown=function(e){var t,n,i,o,r,s=e.args;this.deletedVid=[];if(!(n="HTML"===this.parent.editorMode?(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===i.endContainer&&i.startOffset===i.endOffset:n)&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(s.which)<0)for(var a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),l=0;l<a.length;l++)"VIDEO"!==a[l].nodeName&&"IFRAME"!==a[l].nodeName||this.deletedVid.push(a[l]);switch("HTML"===this.parent.editorMode&&(8===s.which&&"Backspace"===s.code||46===s.which&&"Delete"===s.code)&&(e=i.startContainer===i.endContainer&&i.startOffset===i.endOffset,8===s.which&&"Backspace"===s.code&&e?this.checkVideoBack(i):46===s.which&&"Delete"===s.code&&e&&this.checkVideoDel(i)),j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===s.code||(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i),s.ctrlKey)||!s.key||1!==s.key.length&&"enter"!==s.action||(j.isNullOrUndefined(r[0])||"VIDEO"!==r[0].tagName)&&!this.isEmbedVidElem(r[0])||!r[0].parentElement||(n=r[0].parentElement.childNodes[0],this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle(),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),n,n,n.textContent.length,n.textContent.length),j.removeClass([r[0]],co),this.quickToolObj.videoQTBar.hidePopup()),!s.ctrlKey||89!==s.keyCode&&90!==s.keyCode||this.undoStack({subCommand:90===s.keyCode?"undo":"redo"}),8!==s.keyCode&&46!==s.keyCode||(o&&("VIDEO"===o[0].nodeName||this.isEmbedVidElem(o[0]))&&o.length<1&&(j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),s.preventDefault(),this.deleteVideo({selectNode:o,selection:t,selectParent:r,args:{item:{command:"Videos",subCommand:"VideoRemove"},originalEvent:s}},s.keyCode)),this.parent.contentModule.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle()),"Backspace"===s.code&&(s.action="backspace"),s.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":for(l=0;l<this.deletedVid.length;l++){var d=this.deletedVid[l].src;this.videoRemovePost(d)}"Markdown"!==this.parent.editorMode&&(3===i.startContainer.nodeType?"Backspace"===s.code?i.startContainer.previousElementSibling&&0===i.startOffset&&i.startContainer.previousElementSibling.classList.contains(li)&&j.detach(i.startContainer.previousElementSibling):i.startContainer.nextElementSibling&&i.endContainer.textContent.length===i.endOffset&&i.startContainer.nextElementSibling.classList.contains(li)&&j.detach(i.startContainer.nextElementSibling):1===i.startContainer.nodeType&&i.startContainer.classList&&i.startContainer.classList.contains(li)&&j.detach(i.startContainer));break;case"insert-video":j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),this.openDialog(!0,s,t,o,r),s.preventDefault()}s.ctrlKey&&"a"===s.key&&this.handleSelectAll()},u.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll("."+co);j.removeClass(e,co)},u.prototype.openDialog=function(e,t,n,i,o){var r,s,i=e||j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=n,s=i,o):(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n));"HTML"===this.parent.editorMode&&this.insertVideo({args:{item:{command:"Videos",subCommand:"Video"},originalEvent:t,name:e?null:"showDialog"},selectNode:s,selection:r,selectParent:i})},u.prototype.showDialog=function(){this.openDialog(!1)},u.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},u.prototype.checkVideoBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||j.isNullOrUndefined(e.startContainer.previousSibling)||"VIDEO"!==e.startContainer.previousSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.previousSibling)?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])||"VIDEO"!==e.startContainer.childNodes[e.startOffset-1].nodeName&&!this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset-1])||this.deletedVid.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedVid.push(e.startContainer.previousSibling)},u.prototype.checkVideoDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||j.isNullOrUndefined(e.startContainer.nextSibling)||"VIDEO"!==e.startContainer.nextSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.nextSibling)?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])||"VIDEO"!==e.startContainer.childNodes[e.startOffset].nodeName&&!this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset])||this.deletedVid.push(e.startContainer.childNodes[e.startOffset]):this.deletedVid.push(e.startContainer.nextSibling)},u.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Videos"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),i={args:e,selectNode:n="VIDEO"===n[0].nodeName?n:[this.videoEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":this.alignVideo(i,t.subCommand);break;case"Inline":this.inline(i);break;case"Break":this.break(i)}this.quickToolObj&&document.body.contains(this.quickToolObj.videoQTBar.element)&&(this.quickToolObj.videoQTBar.hidePopup(),j.removeClass([n[0]],co)),this.cancelResizeAction()}},u.prototype.deleteVideo=function(e,t){var n;("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0]))&&(this.isEmbedVidElem(e.selectNode[0])&&(e.selectNode[0]=e.selectNode[0].classList.contains(si)?e.selectNode[0]:e.selectNode[0].parentElement),n={element:this.isEmbedVidElem(e.selectNode[0])?e.selectNode[0]:e.selectNode[0].querySelector("iframe"),src:(this.isEmbedVidElem(e.selectNode[0])?e.selectNode[0].querySelector("iframe"):e.selectNode[0].querySelector("source")).getAttribute("src")},0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.restore(),this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.videoRemovePost(n.src),this.quickToolObj&&document.body.contains(this.quickToolObj.videoQTBar.element)&&this.quickToolObj.videoQTBar.hidePopup(),this.cancelResizeAction(),j.isNullOrUndefined(t))&&this.parent.trigger(Rt,n)},u.prototype.videoRemovePost=function(e){var t=this,n="";j.isNullOrUndefined(this.parent.insertVideoSettings.removeUrl)||""===this.parent.insertVideoSettings.removeUrl||(n=-1<e.indexOf("http://")||-1<e.indexOf("https://")?e:new URL(e,document.baseURI).href,this.removingVideoName=n.replace(/^.*[\\\/]/,""),(e=new XMLHttpRequest).addEventListener("readystatechange",function(){4===this.readyState&&200===this.status&&t.triggerPost(this.response)}),e.open("GET",n),e.responseType="blob",e.send())},u.prototype.triggerPost=function(e){var t,n=this.parent.insertVideoSettings.removeUrl;j.isNullOrUndefined(n)||""===n||(e=new File([e],this.removingVideoName),n=new j.Ajax(n,"POST",!0,null),(t=new FormData).append("UploadFiles",e),n.send(t))},u.prototype.onDocumentClick=function(e){var t=e.target;j.isNullOrUndefined(this.contentModule.getEditPanel())||("VIDEO"!==t.nodeName&&!this.isEmbedVidElem(t)||(this.videoEle=this.isEmbedVidElem(t)?t.querySelector("iframe"):t),j.isNullOrUndefined(this.dialogObj)||!(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_Video")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Video"))||e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(hn,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Or(this.parent.element,"focusout")),this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&("VIDEO"===t.tagName||this.isEmbedVidElem(t)||this.removeResizeEle(),"VIDEO"===t.tagName||this.isEmbedVidElem(t)||j.isNullOrUndefined(this.videoEle)?j.isNullOrUndefined(this.prevSelectedVidEle)||this.prevSelectedVidEle===("IFRAME"===t.tagName||"VIDEO"===t.tagName?t:t.querySelector("iframe"))||(this.prevSelectedVidEle.style.outline=""):this.videoEle.style.outline=""),this.parent.inlineMode.enable&&t&&this.dialogObj&&!j.closest(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide())},u.prototype.removeResizeEle=function(){this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),j.detach(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))},u.prototype.onWindowResize=function(){j.isNullOrUndefined(this.contentModule)||j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))||this.cancelResizeAction()},u.prototype.break=function(e){var t;"VIDEO"!==e.selectNode[0].nodeName&&!this.isEmbedVidElem(e.selectNode[0])||(t=e.args.item?e.args.item.subCommand:"Break",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},u.prototype.inline=function(e){var t;"VIDEO"!==e.selectNode[0].nodeName&&!this.isEmbedVidElem(e.selectNode[0])||(t=e.args.item?e.args.item.subCommand:"Inline",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},u.prototype.alignVideo=function(e,t){t=e.args.item?e.args.item.subCommand:t;this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t})},u.prototype.editAreaClickHandler=function(e){var t,n,i;this.parent.readonly?this.hideVideoQuickToolbar():(t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick,2===t.which||n&&1===t.which||!n&&3===t.which?!n||1!==t.which||j.isNullOrUndefined(t.target)||"VIDEO"!==t.target.tagName&&!this.isEmbedVidElem(t.target)||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),t.target)):"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.videoQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,n=t.target,this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),i=this.quickToolObj.videoQTBar.element.classList.contains("e-rte-pop"),("VIDEO"===n.nodeName||this.isEmbedVidElem(n))&&this.parent.quickToolbarModule?i||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n),vs()&&this.parent.notify(Ve,e),j.addClass([this.isEmbedVidElem(n)?n.querySelector("iframe"):n],co),this.showVideoQuickToolbar({args:t,type:"Videos",elements:[t.target]})):this.hideVideoQuickToolbar()))},u.prototype.showVideoQuickToolbar=function(e){var t,n,i,o=this;"Videos"!==e.type||!j.isNullOrUndefined(e.args)&&2===e.args.detail||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.videoQTBar)||j.isNullOrUndefined(e.args)||(this.quickToolObj=this.parent.quickToolbarModule,t=e.args,n=e.elements,[].forEach.call(e.elements,function(e,t){0===t&&(n=e)}),"VIDEO"!==n.tagName&&!this.isEmbedVidElem(n)||j.addClass([this.isEmbedVidElem(n)&&"IFRAME"!==n.tagName?n.querySelector("iframe"):n],[co]),i=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+t.clientY:t.pageY,this.parent.quickToolbarModule.videoQTBar&&(e.isNotify?this.showPopupTime=setTimeout(function(){o.parent.formatter.editorManager.nodeSelection.Clear(o.contentModule.getDocument()),o.parent.formatter.editorManager.nodeSelection.setSelectionContents(o.contentModule.getDocument(),n),o.quickToolObj.videoQTBar.showPopup(t.pageX-50,i+n.getBoundingClientRect().height/2-n.offsetTop,n)},400):this.quickToolObj.videoQTBar.showPopup(t.pageX-50,i+n.getBoundingClientRect().height/2-n.offsetTop,n)))},u.prototype.hideVideoQuickToolbar=function(){j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector("."+co))||(j.removeClass([this.contentModule.getEditPanel().querySelector("."+co)],co),j.isNullOrUndefined(this.videoEle)||(this.videoEle.style.outline=""),j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))||j.detach(this.contentModule.getEditPanel().querySelector(".e-vid-resize")),this.quickToolObj&&this.quickToolObj.videoQTBar&&document.body.contains(this.quickToolObj.videoQTBar.element)&&this.quickToolObj.videoQTBar.hidePopup())},u.prototype.isEmbedVidElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&e.classList.contains(si)||e&&"IFRAME"===e.nodeName)},u.prototype.insertingVideo=function(e){this.insertVideo(e),j.isNullOrUndefined(this.dialogObj)||(this.dialogObj.element.style.maxHeight="inherit",e=this.dialogObj.element.querySelector(".e-video-content"),(j.isNullOrUndefined(this.parent.insertVideoSettings.path)&&"HTML"!==this.parent.editorMode?e.querySelector(".e-video-url"):document.getElementById(this.rteID+"_insertVideo")).focus())},u.prototype.insertVideo=function(e){var t,n,i,o,r,s,a,l,d=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-video-dialog",id:this.rteID+"_video"}),this.parent.rootContainer.appendChild(t),r=this.i10n.getConstant("dialogInsert"),s=this.i10n.getConstant("dialogCancel"),i=this.i10n.getConstant("videoHeader"),n=e.selection,o={selfVideo:this,selection:e.selection,args:e.args,selectParent:e.selectParent},i={header:i,cssClass:Ei,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",isModal:j.Browser.isDevice,buttons:[{click:this.insertVideoUrl.bind(o),buttonModel:{content:r,cssClass:"e-flat e-insertVideo",isPrimary:!0,disabled:!0}},{click:function(e){d.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel",content:s}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){d.isVideoUploaded&&(d.dialogObj.element.querySelector(".e-file-abort-btn")?d.dialogObj.element.querySelector(".e-file-abort-btn").click():d.uploadObj.remove()),d.parent.isBlur=!1,e&&!j.isNullOrUndefined(e.event)&&e.event.returnValue&&"HTML"===d.parent.editorMode&&n.restore(),d.clearDialogObj(),d.dialogRenderObj.close(e)}},o=this.parent.createElement("div",{className:"e-video-content"}),j.isNullOrUndefined(this.parent.insertVideoSettings.path)&&"HTML"!==this.parent.editorMode||o.appendChild(this.videoUpload(e)),r=this.parent.createElement("div",{className:"e-videoheader"}),s=this.parent.createElement("div",{className:"e-embed-videoheader"}),a=this.i10n.getConstant("videoLinkHeader"),l=this.i10n.getConstant("embedVideoLinkHeader"),"HTML"===this.parent.editorMode&&(r.innerHTML=a,s.innerHTML=l),o.appendChild(this.urlPopup(e)),e.selectNode&&1===e.selectNode[0].nodeType&&("VIDEO"===e.selectNode[0].tagName||this.isEmbedVidElem(e.selectNode[0]))&&(i.header=this.parent.localeObj.getConstant("editVideoHeader")),i.content=o,this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),e.selectNode&&1===e.selectNode[0].nodeType&&("VIDEO"===e.selectNode[0].tagName||this.isEmbedVidElem(e.selectNode[0]))&&"insertVideo"===e.name&&(this.dialogObj.element.querySelector(".e-insertVideo").textContent=this.parent.localeObj.getConstant("dialogUpdate")),t.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.videoQTBar&&document.body.contains(this.quickToolObj.videoQTBar.element)&&(this.quickToolObj.videoQTBar.hidePopup(),j.isNullOrUndefined(e.selectParent)||j.removeClass([e.selectParent[0]],co)),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())},u.prototype.urlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"e-video-url-wrap"}),i=this.parent.createElement("div",{id:"urlcontent"}),o=this.i10n.getConstant("videoUrl"),r=Lr('<input id="embedURL" type="radio"><input id="webURL" type="radio" >'),s=(n.appendChild(r),n.appendChild(i),this.embedInputUrl=this.parent.createElement("textarea",{className:"e-input e-embed-video-url",attrs:{placeholder:this.i10n.getConstant("pasteEmbeddedCodeHere"),type:"text",tabindex:"-1","aria-label":this.i10n.getConstant("embedVideoLinkHeader")}}),this.embedInputUrl.addEventListener("keyup",function(){j.isNullOrUndefined(t.embedInputUrl)||(0===t.embedInputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),this.inputUrl=this.parent.createElement("input",{className:"e-input e-video-url",attrs:{placeholder:o,spellcheck:"false"}}),this.inputUrl.addEventListener("input",function(){j.isNullOrUndefined(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),e.selectNode&&e.selectNode[0]&&("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0]))&&("VIDEO"===e.selectNode[0].nodeName?(r=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),o=e.selectNode[0].querySelector("source"),this.inputUrl.value=o&&o.src&&o.src.match(r)?o.src:""):this.embedInputUrl.value=("IFRAME"===e.selectNode[0].nodeName?e.selectNode[0]:e.selectNode[0].querySelector("iframe")).outerHTML),!!this.inputUrl.value);return this.embedUrlBtn=new H.RadioButton({label:this.i10n.getConstant("embeddedCode"),checked:!s,name:"URL",created:function(){s||i.appendChild(t.embedInputUrl)},change:function(){i.innerHTML="",i.appendChild(t.embedInputUrl)}}),this.embedUrlBtn.appendTo(n.querySelector("#embedURL")),this.webUrlBtn=new H.RadioButton({label:this.i10n.getConstant("webUrl"),checked:s,name:"URL",created:function(){s&&i.appendChild(t.inputUrl)},change:function(){i.innerHTML="",i.appendChild(t.inputUrl)}}),this.webUrlBtn.appendTo(n.querySelector("#webURL")),n},u.prototype.videoUpload=function(e){var i,o,r,s=this,a=this,t=a.parent.iframeSettings.enable,t=(o="HTML"===a.parent.editorMode&&(!t&&j.isNullOrUndefined(j.closest(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||t&&!p(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))?(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)):(i=e.selection,e.selectParent),this.parent.createElement("div",{className:"e-vid-uploadwrap e-droparea"})),n=this.i10n.getConstant("videoDeviceUploadMessage"),l=this.i10n.getConstant("videoUploadMessage"),d=this.parent.createElement("span",{className:"e-droptext"}),n=this.parent.createElement("span",{className:"e-rte-upload-text",innerHTML:j.Browser.isDevice?n:l}),l=(d.appendChild(n),this.parent.createElement("button",{className:"e-browsebtn",id:this.rteID+"_insertVideo",attrs:{autofocus:"true",type:"button"}})),n=(d.appendChild(l),t.appendChild(d),this.i10n.getConstant("browse")),n=(this.button=new H.Button({content:n,enableRtl:this.parent.enableRtl}),this.button.isStringTemplate=!0,this.button.createElement=this.parent.createElement,this.button.appendTo(l),j.Browser.isDevice?d:l),l=(j.EventHandler.add(n,"click",this.fileSelect,this),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}}));return t.appendChild(l),this.uploadObj=new P.Uploader({asyncSettings:{saveUrl:this.parent.insertVideoSettings.saveUrl,removeUrl:this.parent.insertVideoSettings.removeUrl},dropArea:d,multiple:!1,enableRtl:this.parent.enableRtl,allowedExtensions:this.parent.insertVideoSettings.allowedTypes.toString(),selected:function(e){a.isVideoUploaded=!0,e.filesData,s.parent.trigger(wt,e,function(e){var n;e.cancel||(s.checkExtension(e.filesData[0]),r=e.filesData[0].name,"HTML"===s.parent.editorMode&&j.isNullOrUndefined(s.parent.insertVideoSettings.path)&&((n=new FileReader).addEventListener("load",function(e){var t="Base64"===s.parent.insertVideoSettings.saveFormat?n.result:URL.createObjectURL(Ir(n.result));a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o},a.inputUrl.setAttribute("disabled","true"),a.embedInputUrl.setAttribute("disabled","true"),j.isNullOrUndefined(a.parent.insertVideoSettings.saveUrl)&&s.isAllowedTypes&&!j.isNullOrUndefined(s.dialogObj)&&s.dialogObj.getButtons(0).element.removeAttribute("disabled")}),n.readAsDataURL(e.filesData[0].rawFile)))})},beforeUpload:function(e){s.parent.trigger(Pt,e)},uploading:function(e){s.parent.isServerRendered||s.parent.trigger(kt,e)},success:function(e){s.parent.trigger(xt,e,function(e){var t;j.isNullOrUndefined(s.parent.insertVideoSettings.path)||(t=s.parent.insertVideoSettings.path+e.file.name,a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o,width:{width:a.parent.insertVideoSettings.width,minWidth:a.parent.insertVideoSettings.minWidth,maxWidth:a.parent.getInsertImgMaxWidth()},height:{height:a.parent.insertVideoSettings.height,minHeight:a.parent.insertVideoSettings.minHeight,maxHeight:a.parent.insertVideoSettings.maxHeight}},a.embedInputUrl.setAttribute("disabled","true")),"upload"!==e.operation||j.isNullOrUndefined(s.dialogObj)||s.dialogObj.getButtons(0).element.removeAttribute("disabled")})},failure:function(e){s.parent.trigger(Dt,e)},removing:function(){s.parent.trigger(Mt,e,function(e){a.isVideoUploaded=!1,s.dialogObj.getButtons(0).element.disabled=!0,a.inputUrl.getAttribute("disabled")&&a.inputUrl.removeAttribute("disabled"),a.embedInputUrl.getAttribute("disabled")&&a.embedInputUrl.removeAttribute("disabled"),a.uploadUrl&&(a.uploadUrl.url="")})}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(l),t},u.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},u.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},u.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0}),this.isVideoUploaded&&this.uploadObj.removing()},u.prototype.insertVideoUrl=function(e){var t,n=this.selfVideo,i=(n.isVideoUploaded=!1,n.inputUrl.value),o=n.embedInputUrl.value;0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),j.isNullOrUndefined(n.uploadUrl)||""===n.uploadUrl.url?"HTML"!==n.parent.editorMode||""===i&&""===o||("HTML"===n.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+n.contentModule.getPanel().id+"']"))&&(n.contentModule.getEditPanel().focus(),t=n.parent.formatter.editorManager.nodeSelection.getRange(n.contentModule.getDocument()),this.selection=n.parent.formatter.editorManager.nodeSelection.save(t,n.contentModule.getDocument()),this.selectParent=n.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)),o=(t=document.getElementById("webURL")).checked?i.split("/")[i.split("/").length-1]:o,i={cssClass:"Inline"===n.parent.insertVideoSettings.layoutOption?gi:di,url:i,selection:this.selection,fileName:o,isEmbedUrl:!t.checked,selectParent:this.selectParent,width:{width:n.parent.insertVideoSettings.width,minWidth:n.parent.insertVideoSettings.minWidth,maxWidth:n.parent.getInsertImgMaxWidth()},height:{height:n.parent.insertVideoSettings.height,minHeight:n.parent.insertVideoSettings.minHeight,maxHeight:n.parent.insertVideoSettings.maxHeight}},n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,i),n.dialogObj.hide({returnValue:!1})):(n.uploadUrl.cssClass="Inline"===n.parent.insertVideoSettings.layoutOption?gi:di,n.uploadUrl.width={width:n.parent.insertVideoSettings.width,minWidth:n.parent.insertVideoSettings.minWidth,maxWidth:n.parent.getInsertImgMaxWidth()},n.uploadUrl.height={height:n.parent.insertVideoSettings.height,minHeight:n.parent.insertVideoSettings.minHeight,maxHeight:n.parent.insertVideoSettings.maxHeight},n.dialogObj.hide({returnValue:!1}),n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,n.uploadUrl),n.uploadUrl.url="")},u.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedVidEle=void 0,this.removeEventListener(),this.showPopupTime&&(clearTimeout(this.showPopupTime),this.showPopupTime=null),this.clearDialogObj(),this.isDestroyed=!0)},u.prototype.getModuleName=function(){return"video"};var Fs=u;function u(e,t){this.isVideoUploaded=!1,this.isAllowedTypes=!0,this.pageX=null,this.pageY=null,this.mouseX=null,this.deletedVid=[],this.isResizeBind=!0,this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1,this.docClick=this.onDocumentClick.bind(this)}var qs,zs,_s,Vs="keydown",Qs="action",Ws="format-type",m="keydown-handler",Ks="list-type",Gs="keyup-handler",Xs="keyup",Ys="model_changed_plugin",Js="model_changed",$s="ms_word_cleanup_plugin",Zs="ms_word_cleanup",ea="onBegin",ta="actionBegin",na="format_painter_actions",ia="blockquote_list_handled",oa="emoji_picker_actions",ra="mouseDown",sa="destroy",f="internal_destroy",aa=(qs=function(e,t){return(qs=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)},function(e,t){function n(){this.constructor=e}qs(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),la=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},da={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,space:32,escape:27,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,semicolon:186,plus:187,comma:188,minus:189,dot:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222,"]":221,"[":219,"=":187,"<":188,">":190,"`":192},ca=(zs=j.Base,aa(ha,zs),(_s=ha).prototype.destroy=function(){this.unwireEvents(),zs.prototype.destroy.call(this)},ha.prototype.onPropertyChanged=function(e,t){},ha.prototype.bind=function(){this.wireEvents()},ha.prototype.getModuleName=function(){return"keyboard"},ha.prototype.wireEvents=function(){this.element.addEventListener(this.eventName,this.keyPressHandler)},ha.prototype.unwireEvents=function(){this.element.removeEventListener(this.eventName,this.keyPressHandler)},ha.getKeyConfigData=function(e){var t,n;return e in this.configCache?this.configCache[""+e]:(n={altKey:-1!==(t=e.toLowerCase().split("+")).indexOf("alt"),ctrlKey:-1!==t.indexOf("ctrl"),shiftKey:-1!==t.indexOf("shift"),keyCode:null},1<t[t.length-1].length&&Number(t[t.length-1])?n.keyCode=Number(t[t.length-1]):n.keyCode=_s.getKeyCode(t[t.length-1]),_s.configCache[""+e]=n)},ha.getKeyCode=function(e){return da[""+e]||e.toUpperCase().charCodeAt(0)},ha.configCache={},la([j.Property({})],ha.prototype,"keyConfigs",void 0),la([j.Property("keyup")],ha.prototype,"eventName",void 0),la([j.Event()],ha.prototype,"keyAction",void 0),_s=la([j.NotifyPropertyChanges],ha));function ha(e,t){var p=zs.call(this,t,e)||this;return p.keyPressHandler=function(e){for(var t=e.altKey,n=e.ctrlKey,i=e.shiftKey,o=e.metaKey,r=e.which,s=0,a=Object.keys(p.keyConfigs);s<a.length;s++)for(var l=a[s],d=0,c=p.keyConfigs[""+l].split(",");d<c.length;d++){var h=c[d],h=_s.getKeyConfigData(h.trim());t!==h.altKey||n!==h.ctrlKey&&!o||i!==h.shiftKey||r!==h.keyCode||(e.action=l)}p.keyAction&&p.keyAction(e)},p.bind(),p}ua.prototype.addEventListener=function(){this.parent.on(qe,this.sourceCode,this),this.parent.on(n,this.onInitialEnd,this),this.parent.on(ze,this.updateSourceCode,this),this.parent.on(o,this.destroy,this)},ua.prototype.onInitialEnd=function(){this.parent.formatter.editorManager.observer.on(m,this.onKeyDown,this)},ua.prototype.removeEventListener=function(){this.unWireEvent(),this.parent.off(qe,this.sourceCode),this.parent.off(ze,this.updateSourceCode),this.parent.off(n,this.onInitialEnd),this.parent.off(o,this.destroy),this.parent.formatter.editorManager.observer.off(m,this.onKeyDown)},ua.prototype.getSourceCode=function(){return this.parent.createElement("textarea",{className:wo+this.parent.getCssClass(!0)})},ua.prototype.wireEvent=function(e){this.keyboardModule=new ca(e,{keyAction:this.previewKeyDown.bind(this),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"}),j.EventHandler.add(this.previewElement,"mousedown",this.mouseDownHandler,this)},ua.prototype.unWireEvent=function(){this.previewElement&&j.EventHandler.remove(this.previewElement,"mousedown",this.mouseDownHandler),this.keyboardModule&&!this.keyboardModule.isDestroyed&&this.keyboardModule.destroy()},ua.prototype.wireBaseKeyDown=function(){this.parent.keyboardModule=new ca(this.contentModule.getEditPanel(),{keyAction:this.parent.keyDown.bind(this.parent),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"})},ua.prototype.unWireBaseKeyDown=function(){this.parent.keyboardModule.destroy()},ua.prototype.mouseDownHandler=function(e){this.parent.notify(Ge,{args:e})},ua.prototype.previewKeyDown=function(e){switch(e.action){case"html-source":this.updateSourceCode(e),e.preventDefault();break;case"toolbar-focus":var t;this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&((t=this.parent.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]")).firstElementChild.removeAttribute("tabindex"),t.firstElementChild.focus())}},ua.prototype.onKeyDown=function(e){"html-source"===e.event.action&&(e.event.preventDefault(),this.sourceCode(e),e.callBack({requestType:"SourceCode",editorMode:"HTML",event:e.event}))},ua.prototype.sourceCode=function(i){var o=this;this.parent.notify(an,{}),this.parent.isBlur=!1,this.parent.trigger(Oe,{requestType:"SourceCode",targetItem:"SourceCode",args:i,cancel:!1},function(e){var t,n;e.cancel||(e=j.selectAll("."+Kn,o.parent.element),o.contentModule=o.rendererFactory.getRenderer(c.RenderType.Content),t=o.parent.inputElement.getBoundingClientRect().height,o.parent.rootContainer.classList.add("e-source-code-enabled"),o.parent.notify(ke,{targetItem:"SourceCode",updateItem:"Preview",baseToolbar:o.parent.getBaseToolbarObject()}),j.isNullOrUndefined(o.previewElement)&&(o.previewElement=o.getSourceCode()),n=void o.parent.updateValueData(),j.isNullOrUndefined(o.parent.element.querySelector("#"+o.parent.getID()+"_source-view"))?n=o.parent.createElement("div",{className:"e-source-content",id:o.parent.getID()+"_source-view",attrs:{style:"height:"+t+"px"}}):(n=o.parent.element.querySelector("#"+o.parent.getID()+"_source-view")).style.height=t+"px",n.appendChild(o.previewElement),o.parent.rootContainer.appendChild(n),o.getPanel().value=o.getTextAreaValue(),o.parent.isBlur=!1,o.parent.disableToolbarItem(o.parent.toolbarSettings.items),o.parent.enableToolbarItem("SourceCode"),o.parent.getToolbar()&&j.removeClass([o.parent.getToolbar()],[Ni]),j.removeClass(e,[Ci]),o.wireEvent(o.previewElement),o.unWireBaseKeyDown(),o.previewElement.focus(),o.parent.updateValue(),o.parent.trigger(Le,{requestType:"SourceCode",targetItem:"SourceCode",args:i}),o.parent.invokeChangeEvent(),!j.isNullOrUndefined(o.parent.saveInterval)&&0<o.parent.saveInterval&&o.parent.autoSaveOnIdle&&(o.codeViewTimeInterval=setInterval(function(){o.parent.notify(cn,{})},o.parent.saveInterval)))})},ua.prototype.updateSourceCode=function(n){var i=this;this.parent.isBlur=!1,this.parent.trigger(Oe,{requestType:"Preview",targetItem:"Preview",args:n,cancel:!1},function(e){var t;e.cancel||(i.parent.rootContainer.classList.remove("e-source-code-enabled"),e=i.getPanel(),i.parent.notify(ke,{targetItem:"Preview",updateItem:"SourceCode",baseToolbar:i.parent.getBaseToolbarObject()}),t=void 0,t=null===(e=i.parent.serializeValue(e.value))||""===e?"DIV"===i.parent.enterKey?"<div><br/></div>":"BR"===i.parent.enterKey?"<br/>":"<p><br/></p>":e,i.contentModule.getEditPanel().innerHTML=t,i.parent.isBlur=!1,i.parent.enableToolbarItem(i.parent.toolbarSettings.items),i.parent.getToolbar()&&j.removeClass([i.parent.getToolbar()],[Ni]),i.unWireEvent(),i.wireBaseKeyDown(),i.contentModule.getEditPanel().focus(),i.parent.updateValue(),i.parent.trigger(Le,{requestType:"Preview",targetItem:"Preview",args:n}),i.parent.formatter.enableUndo(i.parent),i.parent.addAudioVideoWrapper(),clearTimeout(i.codeViewTimeInterval),i.parent.invokeChangeEvent(),i.parent.notify(_,{}))})},ua.prototype.getTextAreaValue=function(){return"<p><br></p>"===this.contentModule.getEditPanel().innerHTML||"<div><br></div>"===this.contentModule.getEditPanel().innerHTML||"<br>"===this.contentModule.getEditPanel().innerHTML||1===this.contentModule.getEditPanel().childNodes.length&&"P"===this.contentModule.getEditPanel().childNodes[0].tagName&&7===this.contentModule.getEditPanel().innerHTML.length||"DIV"===this.contentModule.getEditPanel().childNodes[0].tagName&&11===this.contentModule.getEditPanel().innerHTML.length?"":this.parent.value},ua.prototype.getPanel=function(){return this.parent.element&&this.parent.element.querySelector(".e-rte-srctextarea")},ua.prototype.destroy=function(){j.isNullOrUndefined(this.parent)||this.removeEventListener()};var pa=ua;function ua(e,t){this.parent=e;e=t;this.rendererFactory=e.getService("rendererFactory"),this.addEventListener()}b.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(at,this.renderDlgContent,this),this.parent.on(n,this.afterRender,this),this.parent.on(qt,this.afterRender,this),this.parent.on(Zt,this.showDialog,this),this.parent.on(en,this.closeDialog,this),this.parent.on(lt,this.docClick,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(Xe,this.editAreaClickHandler,this),this.parent.on(gt,this.clearDialogObj,this),this.parent.on(dt,this.onToolbarAction,this),this.parent.on(ce,this.dropdownSelect,this),this.parent.on(h,this.keyDown,this),this.parent.on(ne,this.keyUp,this),this.parent.on(re,this.selectionTable,this),this.parent.on(te,this.tableModulekeyUp,this),this.parent.on(tn,this.setCssClass,this),this.parent.on(o,this.destroy,this),this.parent.on(dn,this.afterKeyDown,this))},b.prototype.removeEventListener=function(){this.parent.off(at,this.renderDlgContent),this.parent.off(n,this.afterRender),this.parent.off(qt,this.afterRender),this.parent.off(lt,this.docClick),this.parent.off(K,this.onIframeMouseDown),this.parent.off(Zt,this.showDialog),this.parent.off(en,this.closeDialog),this.parent.off(Xe,this.editAreaClickHandler),this.parent.off(gt,this.clearDialogObj),this.parent.off(dt,this.onToolbarAction),this.parent.off(ce,this.dropdownSelect),this.parent.off(Ke,this.cellSelect),this.parent.off(Ze,this.setBGColor),this.parent.off(h,this.keyDown),this.parent.off(ne,this.keyUp),this.parent.off(re,this.selectionTable),this.parent.off(te,this.tableModulekeyUp),this.parent.off(tn,this.setCssClass),this.parent.off(o,this.destroy),this.parent.off(dn,this.afterKeyDown),!j.Browser.isDevice&&this.parent.tableSettings.resize&&(j.EventHandler.remove(this.contentModule.getEditPanel(),"mouseover",this.resizeHelper),j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart))},b.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},b.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)||g([this.popupObj.element],e.oldCssClass),j.addClass([this.popupObj.element],e.cssClass)),this.updateCss(this.createTableButton,e),this.updateCss(this.editdlgObj,e);for(var t=[this.columnTextBox,this.rowTextBox,this.tableWidthNum,this.tableCellPadding,this.tableCellSpacing],n=0;n<t.length;n++)this.updateCss(t[n],e)},b.prototype.selectionTable=function(e){e=e.args.target;"mozilla"!==j.Browser.info.name||j.isNullOrUndefined(j.closest(e,"table"))||"TABLE"!==j.closest(e,"table").tagName||this.parent.contentModule.getEditPanel().setAttribute("contenteditable","true")},b.prototype.afterRender=function(){j.isNullOrUndefined(this.contentModule)&&(this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),this.parent.on(Ze,this.setBGColor,this),this.parent.on(Ke,this.cellSelect,this),this.parent.tableSettings.resize&&j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart,this),!j.Browser.isDevice)&&this.parent.tableSettings.resize&&j.EventHandler.add(this.contentModule.getEditPanel(),"mouseover",this.resizeHelper,this)},b.prototype.dropdownSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Table"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i={args:e,selection:this.parent.formatter.editorManager.nodeSelection.save(n,this.contentModule.getDocument()),selectParent:this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)};switch(t.subCommand){case"InsertRowBefore":case"InsertRowAfter":this.addRow(i.selection,e);break;case"InsertColumnLeft":case"InsertColumnRight":this.addColumn(i.selection,e);break;case"DeleteColumn":case"DeleteRow":this.removeRowColumn(i.selection,e);break;case"AlignTop":case"AlignMiddle":case"AlignBottom":this.verticalAlign(i,e);break;case"Dashed":case"Alternate":case"Custom":this.tableStyles(i,t.subCommand);break;case"Merge":case"VerticalSplit":case"HorizontalSplit":this.UpdateCells(i.selection,e)}}},b.prototype.UpdateCells=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar()},b.prototype.keyUp=function(e){var t=e.args.target;"escape"===e.args.key.toLocaleLowerCase()&&t&&t.classList&&this.popupObj&&!j.closest(t,"[id='"+this.popupObj.element.id+"']")&&this.popupObj&&("BUTTON"!==(e=this.popupObj.relateTo).nodeName&&(e=(e=e.querySelector("span.e-create-table")).parentElement),this.popupObj.hide(),e)&&e.focus()},b.prototype.keyDown=function(e){var t,n=e.args;switch(n.action){case"escape":break;case"insert-table":this.openDialog(!0,e),n.preventDefault()}if(!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&"KeyK"!==n.code){var i=void 0,o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(o)[0];if(r=r&&"TD"!==r.tagName&&"TH"!==r.tagName?r.parentElement:r,(8===n.keyCode||46===n.keyCode||n.ctrlKey&&88===n.keyCode)&&(r&&"TBODY"===r.tagName?(!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(i=this.parent.formatter.editorManager.nodeSelection.save(o,this.contentModule.getDocument())),n.preventDefault(),this.removeTable(i,n,!0)):r&&0<r.querySelectorAll("table").length&&(this.removeResizeElement(),this.hideTableQuickToolbar())),r&&"TD"!==r.tagName&&"TH"!==r.tagName&&(s=j.closest(r,"td"),r=!j.isNullOrUndefined(s)&&this.parent.inputElement.contains(s)?s:r),r&&("TD"===r.tagName||"TH"===r.tagName)){var s=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");if(!j.isNullOrUndefined(this.activeCell)&&this.activeCell===r||j.isNullOrUndefined(s)||0!==s.length||(this.activeCell=r),!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(i=this.parent.formatter.editorManager.nodeSelection.save(o,this.contentModule.getDocument())),!n.shiftKey||n.shiftKey&&9===n.keyCode)switch(n.keyCode){case 9:case 37:case 39:this.removeCellSelectClasses(),this.tabSelection(n,i,r);break;case 40:case 38:this.removeCellSelectClasses(),this.tableArrowNavigation(n,i,r)}}}!n.shiftKey||39!==n.keyCode&&37!==n.keyCode&&38!==n.keyCode&&40!==n.keyCode||(this.keyDownEventInstance=n,j.EventHandler.add(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection,this)),n.ctrlKey&&"a"===n.key&&this.handleSelectAll(),("Delete"===n.code&&46===n.which||"Backspace"===n.code&&8===n.which)&&"HTML"===this.parent.editorMode?(o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer.nodeType===Node.ELEMENT_NODE&&"DIV"===o.startContainer.nodeName&&o.startContainer.classList.contains("e-table-fake-selection")?(this.deleteTable(),n.preventDefault()):(t="Delete"===n.code&&46===n.which?this.getAdjacentTableElement(o,!0):this.getAdjacentTableElement(o,!1))&&(this.updateTableSelection(t),n.preventDefault()):(s=n.shiftKey&&"Enter"===n.key,o=-1!==ko.indexOf(n.key),(s||o||n.key&&1===n.key.length)&&((t=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select"))&&(39===n.keyCode||37===n.keyCode?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),t,0):(s=t.querySelector("tr").cells[0],this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),s,s,0,0))),this.removeTableSelection()))},b.prototype.tableCellsKeyboardSelection=function(e){j.EventHandler.remove(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection);var t,n,i,o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.keyDownEventInstance,o=!(j.isNullOrUndefined(o)||j.isNullOrUndefined(o.commonAncestorContainer)||o.commonAncestorContainer.nodeType!==Node.ELEMENT_NODE||"TR"!==o.commonAncestorContainer.tagName&&"TBODY"!==o.commonAncestorContainer.tagName||j.isNullOrUndefined(this.activeCell)),s=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");!j.isNullOrUndefined(s)&&0<s.length&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),s[0],s[0],0,0),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),s[0],0)),(o||!j.isNullOrUndefined(s)&&0<s.length)&&(o=this.getCorrespondingColumns(),n=!j.isNullOrUndefined(s)&&0<s.length?s[0]:this.activeCell,t=(n=this.getCorrespondingIndex(n,o))[0],n=n[1],i=void 0,39===r.keyCode?n<o[0].length-1?i=o[t][n+1]:t<o.length-1?(i=o[t+1][n],0===s.length&&t<o.length-1&&(this.activeCell=o[t][0])):this.resetTableSelection():37===r.keyCode?0<n?i=o[t][n-1]:0<t?(i=o[t-1][n],0===s.length&&0<t&&(this.activeCell=o[t][o[t].length-1])):this.resetTableSelection():38===r.keyCode?0<t?i=o[t-1][n]:this.resetTableSelection():40===r.keyCode&&(t<o.length-1?i=o[t+1][n]:this.resetTableSelection()),i)&&this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:{target:i},selectNode:[this.activeCell]}),0<s.length&&(r.preventDefault(),e.preventDefault())},b.prototype.resetTableSelection=function(){var e=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");!j.isNullOrUndefined(e)&&0<e.length&&this.parent.formatter.editorManager.nodeSelection.setSelectionNode(this.parent.contentModule.getDocument(),this.curTable),this.activeCell=null,this.removeCellSelectClasses(),this.removeTableSelection()},b.prototype.getCorrespondingColumns=function(){for(var e=[],t=this.curTable.rows,n=0;n<=t.length-1;n++)for(var i=t[n],o=0,r=0;r<=i.children.length-1;r++){for(var s=i.children[r],a=s,l=parseInt(a.getAttribute("colspan"),10)||1,d=parseInt(a.getAttribute("rowspan"),10)||1,c=n;c<n+d;c++)for(var h=o;h<o+l;h++)e[c]||(e[c]=[]),e[c][h]?o++:e[c][h]=s;o+=0}return e},b.prototype.getCorrespondingIndex=function(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(t[n][i]===e)return[n,i];return[]},b.prototype.getAdjacentTableElement=function(e,t){if(!e.collapsed||!t&&this.quickToolObj&&this.quickToolObj.tableQTBar&&document.body.contains(this.quickToolObj.tableQTBar.element))return null;var n=this.getNodeCollection(e),i=e.collapsed&&this.parent.contentModule.getEditPanel()===e.startContainer&&n&&0<n.length&&n[0]?n[0]:e.startContainer,o=this.getSelectedTableEle(n),n=this.getBrElement(e,n);if(i&&i.nodeType===Node.ELEMENT_NODE&&("IMG"===i.tagName||i.querySelector("img")||"AUDIO"===i.tagName||i.querySelector("audio")||"VIDEO"===i.tagName||i.querySelector("video")||i.querySelector(".e-video-clickelem"))){var r=this.contentModule.getDocument().createRange(),s=(r.collapse(!0),r.selectNodeContents(i),this.parent.formatter.editorManager.nodeSelection.getIndex(i));if(t&&r.startOffset>=e.startOffset||!t&&("IMG"!==i.tagName&&r.startOffset!==e.startOffset||"IMG"===i.tagName&&s!==e.startOffset))return null}if(i&&i.nodeType===Node.TEXT_NODE)if(t){if(e.endOffset!==e.endContainer.textContent.length&&e.endOffset!==e.endContainer.textContent.trim().length)return null}else if(0!==e.startOffset)return null;return(o=i&&i.nodeType===Node.ELEMENT_NODE&&"TABLE"===i.tagName?i:o)&&(r=this.parent.formatter.editorManager.nodeSelection.getIndex(o),e.startOffset===r&&t||e.startOffset!==r&&!t||(o=null)),(o=!o&&i?this.getAdjacentElementFromDom(i,n,t):o)&&o.nodeType===Node.ELEMENT_NODE&&"TABLE"===o.tagName?(this.setSelection(o,n),o):null},b.prototype.getAdjacentElementFromDom=function(e,t,n){for(var i,o=t||e.parentNode,r=e;o&&!i&&o.parentNode;){var s=Array.from(o.childNodes),a=s.indexOf(r);if(-1!==a&&(n&&a<s.length-1||!n&&0<a)?i=s[n?a+1:a-1]:(i=n?o.nextSibling:o.previousSibling,r=o),!t&&e.nodeType===Node.TEXT_NODE&&i&&i.tagName&&"BR"===i.tagName.toUpperCase()&&(t=r=o=i,i=null),t||!i||i.nodeType===Node.ELEMENT_NODE&&"TABLE"===i.tagName||j.isNullOrUndefined(i.textContent)||i.textContent.trim()||(r=o=i.parentNode,i=null),i&&i.tagName&&-1!==["UL","OL","LI"].indexOf(i.tagName.toUpperCase())&&!(i=this.getAdjacentElementFromList(i,n)))return null;o&&o.tagName&&"LI"===o.tagName.toUpperCase()&&!n&&(i=o),o=o.parentNode}return i},b.prototype.getAdjacentElementFromList=function(e,t){for(;e;){if(e.tagName&&-1===["UL","OL","LI"].indexOf(e.tagName.toUpperCase())){e.nodeType===Node.ELEMENT_NODE&&"TABLE"===e.tagName||(e=t?e.firstChild:e.lastChild);break}e=t?e.firstChild:e.lastChild}return e},b.prototype.getNodeCollection=function(e){var t,n=[];return e.collapsed&&this.parent.contentModule.getEditPanel()===e.startContainer&&0<e.startContainer.childNodes.length?(t=Math.max(0,Math.min(e.startContainer.childNodes.length-1,e.endOffset-1)),n.push(e.startContainer.childNodes[t])):n=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(e),n},b.prototype.getSelectedTableEle=function(e){if(e&&0<e.length)for(var t=0,n=Array.from(e);t<n.length;t++){var i=n[t];if(i&&"TABLE"===i.tagName)return i}return null},b.prototype.getBrElement=function(e,t){return"BR"===e.endContainer.tagName?e.endContainer:1===t.length&&t[0]&&"BR"===t[0].tagName?t[0]:null},b.prototype.setSelection=function(e,t){e.classList.contains("e-cell-select")||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),t&&(t.parentNode&&1===t.parentNode.childNodes.length&&"BR"===t.parentNode.firstChild.nodeName?j.detach(t.parentNode):j.detach(t)),(e=this.parent.createElement("div",{className:"e-table-fake-selection"})).setAttribute("contenteditable","false"),this.contentModule.getEditPanel().appendChild(e),this.parent.formatter.editorManager.nodeSelection.setSelectionNode(this.contentModule.getDocument(),e))},b.prototype.removeAllFakeSelectionEles=function(){var e=this.parent.contentModule.getEditPanel().querySelectorAll(".e-table-fake-selection");e&&0<e.length&&e.forEach(function(e){j.detach(e)})},b.prototype.deleteTable=function(){var e,t,n=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select");this.removeResizeElement(),n&&(t=e=document.createElement("br"),"DIV"===this.parent.enterKey?(t=document.createElement("div")).appendChild(e):"P"===this.parent.enterKey&&(t=document.createElement("p")).appendChild(e),n.parentNode.replaceChild(t,n),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),t,t,0,0),this.removeTableSelection())},b.prototype.removeTableSelection=function(){var e=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select");e&&g([e],zi),this.removeAllFakeSelectionEles()},b.prototype.updateTableSelection=function(e){j.addClass([e],"e-cell-select")},b.prototype.handleSelectAll=function(){this.cancelResizeAction(),g(this.parent.inputElement.querySelectorAll("."+zi),zi),this.removeTableSelection()},b.prototype.tableModulekeyUp=function(e){var t,n;!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),(t=(t=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)[0])&&"TD"!==t.tagName&&"TH"!==t.tagName?t.parentElement:t)&&"TD"!==t.tagName&&"TH"!==t.tagName&&(n=j.closest(t,"td"),t=!j.isNullOrUndefined(n)&&this.parent.inputElement.contains(n)?n:t),n=e.args,this.previousTableElement===t||j.isNullOrUndefined(this.previousTableElement)||n.shiftKey||39!==n.keyCode&&37!==n.keyCode&&38!==n.keyCode&&40!==n.keyCode||(g([this.previousTableElement],zi),this.removeTableSelection()))},b.prototype.openDialog=function(e,t){var n,i;e||this.parent.contentModule.getEditPanel().focus(),"HTML"===this.parent.editorMode&&(i=this.parent.contentModule.getDocument(),n=this.parent.formatter.editorManager.nodeSelection.getRange(i),n=this.parent.formatter.editorManager.nodeSelection.save(n,i),i={originalEvent:t?t.args:{action:"insert-table"},item:{command:"Table",subCommand:"CreateTable"},name:e?null:"showDialog"},this.insertTableDialog({self:this,args:i,selection:n}))},b.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},b.prototype.closeDialog=function(){this.editdlgObj&&this.editdlgObj.hide({returnValue:!0})},b.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"TableHeader":this.tableHeader(e.selection,e.args);break;case"TableRemove":this.removeTable(e.selection,e.args);break;case"TableEditProperties":this.editTable(e)}},b.prototype.verticalAlign=function(e,t){e=j.closest(e.selectParent[0],"th")||j.closest(e.selectParent[0],"td");e&&this.parent.formatter.process(this.parent,t,t,{tableCell:e,subCommand:t.item.subCommand})},b.prototype.tableStyles=function(e,t){var n=j.closest(e.selectParent[0],"table");if("Dashed"===t&&(this.parent.element.classList.contains(Qi)?g([this.parent.element],Qi):this.parent.element.classList.add(Qi),n.classList.contains(Qi)?g([this.parent.element],Qi):n.classList.add(Qi)),"Alternate"===t&&(this.parent.element.classList.contains(Wi)?g([this.parent.element],Wi):this.parent.element.classList.add(Wi),n.classList.contains(Wi)?g([n],Wi):n.classList.add(Wi)),e.args&&e.args.item.cssClass)for(var i=e.args.item.cssClass.split(" "),o=0;o<i.length;o++)n.classList.contains(i[o])?g([n],i[o]):n.classList.add(i[o]);this.parent.formatter.saveData(),this.hideTableQuickToolbar(),this.parent.formatter.editorManager.nodeSelection.restore()},b.prototype.insideList=function(e){for(var t=this.parent.formatter.editorManager.domNode.blockNodes(),n=[],i=0;i<t.length;i++)"LI"===t[i].parentNode.tagName?n.push(t[i].parentNode):"LI"===t[i].tagName&&"P"!==t[i].childNodes[0].tagName&&"OL"!==t[i].childNodes[0].tagName&&"UL"!==t[i].childNodes[0].tagName&&n.push(t[i]);return 1<n.length||n.length&&0===e.startOffset&&0===e.endOffset?this.ensureInsideTableList=!0:this.ensureInsideTableList=!1},b.prototype.removeEmptyTextNodes=function(e){for(var t=e.childNodes,n=t.length-1;0<=n;n--){var i=t[n];i.nodeType===Node.TEXT_NODE&&""===i.nodeValue.trim()&&e.removeChild(i)}},b.prototype.tabSelection=function(e,t,n){for(var i=n.closest("table").querySelectorAll("thead, tbody, tr"),o=0;o<i.length;o++)this.removeEmptyTextNodes(i[o]);this.previousTableElement=n;var r,s=this.insideList(t.range);(37===e.keyCode||39===e.keyCode)&&3===t.range.startContainer.nodeType||s||(e.preventDefault(),g([n],zi),this.removeTableSelection(),e.shiftKey||37===e.keyCode?(n===(s=j.isNullOrUndefined(n.previousSibling)?j.isNullOrUndefined(j.closest(n,"tr").previousSibling)?!j.isNullOrUndefined(j.closest(n,"table").previousSibling)&&"td"===j.closest(n,"table").previousSibling.nodeName.toLowerCase()?j.closest(n,"table").previousSibling:n:j.closest(n,"tr").previousSibling.childNodes[j.closest(n,"tr").previousSibling.childNodes.length-1]:n.previousSibling)&&0===n.cellIndex&&j.closest(n,"table").tHead&&(s=(r=j.closest(n,"table")).rows[0].cells[r.rows[0].cells.length-1]),(s=37===e.keyCode&&n===s?j.closest(n,"table").previousSibling:s)&&(""!==s.textContent.trim()&&j.closest(s,"td")?t.setSelectionNode(this.contentModule.getDocument(),s):t.setSelectionText(this.contentModule.getDocument(),s,s,0,0))):(n===(r=j.isNullOrUndefined(n.nextSibling)?j.isNullOrUndefined(j.closest(n,"tr").nextSibling)?!j.isNullOrUndefined(j.closest(n,"table").nextSibling)&&"td"===j.closest(n,"table").nextSibling.nodeName.toLowerCase()?j.closest(n,"table").nextSibling:n:j.closest(n,"tr").nextSibling.childNodes[0]:n.nextSibling)&&"TH"===n.nodeName&&(r=j.closest(n,"table").rows[1].cells[0]),(r=39===e.keyCode&&n===r?j.closest(n,"table").nextSibling:r)&&(""!==r.textContent.trim()&&j.closest(r,"td")?t.setSelectionNode(this.contentModule.getDocument(),r):t.setSelectionText(this.contentModule.getDocument(),r,r,0,0)),n===r&&39!==e.keyCode&&r&&(n.classList.add(zi),this.addRow(t,e,!0),g([n],zi),this.removeTableSelection(),""!==(r=(r.parentElement.nextSibling||r.parentElement).firstChild).textContent.trim()&&j.closest(r,"td")?t.setSelectionNode(this.contentModule.getDocument(),r):t.setSelectionText(this.contentModule.getDocument(),r,r,0,0))))},b.prototype.tableArrowNavigation=function(e,t,n){var i=t.range.startContainer;40===e.keyCode&&3===i.nodeType&&(i.nextSibling&&"BR"===i.nextSibling.nodeName||i.parentNode&&"TD"!==i.parentNode.nodeName)||38===e.keyCode&&3===i.nodeType&&(i.previousSibling&&"BR"===i.previousSibling.nodeName||i.parentNode&&"TD"!==i.parentNode.nodeName)||(e.preventDefault(),g([n],zi),this.removeTableSelection(),(n=40===e.keyCode?j.isNullOrUndefined(j.closest(n,"tr").nextElementSibling)?j.closest(n,"table").tHead&&"TH"===n.nodeName?j.closest(n,"table").rows[1].cells[n.cellIndex]:j.isNullOrUndefined(j.closest(n,"table").nextSibling)?n:j.closest(n,"table").nextSibling:j.closest(n,"tr").nextElementSibling.children[n.cellIndex]:j.isNullOrUndefined(j.closest(n,"tr").previousElementSibling)?j.closest(n,"table").tHead&&"TH"!==n.nodeName?j.closest(n,"table").tHead.rows[0].cells[n.cellIndex]:j.isNullOrUndefined(j.closest(n,"table").previousSibling)?n:j.closest(n,"table").previousSibling:j.closest(n,"tr").previousElementSibling.children[n.cellIndex])&&t.setSelectionText(this.contentModule.getDocument(),n,n,0,0))},b.prototype.setBGColor=function(e){for(var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),n=(this.parent.formatter.editorManager.nodeSelection.save(t,this.contentModule.getDocument()),this.curTable.querySelectorAll(".e-cell-select")),i=0;i<n.length;i++)n[i].style.backgroundColor=e.item.value;this.parent.formatter.saveData(),this.hideTableQuickToolbar()},b.prototype.hideTableQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.tableQTBar&&document.body.contains(this.quickToolObj.tableQTBar.element)&&this.quickToolObj.tableQTBar.hidePopup()},b.prototype.tableHeader=function(e,t){this.parent.formatter.process(this.parent,t,t.originalEvent,{selection:e,subCommand:t.item.subCommand})},b.prototype.getAnchorNode=function(e){var t=j.closest(e,"a");return t||e},b.prototype.editAreaClickHandler=function(e){var t,n,i,o,r,s,a,l;this.parent.readonly||!j.isNullOrUndefined(j.closest(e.args.target,".e-img-caption"))||(t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick,2===t.which)||n&&1===t.which||!n&&3===t.which||"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.tableQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,n=t.target,this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content),this.quickToolObj.tableQTBar.element.classList.contains("e-rte-pop")||(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),o=j.closest(n,"table"),a=this.parent.getRange().startContainer.parentElement,l=this.parent.getRange().endContainer.parentElement,s=this.getAnchorNode(n),r=(new Date).getTime(),n&&"A"!==n.nodeName&&"A"!==s.nodeName&&"IMG"!==n.nodeName&&"VIDEO"!==n.nodeName&&!n.classList.contains(ri)&&"AUDIO"!==n.nodeName&&a===l&&("TD"===n.nodeName||"TH"===n.nodeName||"TABLE"===n.nodeName||o&&this.parent.contentModule.getEditPanel().contains(o))&&(3!==i.startContainer.nodeType||i.collapsed)&&100<r-this.resizeEndTime?(s=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.save(s,this.contentModule.getDocument()),a=void this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),l=void 0,l=j.Browser.isDevice&&e.args.touches?(a=this.parent.iframeSettings.enable?window.pageXOffset+this.parent.element.getBoundingClientRect().left+e.args.changedTouches[0].clientX:e.args.changedTouches[0].pageX,this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+(this.parent.inlineMode.enable?0:this.parent.toolbarModule.getToolbarHeight())+e.args.changedTouches[0].clientY:e.args.changedTouches[0].pageY):(a=this.parent.iframeSettings.enable?window.pageXOffset+this.parent.element.getBoundingClientRect().left+t.clientX:t.pageX,this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+this.parent.toolbarModule.getToolbarHeight()+t.clientY:t.pageY),this.quickToolObj.tableQTBar.showPopup(a,l,n),this.parent.formatter.editorManager.nodeSelection.restore()):this.hideTableQuickToolbar()))},b.prototype.tableCellSelect=function(e){var e=e.target,i=Array.prototype.slice.call(e.parentElement.parentElement.children).indexOf(e.parentElement),o=Array.prototype.slice.call(e.parentElement.children).indexOf(e),e=this.dlgDiv.querySelectorAll(".e-rte-tablecell");Array.prototype.forEach.call(e,function(e){var t=Array.prototype.slice.call(e.parentElement.parentElement.children).indexOf(e.parentElement),n=Array.prototype.slice.call(e.parentElement.children).indexOf(e);g([e],"e-active"),t<=i&&n<=o&&j.addClass([e],"e-active")}),this.tblHeader.innerHTML=o+1+"x"+(i+1)},b.prototype.tableMouseUp=function(){this.unwireTableSelectionEvents(),this.isTableMoveActive=!1},b.prototype.tableMouseLeave=function(){this.unwireTableSelectionEvents(),this.isTableMoveActive=!1,this.resetTableSelection()},b.prototype.tableCellLeave=function(e){g(this.dlgDiv.querySelectorAll(".e-rte-tablecell"),"e-active"),j.addClass([this.dlgDiv.querySelector(".e-rte-tablecell")],"e-active"),this.tblHeader.innerHTML="1x1"},b.prototype.tableCellClick=function(e){var t=e.target,n=Array.prototype.slice.call(t.parentElement.parentElement.children).indexOf(t.parentElement)+1,t=Array.prototype.slice.call(t.parentElement.children).indexOf(t)+1;this.self.tableInsert(n,t,e,this)},b.prototype.tableInsert=function(e,t,n,i){var o=i.self||this,r=i.selection.range.startContainer,r=("P"!==r.nodeName||""!==r.textContent.trim()||0<r.childNodes.length||(r.innerHTML="<br />"),r.parentNode),r=("HTML"===o.parent.editorMode&&(o.parent.iframeSettings.enable&&!p(r.ownerDocument.querySelector("body"),"e-lib")||!o.parent.iframeSettings.enable&&j.isNullOrUndefined(j.closest(r,"[id='"+o.contentModule.getPanel().id+"']")))&&(o.contentModule.getEditPanel().focus(),r=o.parent.formatter.editorManager.nodeSelection.getRange(o.contentModule.getDocument()),i.selection=o.parent.formatter.editorManager.nodeSelection.save(r,o.contentModule.getDocument())),{rows:e,columns:t,width:{minWidth:o.parent.tableSettings.minWidth,maxWidth:o.parent.tableSettings.maxWidth,width:o.parent.tableSettings.width},selection:i.selection});if(o.popupObj){for(var s=Array.prototype.slice.call(n.target.parentElement.parentElement.children),a=0;a<s.length;a++){j.EventHandler.remove(s[a],"mouseleave",this.tableCellLeave);for(var l=Array.prototype.slice.call(s[a].children),d=0;d<l.length;d++)j.EventHandler.remove(l[d],"mousemove",this.tableCellSelect),j.EventHandler.remove(l[d],"mouseup",this.tableCellClick)}o.popupObj.hide()}o.editdlgObj&&o.editdlgObj.hide();e=window.scrollX,t=window.scrollY,o.parent.formatter.process(o.parent,i.args,i.args.originalEvent,r),o.contentModule.getEditPanel().focus(),window.scrollTo(e,t),o.parent.on(Ke,o.cellSelect,o),n=o.parent.formatter.editorManager.nodeSelection.get(o.contentModule.getDocument());j.isNullOrUndefined(n)||j.isNullOrUndefined(n.anchorNode)||n.anchorNode.nodeType!==Node.ELEMENT_NODE||"TD"!==n.anchorNode.tagName&&"TH"!==n.anchorNode.tagName||(o.curTable=j.closest(n.anchorNode,"table"),o.activeCell=n.anchorNode)},b.prototype.cellSelect=function(e){var t=e.args.target,n=j.closest(t,"td,th"),t="TD"!==t.nodeName&&n&&this.parent.contentModule.getEditPanel().contains(n)?n:t;j.isNullOrUndefined(this.activeCell)||!e.args.shiftKey||j.isNullOrUndefined(t)||j.isNullOrUndefined(t.tagName)||"TD"!==t.tagName&&"TH"!==t.tagName||this.activeCell===t?(this.parent.quickToolbarSettings.showOnRightClick&&3===e.args.which&&t.classList.contains(zi)||(this.isTableMoveActive&&(this.unwireTableSelectionEvents(),this.isTableMoveActive=!1),this.activeCell=null,this.removeCellSelectClasses(),this.removeTableSelection()),!t||"TD"!==t.tagName&&"TH"!==t.tagName||(j.addClass([t],zi),this.activeCell=t,this.curTable=this.curTable||j.closest(t,"table"),this.wireTableSelectionEvents(),this.isTableMoveActive=!0,this.removeResizeElement(),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&j.detach(this.helper)),"mozilla"!==j.Browser.info.name||j.isNullOrUndefined(j.closest(t,"table"))||"TABLE"!==j.closest(t,"table").tagName||this.parent.contentModule.getEditPanel().setAttribute("contenteditable","false")):(this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:e.args,selectNode:[this.activeCell]}),e.args.preventDefault())},b.prototype.wireTableSelectionEvents=function(){j.EventHandler.add(this.curTable,"mousemove",this.tableMove,this),j.EventHandler.add(this.curTable,"mouseup",this.tableMouseUp,this),j.EventHandler.add(this.curTable,"mouseleave",this.tableMouseLeave,this)},b.prototype.unwireTableSelectionEvents=function(){j.EventHandler.remove(this.curTable,"mousemove",this.tableMove),j.EventHandler.remove(this.curTable,"mouseup",this.tableMouseUp),j.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave)},b.prototype.removeCellSelectClasses=function(){g(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),_i),g(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),Vi),g(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),zi)},b.prototype.tableMove=function(e){this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:e,selectNode:[this.activeCell]})},b.prototype.resizeHelper=function(e){var t,n,i;this.parent.readonly||this.isTableMoveActive||e&&e.buttons&&0<e.buttons||(t=e.target||e.targetTouches[0].target,n=j.closest(t,"table.e-rte-table, table.e-rte-paste-table"),(i=0<this.parent.contentModule.getEditPanel().querySelectorAll(".e-table-box.e-rbox-select, .e-table-rhelper.e-column-helper, .e-table-rhelper.e-row-helper").length)||j.isNullOrUndefined(this.curTable)||j.isNullOrUndefined(n)||n===this.curTable||!this.parent.contentModule.getEditPanel().contains(n)||(this.removeResizeElement(),this.removeHelper(e),this.cancelResizeAction()),i)||"TABLE"!==t.nodeName&&"TD"!==t.nodeName&&"TH"!==t.nodeName||(this.curTable=n&&this.parent.contentModule.getEditPanel().contains(n)&&("TD"===t.nodeName||"TH"===t.nodeName)?n:t,this.removeResizeElement(),this.tableResizeEleCreation(this.curTable,e))},b.prototype.tableResizeEleCreation=function(e,t){this.parent.preventDefaultResize(t);for(var n=this.calMaxCol(this.curTable),i=[],o=0;o<e.rows.length;o++)for(var r=0;r<e.rows[o].cells.length;r++)if(!e.rows[o].cells[r].hasAttribute("rowspan")){i.push(Array.prototype.slice.call(e.rows[o].cells,0,e.rows[o].cells.length)[r]);break}for(var s=parseInt(getComputedStyle(e).height,10),a=parseInt(getComputedStyle(e).width,10),l=this.calcPos(e),o=0;n.length>=o;o++){var d=this.parent.createElement("span",{attrs:{"data-col":o.toString(),unselectable:"on",contenteditable:"false"}});d.classList.add(So,Ki),n.length===o?d.style.cssText="height: "+s+"px; width: 4px; top: "+l.top+"px; left:"+((n[o-1].classList.contains("e-multi-cells-select")?0:l.left)+this.calcPos(n[o-1]).left+n[o-1].offsetWidth-2)+"px;":d.style.cssText="height: "+s+"px; width: 4px; top: "+l.top+"px; left:"+((n[o].classList.contains("e-multi-cells-select")?0:l.left)+this.calcPos(n[o]).left-2)+"px;",this.contentModule.getEditPanel().appendChild(d)}for(o=0;o<i.length;o++){var c=this.parent.createElement("span",{attrs:{"data-row":o.toString(),unselectable:"on",contenteditable:"false"}}),h=(c.classList.add(So,Gi),j.isNullOrUndefined(e.getAttribute("cellspacing"))&&""===e.getAttribute("cellspacing")?this.calcPos(i[o]).left:0);c.style.cssText="width: "+a+"px; height: 4px; top: "+(this.calcPos(i[o]).top+(i[o].classList.contains("e-multi-cells-select")?0:l.top)+i[o].offsetHeight-2)+"px; left:"+(h+l.left)+"px;",this.contentModule.getEditPanel().appendChild(c)}t=this.parent.createElement("span",{className:Xi+this.parent.getCssClass(!0),attrs:{"data-col":n.length.toString(),unselectable:"on",contenteditable:"false"}});t.style.cssText="top: "+(l.top+s-4)+"px; left:"+(l.left+a-4)+"px;",j.Browser.isDevice&&t.classList.add("e-rmob"),this.contentModule.getEditPanel().appendChild(t)},b.prototype.removeResizeElement=function(){var e=this.parent.contentModule.getEditPanel().querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box");if(0<e.length)for(var t=0;t<e.length;t++)j.detach(e[t])},b.prototype.calcPos=function(e){for(var t={top:0,left:0},n=e.getBoundingClientRect(),i=e.ownerDocument,o=e.offsetParent||i.documentElement,r=!1;o&&(o===i.body||o===i.documentElement)&&"static"===o.style.position;)o=o.parentNode;return"TD"===o.nodeName&&"TABLE"===e.nodeName&&(o=j.closest(o,".e-rte-content"),r=!0),o&&o!==e&&1===o.nodeType&&(t=o.getBoundingClientRect()),r?(r=!1,{top:this.parent.inputElement&&0<this.parent.inputElement.scrollTop?this.parent.inputElement.scrollTop+n.top-t.top:n.top-t.top,left:this.parent.inputElement&&0<this.parent.inputElement.scrollLeft?this.parent.inputElement.scrollLeft+n.left-t.left:n.left-t.left}):{top:e.offsetTop,left:e.offsetLeft}},b.prototype.getPointX=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageX},b.prototype.getPointY=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageY},b.prototype.resizeStart=function(e){var t=this;if(!this.parent.readonly){j.Browser.isDevice&&this.resizeHelper(e);var n=e.target;if(n.classList.contains(Ki)||n.classList.contains(Gi)||n.classList.contains(Xi)){if(this.resetResizeHelper(this.curTable),e.preventDefault(),this.parent.preventDefaultResize(e),g(this.curTable.querySelectorAll("td,th"),zi),this.removeTableSelection(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),this.resizeBtnInit(),this.hideTableQuickToolbar(),n.classList.contains(Ki)){if(this.resizeBtnStat.column=!0,parseInt(n.getAttribute("data-col"),10)===this.calMaxCol(this.curTable).length)this.currentColumnResize="last",this.colIndex=parseInt(n.getAttribute("data-col"),10)-1;else{if(0===parseInt(n.getAttribute("data-col"),10))this.currentColumnResize="first";else{this.currentColumnResize="middle";for(var i=this.curTable.rows[0].cells,o=0,r=0;r<i.length;r++)o+=i[r].colSpan;for(var s=new Array(o),a=j.createElement("colgroup"),l=new Map,d=0;d<this.curTable.rows.length;d++)for(var c=0,h=0;h<this.curTable.rows[d].cells.length;h++){for(var p=1;p<this.curTable.rows[d].cells[h].rowSpan;p++)l.set(""+(d+p)+c,this.curTable.rows[d].cells[h]);var u=this.getCellIndex(l,d,h),u=(c<u&&(c=u),this.curTable.rows[d].cells[h].offsetWidth);(!s[c]||u<s[c])&&(s[c]=u),c+=1+this.curTable.rows[d].cells[h].colSpan-1}for(var m=0;m<s.length;m++)(r=j.createElement("col")).appendChild(j.createElement("br")),r.style.width=this.convertPixelToPercentage(s[m],parseInt(getComputedStyle(this.curTable).width,10))+"%",a.appendChild(r);this.curTable.insertBefore(a,this.curTable.firstChild);for(d=0;d<this.curTable.rows.length;d++)for(h=0;h<this.curTable.rows[d].cells.length;h++)this.curTable.rows[d].cells[h].style.width=""}this.colIndex=parseInt(n.getAttribute("data-col"),10)}this.columnEle=this.calMaxCol(this.curTable)[this.colIndex],this.moveEle=e.target,this.appendHelper()}n.classList.contains(Gi)&&(this.rowEle=this.curTable.rows[parseInt(n.getAttribute("data-row"),10)],this.resizeBtnStat.row=!0,this.appendHelper()),n.classList.contains(Xi)&&(this.resizeBtnStat.tableBox=!0),j.Browser.isDevice&&this.helper&&!this.helper.classList.contains("e-reicon")?(this.helper.classList.add("e-reicon"),j.EventHandler.add(document,j.Browser.touchStartEvent,this.removeHelper,this),j.EventHandler.add(this.helper,j.Browser.touchStartEvent,this.resizeStart,this)):this.parent.trigger(ye,{event:e,requestType:"Table"},function(e){e.cancel&&t.cancelResizeAction()}),this.isResizeBind&&(j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing,this),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd,this),this.isResizeBind=!1)}}},b.prototype.getCellIndex=function(e,t,n){var i=e.get(""+t+n);return i?this.getCellIndex(e,t,n+i.colSpan):n},b.prototype.removeHelper=function(e){!e.target.classList.contains("e-reicon")&&this.helper&&(j.EventHandler.remove(document,j.Browser.touchStartEvent,this.removeHelper),j.EventHandler.remove(this.helper,j.Browser.touchStartEvent,this.resizeStart),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&j.detach(this.helper),this.pageX=null,this.helper=null)},b.prototype.appendHelper=function(){this.helper=this.parent.createElement("div",{className:"e-table-rhelper"+this.parent.getCssClass(!0)}),j.Browser.isDevice&&this.helper.classList.add("e-reicon"),this.contentModule.getEditPanel().appendChild(this.helper),this.setHelperHeight()},b.prototype.setHelperHeight=function(){var e=this.calcPos(this.curTable);this.resizeBtnStat.column?(this.helper.classList.add("e-column-helper"),this.helper.style.cssText="height: "+getComputedStyle(this.curTable).height+"; top: "+e.top+"px; left:"+(e.left+this.calcPos(this.columnEle).left+("last"===this.currentColumnResize?this.columnEle.offsetWidth:0)-1)+"px;"):(this.helper.classList.add("e-row-helper"),this.helper.style.cssText="width: "+getComputedStyle(this.curTable).width+"; top: "+(this.calcPos(this.rowEle).top+e.top+this.rowEle.offsetHeight-1)+"px; left:"+(this.calcPos(this.rowEle).left+e.left)+"px;")},b.prototype.updateHelper=function(){var e,t=this.calcPos(this.curTable);this.resizeBtnStat.column?(e=t.left+this.calcPos(this.columnEle).left+("last"===this.currentColumnResize?this.columnEle.offsetWidth:0)-1,this.helper.style.left=e+"px",this.helper.style.height=this.curTable.offsetHeight+"px"):(e=this.calcPos(this.rowEle).top+t.top+this.rowEle.offsetHeight-1,this.helper.style.top=e+"px")},b.prototype.calMaxCol=function(e){for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var o=new Array(n),r=new Map,s=0;s<e.rows.length;s++)for(var a=0,l=0;l<e.rows[s].cells.length;l++){for(var d=1;d<e.rows[s].cells[l].rowSpan;d++)r.set(""+(s+d)+a,e.rows[s].cells[l]);var c=this.getCellIndex(r,s,l),c=(a<c&&(a=c),e.rows[s].cells[l].offsetWidth);(!o[a]||c<o[a].offsetWidth)&&(o[a]=e.rows[s].cells[l]),a+=1+e.rows[s].cells[l].colSpan-1}return o},b.prototype.resizing=function(y){var v,C=this,e=this.getPointX(y),t=this.getPointY(y),N=this.parent.enableRtl?-(e-this.pageX):e-this.pageX,E=this.parent.enableRtl?-(t-this.pageY):t-this.pageY,S=(this.pageX=e,this.pageY=t,this.curTable.closest("td"));this.parent.trigger(ve,{event:y,requestType:"table"},function(e){if(e.cancel)C.cancelResizeAction();else{var e=C.contentModule.getEditPanel().querySelector(".e-table-box"),t=parseInt(getComputedStyle(C.curTable).width,10),n=parseInt(getComputedStyle(C.curTable).height,10),i=+getComputedStyle(C.contentModule.getEditPanel()).paddingRight.match(/\d/g).join(""),i=C.contentModule.getEditPanel().offsetWidth-(C.contentModule.getEditPanel().offsetWidth-C.contentModule.getEditPanel().clientWidth)-2*i,o=void 0;if(o=j.isNullOrUndefined(C.curTable.parentElement.closest("table"))||j.isNullOrUndefined(C.curTable.closest("td"))||!C.contentModule.getEditPanel().contains(C.curTable.closest("td"))?i:(r=C.curTable.closest("td"),s=+getComputedStyle(r).paddingRight.match(/\d/g).join(""),r.offsetWidth-(r.offsetWidth-r.clientWidth)-2*s),C.resizeBtnStat.column){C.curTable.closest("li")&&(o=C.curTable.closest("li").offsetWidth);var r=C.curTable.querySelectorAll("colgroup > col"),s=void 0,s=""!==C.curTable.style.width&&C.curTable.style.width.includes("%")?parseFloat(C.curTable.style.width.split("%")[0]):C.getCurrentTableWidth(C.curTable.offsetWidth,C.parent.inputElement.offsetWidth),a=C.calMaxCol(C.curTable)[C.colIndex],a=C.getCurrentColWidth(a,t);if("first"===C.currentColumnResize){if(N-=.75,C.removeResizeElement(),S&&(v=C.curTable.getBoundingClientRect().right-C.calcPos(S).left,C.curTable.style.maxWidth=v+"px"),(0!==N&&5<a||N<0)&&s<=100&&C.convertPixelToPercentage(t-N,o)<=100){var l,d=C.findFirstLastColCells(C.curTable,!0),c=(C.curTable.style.width=100<C.convertPixelToPercentage(t-N,o)?"100%":C.convertPixelToPercentage(t-N,o)+"%",s-C.convertPixelToPercentage(t-N,o)),h=0;if(!(l=-1<C.curTable.style.width.indexOf("%"))&&C.curTable.offsetWidth>C.contentModule.getEditPanel().offsetWidth)return void(C.curTable.style.width=i+"px");if(l&&100<parseFloat(C.curTable.style.width.split("%")[0]))return void(C.curTable.style.width="100%");var p=(h=j.isNullOrUndefined(C.curTable.style.marginLeft)||""===C.curTable.style.marginLeft||(p=C.curTable.style.marginLeft.match(/[-+]?\d*\.\d+|\d+/),j.isNullOrUndefined(p))?h:parseFloat(p[0]))+c;if(p&&100<p&&(p=100-parseFloat(C.curTable.style.width)),!C.curTable.classList.contains("e-rte-paste-table")&&p&&p<1)return C.curTable.style.marginLeft=null,void(C.curTable.style.width="100%");C.curTable.style.marginLeft="calc("+("100%"===C.curTable.style.width?0:p)+"%)";for(var u=0;u<d.length;u++){var m=C.getCurrentColWidth(d[u],t);d[u].style.width=m-c+"%"}}}else if("last"===C.currentColumnResize){if(N+=.75,C.removeResizeElement(),S&&(v=S.getBoundingClientRect().right-C.curTable.getBoundingClientRect().left,C.curTable.style.maxWidth=v+"px"),(0!==N&&5<a||0<N)&&s<=100&&C.convertPixelToPercentage(t+N,o)<=100)for(var g=C.findFirstLastColCells(C.curTable,!1),c=(C.curTable.style.width=100<C.convertPixelToPercentage(t+N,o)?"100%":C.convertPixelToPercentage(t+N,o)+"%",s-C.convertPixelToPercentage(t+N,o)),u=0;u<g.length;u++){m=C.getCurrentColWidth(g[u],t);g[u].style.width=m-c+"%"}}else{h=r[C.colIndex].offsetWidth-N,p=r[C.colIndex].offsetWidth+r[C.colIndex-1].offsetWidth;20<p-h&&20<h&&(r[C.colIndex-1].style.width=C.convertPixelToPercentage(p-(a=h),t)+"%",r[C.colIndex].style.width=C.convertPixelToPercentage(a,t)+"%")}C.updateHelper()}else if(C.resizeBtnStat.row){C.parent.preventDefaultResize(y);for(var f=[],b=C.curTable.querySelectorAll("tr"),u=0;u<b.length;u++)C.rowEle!==b[u]&&(f[u]=parseFloat(b[u].clientHeight.toString()));C.curTable.style.height=parseFloat(C.curTable.clientHeight.toString())+(0<E?0:E)+"px";for(u=0;u<b.length;u++)C.rowEle===b[u]?b[u].style.height=parseFloat(b[u].clientHeight.toString())+E+"px":b[u].style.height=f[u]+"px";j.isNullOrUndefined(e)||(e.style.cssText="top: "+(C.calcPos(C.curTable).top+n-4)+"px; left:"+(C.calcPos(C.curTable).left+t-4)+"px;"),C.updateHelper()}else C.resizeBtnStat.tableBox&&(S&&(s=C.curTable.getBoundingClientRect().left-S.getBoundingClientRect().left,v=Math.abs(s-S.getBoundingClientRect().width)-5,C.curTable.style.maxWidth=v+"px"),C.curTable.style.height=n+E+"px",j.isNullOrUndefined(e)||(e.classList.add("e-rbox-select"),e.style.cssText="top: "+(C.calcPos(C.curTable).top+n-4)+"px; left:"+(C.calcPos(C.curTable).left+t-4)+"px;"),C.curTable.closest("li")&&(o=C.curTable.closest("li").offsetWidth),(l=-1<C.curTable.style.width.indexOf("%"))&&100<parseFloat(C.curTable.style.width.split("%")[0])?C.curTable.style.width="100%":!l&&C.curTable.offsetWidth>C.contentModule.getEditPanel().offsetWidth?C.curTable.style.width=i+"px":C.curTable.style.width=l?C.convertPixelToPercentage(t+N,o)+"%":t+N+"px")}})},b.prototype.getCurrentColWidth=function(e,t){return""!==e.style.width&&e.style.width.includes("%")?parseFloat(e.style.width.split("%")[0]):this.convertPixelToPercentage(e.offsetWidth,t)},b.prototype.getCurrentTableWidth=function(e,t){return e/t*100},b.prototype.findFirstLastColCells=function(e,r){for(var s=[],a=e.rows,l=[],t=0;t<a.length;t++)!function(t){for(var e=r?0:a[t].cells.length-1,n=a[t].cells[e],i=1;i<n.rowSpan;i++)l.push(t+i+"-"+e);var o=t+"-"+e;(0===l.length||r&&-1===l.indexOf(o)||!r&&-1===l.indexOf(o)&&l.every(function(e){return e.split("-")[0]!==t.toString()}))&&s.push(n)}(t);return s},b.prototype.convertPixelToPercentage=function(e,t){return e/t*100},b.prototype.cancelResizeAction=function(){this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.removeResizeElement()},b.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.contentModule.getEditPanel().querySelector(".e-table-box")&&this.contentModule.getEditPanel().contains(this.contentModule.getEditPanel().querySelector(".e-table-box"))&&this.removeResizeElement(),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&(j.detach(this.helper),this.helper=null),this.resetResizeHelper(this.curTable),this.pageX=null,this.pageY=null,this.moveEle=null;for(var t=this.curTable.querySelectorAll("tr"),n=[],i=0;i<t.length;i++){var o=parseFloat(t[i].clientHeight.toString())/parseFloat(this.curTable.clientHeight.toString())*100;n[i]=o}for(i=0;i<t.length;i++)"THEAD"===t[i].parentElement.nodeName&&(t[i].parentElement.style.height=n[i]+"%"),t[i].style.height=n[i]+"%";this.parent.trigger(Ce,{event:e,requestType:"table"}),this.parent.formatter.saveData(),this.resizeEndTime=(new Date).getTime()},b.prototype.resetResizeHelper=function(e){var t=this.parent.element.querySelectorAll(".e-table-rhelper.e-column-helper"),t=(Array.from(t).forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),this.parent.element.querySelectorAll(".e-table-rhelper.e-row-helper")),t=(Array.from(t).forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),e.style.width||(e.style.width=e.offsetWidth+"px"),e.querySelector("colgroup"));if(t){for(var n=0;n<e.rows.length;n++)for(var i=0;i<e.rows[n].cells.length;i++){var o=this.convertPixelToPercentage(e.rows[n].cells[i].offsetWidth,parseInt(getComputedStyle(e).width,10))+"%";e.rows[n].cells[i].style.width=o}e.removeChild(t)}},b.prototype.resizeBtnInit=function(){return this.resizeBtnStat={column:!1,row:!1,tableBox:!1}},b.prototype.addRow=function(e,t,n){n&&(i={item:{command:"Table",subCommand:"InsertRowAfter"}});var i,e={selection:e,subCommand:(n?i:t).item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t,e)},b.prototype.addColumn=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,width:this.parent.tableSettings.width,subCommand:t.item.subCommand})},b.prototype.removeRowColumn=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar()},b.prototype.removeTable=function(e,t,n){n&&(i={item:{command:"Table",subCommand:"TableRemove"}});var i,e={selection:e,subCommand:(n?i:t).item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t.originalEvent,e),this.contentModule.getEditPanel().focus(),null!==this.parent.inputElement.innerHTML&&""!==this.parent.inputElement.innerHTML||("DIV"===this.parent.enterKey?this.contentModule.getEditPanel().innerHTML="<div><br/></div>":"BR"===this.parent.enterKey?this.contentModule.getEditPanel().innerHTML="<br/>":this.contentModule.getEditPanel().innerHTML="<p><br/></p>"),this.removeResizeElement(),this.hideTableQuickToolbar()},b.prototype.renderDlgContent=function(e){var t,n,i=this,o=e.args.originalEvent.target;j.Browser.isDevice||this.parent.inlineMode.enable||!j.isNullOrUndefined(j.closest(o,".e-rte-text-popup"))?this.insertTableDialog(e):this.popupObj?this.popupObj.hide():(this.hideTableQuickToolbar(),o=this.l10n.getConstant("inserttablebtn"),this.dlgDiv=this.parent.createElement("div",{className:"e-rte-table-popup"+this.parent.getCssClass(!0),id:this.rteID+"_table"}),this.tblHeader=this.parent.createElement("div",{className:"e-rte-popup-header"+this.parent.getCssClass(!0)}),this.tblHeader.innerHTML="1X1",this.dlgDiv.appendChild(this.tblHeader),n=this.parent.createElement("div",{className:"e-rte-table-span"+this.parent.getCssClass(!0)}),this.drawTable(n,e),this.dlgDiv.appendChild(n),this.dlgDiv.appendChild(this.parent.createElement("span",{className:"e-span-border"+this.parent.getCssClass(!0)})),t=this.parent.createElement("button",{className:"e-insert-table-btn"+this.parent.getCssClass(!0),id:this.rteID+"_insertTable",attrs:{type:"button",tabindex:"0"}}),j.isNullOrUndefined(this.parent.getToolbarElement().querySelector(".e-expended-nav"))||this.parent.getToolbarElement().querySelector(".e-expended-nav").setAttribute("tabindex","1"),this.dlgDiv.appendChild(t),this.createTableButton=new H.Button({iconCss:"e-icons e-create-table",content:o,cssClass:"e-flat"+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.createTableButton.isStringTemplate=!0,this.createTableButton.appendTo(t),j.EventHandler.add(t,"click",this.insertTableDialog,{self:this,args:e.args,selection:e.selection}),this.parent.getToolbar().parentElement.appendChild(this.dlgDiv),n=(n=e.args.originalEvent.target).classList.contains("e-toolbar-item")?n.firstChild:n.parentElement,this.popupObj=new U.Popup(this.dlgDiv,{targetType:"relative",relateTo:n,collision:{X:"fit",Y:"none"},offsetY:8,viewPortElement:this.parent.element,position:{X:"left",Y:"bottom"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){j.EventHandler.remove(t,"click",i.insertTableDialog),j.detach(t),i.createTableButton&&!i.createTableButton.isDestroyed&&(i.createTableButton.destroy(),i.createTableButton.element=null,i.createTableButton=null),i.parent.isBlur=!1,i.popupObj.destroy(),j.detach(i.popupObj.element),i.popupObj=null}}),j.addClass([this.popupObj.element],"e-popup-open"),j.isNullOrUndefined(this.parent.cssClass)||j.addClass([this.popupObj.element],this.parent.getCssClass()),t.focus(),this.popupObj.refreshPosition(n))},b.prototype.onIframeMouseDown=function(){this.popupObj&&this.popupObj.hide(),this.parent.inlineMode.enable&&this.editdlgObj&&this.editdlgObj.hide(),j.isNullOrUndefined(this.parent)||j.isNullOrUndefined(this.parent.contentModule)||j.isNullOrUndefined(this.parent.contentModule.getEditPanel())||this.removeResizeElement()},b.prototype.docClick=function(e){var e=e.args.target,t=(e&&e.classList&&(this.popupObj&&!j.closest(e,"[id='"+this.popupObj.element.id+"']")||this.editdlgObj&&!j.closest(e,"#"+this.editdlgObj.element.id))&&!e.classList.contains("e-create-table")&&e.offsetParent&&!e.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")&&(this.popupObj&&this.popupObj.hide(),this.editdlgObj&&(this.parent.notify(hn,{closedBy:"outside click"}),this.editdlgObj.hide()),this.parent.isBlur=!0,Or(this.parent.element,"focusout")),j.closest(e,"td")),t=!(!t||!this.parent.contentModule.getEditPanel().contains(t));!e||"TD"===e.tagName||"TH"===e.tagName||t||null!==j.closest(e,".e-rte-quick-popup")||!e.offsetParent||e.offsetParent.classList.contains("e-quick-dropdown")||e.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")||j.closest(e,".e-rte-dropdown-popup")||j.closest(e,".e-rte-elements")||(e&&e.closest(".e-toolbar")||this.removeCellSelectClasses(),this.removeTableSelection(),j.Browser.isIE)||this.hideTableQuickToolbar(),!e||!e.classList||e.classList.contains(Ki)||e.classList.contains(Gi)||e.classList.contains(Xi)||this.removeResizeElement()},b.prototype.drawTable=function(e,t){for(var n,i,o=0;o<3;o++){n=this.parent.createElement("div",{className:"e-rte-table-row"+this.parent.getCssClass(!0),attrs:{"data-column":""+o}}),j.EventHandler.add(n,"mouseleave",this.tableCellLeave,this);for(var r=0;r<10;r++)i=this.parent.createElement("div",{className:"e-rte-tablecell e-default"+this.parent.getCssClass(!0),attrs:{"data-cell":""+r}}),n.appendChild(i),i.style.display="inline-block",0===r&&0===o&&j.addClass([i],"e-active"),j.EventHandler.add(i,"mousemove",this.tableCellSelect,this),j.EventHandler.add(i,"mouseup",this.tableCellClick,{self:this,args:t.args,selection:t.selection});e.appendChild(n)}},b.prototype.editTable=function(e){var t=this,n=(this.createDialog(e),this.tableDlgContent(e)),i=this.l10n.getConstant("dialogUpdate"),o=this.l10n.getConstant("dialogCancel"),r=this.l10n.getConstant("tableEditHeader");this.editdlgObj.setProperties({height:"initial",width:"290px",content:n,header:r,buttons:[{click:this.applyProperties.bind(this,e),buttonModel:{content:i,cssClass:"e-flat e-size-update"+this.parent.getCssClass(!0),isPrimary:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:o}}],cssClass:this.editdlgObj.cssClass+" e-rte-edit-table-prop-dialog"}),this.editdlgObj.element.style.maxHeight="none",this.editdlgObj.content.querySelector("input").focus(),this.hideTableQuickToolbar()},b.prototype.insertTableDialog=function(e){var t=this.self||this,n=(t.popupObj&&t.popupObj.hide(),t.createDialog(e),t.tableCellDlgContent()),i=t.l10n.getConstant("dialogInsert"),o=t.l10n.getConstant("dialogCancel");j.isNullOrUndefined(t.editdlgObj)||(t.editdlgObj.setProperties({height:"initial",width:"290px",content:n,buttons:[{click:t.customTable.bind(this,e),buttonModel:{content:i,cssClass:"e-flat e-insert-table "+t.parent.cssClass,isPrimary:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel "+t.parent.cssClass,content:o}}]}),j.isNullOrUndefined(t.parent.cssClass)||t.editdlgObj.setProperties({cssClass:t.parent.cssClass}),t.editdlgObj.element.style.maxHeight="none",t.editdlgObj.content.querySelector("input").focus())},b.prototype.tableCellDlgContent=function(){var e=this.l10n.getConstant("columns"),t=this.l10n.getConstant("rows"),n=this.parent.createElement("div",{className:"e-cell-wrap"+this.parent.getCssClass(!0)}),i=Lr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text"  data-role ="none" id="tableColumn" class="e-table-column'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="tableRow" class="e-table-row'+this.parent.getCssClass(!0)+'" /></div>');return n.appendChild(i),this.columnTextBox=new P.NumericTextBox({format:"n0",min:1,value:3,placeholder:e,floatLabelType:"Auto",max:50,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:this.parent.getCssClass()}),this.columnTextBox.isStringTemplate=!0,this.columnTextBox.appendTo(n.querySelector("#tableColumn")),this.rowTextBox=new P.NumericTextBox({format:"n0",min:1,value:3,placeholder:t,floatLabelType:"Auto",max:1e3,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:this.parent.getCssClass()}),this.rowTextBox.isStringTemplate=!0,this.rowTextBox.appendTo(n.querySelector("#tableRow")),n},b.prototype.clearDialogObj=function(){this.editdlgObj&&(this.editdlgObj.destroy(),j.detach(this.editdlgObj.element),this.editdlgObj=null)},b.prototype.createDialog=function(e){var t,n,i,o=this;this.editdlgObj?this.editdlgObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-edit-table"+this.parent.getCssClass(!0),id:this.rteID+"_tabledialog"}),this.parent.rootContainer.appendChild(t),i=this.l10n.getConstant("dialogInsert"),n=this.l10n.getConstant("dialogCancel"),i={header:this.l10n.getConstant("tabledialogHeader"),cssClass:Ei+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",height:"initial",position:{X:"center",Y:j.Browser.isDevice?"center":"top"},isModal:j.Browser.isDevice,buttons:[{buttonModel:{content:i,cssClass:"e-flat e-insert-table"+this.parent.getCssClass(!0),isPrimary:!0}},{click:function(e){o.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:n}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){o.parent.isBlur=!1,o.editdlgObj.destroy(),j.detach(o.editdlgObj.element),o.dialogRenderObj.close(e),o.editdlgObj=null}},this.editdlgObj=this.dialogRenderObj.render(i),this.editdlgObj.appendTo(t),this.quickToolObj&&this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj&&this.quickToolObj.textQTBar&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())},b.prototype.customTable=function(e,t){var n=this.self||this;n&&n.rowTextBox&&n.rowTextBox.value&&n.columnTextBox&&n.columnTextBox.value&&(e=j.Browser.isDevice||!j.isNullOrUndefined(e.args)&&!j.isNullOrUndefined(e.args.originalEvent)&&"insert-table"===e.args.originalEvent.action||n.parent.inlineMode.enable||!j.isNullOrUndefined(n.parent.quickToolbarSettings.text)&&!(e instanceof PointerEvent)?e:this,n.tableInsert(n.rowTextBox.value,n.columnTextBox.value,t,e))},b.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.editdlgObj.hide({returnValue:!0})},b.prototype.applyProperties=function(e,t){var n=this.editdlgObj.element,e=j.closest(e.selectNode[0],"table");if(e.style.width=n.querySelector(".e-table-width")?n.querySelector(".e-table-width").value+"px":e.style.width,n.querySelector(".e-cell-padding")&&""!==n.querySelector(".e-cell-padding").value)for(var i=e.querySelectorAll("td"),o=0;o<i.length;o++){var r="",r=""===i[o].style.padding?i[o].getAttribute("style")+" padding:"+n.querySelector(".e-cell-padding").value+"px;":(i[o].style.padding=n.querySelector(".e-cell-padding").value+"px",i[o].getAttribute("style"));i[o].setAttribute("style",r)}e.cellSpacing=n.querySelector(".e-cell-spacing")?n.querySelector(".e-cell-spacing").value:e.cellSpacing,j.isNullOrUndefined(e.cellSpacing)||"0"===e.cellSpacing?g([e],Eo):j.addClass([e],Eo),this.parent.formatter.saveData(),this.editdlgObj.hide({returnValue:!0})},b.prototype.tableDlgContent=function(e){var e=e.selectParent[0],t=this.l10n.getConstant("tableWidth"),n=this.l10n.getConstant("cellpadding"),i=this.l10n.getConstant("cellspacing"),o=this.parent.createElement("div",{className:"e-table-sizewrap"+this.parent.getCssClass(!0)}),r=j.closest(e,"table").getClientRects()[0].width,s=j.closest(e,"td").style.padding,e=j.closest(e,"table").getAttribute("cellspacing"),a=Lr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="tableWidth" class="e-table-width'+this.parent.getCssClass(!0)+'"  /></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="cellPadding" class="e-cell-padding'+this.parent.getCssClass(!0)+'" /> </div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="cellSpacing" class="e-cell-spacing'+this.parent.getCssClass(!0)+'" /></div>');return o.appendChild(a),this.tableWidthNum=new P.NumericTextBox({format:"n0",min:0,value:r,placeholder:t,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableWidthNum.isStringTemplate=!0,this.tableWidthNum.appendTo(o.querySelector("#tableWidth")),this.tableCellPadding=new P.NumericTextBox({format:"n0",min:0,value:""!==s?parseInt(s,null):0,placeholder:n,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableCellPadding.isStringTemplate=!0,this.tableCellPadding.appendTo(o.querySelector("#cellPadding")),this.tableCellSpacing=new P.NumericTextBox({format:"n0",min:0,value:""===e||j.isNullOrUndefined(e)?0:parseInt(e,null),placeholder:i,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableCellSpacing.isStringTemplate=!0,this.tableCellSpacing.appendTo(o.querySelector("#cellSpacing")),o},b.prototype.destroy=function(){this.isDestroyed||(this.resizeIconPositionTime&&(clearTimeout(this.resizeIconPositionTime),this.resizeIconPositionTime=null),this.removeEventListener(),j.EventHandler.remove(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection),this.curTable&&j.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave),this.tableCellSpacing&&!this.tableCellSpacing.isDestroyed&&(this.tableCellSpacing.destroy(),this.tableCellSpacing=null),this.tableCellPadding&&!this.tableCellPadding.isDestroyed&&(this.tableCellPadding.destroy(),this.tableCellPadding=null),this.tableWidthNum&&!this.tableWidthNum.isDestroyed&&(this.tableWidthNum.destroy(),this.tableWidthNum=null),this.rowTextBox&&!this.rowTextBox.isDestroyed&&(this.rowTextBox.destroy(),this.rowTextBox=null),this.columnTextBox&&!this.columnTextBox.isDestroyed&&(this.columnTextBox.destroy(),this.columnTextBox=null),this.createTableButton&&!this.createTableButton.isDestroyed&&(this.createTableButton.destroy(),this.createTableButton=null),this.isDestroyed=!0)},b.prototype.getModuleName=function(){return"table"},b.prototype.afterKeyDown=function(){var e=this;this.curTable&&(this.resizeIconPositionTime=setTimeout(function(){e.updateResizeIconPosition()},1))},b.prototype.updateResizeIconPosition=function(){var e,t=this.parent.contentModule.getEditPanel().querySelector(".e-table-box");j.isNullOrUndefined(t)||(e=this.calcPos(this.curTable),t.style.cssText="top: "+(e.top+parseInt(getComputedStyle(this.curTable).height,10)-4)+"px; left:"+(e.left+parseInt(getComputedStyle(this.curTable).width,10)-4)+"px;")};aa=b;function b(e,t){this.ensureInsideTableList=!0,this.pageX=null,this.pageY=null,this.moveEle=null,this.currentColumnResize="",this.resizeEndTime=0,this.isTableMoveActive=!1,this.isResizeBind=!0,this.parent=e,this.rteID=e.element.id,this.l10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1}ga.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(o,this.removeEventListener,this),this.parent.on(hn,this.documentClickClosedBy,this))},ga.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(o,this.removeEventListener),this.parent.off(hn,this.documentClickClosedBy))},ga.prototype.render=function(e){return e.beforeOpen=this.beforeOpen.bind(this),e.open=this.open.bind(this),e.position={X:"center",Y:"string"===e.target||"BODY"!==e.target.nodeName||j.isNullOrUndefined(e.position)?this.getDialogPosition():e.position.Y},j.isNullOrUndefined(e.close)&&(e.close=this.close.bind(this)),e.beforeClose=this.beforeClose.bind(this),(e=new U.Dialog(e)).isStringTemplate=!0,e},ga.prototype.beforeOpen=function(e){var t;e.element.classList.contains("e-dialog")&&(t=j.closest(e.target,"form"),j.isNullOrUndefined(t)||(this.dialogEle=e.element,this.dialogEle.addEventListener("keydown",this.handleEnterKeyDown))),this.parent.trigger(mt,e,this.beforeOpenCallback.bind(this,e))},ga.prototype.handleEnterKeyDown=function(e){"Enter"===e.key&&e.preventDefault()},ga.prototype.beforeOpenCallback=function(e){e.cancel&&this.parent.notify(gt,null)},ga.prototype.open=function(e){this.parent.trigger(ft,e)},ga.prototype.documentClickClosedBy=function(e){this.outsideClickClosedBy=e.closedBy},ga.prototype.beforeClose=function(e){this.dialogEle&&this.dialogEle.removeEventListener("keydown",this.handleEnterKeyDown),e.closedBy="outside click"===this.outsideClickClosedBy?this.outsideClickClosedBy:e.closedBy,this.parent.trigger(bt,e,function(e){e.cancel||e.container.classList.contains("e-popup-close")&&(e.cancel=!0)}),this.outsideClickClosedBy=""},ga.prototype.getDialogPosition=function(){var e=this.parent.element.getBoundingClientRect().top;if(e<0){for(var t=0,n=this.parent.element;"BODY"!==n.nodeName;){var i=n.getBoundingClientRect().top;0<i&&(t=i),n=n.parentElement}return(e=Math.abs(e)+t).toString()}return"top"},ga.prototype.close=function(e){this.parent.trigger(yt,e)};var ma=ga;function ga(e){this.parent=e,this.addEventListener()}fa=function(e,t){return(fa=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};(function(e,t){function n(){this.constructor=e}fa(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(va,ba=Hr),va.prototype.renderPanel=function(){var e,i,t=this.parent,n='\n<!DOCTYPE html> \n    <html>\n         <head>\n            <meta charset=\'utf-8\' /> \n            <style>\n                @charset "UTF-8";\n                body {\n                    font-family: "Roboto", sans-serif;\n                    font-size: 14px;\n                }\n                html, body{height: 100%;margin: 0;}\n                body.e-cursor{cursor:default}\n                span.e-selected-node\t{background-color: #939393;color: white;}\n                span.e-selected-node.e-highlight {background-color: #1d9dd8;}\n                body{color:#333;word-wrap:break-word;padding: 8px;box-sizing: border-box;}\n                .e-rte-image, .e-rte-video {border: 0;cursor: pointer;display:\n                    block;float: none;height: auto;margin: 5px auto;max-width: 100%;position: relative;}\n                .e-rte-audio {border: 0;cursor: pointer;display:\n                        block;float: none;margin: 5px auto;max-width: 100%;position: relative;}\n                .e-rte-image.e-imginline, .e-rte-audio.e-audio-inline, .e-rte-video.e-video-inline {display: inline-block;float: none;\n                    margin-left: 5px;margin-right: 5px;max-width: calc(100% - (2 * 5px));padding: 1px;vertical-align: bottom;}\n                .e-rte-image.e-imgcenter, .e-rte-video.e-video-center {cursor: pointer;display: block;float: none;margin: 5px auto;max-width: 100%;position: relative;}\n                .e-rte-image.e-imgright, .e-rte-video.e-video-right { float: right; margin: 0 auto;margin-left: 5px;text-align: right;}\n                .e-rte-image.e-imgleft, .e-rte-video.e-video-left {float: left;margin: 0 auto;margin-right: 5px;text-align: left;}\n                .e-img-caption { display: inline-block; float: none; margin: 5px auto; max-width: 100%;position: relative;}\n                .e-img-caption.e-caption-inline {display: inline-block;float: none;\n                    margin: 5px auto;margin-left: 5px;margin-right: 5px;max-width: calc(100% - (2 * 5px));\n                    position: relativetext-align: center;vertical-align: bottom;}\n                .e-rte-img-caption.e-imgcenter {display: contents; margin-left: auto; margin-right: auto;}\n                .e-rte-img-caption.e-imgright {display: contents; margin-left: auto; margin-right: 0;}\n                .e-rte-img-caption.e-imgleft {display: contents;margin-left: 0;margin-right: auto;}\n                .e-img-caption.e-rte-img-caption.e-imgbreak {display: contents;}\n                .e-img-inner {box-sizing: border-box;display: block;font-size: 16px;font-weight: initial;\n                    margin: auto;opacity: .9;text-align: center;width: 100%;}\n                .e-img-wrap {display: inline-block;margin: auto;padding: 0;text-align: center;width: 100%;}\n                .e-imgleft, .e-video-left {float: left;margin: 0 5px 0 0;text-align: left;}\n                .e-imgright, .e-video-right {float: right;margin: 0 0 0 5px;text-align: right;}\n                .e-imgcenter, .e-video-center {cursor: pointer;display: block;float: none;height: auto;margin: 5px auto;max-width: 100%;position: relative;}\n                .e-control img:not(.e-resize) {border: 2px solid transparent; z-index: 1000}\n                .e-imginline , .e-audio-inline, .e-video-inline {display: inline-block;float: none;margin-left: 5px;margin-right: 5px;\n                    max-width: calc(100% - (2 * 5px));vertical-align: bottom;}\n                .e-imgbreak, .e-audio-break, .e-video-break {border: 0;cursor: pointer;\n                    display: block;float: none;height: auto;margin: 5px auto;max-width: 100%;position: relative;}\n                .e-rte-image.e-img-focus:not(.e-resize), .e-audio-focus:not(.e-resize), .e-video-focus:not(.e-resize) {border: solid 2px #4a90e2;}\n                img.e-img-focus::selection, audio.e-audio-focus::selection, .e-video-focus::selection { background: transparent;color: transparent;}\n                span.e-rte-imageboxmark, span.e-rte-videoboxmark {  width: 10px; height: 10px; position: absolute; display: block;\n                    background: #4a90e2; border: 1px solid #fff; z-index: 1000;}\n                .e-mob-rte.e-mob-span span.e-rte-imageboxmark, .e-mob-rte.e-mob-span span.e-rte-videoboxmark { background: #4a90e2; border: 1px solid #fff; }\n                .e-mob-rte span.e-rte-imageboxmark, .e-mob-rte span.e-rte-videoboxmark { background: #fff; border: 1px solid #4a90e2;\n                    border-radius: 15px; height: 20px; width: 20px; }\n                .e-mob-rte.e-mob-span span.e-rte-imageboxmark, .e-mob-rte.e-mob-span span.e-rte-videoboxmark { background: #4a90e2; border: 1px solid #fff; }\n                .e-rte-content .e-content img.e-resize, .e-rte-content .e-content video.e-resize { z-index: 1000; }\n                .e-rte-content { font-size: 14px; }\n                .e-content { font-weight: normal; line-height: 1.5; font-size: 1em; }\n                .e-img-caption .e-img-inner { outline: 0; }\n                .e-rte-img-caption.e-imgleft .e-img-inner { float: left; text-align: left; }\n                .e-rte-img-caption.e-imgright .e-img-inner { float: right; text-align: right; }\n                .e-rte-img-caption.e-imgleft .e-img-wrap, .e-rte-img-caption.e-imgright .e-img-wrap { display: contents; }\n                .e-img-caption a:focus-visible { outline: none; }\n                .e-rte-img-caption .e-rte-image.e-imgright { margin-left: auto; margin-right: 0; }\n                .e-rte-img-caption .e-rte-image.e-imgleft { margin: 0; }\n                body{box-sizing: border-box;min-height: 100px;outline: 0 solid transparent;\n                    overflow-x: auto;padding: 16px;position: relative;text-align: inherit;z-index: 2;}\n                p{margin: 0 0 10px;margin-bottom: 10px;}\n                code{ background: #9d9d9d26; color: #ed484c;}\n                li{margin-bottom: 10px;}\n                table{margin-bottom: 10px;}\n                h1{ font-size: 2.857em; font-weight: 600; line-height: 1.2; margin: 10px 0; }\n                h2{ font-size: 2.285em; font-weight: 600; line-height: 1.2; margin: 10px 0; }\n                h3{ font-size: 2em; font-weight: 600; line-height: 1.2; margin: 10px 0; }\n                h4{ font-size: 1.714em; font-weight: 600; line-height: 1.2; margin: 10px 0; }\n                h5{ font-size: 1.428em; font-weight: 600; line-height: 1.2; margin: 10px 0; }\n                h6{ font-size: 1.142em; line-height: 600; line-height: 1.5; margin: 10px 0; }\n                blockquote{margin: 10px 0;margin-left: 0;padding-left: 5px;border-left: solid 2px #5c5c5c;}\n                pre{background-color: inherit;border: 0;border-radius: 0;color: #333;\n                    font-size: inherit;line-height: inherit;margin: 0 0 10px;overflow: visible;padding: 0;\n                    white-space: pre-wrap;word-break: inherit;word-wrap: break-word;}\n                strong, b{font-weight: 700;}\n                a{text-decoration: none;user-select: auto;}\n                a:hover{text-decoration: underline;};\n                p:last-child, pre:last-child, blockquote:last-child{margin-bottom: 0;}\n                h3+h4, h4+h5, h5+h6{margin-top: 00.6em;}\n                ul:last-child{margin-bottom: 0;}\n                table { border-collapse: collapse; empty-cells: show;}\n                table td,table th {border: 1px solid #BDBDBD; height: 20px; padding: 2px 5px; vertical-align: middle;}\n                table.e-alternate-border tbody tr:nth-child(2n) {background-color: #F5F5F5;}\n                table th {background-color: #E0E0E0;}\n                table.e-dashed-border td,table.e-dashed-border th { border: 1px dashed #BDBDBD} \n                table .e-cell-select {border: 1px double #4a90e2;}\n                table.e-cell-select {position: relative;}\n                table.e-cell-select::after { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 2px solid #4a90e2; pointer-events: none;}\n                table td.e-cell-select.e-multi-cells-select, table th.e-cell-select.e-multi-cells-select {border: 1px solid #dee2e6; position: relative; }\n                table td.e-cell-select.e-multi-cells-select::after, table th.e-cell-select.e-multi-cells-select::after {background-color: rgba(13, 110, 253, 0.08); content: "";\n                    position: absolute; top: 0; left: 0; width: 100%; height: 100%; bottom: 0; pointer-events: none; right: 0;}\n                span.e-table-box { cursor: nwse-resize; display: block; height: 10px; position: absolute; width: 10px; }\n                span.e-table-box.e-rmob {height: 14px;width: 14px;}\n                .e-row-resize, .e-column-resize { background-color: transparent; background-repeat: repeat;\n                    bottom: 0;cursor: col-resize;height: 1px;overflow: visible;position: absolute;width: 1px; }\n                .e-row-resize { cursor: row-resize; height: 1px;}\n                .e-table-rhelper { cursor: col-resize; opacity: .87;position: absolute;}\n                .e-table-rhelper.e-column-helper { width: 1px; }\n                .e-table-rhelper.e-row-helper {height: 1px;}\n                .e-reicon::before { border-bottom: 6px solid transparent; border-right: 6px solid;\n                    border-top: 6px solid transparent; content: \'\'; display: block; height: 0;\n                    position: absolute; right: 4px; top: 4px; width: 20px; }\n                .e-reicon::after { border-bottom: 6px solid transparent; border-left: 6px solid;\n                    border-top: 6px solid transparent; content: \'\'; display: block;\n                    height: 0; left: 4px; position: absolute; top: 4px; width: 20px; z-index: 3; }\n                .e-row-helper.e-reicon::after { top: 10px; transform: rotate(90deg); }\n                .e-row-helper.e-reicon::before { left: 4px; top: -20px; transform: rotate(90deg); }\n                span.e-table-box { background-color: #ffffff; border: 1px solid #BDBDBD; }\n                span.e-table-box.e-rbox-select { background-color: #BDBDBD; border: 1px solid #BDBDBD; }\n                .e-table-rhelper { background-color: #4a90e2;}\n                .e-rtl { direction: rtl; }\n                .e-rte-placeholder::before { content: attr(placeholder); opacity: 0.54; overflow: hidden; padding-top: 16px; position: absolute; text-align: start; top: 0; z-index: 1; }\n                li ol, li ul { margin-block-start: 10px;}\n                .e-resize-enabled, .e-count-enabled { padding-bottom: 0px; }\n                td.e-multi-cells-select ::selection, th.e-multi-cells-select ::selection { background-color: transparent; }\n                td.e-multi-cells-select, th.e-multi-cells-select { user-select: none !important; }\n            </style>\n        </head>'+('<body spellcheck="false" autocorrect="off" contenteditable="true">'+xr(t.value,t)+"</body></html>"),o=this.parent.createElement("iframe",{id:this.parent.getID()+"_rte-view",className:"e-rte-content",attrs:{srcdoc:n}});o.setAttribute("role","none"),this.setPanel(o),j.isNullOrUndefined(this.parent.iframeSettings.sandbox)||((e=this.parent.iframeSettings.sandbox.map(function(e){return e.toLocaleLowerCase().trim()}).join(" ")).includes("allow-same-origin")||(e+=" allow-same-origin"),o.setAttribute("sandbox",e.trim())),t.rootContainer.appendChild(o),o.contentDocument.body.id=this.parent.getID()+"_rte-edit-view",o.contentDocument.body.setAttribute("aria-owns",this.parent.getID()),o.contentDocument.open(),n=this.setThemeColor(n,{color:"#333"}),o.contentDocument.write(n),o.contentDocument.close(),t.enableRtl&&this.contentPanel.contentDocument.body.setAttribute("class","e-rtl"),!j.isNullOrUndefined(o.contentDocument.head)&&0<this.parent.iframeSettings.metaTags.length&&(i=o.contentDocument.head,this.parent.iframeSettings.metaTags.forEach(function(e){var t,n=document.createElement("meta");for(t in e)j.isNullOrUndefined(e[t])||n.setAttribute("httpEquiv"===t?"http-equiv":t,e[t]);i.appendChild(n)}))},va.prototype.setThemeColor=function(e,t){var n=getComputedStyle(this.parent.element,".e-richtexteditor").getPropertyValue("color");return e.replace(t.color,n)},va.prototype.getEditPanel=function(){var e=j.isNullOrUndefined(this.contentPanel.contentDocument)?this.parent.inputElement:this.contentPanel.contentDocument.body;return e},va.prototype.getDocument=function(){return this.getEditPanel().ownerDocument};var fa,ba,ya=va;function va(){return null!==ba&&ba.apply(this,arguments)||this}Na.prototype.renderPanel=function(){var e=this.parent,t=this.parent.createElement("div",{id:this.parent.getID()+"_view",className:"e-rte-content"});this.editableElement=this.parent.createElement("textarea",{className:"e-content",id:this.parent.getID()+"_editable-content",attrs:{"aria-labelledby":this.parent.getID()+"_view"}}),t.appendChild(this.editableElement),this.setPanel(t),e.rootContainer.appendChild(t)},Na.prototype.getPanel=function(){return this.contentPanel},Na.prototype.getEditPanel=function(){return this.editableElement},Na.prototype.getText=function(){return this.getEditPanel().value},Na.prototype.setPanel=function(e){this.contentPanel=e},Na.prototype.getDocument=function(){return this.getEditPanel().ownerDocument};var Ca=Na;function Na(e){this.parent=e}Sa.prototype.quickToolbarOpen=function(){var e=this.popupObj;this.parent.trigger(Ct,e)},Sa.prototype.renderPopup=function(e){this.setPanel(e.element),this.renderPanel(),e.popupObj=new U.Popup(e.element,{targetType:"relative",relateTo:this.parent.element,open:this.quickToolbarOpen.bind(this)}),this.popupObj=e.popupObj,e.popupObj.hide()},Sa.prototype.renderPanel=function(){this.getPanel().classList.add(Un)},Sa.prototype.getPanel=function(){return this.popupPanel},Sa.prototype.setPanel=function(e){this.popupPanel=e};var Ea=Sa;function Sa(e){this.parent=e}Ta=function(e,t){return(Ta=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Ta,Oa,la=function(e,t){function n(){this.constructor=e}Ta(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},La=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},la=(Oa=j.ChildProperty,la(wa,Oa),La([j.Property(!1)],wa.prototype,"enable",void 0),La([j.Property(["Paragraph","Heading 1","Heading 2","Heading 3","Heading 4","OrderedList","UnorderedList","CodeBlock","Blockquote"])],wa.prototype,"items",void 0),La([j.Property("300px")],wa.prototype,"popupWidth",void 0),La([j.Property("320px")],wa.prototype,"popupHeight",void 0),wa);function wa(){return null!==Oa&&Oa.apply(this,arguments)||this}var ka=[{command:"Paragraph",subCommand:"p",type:"Basic Block",iconCss:"e-rte-paragraph"},{command:"Heading 1",subCommand:"h1",type:"Basic Block",iconCss:"e-rte-h1"},{command:"Heading 2",subCommand:"h2",type:"Basic Block",iconCss:"e-rte-h2"},{command:"Heading 3",subCommand:"h3",type:"Basic Block",iconCss:"e-rte-h3"},{command:"Heading 4",subCommand:"h4",type:"Basic Block",iconCss:"e-rte-h4"},{command:"OrderedList",subCommand:"insertOrderedList",type:"Basic Block",iconCss:"e-list-ordered e-icons"},{command:"UnorderedList",subCommand:"insertUnorderedList",type:"Basic Block",iconCss:"e-list-unordered e-icons"},{command:"Blockquote",subCommand:"blockquote",type:"Basic Block",iconCss:"e-blockquote e-icons"},{command:"CodeBlock",subCommand:"pre",type:"Basic Block",iconCss:"e-code-view e-icons"}],xa=[{command:"Image",subCommand:c.DialogType.InsertImage,type:"Media",module:"Image",iconCss:"e-icons e-image"},{command:"Audio",subCommand:c.DialogType.InsertAudio,type:"Media",module:"Audio",iconCss:"e-icons e-audio"},{command:"Video",subCommand:c.DialogType.InsertVideo,type:"Media",module:"Video",iconCss:"e-icons e-video"},{command:"Link",subCommand:c.DialogType.InsertLink,type:"Inline",module:"Link",iconCss:"e-icons e-link"},{command:"Table",subCommand:c.DialogType.InsertTable,type:"Basic Block",module:"Table",iconCss:"e-icons e-table"},{command:"Emojipicker",subCommand:null,type:"Inline",module:"EmojiPicker",iconCss:"e-icons e-emoji"}],La=(Da.prototype.removeEventListener=function(){this.parent.off(l,this.onPropertyChanged),this.parent.off(o,this.removeEventListener)},Da.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++)if("slashMenuSettings"===n[t])switch(Object.keys(e.newProp.slashMenuSettings)[0]){case"enable":e.newProp.slashMenuSettings.enable?this.render():this.removeEventListener();break;case"items":this.mention.dataSource=this.getItems();break;case"popupHeight":this.mention.popupHeight=e.newProp.slashMenuSettings.popupHeight;break;case"popupWidth":this.mention.popupWidth=e.newProp.slashMenuSettings.popupWidth}},Da.prototype.getModuleName=function(){return"slashMenu"},Da.prototype.destroy=function(){this.mention&&!this.mention.isDestroyed&&(this.mention.destroy(),this.defaultItems=[],this.injectibleItems=[])},Da.prototype.generateMentionModel=function(){var e=this;return{dataSource:this.getItems(),cssClass:"e-slash-menu"+this.parent.getCssClass(),fields:{text:"text",groupBy:"type",iconCss:"iconCss",value:"description"},mentionChar:"/",target:this.parent.inputElement,popupHeight:this.parent.slashMenuSettings.popupHeight,popupWidth:this.parent.slashMenuSettings.popupWidth,allowSpaces:!0,itemTemplate:'${if(iconCss && description)}<div class="e-rte-slash-menu-item-content" style="display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center;"><div class="e-slash-menu-icon"style="padding: 15px 15px 15px 15px;"><div class="${iconCss}"></div></div> <div style="display: flex; flex-direction: column;"><span class="e-rte-slash-menu-item-text" style="font-weight: 500;">${text}</span>${if(description)}<span class="e-rte-slash-menu-item-description">${description}</span>${/if}</div></div>${else}${if(iconCss && text)}<div class="e-rte-slash-menu-item-content" style="display: flex; flex-direction: row; align-items: center; height: 25px; font-weight: 500;"><div class="e-slash-menu-icon"style="margin-left: 15px; width: 30px"><div class="${iconCss}"></div></div> <span class="e-rte-slash-menu-item-icon-text">${text}</span></div>${/if}${/if}',beforeOpen:function(){e.savedSelection=e.savedSelection.save(e.savedSelection.getRange(e.currentDocument),e.currentDocument)},filtering:function(){e.savedSelection=e.savedSelection.save(e.savedSelection.getRange(e.currentDocument),e.currentDocument)},select:this.handleSelect.bind(this)}},Da.prototype.handleSelect=function(e){var n=this,i=(e.cancel=!0,this.parent.focusIn(),this.savedSelection.restore(),e.itemData),t={isInteracted:e.isInteracted,item:e.item,itemData:e.itemData,originalEvent:e.e,cancel:!1};e.itemData.isCustomItem&&this.parent.formatter.beforeSlashMenuApply(),this.parent.trigger("slashMenuItemSelect",t,function(e){if(!e.cancel&&!e.itemData.isCustomItem){n.parent.formatter.beforeSlashMenuApply();var t=i;switch(t.command){case"OrderedList":n.parent.executeCommand("insertOrderedList");break;case"UnorderedList":n.parent.executeCommand("insertUnorderedList");break;case"Audio":case"Video":case"Image":case"Table":case"Link":n.mention.hidePopup(),setTimeout(function(){n.parent.showDialog(t.subCommand)},100);break;case"Emojipicker":n.mention.hidePopup(),setTimeout(function(){n.parent.showEmojiPicker()},100);break;default:n.parent.executeCommand("formatBlock",t.subCommand)}}})},Da.prototype.getItems=function(){for(var o=this.parent.slashMenuSettings.items,r=[],s=this,e=0;e<o.length;e++)!function(e){var t,n,i;"string"==typeof o[e]?(t=o[e],n=s.defaultItems.filter(function(e){return e.command===t})[0],j.isNullOrUndefined(n)&&(n=s.injectibleItems.filter(function(e){return e.module.toLowerCase().replace(" ","")===t.toLowerCase().replace(" ","")})[0]),i=pr.get(t),r.push({text:s.L10n.getConstant(i.text),command:n.command,subCommand:n.subCommand,type:n.type,module:n.module,iconCss:n.iconCss,description:s.L10n.getConstant(i.description)})):r.push({text:o[e].text,command:o[e].command,type:o[e].type,iconCss:o[e].iconCss,description:o[e].description,isCustomItem:!0})}(e);return r},Da.prototype.render=function(){var e;"HTML"===this.parent.editorMode&&this.parent.slashMenuSettings.enable&&(e=this.generateMentionModel(),this.mention=new q.Mention(e),this.mention.appendTo(this.parent.rootContainer.appendChild(this.parent.createElement("div",{className:"e-rte-slash-menu",id:this.parent.getID()+"_slash_menu"}))))},Da);function Da(e,t){this.parent=e,this.currentDocument=this.parent.element.ownerDocument,this.L10n=t.getService("rteLocale"),this.savedSelection=new bs,this.defaultItems=ka,this.injectibleItems=xa,this.parent.on(l,this.onPropertyChanged,this),this.parent.on(o,this.removeEventListener,this),this.parent.on(n,this.render,this)}Ba.prototype.addEventListener=function(){this.parent.on(st,this.setRtl,this),this.parent.on(tn,this.setCssClass,this)},Ba.prototype.removeEventListener=function(){this.parent.off(st,this.setRtl),this.parent.off(tn,this.setCssClass)},Ba.prototype.setCssClass=function(e){j.isNullOrUndefined(this.toolbarObj)||(j.isNullOrUndefined(e.oldCssClass)?this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass+" "+e.cssClass).trim()}):this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},Ba.prototype.setRtl=function(e){j.isNullOrUndefined(this.toolbarObj)||this.toolbarObj.setProperties({enableRtl:e.enableRtl})},Ba.prototype.getClass=function(e){var t;switch(e){case"fontsize":t="e-rte-inline-size-template";break;case"fontcolor":case"backgroundcolor":t="e-rte-inline-color-template";break;default:t="e-rte-inline-template"}return t},Ba.prototype.getTemplateObject=function(e,t){var n;switch(e){case"fontcolor":case"backgroundcolor":case"numberformatlist":case"bulletformatlist":n="span";break;default:n="button"}return{command:this.tools[e.toLocaleLowerCase()].command,subCommand:this.tools[e.toLocaleLowerCase()].subCommand,template:this.parent.createElement(n,{id:this.parent.getID()+"_"+t+"_"+this.tools[e.toLocaleLowerCase()].id}).outerHTML,cssClass:this.parent.inlineMode.enable?this.getClass(e):"",tooltipText:Cr(e,this.locator)}},Ba.prototype.getObject=function(e,t){var n=e.toLowerCase();if(-1!==xo.indexOf(n))return this.getTemplateObject(n,t);switch(n){case"|":return{type:"Separator"};case"-":return{type:"Separator",cssClass:Ti};default:return{id:this.parent.getID()+"_"+t+"_"+this.tools[n.toLocaleLowerCase()].id,prefixIcon:this.tools[n.toLocaleLowerCase()].icon,tooltipText:Cr(n,this.locator),command:this.tools[n.toLocaleLowerCase()].command,subCommand:this.tools[n.toLocaleLowerCase()].subCommand}}},Ba.prototype.getItems=function(e,t){var o=this;if(this.parent.toolbarSettings.items.length<1)return[];for(var r=[],s=this,n=0,i=e;n<i.length;n++)!function(e){var n,i;"string"==typeof e?r.push(s.getObject(e,t)):(j.isNullOrUndefined(e.click)||(i=(n=e).click,n.click=function(){if(n.undo&&0===o.parent.formatter.getUndoRedoStack().length&&o.parent.formatter.saveData(),i.call(o),0<o.parent.formatter.getUndoRedoStack().length){var e=o.parent.createElement("div"),t=o.parent.formatter.getUndoRedoStack()[o.parent.formatter.getUndoRedoStack().length-1].text.cloneNode(!0);if(e.appendChild(t),e.innerHTML.trim()===o.parent.inputElement.innerHTML.trim())return}n.undo&&o.parent.formatter.saveData()}),r.push(e))}(i[n]);if(this.parent.showTooltip)for(var a=0;a<r.length;a++){var l=r[a].tooltipText,d=void 0,c=window.navigator.platform.toLocaleLowerCase().includes("mac");!(d=or[""+l]?c?or[""+l].replace("Ctrl+","").replace("Shift+","").replace("Alt+",""):or[""+l]:l)||"Images"===r[a].command&&"InsertLink"===r[a].subCommand||(r[a].tooltipText=l!==d?l+" ("+d+")":l)}return r},Ba.prototype.getToolbarOptions=function(e){return{target:e.target,rteToolbarObj:this,items:this.getItems(e.items,e.container),overflowMode:e.mode,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,cssClass:e.cssClass,type:e.container}},Ba.prototype.render=function(e){this.toolbarRenderer=this.renderFactory.getRenderer(c.RenderType.Toolbar),this.toolbarRenderer&&this.toolbarRenderer.isDestroyed&&(this.toolbarRenderer=new ws(this.parent,this.locator)),this.toolbarRenderer.renderToolbar(this.getToolbarOptions(e))},Ba.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.toolbarObj&&!this.toolbarObj.isDestroyed&&(this.toolbarObj.destroy(),this.toolbarObj=null),this.toolbarRenderer.destroy(),this.toolbarRenderer=null,this.tools={},this.isDestroyed=!0)};var Ma=Ba;function Ba(e,t){this.tools={},this.parent=e,this.locator=t,this.isDestroyed=!1,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.parent.toolbarSettings&&0<Object.keys(this.parent.toolbarSettings.itemConfigs).length?j.extend(this.tools,Do,kr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Do,(this.parent.toolbarSettings.enable||this.parent.quickToolbarSettings.enable)&&(this.toolbarRenderer=new ws(this.parent,this.locator),this.renderFactory.addRenderer(c.RenderType.Toolbar,this.toolbarRenderer))}y.prototype.initializeInstance=function(){this.toolbarRenderer=this.renderFactory.getRenderer(c.RenderType.Toolbar)},y.prototype.beforeRender=function(e){var t=e.item;t.cssClass&&j.addClass([e.element],t.cssClass)},y.prototype.dropdownContent=function(e,t,n){return'<span style="display: inline-flex;width:'+("quick"===t?"auto":e)+'" ><span class="e-rte-dropdown-btn-text">'+n+"</span></span>"},y.prototype.renderDropDowns=function(o){var r=this,s=(this.initializeInstance(),o.containerType),a=o.container;xo.forEach(function(e){var t=void 0;if(-1!==gr(e,o.items))switch(e){case"numberformatlist":if(t=j.select("#"+r.parent.getID()+"_"+s+"_NumberFormatList",a),j.isNullOrUndefined(t)||t.classList.contains(Qn))return;var n=r.parent.numberFormatList.types.slice();n.forEach(function(e){Object.defineProperties(e,{command:{value:"Lists",enumerable:!0},subCommand:{value:"NumberFormatList",enumerable:!0}})}),r.numberFormatListDropDown=r.toolbarRenderer.renderListDropDown({cssClass:"e-order-list "+Ei+" "+vi,itemName:"NumberFormatList",items:n,element:t});break;case"bulletformatlist":if(t=j.select("#"+r.parent.getID()+"_"+s+"_BulletFormatList",a),j.isNullOrUndefined(t)||t.classList.contains(Qn))return;n=r.parent.bulletFormatList.types.slice();n.forEach(function(e){Object.defineProperties(e,{command:{value:"Lists",enumerable:!0},subCommand:{value:"BulletFormatList",enumerable:!0}})}),r.bulletFormatListDropDown=r.toolbarRenderer.renderListDropDown({cssClass:"e-unorder-list "+Ei+" "+vi,itemName:"BulletFormatList",items:n,element:t});break;case"formats":if(t=j.select("#"+r.parent.getID()+"_"+s+"_Formats",a),j.isNullOrUndefined(t)||t.classList.contains(Qn))return;var n=r.parent.format.types.slice(),i=(n.forEach(function(e){Object.defineProperties(e,{command:{value:"Formats",enumerable:!0},subCommand:{value:e.value,enumerable:!0}})}),j.isNullOrUndefined(r.parent.format.default)?n[0].text:r.parent.format.default);r.formatDropDown=r.toolbarRenderer.renderDropDownButton({iconCss:"quick"===s?"e-formats e-icons":"",content:r.dropdownContent(r.parent.format.width,s,"quick"===s?"":fr(n,i,"text","text")),cssClass:zn+" "+Vn+" "+xi,itemName:"Formats",items:n,element:t});break;case"fontname":if(t=j.select("#"+r.parent.getID()+"_"+s+"_FontName",a),j.isNullOrUndefined(t)||t.classList.contains(Qn))return;i=r.parent.fontFamily.items.slice(),n=(i.forEach(function(e){Object.defineProperties(e,{command:{value:"Font",enumerable:!0},subCommand:{value:"FontName",enumerable:!0}})}),j.isNullOrUndefined(r.parent.fontFamily.default)?i[0].text:r.parent.fontFamily.default);r.fontNameDropDown=r.toolbarRenderer.renderDropDownButton({iconCss:"quick"===s?"e-font-name e-icons":"",content:r.dropdownContent(r.parent.fontFamily.width,s,"quick"===s?"":"Default"===fr(i,n,"text","text")?r.i10n.getConstant("fontName"):fr(i,n,"text","text")),cssClass:zn+" "+Vn+" "+Di,itemName:"FontName",items:i,element:t}),j.isNullOrUndefined(r.parent.fontFamily.default)||(r.getEditNode().style.fontFamily=r.parent.fontFamily.default);break;case"fontsize":if(t=j.select("#"+r.parent.getID()+"_"+s+"_FontSize",a),j.isNullOrUndefined(t)||t.classList.contains(Qn))return;n=!j.isNullOrUndefined(r.fontSizeDropDown)&&!j.isNullOrUndefined(r.fontSizeDropDown.items)&&0<r.fontSizeDropDown.items.length?r.fontSizeDropDown.items:JSON.parse(JSON.stringify(r.parent.fontSize.items.slice())),i=(n.forEach(function(e){Object.defineProperties(e,{command:{value:"Font",enumerable:!0},subCommand:{value:"FontSize",enumerable:!0}})}),j.isNullOrUndefined(r.parent.fontSize.default)?n[0].text:r.parent.fontSize.default),i=fr(n,i.replace(/\s/g,""),"Default"===i?"text":"value","text");r.fontSizeDropDown=r.toolbarRenderer.renderDropDownButton({content:r.dropdownContent(r.parent.fontSize.width,s,yr("Default"===i?r.i10n.getConstant("fontSize"):i)),cssClass:zn+" "+Vn+" "+Mi,itemName:"FontSize",items:n,element:t}),j.isNullOrUndefined(r.parent.fontSize.default)||(r.getEditNode().style.fontSize=r.parent.fontSize.default);break;case"alignments":t=j.select("#"+r.parent.getID()+"_"+s+"_Alignments",a),j.isNullOrUndefined(t)||t.classList.contains(Qn)||(r.alignDropDown=r.toolbarRenderer.renderDropDownButton({iconCss:"e-justify-left e-icons",cssClass:zn+" "+Vn+" "+Bi,itemName:"Alignments",items:Bo,element:t}));break;case"align":case"videoalign":r.renderAlignmentDropDown(s,a,t,e);break;case"display":case"audiolayoutoption":case"videolayoutoption":r.renderDisplayDropDown(s,a,t,e);break;case"tablerows":r.rowDropDown(s,a,t);break;case"tablecolumns":r.columnDropDown(s,a,t);break;case"tablecell":r.cellDropDown(s,a,t);break;case"tablecellverticalalign":r.verticalAlignDropDown(s,a,t);break;case"styles":r.tableStylesDropDown(s,a,t)}}),this.parent.inlineMode.enable&&this.setCssClass({cssClass:this.parent.getCssClass()})},y.prototype.getUpdateItems=function(e,t){e=e.slice();return e.forEach(function(e){Object.defineProperties(e,{command:{value:"Format"===t?"Formats":"Font",enumerable:!0},subCommand:{value:"Format"===t?e.value:t,enumerable:!0}})}),e},y.prototype.onPropertyChanged=function(e){for(var t=e.newProp,n=0,i=Object.keys(t);n<i.length;n++)switch(i[n]){case"fontFamily":if(this.fontNameDropDown)for(var o=0,r=Object.keys(t.fontFamily);o<r.length;o++)switch(r[o]){case"default":case"width":var s=this.fontNameDropDown.items,a=j.isNullOrUndefined(j.closest(this.fontNameDropDown.element,"."+Bn))?"toolbar":"quick",l=j.isNullOrUndefined(this.parent.fontFamily.default)?s[0].text:this.parent.fontFamily.default,d=this.dropdownContent(this.parent.fontFamily.width,a,"quick"===a?"":"Default"===fr(s,l,"text","text")?this.i10n.getConstant("fontName"):fr(s,l,"text","text"));this.fontNameDropDown.setProperties({content:d}),j.isNullOrUndefined(this.parent.fontFamily.default)?this.getEditNode().style.removeProperty("font-family"):this.getEditNode().style.fontFamily=this.parent.fontFamily.default;break;case"items":this.fontNameDropDown.setProperties({items:this.getUpdateItems(t.fontFamily.items,"FontName")})}break;case"fontSize":if(this.fontSizeDropDown)for(var c=0,h=Object.keys(t.fontSize);c<h.length;c++)switch(h[c]){case"default":case"width":var p=this.fontSizeDropDown.items,u=(a=j.isNullOrUndefined(j.closest(this.fontSizeDropDown.element,"."+Bn))?"toolbar":"quick",j.isNullOrUndefined(this.parent.fontSize.default)?p[0].text:this.parent.fontSize.default),p=fr(p,u.replace(/\s/g,""),"Default"===u?"text":"value","text");d=this.dropdownContent(this.parent.fontSize.width,a,yr("Default"===p?this.i10n.getConstant("fontSize"):p)),this.fontSizeDropDown.setProperties({content:d}),j.isNullOrUndefined(this.parent.fontSize.default)?this.getEditNode().style.removeProperty("font-size"):this.getEditNode().style.fontSize=this.parent.fontSize.default;break;case"items":this.fontSizeDropDown.setProperties({items:this.getUpdateItems(t.fontSize.items,"FontSize")})}break;case"format":if(this.formatDropDown)for(var m=0,g=Object.keys(t.format);m<g.length;m++)switch(g[m]){case"default":case"width":var f=this.formatDropDown.items,b=(a=j.isNullOrUndefined(j.closest(this.formatDropDown.element,"."+Bn))?"toolbar":"quick",j.isNullOrUndefined(this.parent.format.default)?f[0].text:this.parent.format.default);d=this.dropdownContent(this.parent.format.width,a,"quick"===a?"":fr(f,b,"text","text")),this.formatDropDown.setProperties({content:d});break;case"types":this.formatDropDown.setProperties({items:this.getUpdateItems(t.format.types,"Format")})}}},y.prototype.getEditNode=function(){return this.parent.contentModule.getEditPanel()},y.prototype.rowDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableRows",t)).classList.contains(Qn)||(this.tableRowsDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-rows e-icons",cssClass:zn+" "+Vn+" "+Pn,itemName:"TableRows",items:_o,element:n}))},y.prototype.columnDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableColumns",t)).classList.contains(Qn)||(this.tableColumnsDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-columns e-icons",cssClass:zn+" "+Vn+" "+Pn,itemName:"TableColumns",items:Qo,element:n}))},y.prototype.cellDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableCell",t)).classList.contains(Qn)||(this.tableCellDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-cell e-icons",cssClass:zn+" "+Vn+" "+Pn,itemName:"TableCell",items:qo,element:n}))},y.prototype.verticalAlignDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableCellVerticalAlign",t)).classList.contains(Qn)||(this.tableCellVerticalAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-cell-ver-align e-icons",cssClass:zn+" "+Vn+" "+Pn,itemName:"TableCellVerticalAlign",items:Ko,element:n}))},y.prototype.renderDisplayDropDown=function(e,t,n,i){(n=j.select("#"+this.parent.getID()+"_"+e+("display"===i?"_Display":"videolayoutoption"===i?"_VideoLayoutOption":"_AudioLayoutOption"),t)).classList.contains(Qn)||(this.displayDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"display"===i?"e-display e-icons":"videolayoutoption"===i?"e-video-display e-icons":"e-audio-display e-icons",cssClass:zn+" "+Vn+" "+Pn,itemName:"display"===i?"Display":"videolayoutoption"===i?"VideoLayoutOption":"AudioLayoutOption",items:"display"===i?Ho:"videolayoutoption"===i?Fo:jo,element:n}))},y.prototype.renderAlignmentDropDown=function(e,t,n,i){(n=j.select("#"+this.parent.getID()+"_"+e+("align"===i?"_Align":"_VideoAlign"),t)).classList.contains(Qn)||(this.imageAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-justify-left e-icons",cssClass:zn+" "+_n+" "+Pn,itemName:"align"===i?"Align":"VideoAlign",items:"align"===i?Ro:Ao,element:n}))},y.prototype.tableStylesDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_Styles",t)).classList.contains(Qn)||(this.imageAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-style e-icons",cssClass:zn+" "+_n+" "+Pn,itemName:"Styles",items:this.parent.tableSettings.styles,element:n}))},y.prototype.removeDropDownClasses=function(e){j.removeClass([e],[Qn,zn,_n,Vn])},y.prototype.destroyDropDowns=function(){this.formatDropDown&&(this.removeDropDownClasses(this.formatDropDown.element),this.formatDropDown.destroy(),this.formatDropDown=null),this.fontNameDropDown&&(this.removeDropDownClasses(this.fontNameDropDown.element),this.fontNameDropDown.destroy(),this.fontNameDropDown=null),this.fontSizeDropDown&&(this.removeDropDownClasses(this.fontSizeDropDown.element),this.fontSizeDropDown.destroy(),this.fontSizeDropDown=null),this.alignDropDown&&(this.removeDropDownClasses(this.alignDropDown.element),this.alignDropDown.destroy(),this.alignDropDown=null),this.imageAlignDropDown&&(this.removeDropDownClasses(this.imageAlignDropDown.element),this.imageAlignDropDown.destroy(),this.imageAlignDropDown=null),this.displayDropDown&&(this.removeDropDownClasses(this.displayDropDown.element),this.displayDropDown.destroy(),this.displayDropDown=null),this.tableRowsDropDown&&(this.removeDropDownClasses(this.tableRowsDropDown.element),this.tableRowsDropDown.destroy(),this.tableRowsDropDown=null),this.tableColumnsDropDown&&(this.removeDropDownClasses(this.tableColumnsDropDown.element),this.tableColumnsDropDown.destroy(),this.tableColumnsDropDown=null),this.tableCellDropDown&&(this.removeDropDownClasses(this.tableCellDropDown.element),this.tableCellDropDown.destroy(),this.tableCellDropDown=null),this.tableCellVerticalAlignDropDown&&(this.removeDropDownClasses(this.tableCellVerticalAlignDropDown.element),this.tableCellVerticalAlignDropDown.destroy(),this.tableCellVerticalAlignDropDown=null),this.numberFormatListDropDown&&(this.removeDropDownClasses(this.numberFormatListDropDown.element),this.numberFormatListDropDown.destroy(),this.numberFormatListDropDown=null),this.bulletFormatListDropDown&&(this.removeDropDownClasses(this.bulletFormatListDropDown.element),this.bulletFormatListDropDown.destroy(),this.bulletFormatListDropDown=null),this.toolbarRenderer=null},y.prototype.setRtl=function(e){this.formatDropDown&&this.formatDropDown.setProperties({enableRtl:e.enableRtl}),this.fontNameDropDown&&this.fontNameDropDown.setProperties({enableRtl:e.enableRtl}),this.fontSizeDropDown&&this.fontSizeDropDown.setProperties({enableRtl:e.enableRtl}),this.alignDropDown&&this.alignDropDown.setProperties({enableRtl:e.enableRtl}),this.imageAlignDropDown&&this.imageAlignDropDown.setProperties({enableRtl:e.enableRtl}),this.displayDropDown&&this.displayDropDown.setProperties({enableRtl:e.enableRtl}),this.numberFormatListDropDown&&this.numberFormatListDropDown.setProperties({enableRtl:e.enableRtl}),this.bulletFormatListDropDown&&this.bulletFormatListDropDown.setProperties({enableRtl:e.enableRtl})},y.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},y.prototype.setCssClass=function(e){for(var t=[this.formatDropDown,this.fontNameDropDown,this.fontSizeDropDown,this.alignDropDown,this.imageAlignDropDown,this.displayDropDown,this.numberFormatListDropDown,this.bulletFormatListDropDown,this.tableRowsDropDown,this.tableColumnsDropDown,this.tableCellDropDown,this.tableCellVerticalAlignDropDown],n=0;n<t.length;n++)this.updateCss(t[n],e)},y.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(he,this.beforeRender,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(st,this.setRtl,this),this.parent.on(l,this.onPropertyChanged,this),this.parent.on(tn,this.setCssClass,this))},y.prototype.onIframeMouseDown=function(){!j.isNullOrUndefined(this.parent.getToolbarElement())&&(0<this.parent.getToolbarElement().querySelectorAll('.e-rte-dropdown-btn[aria-expanded="true"]').length||0<this.parent.getToolbarElement().querySelectorAll('.e-dropdown-btn.e-rte-inline-dropdown[aria-expanded="true"]').length)&&Or(document,"mousedown")},y.prototype.removeEventListener=function(){this.parent.off(K,this.onIframeMouseDown),this.parent.off(st,this.setRtl),this.parent.off(he,this.beforeRender),this.parent.off(l,this.onPropertyChanged),this.parent.off(tn,this.setCssClass)},y.prototype.destroy=function(){this.removeEventListener(),this.destroyDropDowns()};var Ra=y;function y(e,t){this.parent=e,this.locator=t,this.i10n=t.getService("rteLocale"),this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener()}Ia.prototype.addEventListener=function(){this.parent.on(G,this.toolbarClick,this),this.parent.on(ce,this.dropDownSelect,this),this.parent.on($e,this.renderSelection,this),this.parent.on(o,this.removeEventListener,this)},Ia.prototype.toolbarClick=function(e){var t;j.isNullOrUndefined(e.item)||(j.isNullOrUndefined(e.item.controlParent)||(t=e.item.controlParent.activeEle)&&(t.tabIndex=-1),"NumberFormatList"!==e.item.command&&"BulletFormatList"!==e.item.command||(e.originalEvent.target.classList.contains("e-order-list")||e.originalEvent.target.classList.contains("e-unorder-list"))&&(e.item.command="Lists",e.item.subCommand="NumberFormatList"===e.item.subCommand?"OL":"UL"),"Lists"===e.item.command&&e.originalEvent.target.classList.contains("e-caret")&&(e.originalEvent.target.parentElement.classList.contains("e-rte-bulletformatlist-dropdown")||e.originalEvent.target.parentElement.classList.contains("e-rte-numberformatlist-dropdown")))||(this.parent.notify(Z,e),this.parent.notify(ee,e))},Ia.prototype.dropDownSelect=function(e){var t,n;this.parent.notify(Qe,{}),document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&e.item&&("Images"===e.item.command||"Audios"===e.item.command||"Videos"===e.item.command||"VideoLayoutOption"===e.item.command||"Display"===e.item.command||"Table"===e.item.command)||(t=e.item.controlParent&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.tableQTBar&&this.parent.quickToolbarModule.tableQTBar.element.contains(e.item.controlParent.element)?"Table":null,"Lists"===e.item.command?(n={listStyle:e.item.value,listImage:e.item.listImage,type:e.item.subCommand},this.parent.formatter.process(this.parent,e,e.originalEvent,n)):this.parent.formatter.process(this.parent,e,e.originalEvent,t)),this.parent.notify(Ve,{})},Ia.prototype.renderSelection=function(e){this.parent.notify(Qe,{}),this.parent.formatter.process(this.parent,e,e.originalEvent,null),this.parent.notify(Ve,{})},Ia.prototype.removeEventListener=function(){this.parent.off(G,this.toolbarClick),this.parent.off(ce,this.dropDownSelect),this.parent.off($e,this.renderSelection),this.parent.off(o,this.removeEventListener)};var Aa=Ia;function Ia(e){this.parent=e,this.addEventListener()}Pa.prototype.initializeInstance=function(){this.toolbarRenderer=this.renderFactory.getRenderer(c.RenderType.Toolbar)},Pa.prototype.renderColorPickerInput=function(r){var s,a,l=this,d=(this.initializeInstance(),r.containerType),c=r.container;xo.forEach(function(e){if(-1!==gr(e,r.items))switch(e){case"fontcolor":s=l.parent.getID()+"_"+d+"_FontColor_Target";var t=l.parent.createElement("input");if(t.id=s,t.classList.add(Ri),!j.isNullOrUndefined(l.parent.cssClass))for(var n=l.parent.cssClass.split(" "),i=0;i<n.length;i++)""!==n[i].trim()&&t.classList.add(n[i]);document.body.appendChild(t),a={cssClass:l.tools[e.toLocaleLowerCase()].icon+" "+Ei+" "+vi+l.parent.getCssClass(!0),value:l.tools[e.toLocaleLowerCase()].value,command:l.tools[e.toLocaleLowerCase()].command,subCommand:l.tools[e.toLocaleLowerCase()].subCommand,element:j.select("#"+l.parent.getID()+"_"+d+"_FontColor",c),target:s},l.fontColorPicker=l.toolbarRenderer.renderColorPicker(a,"fontcolor"),l.fontColorDropDown=l.toolbarRenderer.renderColorPickerDropDown(a,"fontcolor",l.fontColorPicker);break;case"backgroundcolor":s=l.parent.getID()+"_"+d+"_BackgroundColor_Target";var o=l.parent.createElement("input");if(o.id=s,o.classList.add(Ai),!j.isNullOrUndefined(l.parent.cssClass))for(n=l.parent.cssClass.split(" "),i=0;i<n.length;i++)""!==n[i].trim()&&o.classList.add(n[i]);document.body.appendChild(o),a={cssClass:l.tools[e.toLocaleLowerCase()].icon+" "+Ei+" "+vi+l.parent.getCssClass(!0),value:l.tools[e.toLocaleLowerCase()].value,command:l.tools[e.toLocaleLowerCase()].command,subCommand:l.tools[e.toLocaleLowerCase()].subCommand,element:j.select("#"+l.parent.getID()+"_"+d+"_BackgroundColor",c),target:s},l.backgroundColorPicker=l.toolbarRenderer.renderColorPicker(a,"backgroundcolor"),l.backgroundColorDropDown=l.toolbarRenderer.renderColorPickerDropDown(a,"backgroundcolor",l.backgroundColorPicker,l.defaultColorPicker)}}),this.parent.inlineMode.enable&&this.setCssClass({cssClass:this.parent.getCssClass()})},Pa.prototype.destroy=function(){this.removeEventListener(),this.destroyColorPicker(),this.defaultColorPicker=null,this.fontColorPicker=null,this.fontColorDropDown=null,this.backgroundColorDropDown=null,this.backgroundColorPicker=null,this.tools={}},Pa.prototype.destroyColorPicker=function(){var e;this.fontColorPicker&&!this.fontColorPicker.isDestroyed&&this.fontColorPicker.destroy(),this.backgroundColorPicker&&!this.backgroundColorPicker.isDestroyed&&this.backgroundColorPicker.destroy(),this.fontColorDropDown&&!this.fontColorDropDown.isDestroyed&&((e=this.fontColorDropDown.element.querySelector(".e-rte-color-content"))&&j.detach(e),this.fontColorDropDown.destroy()),this.backgroundColorDropDown&&!this.backgroundColorDropDown.isDestroyed&&((e=this.backgroundColorDropDown.element.querySelector(".e-rte-color-content"))&&(this.defaultColorPicker=e.children[0].style.borderBottomColor,j.detach(e)),this.backgroundColorDropDown.destroy())},Pa.prototype.setRtl=function(e){this.fontColorPicker&&(this.fontColorPicker.setProperties({enableRtl:e.enableRtl}),this.fontColorDropDown.setProperties({enableRtl:e.enableRtl})),this.backgroundColorPicker&&(this.backgroundColorPicker.setProperties({enableRtl:e.enableRtl}),this.backgroundColorDropDown.setProperties({enableRtl:e.enableRtl}))},Pa.prototype.setCssClass=function(e){this.updateCss(this.fontColorPicker,this.fontColorDropDown,e),this.updateCss(this.backgroundColorPicker,this.backgroundColorDropDown,e)},Pa.prototype.updateCss=function(e,t,n){e&&n.cssClass&&(j.isNullOrUndefined(n.oldCssClass)?(e.setProperties({cssClass:(e.cssClass+" "+n.cssClass).trim()}),t.setProperties({cssClass:(t.cssClass+" "+n.cssClass).trim()})):(e.setProperties({cssClass:(e.cssClass.replace(n.oldCssClass,"").replace("  "," ").trim()+" "+n.cssClass).trim()}),t.setProperties({cssClass:(t.cssClass.replace(n.oldCssClass,"").replace("  "," ").trim()+" "+n.cssClass).trim()})))},Pa.prototype.addEventListener=function(){this.parent.on(ae,this.renderColorPickerInput,this),this.parent.on(st,this.setRtl,this),this.parent.on(l,this.onPropertyChanged,this),this.parent.on(tn,this.setCssClass,this),this.parent.on(pn,this.showColorPicker,this)},Pa.prototype.showColorPicker=function(e){j.isNullOrUndefined(this.fontColorPicker)||"fontcolor"!==e.toolbarClick?j.isNullOrUndefined(this.backgroundColorPicker)||"backgroundcolor"!==e.toolbarClick||this.backgroundColorDropDown.toggle():this.fontColorDropDown.toggle()},Pa.prototype.onPropertyChanged=function(e){for(var t=e.newProp,n=0,i=Object.keys(t);n<i.length;n++)switch(i[n]){case"fontColor":if(this.fontColorPicker)for(var o=0,r=Object.keys(t.fontColor);o<r.length;o++)switch(r[o]){case"default":this.fontColorPicker.setProperties({value:t.fontColor.default}),this.fontColorDropDown.element.querySelector("."+this.tools.fontcolor.icon).style.borderBottomColor=t.fontColor.default;break;case"mode":this.fontColorPicker.setProperties({mode:t.fontColor.mode});break;case"columns":this.fontColorPicker.setProperties({columns:t.fontColor.columns});break;case"colorCode":this.fontColorPicker.setProperties({presetColors:t.fontColor.colorCode});break;case"modeSwitcher":this.fontColorPicker.setProperties({modeSwitcher:t.fontColor.modeSwitcher})}break;case"backgroundColor":if(this.backgroundColorPicker)for(var s=0,a=Object.keys(t.backgroundColor);s<a.length;s++)switch(a[s]){case"default":this.backgroundColorPicker.setProperties({value:t.backgroundColor.default}),this.backgroundColorDropDown.element.querySelector("."+this.tools.backgroundcolor.icon).style.borderBottomColor=t.backgroundColor.default;break;case"mode":this.backgroundColorPicker.setProperties({mode:t.backgroundColor.mode});break;case"columns":this.backgroundColorPicker.setProperties({columns:t.backgroundColor.columns});break;case"colorCode":this.backgroundColorPicker.setProperties({presetColors:t.backgroundColor.colorCode});break;case"modeSwitcher":this.backgroundColorPicker.setProperties({modeSwitcher:t.backgroundColor.modeSwitcher})}}},Pa.prototype.removeEventListener=function(){this.parent.off(ae,this.renderColorPickerInput),this.parent.off(st,this.setRtl),this.parent.off(l,this.onPropertyChanged),this.parent.off(tn,this.setCssClass),this.parent.off(pn,this.showColorPicker)};var Ua=Pa;function Pa(e,t){this.tools={},this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.parent.toolbarSettings&&0<Object.keys(this.parent.toolbarSettings.itemConfigs).length?j.extend(this.tools,Do,kr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Do}v.prototype.initializeInstance=function(){this.contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content),this.editableElement=this.contentRenderer.getEditPanel(),this.editPanel=this.contentRenderer.getPanel()},v.prototype.toolbarBindEvent=function(){this.parent.inlineMode.enable||(this.keyBoardModule=new j.KeyboardEvents(this.getToolbarElement(),{keyAction:this.toolBarKeyDown.bind(this),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"}))},v.prototype.toolBarKeyDown=function(e){switch(e.action){case"escape":this.parent.contentModule.getEditPanel().focus();break;case"enter":j.isNullOrUndefined(e.target)||!e.target.classList.contains("e-rte-fontcolor-dropdown")&&!e.target.classList.contains("e-rte-backgroundcolor-dropdown")||this.parent.notify(pn,{toolbarClick:e.target.classList.contains("e-rte-fontcolor-dropdown")?"fontcolor":"backgroundcolor"})}},v.prototype.createToolbarElement=function(){this.tbElement=this.parent.createElement("div",{id:this.parent.getID()+"_toolbar"}),!j.Browser.isDevice&&this.parent.inlineMode.enable&&br()||(this.parent.inlineMode.enable?this.parent.rootContainer.insertBefore(this.tbElement,this.editPanel):(this.tbWrapper=this.parent.createElement("div",{id:this.parent.getID()+"_toolbar_wrapper",innerHTML:this.tbElement.outerHTML,className:Gn}),this.tbElement=this.tbWrapper.firstElementChild,this.parent.rootContainer.insertBefore(this.tbWrapper,this.editPanel)))},v.prototype.getToolbarMode=function(){var e;switch(this.parent.toolbarSettings.type){case c.ToolbarType.Expand:e="Extended";break;case c.ToolbarType.Scrollable:e="Scrollable";break;default:e="MultiRow"}return e=br()&&this.parent.toolbarSettings.type===c.ToolbarType.Expand?c.ToolbarType.Scrollable:e},v.prototype.checkToolbarResponsive=function(e){var t;return!(!j.Browser.isDevice||br()||(t=this.parent.toolbarSettings.type===c.ToolbarType.Expand?c.ToolbarType.MultiRow:this.parent.toolbarSettings.type,this.baseToolbar.render({container:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items,mode:t,target:e,cssClass:this.parent.getCssClass()}),this.parent.toolbarSettings.type===c.ToolbarType.Expand&&(j.addClass([e],["e-rte-tb-mobile"]),this.parent.inlineMode.enable?this.addFixedTBarClass():j.addClass([e],[In])),this.wireEvents(),this.dropDownModule.renderDropDowns({container:e,containerType:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items}),this.renderColorPicker({container:this.tbElement,containerType:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items}),0))},v.prototype.checkIsTransformChild=function(){this.isTransformChild=!1;for(var e=j.selectAll('[style*="transform"]',document),t=0;t<e.length;t++)if(!j.isNullOrUndefined(e[t].contains)&&e[t].contains(this.parent.element)){this.isTransformChild=!0;break}},v.prototype.toggleFloatClass=function(){var e=this.parent.floatingToolbarOffset;this.parent.toolbarSettings.enableFloating?(j.addClass([this.tbElement.parentElement],[kn]),j.setStyleAttribute(this.tbElement.parentElement,{top:e+"px"})):(j.removeClass([this.tbElement.parentElement],[kn]),j.setStyleAttribute(this.tbElement.parentElement,{top:""}))},v.prototype.renderToolbar=function(){this.initializeInstance(),this.createToolbarElement(),this.checkToolbarResponsive(this.tbElement)||(this.parent.inlineMode.enable?this.parent.notify(ot,{}):(this.baseToolbar.render({container:"toolbar",items:this.parent.toolbarSettings.items,mode:this.getToolbarMode(),target:this.tbElement,cssClass:this.parent.getCssClass()}),this.parent.inlineMode.enable||(this.parent.toolbarSettings.enableFloating&&(this.checkIsTransformChild(),this.toggleFloatClass()),j.addClass([this.parent.element],[Oo]),this.parent.toolbarSettings.type===c.ToolbarType.Expand&&j.addClass([this.parent.element],[Dn]))),this.wireEvents(),this.parent.inlineMode.enable&&!br()&&this.addFixedTBarClass(),this.parent.inlineMode.enable||(this.dropDownModule.renderDropDowns({container:this.tbElement,containerType:"toolbar",items:this.parent.toolbarSettings.items}),this.renderColorPicker({container:this.tbElement,containerType:"toolbar",items:this.parent.toolbarSettings.items}),this.refreshToolbarOverflow()),this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-source-code-enabled")&&(this.parent.notify(ke,{targetItem:"SourceCode",updateItem:"Preview",baseToolbar:this.parent.getBaseToolbarObject()}),this.parent.disableToolbarItem(this.parent.toolbarSettings.items)))},v.prototype.addFixedTBarClass=function(){j.addClass([this.tbElement],[wn])},v.prototype.removeFixedTBarClass=function(){j.removeClass([this.tbElement],[wn])},v.prototype.showFixedTBar=function(){j.addClass([this.tbElement],[Xn]),j.Browser.isIos&&j.addClass([this.tbElement],[Oi])},v.prototype.hideFixedTBar=function(){this.isToolbar?this.isToolbar=!1:j.removeClass([this.tbElement],[Xn,Oi])},v.prototype.updateItem=function(e){var t=this.tools[e.updateItem.toLocaleLowerCase()];("Code View"!==Cr(e.updateItem.toLocaleLowerCase(),this.locator)&&"Preview"!==Cr(e.updateItem.toLocaleLowerCase(),this.locator)||"en-US"!==this.parent.locale)&&(t.tooltip=Cr(e.updateItem.toLocaleLowerCase(),this.locator));var n,i=Sr(Er(this.tools[e.targetItem.toLocaleLowerCase()].subCommand),e.baseToolbar.toolbarObj.items)[0];j.isNullOrUndefined(i)?this.addTBarItem(e,0):(n=this.parent.inlineMode.enable?"_quick_":"_toolbar_",e.baseToolbar.toolbarObj.items[i].id=this.parent.getID()+n+t.id,e.baseToolbar.toolbarObj.items[i].prefixIcon=t.icon,e.baseToolbar.toolbarObj.items[i].tooltipText=t.tooltip,e.baseToolbar.toolbarObj.items[i].subCommand=t.subCommand,e.baseToolbar.toolbarObj.dataBind(),e.baseToolbar.toolbarObj.refreshOverflow())},v.prototype.updateToolbarStatus=function(e){this.tbElement&&(!this.parent.inlineMode.enable||!br()&&j.Browser.isDevice)&&Nr({args:e,dropDownModule:this.dropDownModule,parent:this.parent,tbElements:j.selectAll("."+Kn,this.tbElement),tbItems:this.baseToolbar.toolbarObj.items},!!this.parent.inlineMode.enable,this.parent)},v.prototype.fullScreen=function(e){this.parent.fullScreenModule.showFullScreen(e)},v.prototype.hideScreen=function(e){this.parent.fullScreenModule.hideFullScreen(e)},v.prototype.getBaseToolbar=function(){return this.baseToolbar},v.prototype.addTBarItem=function(e,t){e.baseToolbar.toolbarObj.addItems([e.baseToolbar.getObject(e.updateItem,"toolbar")],t)},v.prototype.enableTBarItems=function(e,t,n,i){var o=Sr(Er(t),e.toolbarObj.items);this.tbItems=j.selectAll("."+Kn,e.toolbarObj.element);for(var r=0;r<o.length;r++){var s=this.tbItems[o[r]];s&&e.toolbarObj.enableItems(s,n)}j.select("."+wo,this.parent.element)||i||Tr(e,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())},v.prototype.removeTBarItems=function(e){j.isNullOrUndefined(this.baseToolbar.toolbarObj)&&(this.baseToolbar=this.parent.getBaseToolbarObject());var t=Sr(Er(e),this.baseToolbar.toolbarObj.items);this.tbItems=this.parent.inlineMode.enable?j.selectAll("."+Kn,this.baseToolbar.toolbarObj.element):j.selectAll("."+Kn,this.parent.element);for(var n=0;n<t.length;n++)this.baseToolbar.toolbarObj.removeItems(this.tbItems[t[n]])},v.prototype.getExpandTBarPopHeight=function(){var e,t=0;return this.parent.toolbarSettings.type===c.ToolbarType.Expand&&this.tbElement.classList.contains("e-extended-toolbar")&&((e=j.select(".e-toolbar-extended",this.tbElement))&&this.tbElement.classList.contains("e-expand-open")||e&&e.classList.contains("e-popup-open")?(j.addClass([e],[Jn]),t+=e.offsetHeight,j.removeClass([e],[Jn])):j.removeClass([this.tbElement],[Ni])),t},v.prototype.getToolbarHeight=function(){return this.tbElement.offsetHeight},v.prototype.getToolbarElement=function(){return this.parent&&this.parent.element?j.select("."+Ln,this.parent.element):null},v.prototype.refreshToolbarOverflow=function(){this.parent.element.classList.remove(Nn),this.baseToolbar.toolbarObj.refreshOverflow(),this.parent.enableRtl&&this.parent.element.classList.add(Nn)},v.prototype.isToolbarDestroyed=function(){return!!(this.baseToolbar&&this.baseToolbar.toolbarObj&&this.baseToolbar.toolbarObj.isDestroyed)},v.prototype.destroyToolbar=function(){var e,t;this.isToolbarDestroyed()||(this.parent.unWireScrollElementsEvents(),this.unWireEvents(),this.dropDownModule.destroy(),this.parent.emojiPickerModule&&!this.parent.emojiPickerModule.isPopupDestroyed&&this.parent.emojiPickerModule.childDestroy(),this.dropDownModule=null,this.colorPickerModule.destroy(),this.colorPickerModule=null,this.keyBoardModule&&(this.keyBoardModule.destroy(),this.keyBoardModule=null),this.baseToolbar.destroy(),this.removeEventListener(),j.removeClass([this.parent.element],[Oo]),j.removeClass([this.parent.element],[Dn]),e=j.select("."+Gn,this.parent.element),t=j.select("."+Ln,this.parent.element),j.isNullOrUndefined(e)||j.detach(e),j.isNullOrUndefined(t))||j.detach(t)},v.prototype.destroy=function(){this.isDestroyed||(this.isToolbarDestroyed()||this.destroyToolbar(),this.toolbarObj=null,this.editPanel=null,this.isToolbar=null,this.editableElement=null,this.tbItems=null,this.baseToolbar=null,this.tbElement=null,this.tbWrapper=null,this.isTransformChild=null,this.contentRenderer=null,this.dropDownModule=null,this.colorPickerModule=null,this.toolbarActionModule=null,this.tools=null,this.locator=null,this.renderFactory=null,this.isDestroyed=!0)},v.prototype.mouseDownHandler=function(){j.Browser.isDevice&&this.parent.inlineMode.enable&&!br()&&this.showFixedTBar()},v.prototype.focusChangeHandler=function(){j.Browser.isDevice&&this.parent.inlineMode.enable&&!br()&&(this.isToolbar=!1,this.hideFixedTBar())},v.prototype.dropDownBeforeOpenHandler=function(){this.isToolbar=!0},v.prototype.tbFocusHandler=function(e){var t=document.activeElement,n=j.closest(t,".e-rte-toolbar");if(t===this.parent.getToolbarElement()||n===this.parent.getToolbarElement())for(var i=this.parent.getToolbarElement().querySelectorAll(".e-expended-nav"),o=0;o<i.length;o++)j.isNullOrUndefined(this.parent.getToolbarElement().querySelector(".e-insert-table-btn"))?i[o].setAttribute("tabindex","0"):i[o].setAttribute("tabindex","1")},v.prototype.wireEvents=function(){this.parent.inlineMode.enable&&br()||j.EventHandler.add(this.tbElement,"focusin",this.tbFocusHandler,this)},v.prototype.unWireEvents=function(){j.EventHandler.remove(this.tbElement,"focusin",this.tbFocusHandler)},v.prototype.addEventListener=function(){this.parent.isDestroyed||(this.dropDownModule=new Ra(this.parent,this.locator),this.toolbarActionModule=new Aa(this.parent),this.colorPickerModule=new Ua(this.parent,this.locator),this.parent.on(n,this.renderToolbar,this),this.parent.on($,this.toolbarBindEvent,this),this.parent.on(J,this.updateToolbarStatus,this),this.parent.on(l,this.onPropertyChanged,this),this.parent.on(Y,this.onRefresh,this),this.parent.on(o,this.destroy,this),this.parent.on(le,this.fullScreen,this),this.parent.on(de,this.hideScreen,this),this.parent.on(ke,this.updateItem,this),this.parent.on(_e,this.dropDownBeforeOpenHandler,this),this.parent.on(et,this.focusChangeHandler,this),this.parent.on(Ke,this.mouseDownHandler,this),this.parent.on(Ge,this.mouseDownHandler,this),this.parent.on(tn,this.setCssClass,this))},v.prototype.removeEventListener=function(){this.parent.off(n,this.renderToolbar),this.parent.off($,this.toolbarBindEvent),this.parent.off(J,this.updateToolbarStatus),this.parent.off(l,this.onPropertyChanged),this.parent.off(Y,this.onRefresh),this.parent.off(o,this.destroy),this.parent.off(le,this.parent.fullScreenModule.showFullScreen),this.parent.off(de,this.parent.fullScreenModule.hideFullScreen),this.parent.off(ke,this.updateItem),this.parent.off(_e,this.dropDownBeforeOpenHandler),this.parent.off(et,this.focusChangeHandler),this.parent.off(Ke,this.mouseDownHandler),this.parent.off(Ge,this.mouseDownHandler),this.parent.off(tn,this.setCssClass)},v.prototype.setCssClass=function(e){this.toolbarObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)?this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass+" "+e.cssClass).trim()}):this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},v.prototype.onRefresh=function(){this.parent.inlineMode.enable||this.refreshToolbarOverflow(),this.parent.autoResize()},v.prototype.onPropertyChanged=function(e){if(!j.isNullOrUndefined(e.newProp.inlineMode))for(var t=0,n=Object.keys(e.newProp.inlineMode);t<n.length;t++)"enable"===n[t]&&this.refreshToolbar();j.isNullOrUndefined(e.newProp.toolbarSettings)||j.isNullOrUndefined(e.newProp.toolbarSettings.enableFloating)||this.toggleFloatClass(),e.module===this.getModuleName()&&this.refreshToolbar()},v.prototype.refreshToolbar=function(){j.isNullOrUndefined(this.baseToolbar.toolbarObj)&&(this.baseToolbar=this.parent.getBaseToolbarObject());var e=j.select("."+Gn,this.parent.element);(j.select("."+Ln,this.parent.element)||e)&&this.destroyToolbar(),this.parent.toolbarSettings.enable&&(this.baseToolbar&&this.baseToolbar.toolbarObj&&!this.baseToolbar.toolbarObj.isDestroyed&&this.baseToolbar.destroy(),this.baseToolbar=new Ma(this.parent,this.locator),this.addEventListener(),this.renderToolbar(),this.parent.wireScrollElementsEvents(),j.select("."+wo,this.parent.element)||this.parent.inlineMode.enable||Tr(this.baseToolbar,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus()),this.parent.notify(qt,{}))},v.prototype.getModuleName=function(){return"toolbar"},v.prototype.renderColorPicker=function(e){this.colorPickerModule.renderColorPickerInput(e)};var Ha=v;function v(e,t){var n;this.tools={},this.parent=e,this.isDestroyed=!1,this.isToolbar=!1,this.locator=t,this.isTransformChild=!1,this.renderFactory=this.locator.getService("rendererFactory"),n=this.parent,Bo.forEach(function(e,t){Bo[t].text=ir(n,Mo,Bo[t])}),Ho.forEach(function(e,t){Ho[t].text=ir(n,Io,Ho[t])}),jo.forEach(function(e,t){jo[t].text=ir(n,Uo,jo[t])}),Fo.forEach(function(e,t){Fo[t].text=ir(n,Po,Fo[t])}),_o.forEach(function(e,t){_o[t].text=ir(n,zo,_o[t])}),Qo.forEach(function(e,t){Qo[t].text=ir(n,Vo,Qo[t])}),Ko.forEach(function(e,t){Ko[t].text=ir(n,Wo,Ko[t])}),Xo.forEach(function(e,t){Xo[t].text=ir(n,Go,Xo[t])}),Pr(this.parent),this.baseToolbar=new Ma(this.parent,this.locator),this.addEventListener(),this.parent.toolbarSettings&&0<Object.keys(this.parent.toolbarSettings.itemConfigs).length?j.extend(this.tools,Do,kr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Do}Fa.prototype.appendPopupContent=function(){this.toolbarElement=this.parent.createElement("div",{className:Bn}),this.element.classList.contains(jn)&&this.toolbarElement.classList.add(Rn),this.element.appendChild(this.toolbarElement)},Fa.prototype.render=function(e){var t="Image"===e.popupType?Hn:"Inline"===e.popupType?Fn:"Text"===e.popupType?jn:"",n=j.getUniqueID(e.popupType+"_Quick_Popup");this.stringItems=e.toolbarItems,this.element=this.parent.createElement("div",{id:n,className:t+" "+Ei}),this.element.setAttribute("aria-owns",this.parent.getID()),this.appendPopupContent(),this.createToolbar(e.toolbarItems,e.mode,e.cssClass),this.popupRenderer.renderPopup(this),this.addEventListener()},Fa.prototype.createToolbar=function(e,t,n){this.quickTBarObj=new Ma(this.parent,this.locator),this.quickTBarObj.render({container:"quick",target:this.toolbarElement,items:e,mode:t,cssClass:n}),this.quickTBarObj.toolbarObj.refresh()},Fa.prototype.setPosition=function(e){var t=j.closest(e.target,".e-img-caption"),n=!e.target.classList.contains("e-imginline")&&!e.target.classList.contains("e-imgbreak"),t=j.isNullOrUndefined(t)?e.target:t;if(j.addClass([this.toolbarElement],[Zn]),j.isNullOrUndefined(j.closest(t,"table"))||t.classList.contains("e-multi-cells-select")||t.classList.contains("e-rte-image"))i=(t.classList.contains("e-rte-audio")?t.parentElement:t).offsetTop;else for(var i=t.offsetTop,o=j.closest(t,"table");!j.isNullOrUndefined(o);)i+=o.offsetTop,o=j.closest(o.parentElement,"table");var r=window.pageYOffset+e.parentData.top,r=i-e.editTop>e.popHeight?r+e.tBarElementHeight+(i-e.editTop)-e.popHeight-5:e.editTop+e.editHeight-(i+t.offsetHeight)>e.popHeight?r+e.tBarElementHeight+(i-e.editTop)+t.offsetHeight+5:e.y,t=n?e.target:t;if(j.isNullOrUndefined(j.closest(t,"table"))||t.classList.contains("e-multi-cells-select")||t.classList.contains("e-rte-image"))s=(t.classList.contains("e-rte-audio")?t.parentElement:t).offsetLeft;else for(var s=t.offsetLeft,o=j.closest(t.parentElement,"th, td");!j.isNullOrUndefined(o);)s+=o.offsetLeft,o=j.closest(o.parentElement,"table");n=t.offsetWidth>e.popWidth?t.offsetWidth/2-e.popWidth/2+e.parentData.left+s:e.parentData.left+s,this.popupObj.position.X=n+e.popWidth>e.parentData.right?e.parentData.right-e.popWidth:n,this.popupObj.position.Y=0<=r?r:e.y+5,this.popupObj.dataBind(),j.removeClass([this.toolbarElement],[Zn])},Fa.prototype.checkCollision=function(e,t,n){for(var i,o=e.parentData.top,r=e.windowY+o+e.tBarElementHeight,s=[],s="document"===t?U.isCollide(e.popup):U.isCollide(e.popup,e.parentElement),a=0;a<s.length;a++)switch(s[a]){case"top":l="document"===t?e.windowY:window.pageYOffset+o+e.tBarElementHeight;break;case"bottom":var l="document"===t?"inline"===n||"text"===n?e.y-e.popHeight-10:e.windowHeight-(o+e.tBarElementHeight)>e.popHeight?r-e.windowHeight>e.popHeight?r+(e.windowHeight-o)-e.popHeight:r:e.windowY+(o+e.tBarElementHeight):"IMG"!==e.target.tagName?e.parentData.bottom+window.pageYOffset-e.popHeight-10:e.parentData.bottom+window.pageYOffset-e.popHeight-5;break;case"right":i="inline"===n||"text"===n?window.pageXOffset+(e.windowWidth-(e.popWidth+e.bodyRightSpace+10)):e.x-e.popWidth;break;case"left":i="inline"===n||"text"===n?0:e.parentData.left}this.popupObj.position.X=i||this.popupObj.position.X,this.popupObj.position.Y=l||this.popupObj.position.Y,this.popupObj.dataBind()},Fa.prototype.showPopup=function(h,p,u,m){var g=this,e={popup:this.popupObj,cancel:!1,targetElement:u,positionX:h,positionY:p};this.parent.trigger(vt,e,function(e){var t,n,i,o,r,s,a,l,d,c;e.cancel||(l=a=void 0,t=window.getComputedStyle(document.body),t=parseFloat(t.marginRight.split("px")[0])+parseFloat(t.paddingRight.split("px")[0]),n=window.innerHeight,i=window.innerWidth,o=g.parent.element,c=(s=!j.isNullOrUndefined(g.parent.getToolbar()))&&g.parent.toolbarModule.getToolbarHeight(),r=s&&g.parent.toolbarModule.getExpandTBarPopHeight(),s=s?c+r:0,j.addClass([g.element],[Yn]),j.Browser.isDevice&&!br()&&j.addClass([g.parent.getToolbar()],[Yn]),l=g.parent.iframeSettings.enable?(a=(d=g.contentRenderer.getPanel().contentWindow).pageYOffset,d.innerHeight):(a=(d=j.closest(u,"."+Wn))?d.scrollTop:0,d?d.offsetHeight:0),!g.parent.inlineMode.enable&&!j.closest(u,"table")&&"text"!==m&&"link"!==m||"IMG"===u.tagName?(g.parent.disableToolbarItem(g.parent.toolbarSettings.items),g.parent.enableToolbarItem(["Undo","Redo"])):g.parent.enableToolbarItem(g.parent.toolbarSettings.items),j.append([g.element],document.body),g.parent.showTooltip&&(g.tooltip=new U.Tooltip({target:"#"+g.element.id+" [title]",openDelay:400,showTipPointer:!0,beforeRender:g.tooltipBeforeRender.bind(g),windowCollision:!0,position:"BottomCenter",cssClass:g.parent.getCssClass()}),g.tooltip.appendTo(g.element)),g.popupObj.position.X=e.positionX+20,g.popupObj.position.Y=e.positionY+20,g.popupObj.dataBind(),g.popupObj.element.classList.add("e-popup-open"),g.dropDownButtons.renderDropDowns({container:g.toolbarElement,containerType:"quick",items:g.stringItems}),g.colorPickerObj.renderColorPickerInput({container:g.toolbarElement,containerType:"quick",items:g.stringItems}),c={x:h,y:p,target:u,editTop:a,editHeight:l,popup:g.popupObj.element,popHeight:g.popupObj.element.offsetHeight,popWidth:g.popupObj.element.offsetWidth,parentElement:o,bodyRightSpace:t,windowY:window.pageYOffset,windowHeight:n,windowWidth:i,parentData:o.getBoundingClientRect(),tBarElementHeight:s},!(j.closest(u,"TABLE")||"IMG"===u.tagName||"AUDIO"===u.tagName||"VIDEO"===u.tagName||"IFRAME"===u.tagName||u.classList&&(u.classList.contains(ai)||u.classList.contains(ri)||u.classList.contains(si)))||h!==e.positionX&&p!==e.positionY||g.setPosition(c),g.parent.inlineMode.enable||g.checkCollision(c,"parent",""),g.checkCollision(c,"document",g.parent.inlineMode.enable?"inline":"text"===m?"text":""),g.popupObj.element.classList.remove("e-popup-open"),j.removeClass([g.element],[Yn]),g.popupObj.show({name:"ZoomIn",duration:j.Browser.isIE?250:400},u),g.popupObj&&g.parent.cssClass&&(j.removeClass([g.popupObj.element],g.parent.cssClass.replace(/\s+/g," ").trim().split(" ")),j.addClass([g.popupObj.element],g.parent.cssClass.replace(/\s+/g," ").trim().split(" "))),j.setStyleAttribute(g.element,{maxWidth:window.outerWidth+"px"}),j.addClass([g.element],[An]),g.isRendered=!0)})},Fa.prototype.tooltipBeforeRender=function(e){e.target.querySelector(".e-active")&&(e.cancel=!0,j.isNullOrUndefined(e.target.getAttribute("title"))||this.parent.notify(un,{target:e.target,isTitle:!0}))},Fa.prototype.hidePopup=function(){var e,t,n=!j.isNullOrUndefined(this.parent.rootContainer)&&this.parent.rootContainer.classList.contains("e-source-code-enabled");j.Browser.isDevice&&!br()&&j.removeClass([this.parent.getToolbar()],[Yn]),j.isNullOrUndefined(this.element.querySelectorAll("[data-title]"))||this.element.querySelectorAll("[data-title]").forEach(function(e){var t=new MouseEvent("mouseout",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}),j.isNullOrUndefined(document.querySelector(".e-tooltip-wrap"))?j.isNullOrUndefined(this.tooltip)||this.tooltip.destroy():(j.isNullOrUndefined(document.querySelector("#"+this.element.id+" [data-tooltip-id]"))||(t=(e=document.querySelector("#"+this.element.id+" [data-tooltip-id]")).getAttribute("data-content"),e.removeAttribute("data-content"),e.setAttribute("title",t),e.removeAttribute("data-tooltip-id")),this.tooltip.destroy()),j.isNullOrUndefined(this.parent.getToolbar())||this.parent.inlineMode.enable||n||this.parent.enableToolbarItem(this.parent.toolbarSettings.items),this.removeEleFromDOM(),this.isRendered=!1},Fa.prototype.addQTBarItem=function(e,t){this.quickTBarObj.toolbarObj.addItems(this.quickTBarObj.getItems(e,"toolbar"),t)},Fa.prototype.removeQTBarItem=function(e){this.quickTBarObj.toolbarObj.removeItems(e)},Fa.prototype.removeEleFromDOM=function(){var e=this.popupObj.element;this.isRendered&&(this.dropDownButtons.destroyDropDowns(),this.colorPickerObj.destroyColorPicker(),j.removeClass([this.element],[An]),j.detach(e),e=this.popupObj,this.parent.trigger(Nt,e))},Fa.prototype.updateStatus=function(e){Nr({args:e,dropDownModule:this.dropDownButtons,parent:this.parent,tbElements:j.selectAll("."+Kn,this.element),tbItems:this.quickTBarObj.toolbarObj.items},!0,this.parent),this.parent.quickToolbarSettings.text&&this.parent.quickToolbarModule.textQTBar&&(Nr({args:e,dropDownModule:this.parent.quickToolbarModule.textQTBar.dropDownButtons,parent:this.parent,tbElements:j.selectAll("."+Kn,this.parent.quickToolbarModule.textQTBar.element),tbItems:this.parent.quickToolbarModule.textQTBar.quickTBarObj.toolbarObj.items},!0,this.parent),Tr(this.parent.quickToolbarModule.textQTBar.quickTBarObj,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())),j.select("."+wo,this.parent.element)||Tr(this.parent.getBaseToolbarObject(),this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())},Fa.prototype.destroy=function(){this.isDestroyed||(this.tooltip&&!this.tooltip.isDestroyed&&(this.tooltip.destroy(),this.tooltip=null),this.removeEventListener(),this.quickTBarObj.destroy(),this.quickTBarObj=null,this.popupObj&&!this.popupObj.isDestroyed&&(this.removeEleFromDOM(),this.popupObj.destroy()),this.colorPickerObj=null,this.dropDownButtons=null,this.stringItems=null,this.dropDownButtons=null,this.colorPickerObj=null,this.toolbarElement=null,this.isDestroyed=!0)},Fa.prototype.addEventListener=function(){!this.parent.isDestroyed&&(this.parent.on(o,this.destroy,this),this.parent.on(l,this.onPropertyChanged,this),this.parent.inlineMode.enable||this.parent.quickToolbarSettings.text)&&this.parent.on(J,this.updateStatus,this)},Fa.prototype.onPropertyChanged=function(e){if(!j.isNullOrUndefined(e.newProp.inlineMode))for(var t=0,n=Object.keys(e.newProp.inlineMode);t<n.length;t++)"enable"===n[t]&&(e.newProp.inlineMode.enable?this.parent.on(J,this.updateStatus,this):this.parent.off(J,this.updateStatus))},Fa.prototype.removeEventListener=function(){this.parent.off(o,this.destroy),this.parent.off(l,this.onPropertyChanged),(this.parent.inlineMode.enable||this.parent.quickToolbarSettings.text)&&this.parent.off(J,this.updateStatus)};var ja=Fa;function Fa(e,t){this.parent=e,this.locator=t,this.isRendered=!1,this.isDestroyed=!1,this.renderFactory=this.locator.getService("rendererFactory"),this.contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content),this.popupRenderer=this.renderFactory.getRenderer(c.RenderType.Popup),this.dropDownButtons=new Ra(this.parent,this.locator),this.colorPickerObj=new Ua(this.parent,this.locator)}C.prototype.formatItems=function(e){var t=[];return e.forEach(function(e){if("string"==typeof e)switch(e.toLocaleLowerCase()){case"open":t.push("openLink");break;case"edit":t.push("editLink");break;case"unlink":t.push("removeLink");break;default:t.push(e)}else t.push(e)}),t},C.prototype.getQTBarOptions=function(e,t,n,i){return{popupType:e,toolbarItems:n,mode:t,renderType:i,cssClass:this.parent.getCssClass()}},C.prototype.createQTBar=function(e,t,n,i){var o;return n.length<1?null:((o=new ja(this.parent,this.locator)).render(this.getQTBarOptions(e,t,this.formatItems(n),i)),o)},C.prototype.initializeQuickToolbars=function(){(this.parent.quickToolbarModule=this).contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content),this.parent.inlineMode.enable&&this.parent.inlineMode.onSelection&&br()&&j.EventHandler.add(this.contentRenderer.getDocument(),"selectionchange",this.selectionChangeHandler,this)},C.prototype.onMouseDown=function(e){this.parent.isBlur=!1,this.parent.isRTE=!0},C.prototype.keyUpQT=function(e){27===e.which&&this.hideQuickToolbars()},C.prototype.renderQuickToolbars=function(){this.linkQTBar||this.imageQTBar||this.audioQTBar||this.videoQTBar||this.textQTBar||this.tableQTBar||(this.linkQTBar=this.createQTBar("Link","Scrollable",this.parent.quickToolbarSettings.link,c.RenderType.LinkToolbar),this.renderFactory.addRenderer(c.RenderType.LinkToolbar,this.linkQTBar),j.isNullOrUndefined(this.parent.quickToolbarSettings.text)||this.parent.inlineMode.enable||(this.textQTBar=this.createQTBar("Text","MultiRow",this.parent.quickToolbarSettings.text,c.RenderType.TextToolbar),this.renderFactory.addRenderer(c.RenderType.TextToolbar,this.textQTBar)),this.imageQTBar=this.createQTBar("Image","MultiRow",this.parent.quickToolbarSettings.image,c.RenderType.ImageToolbar),this.renderFactory.addRenderer(c.RenderType.ImageToolbar,this.imageQTBar),this.audioQTBar=this.createQTBar("Audio","MultiRow",this.parent.quickToolbarSettings.audio,c.RenderType.AudioToolbar),this.renderFactory.addRenderer(c.RenderType.AudioToolbar,this.audioQTBar),this.videoQTBar=this.createQTBar("Video","MultiRow",this.parent.quickToolbarSettings.video,c.RenderType.VideoToolbar),this.renderFactory.addRenderer(c.RenderType.VideoToolbar,this.videoQTBar),this.tableQTBar=this.createQTBar("Table","MultiRow",this.parent.quickToolbarSettings.table,c.RenderType.TableToolbar),this.renderFactory.addRenderer(c.RenderType.TableToolbar,this.tableQTBar),this.linkQTBar&&(j.EventHandler.add(this.linkQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.linkQTBar.element,"keyup",this.keyUpQT,this)),this.imageQTBar&&(j.EventHandler.add(this.imageQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.imageQTBar.element,"keyup",this.keyUpQT,this)),this.audioQTBar&&(j.EventHandler.add(this.audioQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.audioQTBar.element,"keyup",this.keyUpQT,this)),this.videoQTBar&&(j.EventHandler.add(this.videoQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.videoQTBar.element,"keyup",this.keyUpQT,this)),this.textQTBar&&(j.EventHandler.add(this.textQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.textQTBar.element,"keyup",this.keyUpQT,this)),this.tableQTBar&&(j.EventHandler.add(this.tableQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.tableQTBar.element,"keyup",this.keyUpQT,this)))},C.prototype.renderInlineQuickToolbar=function(){!this.parent.inlineMode.enable||j.Browser.isDevice&&!br()||(j.addClass([this.parent.element],[xn]),this.inlineQTBar=this.createQTBar("Inline","MultiRow",this.parent.toolbarSettings.items,c.RenderType.InlineToolbar),this.renderFactory.addRenderer(c.RenderType.InlineToolbar,this.inlineQTBar),j.EventHandler.add(this.inlineQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.inlineQTBar.element,"keyup",this.keyUpQT,this))},C.prototype.showInlineQTBar=function(e,t,n){j.isNullOrUndefined(this.parent)||this.parent.readonly||"img"===n.tagName.toLowerCase()||this.inlineQTBar.element.querySelector(".e-rte-color-content")||this.inlineQTBar.showPopup(e,t,n)},C.prototype.hideInlineQTBar=function(){this.inlineQTBar&&!p(this.inlineQTBar.element,"e-popup-close")&&this.inlineQTBar.hidePopup()},C.prototype.hideQuickToolbars=function(){this.linkQTBar&&!p(this.linkQTBar.element,"e-popup-close")&&document.body.contains(this.linkQTBar.element)&&this.linkQTBar.hidePopup(),this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&document.body.contains(this.textQTBar.element)&&this.textQTBar.hidePopup(),this.imageQTBar&&!p(this.imageQTBar.element,"e-popup-close")&&document.body.contains(this.imageQTBar.element)&&this.imageQTBar.hidePopup(),this.audioQTBar&&!p(this.audioQTBar.element,"e-popup-close")&&document.body.contains(this.audioQTBar.element)&&this.audioQTBar.hidePopup(),this.videoQTBar&&!p(this.videoQTBar.element,"e-popup-close")&&document.body.contains(this.videoQTBar.element)&&this.videoQTBar.hidePopup(),this.tableQTBar&&!p(this.tableQTBar.element,"e-popup-close")&&document.body.contains(this.tableQTBar.element)&&this.tableQTBar.hidePopup(),j.isNullOrUndefined(this.parent)||!this.parent.inlineMode.enable||j.Browser.isDevice&&!br()||this.hideInlineQTBar()},C.prototype.deBounce=function(e,t,n){var i=this;clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout(function(){i.showInlineQTBar(e,t,n)},this.debounceTimeout)},C.prototype.mouseUpHandler=function(e){if(this.parent.inlineMode.enable&&(!j.Browser.isDevice||br())){var t=e.args.touches?e.args.changedTouches[0]:e.args,n=this.parent.getRange(),i=e.args.target;if(j.isNullOrUndefined(j.select("."+Fn,document.body))){if(br()&&e.touchData&&e.touchData.prevClientX!==e.touchData.clientX&&e.touchData.prevClientY!==e.touchData.clientY)return;this.hideInlineQTBar();var o=this.parent.element.getBoundingClientRect().left;if(this.offsetX=this.parent.iframeSettings.enable?window.pageXOffset+o+t.clientX:t.pageX,this.offsetY=vr(t,this.parent.element,this.parent.iframeSettings.enable),"TEXTAREA"===i.nodeName)this.showInlineQTBar(this.offsetX,this.offsetY,i);else{var r=j.closest(i,"a"),r=(i=r||i,this.parent.getRange().startContainer.parentElement),s=this.parent.getRange().endContainer.parentElement;if((j.isNullOrUndefined(j.closest(r,"A"))||j.isNullOrUndefined(j.closest(s,"A")))&&(!j.closest(i,"td,th")||!n.collapsed)&&("IMG"!==i.tagName||this.parent.getRange().startOffset!==this.parent.getRange().endOffset)){if(this.parent.inlineMode.onSelection&&n.collapsed)return;this.target=i,this.showInlineQTBar(this.offsetX,this.offsetY,i)}}}}j.isNullOrUndefined(this.textQTBar)||j.isNullOrUndefined(this.parent.quickToolbarSettings.text)||this.parent.inlineMode.enable||(j.isNullOrUndefined(e)||j.isNullOrUndefined(e.name)||"sourceCodeMouseDown"!==e.name)&&(t=e.args.touches?e.args.changedTouches[0]:e.args,i=e.args.target,this.hideQuickToolbars(),o=this.parent.element.getBoundingClientRect().left,this.offsetX=this.parent.iframeSettings.enable?this.parent.element.ownerDocument.documentElement.scrollLeft+o+t.clientX:t.pageX,this.offsetY=vr(t,this.parent.element,this.parent.iframeSettings.enable),(n=this.parent.getRange()).endContainer.parentElement.tagName===n.startContainer.parentElement.tagName&&"A"===n.startContainer.parentElement.tagName&&"A"===n.endContainer.parentElement.tagName||"IMG"===i.tagName||"VIDEO"===i.tagName||this.isEmbedVidElem(i)||"AUDIO"===i.tagName||i.childNodes[0]&&1===i.childNodes[0].nodeType&&i.childNodes[0].classList.contains("e-rte-audio")||this.parent.getRange().startOffset===this.parent.getRange().endOffset||(this.target=i,this.textQTBar.showPopup(this.offsetX,this.offsetY,i,"text")))},C.prototype.isEmbedVidElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&e.classList.contains(si)||e&&"IFRAME"===e.nodeName)},C.prototype.keyDownHandler=function(e){var t=e.args.altKey;this.parent.inlineMode.enable&&e.args.metaKey&&65===e.args.keyCode?this.showInlineQTBar(this.offsetX,this.offsetY,e.args.target):t||(!this.parent.inlineMode.enable||j.Browser.isDevice&&!br()||j.isNullOrUndefined(j.select("."+Fn,document))||this.hideInlineQTBar(),this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&this.textQTBar.hidePopup())},C.prototype.inlineQTBarMouseDownHandler=function(){!this.parent.inlineMode.enable||j.Browser.isDevice&&!br()||j.isNullOrUndefined(j.select("."+Fn,document))||this.hideInlineQTBar(),j.isNullOrUndefined(this.parent.quickToolbarSettings.text)||this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&document.body.contains(this.textQTBar.element)&&this.textQTBar.hidePopup()},C.prototype.keyUpHandler=function(e){e=e.args;if(this.parent.inlineMode.enable&&!j.Browser.isDevice){if(this.parent.inlineMode.onSelection)return void(0<this.parent.getSelection().length&&(e.ctrlKey&&65===e.keyCode||e.shiftKey&&(33===e.keyCode||34===e.keyCode||35===e.keyCode||36===e.keyCode||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode))&&this.showInlineQTBar(this.offsetX,this.offsetY,e.target));this.deBounce(this.offsetX,this.offsetY,e.target)}this.parent.quickToolbarSettings.text&&!j.Browser.isDevice&&(e.ctrlKey&&65===e.keyCode||e.shiftKey&&(33===e.keyCode||34===e.keyCode||35===e.keyCode||36===e.keyCode||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode))&&this.textQTBar.showPopup(this.offsetX,this.offsetY,e.target,"text")},C.prototype.selectionChangeHandler=function(e){var t=this;clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout(function(){t.onSelectionChange(e)},this.debounceTimeout)},C.prototype.onSelectionChange=function(e){j.isNullOrUndefined(j.select("."+Fn,document.body))&&!this.contentRenderer.getDocument().getSelection().isCollapsed&&this.mouseUpHandler({args:e})},C.prototype.getInlineBaseToolbar=function(){return this.inlineQTBar&&this.inlineQTBar.quickTBarObj},C.prototype.destroy=function(){this.isDestroyed||(this.linkQTBar&&!this.linkQTBar.isDestroyed&&(j.EventHandler.remove(this.linkQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.linkQTBar.element,"keyup",this.keyUpQT),this.linkQTBar.destroy()),this.textQTBar&&!this.textQTBar.isDestroyed&&(j.EventHandler.remove(this.textQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.textQTBar.element,"keyup",this.keyUpQT),this.textQTBar.destroy()),this.imageQTBar&&!this.imageQTBar.isDestroyed&&(j.EventHandler.remove(this.imageQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.imageQTBar.element,"keyup",this.keyUpQT),this.imageQTBar.destroy()),this.audioQTBar&&!this.audioQTBar.isDestroyed&&(j.EventHandler.remove(this.audioQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.audioQTBar.element,"keyup",this.keyUpQT),this.audioQTBar.destroy()),this.videoQTBar&&!this.videoQTBar.isDestroyed&&(j.EventHandler.remove(this.videoQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.videoQTBar.element,"keyup",this.keyUpQT),this.videoQTBar.destroy()),this.tableQTBar&&!this.tableQTBar.isDestroyed&&(j.EventHandler.remove(this.tableQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.tableQTBar.element,"keyup",this.keyUpQT),this.tableQTBar.destroy()),this.inlineQTBar&&!this.inlineQTBar.isDestroyed&&(j.EventHandler.remove(this.inlineQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.inlineQTBar.element,"keyup",this.keyUpQT),br()&&j.EventHandler.remove(document,"selectionchange",this.selectionChangeHandler),this.inlineQTBar.destroy()),this.removeEventListener(),this.isDestroyed=!0)},C.prototype.wireInlineQTBarEvents=function(){this.parent.on(re,this.mouseUpHandler,this),this.parent.on(Ke,this.inlineQTBarMouseDownHandler,this),this.parent.on(h,this.keyDownHandler,this),this.parent.on(ne,this.keyUpHandler,this),this.parent.on(Ge,this.mouseUpHandler,this),this.parent.on(ot,this.renderInlineQuickToolbar,this)},C.prototype.unWireInlineQTBarEvents=function(){this.parent.off(re,this.mouseUpHandler),this.parent.off(Ke,this.inlineQTBarMouseDownHandler),this.parent.off(h,this.keyDownHandler),this.parent.off(ne,this.keyUpHandler),this.parent.off(Ge,this.mouseUpHandler),this.parent.off(ot,this.renderInlineQuickToolbar)},C.prototype.toolbarUpdated=function(e){this.linkQTBar&&!p(this.linkQTBar.element,"e-popup-close")&&this.linkQTBar.hidePopup(),this.imageQTBar&&!p(this.imageQTBar.element,"e-popup-close")&&this.imageQTBar.hidePopup(),this.audioQTBar&&!p(this.audioQTBar.element,"e-popup-close")&&this.audioQTBar.hidePopup(),this.videoQTBar&&!p(this.videoQTBar.element,"e-popup-close")&&this.videoQTBar.hidePopup(),this.tableQTBar&&!p(this.tableQTBar.element,"e-popup-close")&&this.tableQTBar.hidePopup()},C.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(n,this.initializeQuickToolbars,this),this.parent.on(Ke,this.renderQuickToolbars,this),this.parent.on(J,this.toolbarUpdated,this),this.parent.on(At,this.renderQuickToolbars,this),this.wireInlineQTBarEvents(),this.parent.on(l,this.onPropertyChanged,this),"hide"===this.parent.quickToolbarSettings.actionOnScroll&&(this.parent.on(Ye,this.hideQuickToolbars,this),this.parent.on(Je,this.hideQuickToolbars,this)),this.parent.on(et,this.hideQuickToolbars,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(o,this.destroy,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(st,this.setRtl,this),this.parent.on(tn,this.setCssClass,this),this.parent.on(an,this.hideQuickToolbars,this))},C.prototype.onKeyDown=function(e){e=e.args;8!==e.which&&46!==e.which||(this.imageQTBar&&!p(this.imageQTBar.element,"e-popup-close")&&this.imageQTBar.hidePopup(),this.audioQTBar&&!p(this.audioQTBar.element,"e-popup-close")&&this.audioQTBar.hidePopup(),this.videoQTBar&&!p(this.videoQTBar.element,"e-popup-close")&&this.videoQTBar.hidePopup(),this.tableQTBar&&!p(this.tableQTBar.element,"e-popup-close")&&this.tableQTBar.hidePopup(),this.linkQTBar&&!p(this.linkQTBar.element,"e-popup-close")&&this.linkQTBar.hidePopup(),this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&this.textQTBar.hidePopup())},C.prototype.onIframeMouseDown=function(){this.hideQuickToolbars(),this.hideInlineQTBar()},C.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass&&e.quickTBarObj.toolbarObj.cssClass!==t.cssClass)?e.quickTBarObj.toolbarObj.setProperties({cssClass:(e.quickTBarObj.toolbarObj.cssClass+" "+t.cssClass).trim()}):e.quickTBarObj.toolbarObj.setProperties({cssClass:(e.quickTBarObj.toolbarObj.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},C.prototype.setCssClass=function(e){for(var t=[this.inlineQTBar,this.imageQTBar,this.linkQTBar,this.textQTBar,this.tableQTBar],n=0;n<t.length;n++)this.updateCss(t[n],e)},C.prototype.setRtl=function(e){this.inlineQTBar&&this.inlineQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.imageQTBar&&this.imageQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.audioQTBar&&this.audioQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.videoQTBar&&this.videoQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.linkQTBar&&this.linkQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.textQTBar&&this.textQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl})},C.prototype.removeEventListener=function(){this.deBouncer&&(clearTimeout(this.deBouncer),this.deBouncer=null),this.parent.off(n,this.initializeQuickToolbars),this.parent.off(Ke,this.renderQuickToolbars),this.parent.off(J,this.toolbarUpdated),this.parent.off(At,this.renderQuickToolbars),this.unWireInlineQTBarEvents(),this.parent.off(l,this.onPropertyChanged),"hide"===this.parent.quickToolbarSettings.actionOnScroll&&(this.parent.off(Ye,this.hideQuickToolbars),this.parent.off(Je,this.hideQuickToolbars)),this.parent.off(et,this.hideQuickToolbars),this.parent.off(o,this.destroy),this.parent.off(K,this.onIframeMouseDown),this.parent.off(h,this.onKeyDown),this.parent.off(st,this.setRtl),this.parent.off(tn,this.setCssClass),this.parent.off(an,this.hideQuickToolbars)},C.prototype.onPropertyChanged=function(e){if(!j.isNullOrUndefined(e.newProp.quickToolbarSettings))for(var t=0,n=Object.keys(e.newProp.quickToolbarSettings);t<n.length;t++)"actionOnScroll"===n[t]&&("none"===e.newProp.quickToolbarSettings.actionOnScroll?(this.parent.off(Ye,this.hideQuickToolbars),this.parent.off(Je,this.hideQuickToolbars)):(this.parent.on(Ye,this.hideQuickToolbars,this),this.parent.on(Je,this.hideQuickToolbars,this)));e.module!==this.getModuleName()||(this.inlineQTBar&&(j.removeClass([this.parent.element],[xn]),this.unWireInlineQTBarEvents(),this.hideInlineQTBar()),!this.parent.inlineMode.enable)||j.Browser.isDevice&&!br()||(j.addClass([this.parent.element],[xn]),this.wireInlineQTBarEvents())},C.prototype.getModuleName=function(){return"quickToolbar"},C.prototype.getQuickToolbarInstance=function(){return[this.linkQTBar,this.imageQTBar,this.audioQTBar,this.videoQTBar,this.tableQTBar,this.textQTBar,this.inlineQTBar]};var qa=C;function C(e,t){this.debounceTimeout=1e3,this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.renderFactory.addRenderer(c.RenderType.Popup,new Ea(this.parent)),this.addEventListener(),this.isDestroyed=!1}_a.prototype.initializeInstance=function(){this.contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content),this.editPanel=this.contentRenderer.getEditPanel(),this.addEventListener()},_a.prototype.renderCount=function(){this.initializeInstance(),this.element=this.parent.createElement("span",{className:fi}),this.parent.rootContainer.appendChild(this.element),this.parent.rootContainer.classList.add("e-count-enabled"),this.parent.iframeSettings.enable&&this.parent.inputElement.classList.add("e-count-enabled"),this.appendCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength)},_a.prototype.appendCount=function(){var e="Markdown"===this.parent.editorMode?this.editPanel.value:this.parent.getText().replace(/(\r\n|\n|\r|\t)/gm,""),e=("Markdown"!==this.parent.editorMode&&-1!==e.indexOf("")?this.htmlLength=e.replace(/\u200B/g,"").length:this.htmlLength=e.length,-1===this.parent.maxLength?this.htmlLength:this.htmlLength+" / "+this.parent.maxLength);this.element.innerHTML=e},_a.prototype.charCountBackground=function(e){e=e/this.parent.maxLength*100;e<85?(this.element.classList.remove(bi),this.element.classList.remove(yi)):85<e&&e<=90?(this.element.classList.remove(yi),this.element.classList.add(bi)):90<e&&(this.element.classList.remove(bi),this.element.classList.add(yi))},_a.prototype.refresh=function(){j.isNullOrUndefined(this.editPanel)||(this.appendCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength))},_a.prototype.destroy=function(){this.isDestroyed||(this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-count-enabled")&&this.parent.rootContainer.classList.remove("e-count-enabled"),this.parent.iframeSettings.enable&&!j.isNullOrUndefined(this.parent.inputElement)&&this.parent.inputElement.classList.remove("e-count-enabled"),this.element&&!j.isNullOrUndefined(this.parent.element.querySelector("."+fi))&&j.detach(this.element),this.removeEventListener(),this.editPanel&&(this.editPanel=null),this.element&&(j.detach(this.element),this.element=null),this.isDestroyed=!0)},_a.prototype.toggle=function(e){this.element.style.display="viewSource"===e.member?"none":"block"},_a.prototype.addEventListener=function(){this.parent.on(n,this.renderCount,this),this.parent.on(ne,this.refresh,this),this.parent.on(We,this.refresh,this),this.parent.on(Y,this.refresh,this),this.parent.on(Ke,this.refresh,this),this.parent.on(o,this.destroy,this),this.parent.on(qe,this.toggle,this),this.parent.on(ze,this.toggle,this)},_a.prototype.removeEventListener=function(){this.parent.off(n,this.renderCount),this.parent.off(ne,this.refresh),this.parent.off(Y,this.refresh),this.parent.off(We,this.refresh),this.parent.off(Ke,this.refresh),this.parent.off(o,this.destroy),this.parent.off(qe,this.toggle),this.parent.off(ze,this.toggle)},_a.prototype.getModuleName=function(){return"count"};var za=_a;function _a(e,t){this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1}Qa.prototype.getLineNumber=function(e,t){return e.value.substr(0,t).split("\n").length},Qa.prototype.getSelectedText=function(e){var t=e.selectionStart,n=e.selectionEnd;return e.value.substring(t,n)},Qa.prototype.getAllParents=function(e){return e.split("\n")},Qa.prototype.getSelectedLine=function(e){return this.getAllParents(e.value)[this.getLineNumber(e,e.selectionStart)-1]},Qa.prototype.getLine=function(e,t){return this.getAllParents(e.value)[t]},Qa.prototype.getSelectedParentPoints=function(e){var t=this.getAllParents(e.value),n=this.getLineNumber(e,e.selectionStart),i=this.getLineNumber(e,e.selectionEnd),o=this.getSelectedText(e).split("\n"),r=[],e=t[n-1],s=t.slice(0,n-1).join("").length,a={};if(a.line=n-1,a.start=s+a.line,a.end=""!==e?a.start+e.length+1:a.start+e.length,a.text=e,r.push(a),1<o.length){for(var l=1;l<o.length-1;l++){var d={};d.line=r[l-1].line+1,d.start=(o[l],r[l-1].end),d.end=d.start+o[l].length+1,d.text=o[l],r.push(d)}n={};n.line=r[r.length-1].line+1,n.start=r[r.length-1].end,n.end=n.start+t[i-1].length+1,n.text=t[i-1],r.push(n)}return r},Qa.prototype.setSelection=function(e,t,n){e.setSelectionRange(t,n),e.focus()},Qa.prototype.save=function(e,t){this.selectionStart=e,this.selectionEnd=t},Qa.prototype.restore=function(e){this.setSelection(e,this.selectionStart,this.selectionEnd)},Qa.prototype.isStartWith=function(e,t){var n=!1,i=RegExp;return n=e?(e.trim()===t.trim()?new i("^("+this.replaceSpecialChar(t.trim())+")","gim"):new i("^("+this.replaceSpecialChar(t)+")","gim")).test(e.trim()):n},Qa.prototype.replaceSpecialChar=function(e){return e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"\\$&")},Qa.prototype.isClear=function(e,t){for(var n=RegExp,i=0;i<e.length;i++)if(new n(t,"gim").test(e[i].text))return!0;return!1},Qa.prototype.getSelectedInlinePoints=function(e){return{start:e.selectionStart,end:e.selectionEnd,text:this.getSelectedText(e)}};var Va=Qa;function Qa(){}Ka.prototype.addEventListener=function(){this.parent.on(X,this.onRefreshHandler,this),this.parent.on(o,this.removeEventListener,this)},Ka.prototype.removeEventListener=function(){this.parent.off(X,this.onRefreshHandler),this.parent.off(o,this.removeEventListener)},Ka.prototype.onRefreshHandler=function(e){var t=this.selection.getSelectedParentPoints(this.element),t=(this.toolbarStatus={orderedlist:!e.documentNode&&this.isListsApplied(t,"OL"),unorderedlist:!e.documentNode&&this.isListsApplied(t,"UL"),formats:this.currentFormat(t,e.documentNode),bold:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Bold"),italic:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Italic"),inlinecode:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode"),strikethrough:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("StrikeThrough"),subscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SubScript"),superscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SuperScript"),uppercase:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("UpperCase")},this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode")&&(this.toolbarStatus.formats="pre"),JSON.stringify(this.toolbarStatus));this.parent.notify(J,this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==t&&(this.parent.notify(Vt,{html:null,markdown:JSON.parse(t)}),this.prevToolbarStatus=JSON.parse(t))},Ka.prototype.isListsApplied=function(e,t){var n=!0;if("OL"===t)for(var i=0;i<e.length;i++){var o=e[i].text.trim().split(" ",2)[0]+" ";if(!/^[\d.]+[ ]+$/.test(o)){n=!1;break}}else for(i=0;i<e.length;i++)if(!this.selection.isStartWith(e[i].text,this.parent.formatter.listTags[""+t])){n=!1;break}return n},Ka.prototype.currentFormat=function(e,t){for(var n="p",i=Object.keys(this.parent.formatter.formatTags),o=("backward"===this.element.selectionDirection?e[0]:e[e.length-1]).text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(o,this.parent.formatter.formatTags[i[r]])){n=i[r];break}if("pre"===i[r]&&this.codeFormat()){n=i[r];break}}return n},Ka.prototype.codeFormat=function(){var t,e=!1,n=this.parent.inputElement,i=n.selectionStart,i=(t=i,function(e){return[e.slice(0,t),e.slice(t)]}(n.value)),o=this.parent.formatter.formatTags.pre,r=this.getSelectedText(n);if(""!==r&&r===r.toLocaleUpperCase())return!0;if(""===r){r=n.value.substr(i[0].length-1,1),n=i[1].substr(0,1);if(""!==r&&""!==n&&r.match(/[a-z]/i)&&r===r.toLocaleUpperCase()&&n===n.toLocaleUpperCase())return!0}return e=this.isCode(i[0],o)&&this.isCode(i[1],o)&&i[0].match(this.multiCharRegx(o)).length%2==1&&i[1].match(this.multiCharRegx(o)).length%2==1?!0:e},Ka.prototype.getSelectedText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},Ka.prototype.isCode=function(e,t){return-1!==e.search("\\"+t)},Ka.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+")","g")};var Wa=Ka;function Ka(e){this.toolbarStatus=this.prevToolbarStatus={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,uppercase:!1,lowercase:!1,inlinecode:!1,unorderedlist:!1,formats:null},this.selection=new Va,this.parent=e,this.element=this.parent.contentModule.getEditPanel(),this.addEventListener()}Xa.prototype.addEventListener=function(){this.parent.on(pe,this.commandCallBack,this),this.parent.on(o,this.removeEventListener,this)},Xa.prototype.commandCallBack=function(e){var t=!j.isNullOrUndefined(e.requestType)&&"FormatPainter"===e.requestType&&"format-copy"===e.action;j.isNullOrUndefined(e)||j.isNullOrUndefined(e.requestType)||"Undo"===e.requestType||"Redo"===e.requestType||t||this.parent.formatter.saveData(),this.parent.notify(X,{args:e}),this.parent.notify(We,{})},Xa.prototype.removeEventListener=function(){this.parent.off(pe,this.commandCallBack),this.parent.off(o,this.removeEventListener)};var Ga=Xa;function Xa(e){this.parent=e,this.addEventListener()}Ja.prototype.process=function(i,o,r,s){var a,t,l=this,e=i.contentModule.getDocument().getSelection(),e=0<e.rangeCount?e.getRangeAt(e.rangeCount-1):null,d=(j.isNullOrUndefined(s)||j.isNullOrUndefined(s.selection)||(n=s.selection.range),!j.isNullOrUndefined(s)&&!j.isNullOrUndefined(s.cssClass)&&"e-video-inline"!==s.cssClass);if("HTML"!==i.editorMode||j.isNullOrUndefined(o)||d||(j.isNullOrUndefined(o.name)||!j.isNullOrUndefined(o.name)&&"showDialog"!==o.name)&&(a=n?this.editorManager.nodeSelection.save(n,i.contentModule.getDocument()):this.editorManager.nodeSelection.save(e,i.contentModule.getDocument())),j.isNullOrUndefined(o)||!o.item.command||"Table"===o.item.command||"Actions"===o.item.command||"Links"===o.item.command||"Images"===o.item.command||"Files"===o.item.command||"Audios"===o.item.command||"Videos"===o.item.command||"EmojiPicker"===o.item.command||!e||i.contentModule.getEditPanel().contains(this.getAncestorNode(e.commonAncestorContainer))||i.contentModule.getEditPanel()===e.commonAncestorContainer||i.contentModule.getPanel()===e.commonAncestorContainer){if(!j.isNullOrUndefined(o)&&-1!==i.maxLength&&!j.isNullOrUndefined(o.item.command)){var n=0,e=("Links"===o.item.command&&(n=(0===s.text.length?s.url:s.text).length),"Images"!==o.item.command&&"Videos"!==o.item.command&&"Table"!==o.item.command&&"Files"!==o.item.command||(n=1),i.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length),c=i.getSelection().length;if(!(-1===i.maxLength||e-c+n<=i.maxLength))return}j.isNullOrUndefined(o)?(t=r.action,e={originalEvent:r,cancel:!(o={}),requestType:t||r.key+"Key",itemCollection:s},j.extend(o,o,e,!0),"tab"!==t&&"enter"!==t&&"space"!==t&&"escape"!==t&&("Markdown"===i.editorMode&&"insert-table"===t&&(s={headingText:i.localeObj.getConstant("TableHeadingText"),colText:i.localeObj.getConstant("TableColText")}),i.trigger(Oe,o,function(e){!e.cancel||"paste"!==t&&"cut"!==t&&"copy"!==t||r.preventDefault()})),!o.cancel&&(c=!!j.isNullOrUndefined(i.tableModule)||!!i.tableModule&&i.tableModule.ensureInsideTableList,9===r.which&&c||9!==r.which)&&(13===r.which&&"HTML"===i.editorMode&&(s={enterAction:i.enterKey}),this.editorManager.observer.notify("keydown"===r.type?Vs:Xs,{event:r,callBack:this.onSuccess.bind(this,i),value:s,enterAction:i.enterKey}))):!j.isNullOrUndefined(o)&&o.item.command&&o.item.subCommand&&(o.item.command!==o.item.subCommand&&"Font"!==o.item.command&&"Export"!==o.item.command||("FontName"===o.item.subCommand||"FontSize"===o.item.subCommand)&&"dropDownSelect"===o.name||("BackgroundColor"===o.item.subCommand||"FontColor"===o.item.subCommand)&&"colorPickerChanged"===o.name||"FormatPainter"===o.item.subCommand||"EmojiPicker"===o.item.subCommand)&&(j.extend(o,o,{requestType:o.item.subCommand,cancel:!1,itemCollection:s,selectType:o.name},!0),i.trigger(Oe,o,function(e){var t,n;e.cancel||(t=!j.isNullOrUndefined(e.requestType)&&"FormatPainter"===e.requestType&&"format-copy"===e.name,n=!j.isNullOrUndefined(e.requestType)&&"FormatPainter"===e.requestType&&"format-paste"===e.name,(0===l.getUndoRedoStack().length&&"Links"!==e.item.command&&"Images"!==e.item.command&&!t||n)&&l.saveData(),i.isBlur=!1,t=!(j.isNullOrUndefined(r)||j.isNullOrUndefined(r.target)||j.isNullOrUndefined(j.closest(r.target,".e-rte-elements.e-dropdown-popup.e-rte-dropdown-popup.e-quick-dropdown.e-popup-open"))&&j.isNullOrUndefined(j.closest(r.target,".e-rte-elements.e-rte-quick-popup.e-popup-open"))),!j.isNullOrUndefined(a)&&(t||!j.isNullOrUndefined(j.closest(a.range.startContainer.parentElement,".e-img-caption"))&&"false"===j.closest(a.range.startContainer.parentElement,".e-img-caption").getAttribute("contenteditable"))||i.contentModule.getEditPanel().focus(),"HTML"!==i.editorMode||d||(j.isNullOrUndefined(o.selectType)||!j.isNullOrUndefined(o.selectType)&&"showDialog"!==o.selectType)&&a.restore(),"image"===(n=e.item.subCommand.toLocaleLowerCase())&&(s=e.itemCollection),"paste"===n||"cut"===n||"copy"===n?i.clipboardAction(n,r):(l.editorManager.observer.notify(ct,{subCommand:e.item.subCommand}),l.editorManager.execCommand(e.item.command,e.item.subCommand,r,l.onSuccess.bind(l,i),e.item.value,"Pre"===e.item.subCommand&&"dropDownSelect"===e.selectType?{name:e.selectType}:s,"#"+i.getID()+" iframe",i.enterKey)))})),(j.isNullOrUndefined(r)||r&&"copy"!==r.action)&&this.enableUndo(i)}},Ja.prototype.getAncestorNode=function(e){return e=3===e.nodeType?e.parentNode:e},Ja.prototype.onKeyHandler=function(e,t){var n=this;this.editorManager.observer.notify(Xs,{event:t,callBack:function(){e.notify(W,{}),n.enableUndo(e)},enterAction:e.enterKey})},Ja.prototype.onSuccess=function(t,e){t.notify(W,{}),e&&(j.isNullOrUndefined(e.event)||"copy"!==e.event.action)&&(this.enableUndo(t),t.notify(pe,e)),t.trigger(Le,e,function(e){if(t.setPlaceHolder(),("Images"===e.requestType||"Links"===e.requestType||"Audios"===e.requestType||"Videos"===e.requestType)&&"HTML"===t.editorMode){if("Links"===e.requestType&&e.event&&"keydown"===e.event.type&&32===e.event.keyCode)return;t.notify(Be,{args:e.event,type:e.requestType,isNotify:!0,elements:e.elements})}"VideosPlayPause"===e.requestType&&t.notify("editAreaClick",{args:event}),t.autoResize()})},Ja.prototype.saveData=function(e){this.editorManager.undoRedoManager.saveData(e)},Ja.prototype.getUndoStatus=function(){return this.editorManager.undoRedoManager.getUndoStatus()},Ja.prototype.getUndoRedoStack=function(){return this.editorManager.undoRedoManager.undoRedoStack},Ja.prototype.enableUndo=function(e){var t=this.getUndoStatus();!e.inlineMode.enable||j.Browser.isDevice&&!br()?e.toolbarModule&&e.toolbarModule.baseToolbar&&Tr(e.toolbarModule.baseToolbar,t):Tr(e.quickToolbarModule.inlineQTBar.quickTBarObj,t)},Ja.prototype.beforeSlashMenuApply=function(){this.editorManager.beforeSlashMenuApplyFormat()};var Ya=Ja;function Ja(){}var $a="lists-commands",Za="command-type",el="link-commands",tl="clear-commands",nl="insert-table",il="insert-text",ol=(rl.prototype.addEventListener=function(){this.parent.observer.on($a,this.applyListsHandler,this),this.parent.observer.on(m,this.keyDownHandler,this),this.parent.observer.on(Gs,this.keyUpHandler,this),this.parent.observer.on(f,this.destroy,this)},rl.prototype.removeEventListener=function(){this.parent.observer.off($a,this.applyListsHandler),this.parent.observer.off(m,this.keyDownHandler),this.parent.observer.off(Gs,this.keyUpHandler),this.parent.observer.off(f,this.destroy)},rl.prototype.keyDownHandler=function(e){switch(9===e.event.which&&this.tabKey(e),e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()}},rl.prototype.keyUpHandler=function(e){13===e.event.which&&this.enterKey(e)},rl.prototype.tabKey=function(e){var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),t.selectionStart),i=t.selectionEnd,o=this.selection.getSelectedParentPoints(t),r=0,s=this.isNotFirstLine(t,o[0]);if(s||e.event.shiftKey){var a=this.olListType(),l=this.getListRegex();this.currentAction=this.getAction(o[0].text);for(var d=0;d<o.length;d++){e.event.shiftKey;var c=o[d].line-1;if((b=this.selection.getLine(t,c))&&(!e.event.shiftKey&&s||e.event.shiftKey)){var h=b.split(". "),p=e.event.shiftKey?-"\t".length:"\t".length,u=o[d].text.split("\t");if(e.event.shiftKey&&1===u.length)break;if("OL"===this.currentAction&&/^\d+$/.test(h[0].trim())&&a){e.event.preventDefault(),o[d].text=e.event.shiftKey?u.splice(1,u.length).join("\t"):"\t"+o[d].text;var m=this.getTabSpace(o[d].text),g=this.getTabSpace(b),f=o[d].text.split(". ");if(m===g)this.changeTextAreaValue(f,this.nextOrderedListValue(h[0].trim()),e,t,o,d,i);else if(g<m)this.changeTextAreaValue(f,"1. ",e,t,o,d,i);else for(;g.length>m.length;){c-=1;var b,y=(b=this.selection.getLine(t,c)).trim().split(". ");if(/^\d+$/.test(y[0])&&(g=this.getTabSpace(b)).length<=m.length){this.changeTextAreaValue(f,this.nextOrderedListValue(y[0]),e,t,o,d,i);break}}}else("UL"===this.currentAction&&l.test(b.trim())||!a)&&(e.event.preventDefault(),o[d].text=e.event.shiftKey?u.splice(1,u.length).join("\t"):"\t"+o[d].text,t.value=t.value.substr(0,o[d].start)+o[d].text+"\n"+t.value.substr(o[d].end,t.value.length));if(n=0===d?n+p:n,r+=p,1!==o.length)for(var v=d;v<o.length;v++)o[v].start=0!==v?o[v].start+p:o[v].start,o[v].end=o[v].end+p}}}this.restore(t,n,i+r,e)},rl.prototype.changeTextAreaValue=function(e,t,n,i,o,r,s){e.splice(0,1);for(var a,l=this.selection.getAllParents(i.value).length,d="",c=this.getTabSpace(o[r].text),h=parseInt(t.split(".")[0],null),p=this.getTabSpace(o[r].text),u=!0,m=!0,g=-1,f=!0,b=0,d=""!==this.selection.getLine(i,o[0].line+1)?"":d+i.value.substr(o[0].end,i.value.length),y=1;y<l&&!j.isNullOrUndefined(this.selection.getLine(i,o[0].line+y))&&""!==this.selection.getLine(i,o[0].line+y);y++){var v=this.selection.getLine(i,o[0].line+y),C=this.getTabSpace(v),N=v.split(". ");if(1===N.length){d+=i.value.substr(o[0].end+b,i.value.length);break}b+=v.length;var E,S=!1,T=n.event.shiftKey?c.length+1:c.length-1;C.length>p.length&&(f=!1),c.length!==C.length&&C.length<p.length?(u=!(m=!0),S=!(!n.event.shiftKey||c.length!==C.length||(m=!1))):f&&n.event.shiftKey&&c.length===C.length&&C.length===p.length&&(S=!(m=!1)),a=""===d?"":"\n",T===C.length&&m?(E=n.event.shiftKey?(g++,this.nextOrderedListValue(g.toString())):this.previousOrderedListValue(N[0]),N.splice(0,1),d=d+a+C+E+N.join(". ")):c.length===C.length&&u||S?(E=this.nextOrderedListValue(h.toString()),h++,N.splice(0,1),d=d+a+C+E+N.join(". ")):(d=d+a+v,m=!1),p=this.getTabSpace(v)}o[r].text=this.getTabSpace(o[r].text)+t+e.join(". ")+"\n",i.value=i.value.substr(0,o[r].start)+o[r].text+d},rl.prototype.getTabSpace=function(e){for(var t=e.split("\t"),n="",i=0;i<t.length&&""===t[i];i++)n+="\t";return n},rl.prototype.isNotFirstLine=function(e,t){var n,i=t.text,o=t.line-1,r=this.selection.getLine(e,o),s=this.getListRegex(),a=!1;if(r&&(this.currentAction=this.getAction(r),c=r.split(". "),n="OL"===this.currentAction?/^\d+$/.test(c[0].trim()):s.test(r.trim())),r&&n)for(var l=this.getTabSpace(i),d=this.getTabSpace(r),a=l===d||a;d.length>l.length;){o-=1;var c=(r=this.selection.getLine(e,o)).trim().split(". "),h="OL"===this.currentAction?/^\d+$/.test(c[0]):s.test(r.trim());if(h&&(d=this.getTabSpace(r)).length<=l.length){a=!0;break}}return a},rl.prototype.getAction=function(e){var t=e.split(". ")[0],t=/^\d+$/.test(t.trim()),e=e.trim().split(new RegExp("^("+this.selection.replaceSpecialChar(this.syntax.UL).trim()+")"))[1];return t?"OL":e?"UL":"NOTLIST"},rl.prototype.nextOrderedListValue=function(e){return(parseInt(e,null)+1).toString()+". "},rl.prototype.previousOrderedListValue=function(e){return(parseInt(e,null)-1).toString()+". "},rl.prototype.enterKey=function(e){var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),t.selectionStart),i=t.selectionEnd,o=this.selection.getSelectedParentPoints(t),r=this.selection.getLine(t,o[0].line-1),s=this.olListType(),a=this.getListRegex(),l=[],d=(j.isNullOrUndefined(r)||(l=r.split(". "),this.currentAction=this.getAction(r)),0);if("OL"===this.currentAction&&1<l.length&&/^\d+$/.test(l[0].trim())&&s&&""!==l[1]){for(var c=this.getTabSpace(r),h=(this.currentAction=this.getAction(r),this.nextOrderedListValue(l[0])),p=(o[0].text=c+h+o[0].text,this.selection.getAllParents(t.value).length),u="\n",m=this.getTabSpace(r),g=this.getTabSpace(o[0].text),f=!0,b=1;b<p&&""!==t.value.substr(o[0].end,t.value.length);b++){var y,v,C,N=this.selection.getLine(t,o[0].line+b);j.isNullOrUndefined(N)?u+="":(y=N.split(". "),(v=this.getTabSpace(N)).length<g.length&&(f=!1),1<y.length&&/^\d+$/.test(y[0].trim())&&m.length===v.length&&f?(C=this.nextOrderedListValue(y[0]),y.splice(0,1),u=u+v+C+y.join(". ")+"\n"):(u=u+N+"\n",g=this.getTabSpace(N)))}t.value=t.value.substr(0,o[0].start)+m+h+this.selection.getLine(t,o[0].line)+u,n=n+h.length+c.length,d+=h.length+c.length}else("UL"===this.currentAction&&r&&a.test(r.trim())&&""!==r.trim().replace(a,"")||"OL"===this.currentAction&&!s)&&(c=this.getTabSpace(r),h=this.syntax[this.currentAction],o[0].text=c+h+o[0].text+(0<o[0].text.trim().length?"\n":""),t.value=t.value.substr(0,o[0].start)+o[0].text+t.value.substr(o[0].end,t.value.length),n=n+h.length+c.length,d+=h.length+c.length);this.restore(t,n,i+d,e)},rl.prototype.olListType=function(){var e=this.syntax.OL.split(".,");return(1===e.length?null:parseInt(e[2].trim(),null)-parseInt(e[0].trim(),null))?1:0},rl.prototype.applyListsHandler=function(e){for(var t,n=this.parent.element,i=(this.selection.save(n.selectionStart,n.selectionEnd),this.currentAction=e.subCommand,n.selectionStart),o=n.selectionEnd,r=0,s=0,a=this.selection.getSelectedParentPoints(n),l="",d=this.olListType(),c={},h=0;h<a.length;h++)if(t=d?"OL"===this.currentAction?h+d+". ":this.syntax[this.currentAction]:"OL"===this.currentAction?this.syntax.OL:this.syntax[this.currentAction],this.selection.isStartWith(a[h].text,t))a[h].text=a[h].text.replace(t,""),n.value=n.value.substr(0,a[h].start+s)+a[h].text+"\n"+n.value.substr(a[h].end+s,n.value.length),s-=t.length,u=t.length,this.restore(n,i-u,o+s,null);else{if(""===a[h].text&&0===h&&(this.selection.save(i,o),1!==a.length))for(var p=h;p<a.length;p++)a[p].start=0!==p?1+a[p].start:a[p].start,a[p].end=1+a[p].end;var u=j.isNullOrUndefined(a[h-1])?0:this.getTabSpace(a[h-1].text).length,m=this.appliedLine(a[h].text,t,c,u),l=m.line?l:t;if(a[h].text=m.line||l+a[h].text,m.space=m.space||0,n.value=n.value.substr(0,a[h].start+s)+a[h].text+"\n"+n.value.substr(a[h].end,n.value.length),i=0===h?0<i+l.length+m.space?i+l.length+m.space:0:i,r+=l.length+m.space,1!==a.length)for(p=h;p<a.length;p++)a[p].start=0!==p?l.length+a[p].start+m.space:a[p].start,a[p].end=l.length+a[p].end+m.space;this.restore(n,i,o+r,null)}this.restore(n,null,null,e)},rl.prototype.appliedLine=function(e,t,n,i){var o={},r=new RegExp("^["+this.syntax.UL.trim()+"]"),s=e.split(". "),a=s[0]+". ",l=r.test(e.trim())||e.trim()===this.syntax.OL.trim()||e.trim()===this.syntax.UL.trim()||/^\d+$/.test(s[0].trim()),d=this.olListType(),c=this.getTabSpace(e).length;return"OL"===this.currentAction&&d&&(n[c.toString()]=j.isNullOrUndefined(n[c.toString()])?1:n[c.toString()].valueOf()+1,t=n[c.toString()].valueOf().toString()+". ",!j.isNullOrUndefined(i))&&c<i&&(n[i.toString()]=0),l&&(n=c=void 0,r.test(e.trim())?(n=this.syntax.UL,c=t,o.space=t.trim().length-this.syntax.UL.trim().length):/^\d+$/.test(s[0].trim())&&d?(n=s[0].trim()+". ",c=t,o.space=this.syntax.UL.trim().length-a.trim().length):/^\d+$/.test(s[0].trim())&&(n=s[0].trim()+". ",c=this.syntax.UL,o.space=this.syntax.UL.trim().length-a.trim().length),o.line=e.replace(n,c)),o},rl.prototype.restore=function(e,t,n,i){j.isNullOrUndefined(t)||j.isNullOrUndefined(t)||this.selection.save(t,n),j.isNullOrUndefined(i)||this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},rl.prototype.getListRegex=function(){for(var e="",t=Object.keys(this.syntax),n=RegExp,i=0;i<t.length;i++){var o=this.selection.replaceSpecialChar(this.syntax[t[i]]);e+=""===e?"^("+o+")|^("+o.trim()+")":"|^("+o+")|^("+o.trim()+")"}return new n(e)},rl.prototype.destroy=function(){this.removeEventListener()},rl);function rl(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}al.prototype.addEventListener=function(){this.parent.observer.on(Ws,this.applyFormats,this),this.parent.observer.on(f,this.destroy,this)},al.prototype.removeEventListener=function(){this.parent.observer.off(Ws,this.applyFormats),this.parent.observer.off(f,this.destroy)},al.prototype.applyFormats=function(e){e.subCommand=e.subCommand.toLowerCase();var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),this.selection.getSelectedParentPoints(t));if(this.isAppliedFormat(n)===e.subCommand){if("pre"===e.subCommand){if(!(1<n.length))return;this.applyCodeBlock(t,e,n)}this.cleanFormat(t),this.restore(t,t.selectionStart,t.selectionEnd,e)}else if("p"===e.subCommand)this.cleanFormat(t),this.restore(t,t.selectionStart,t.selectionEnd,e);else{("pre"===e.subCommand&&1!==n.length||"pre"!==e.subCommand)&&this.cleanFormat(t,e.subCommand);var i=t.selectionStart,o=t.selectionEnd,r=0,n=this.selection.getSelectedParentPoints(t);if("pre"===e.subCommand)1<n.length?this.applyCodeBlock(t,e,n):(j.extend(e,e,{subCommand:"InlineCode"},!0),this.parent.observer.notify(Za,e));else{for(var s=0;s<n.length;s++)if(""===n[s].text||this.selection.isStartWith(n[s].text,"\\"+this.syntax[e.subCommand])){if(""===n[s].text&&0===s&&(this.selection.save(i,o),0===this.selection.getSelectedText(t).length&&(n[s].text=this.syntax[e.subCommand],t.value=t.value.substr(0,n[s].start)+this.syntax[e.subCommand]+t.value.substr(n[s].end,t.value.length),i=0===s?i+this.syntax[e.subCommand].length:i,r+=this.syntax[e.subCommand].length),1!==n.length))for(a=s;a<n.length;a++)n[a].start=0!==a?1+n[a].start:n[a].start,n[a].end=1+n[a].end}else if(n[s].text=this.syntax[e.subCommand]+n[s].text,t.value=t.value.substr(0,n[s].start)+n[s].text+"\n"+t.value.substr(n[s].end,t.value.length),i=0===s?i+this.syntax[e.subCommand].length:i,r+=this.syntax[e.subCommand].length,1!==n.length)for(var a=s;a<n.length;a++)n[a].start=0!==a?this.syntax[e.subCommand].length+n[a].start:n[a].start,n[a].end=this.syntax[e.subCommand].length+n[a].end;this.restore(t,i,o+r,e)}}},al.prototype.clearRegex=function(){for(var e="",t=Object.keys(this.syntax),n=0;n<t.length&&"pre"!==t[n]&&"p"!==t[n];n++)e+=""===e?"^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")":"|^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")";return e},al.prototype.cleanFormat=function(e,t){var n=this.selection.getSelectedParentPoints(e),i=e.selectionStart,o=e.selectionEnd,r=0;if(this.selection.isClear(n,this.clearRegex())){for(var s=0;s<n.length;s++){for(var a=Object.keys(this.syntax),l=0;""!==n[s].text&&l<a.length;l++){var d=this.syntax[a[l]];if(a[l]!==t){var c=new RegExp("^("+this.selection.replaceSpecialChar(d)+")","gim");if(c.test(n[s].text)){if(n[s].text=n[s].text.replace(c,""),e.value=e.value.substr(0,n[s].start)+n[s].text+"\n"+e.value.substr(n[s].end,e.value.length),i=0===s?0<i-d.length?i-d.length:0:i,r+=d.length,1!==n.length)for(var h=0;h<n.length;h++)n[h].start=0!==h?n[h].start-d.length:n[h].start,n[h].end=n[h].end-d.length;break}}}if(""===n[s].text&&0===s&&(this.selection.save(i,o),1!==n.length))for(l=s;l<n.length;l++)n[l].start=0!==l?1+n[l].start:n[l].start,n[l].end=1+n[l].end}this.restore(e,i,o-r)}},al.prototype.applyCodeBlock=function(e,t,n){var i,o=t.subCommand,r=n[0].start,s=n[n.length-1].end,a=this.selection.getAllParents(e.value),l=a[n[0].line-1],a=a[n.length+1+1],s=this.selection.isStartWith(l,this.syntax.pre.split("\n")[0])||this.selection.isStartWith(a,this.syntax.pre.split("\n")[0])?(n=this.syntax[""+o],l=this.parent.markdownSelection.getSelectedInlinePoints(e),a=e.value.substr(0,e.selectionStart).lastIndexOf(n),i=e.value.substr(e.selectionEnd,e.selectionEnd).indexOf(n),i+=l.end,a=this.replaceAt(e.value.substr(0,l.start),n,"",a,l.start),i=this.replaceAt(e.value.substr(l.end,e.value.length),n,"",0,i),e.value=a+l.text+i,r=this.selection.selectionStart-n.length,this.selection.selectionEnd-n.length):(l=""===(a=e.value.substring(r,s).split("\n"))[a.length-1]?"":"\n",e.value=e.value.substr(0,r)+this.syntax[""+o]+e.value.substring(r,s)+l+this.syntax[""+o]+e.value.substr(s,e.value.length),r=this.selection.selectionStart+this.syntax[""+o].length,this.selection.selectionEnd+this.syntax[""+o].length-1);this.restore(e,r,s,t)},al.prototype.replaceAt=function(e,t,n,i,o){return e.slice(0,i)+e.slice(i,o).replace(t,n)+e.slice(o)},al.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},al.prototype.isAppliedFormat=function(e,t){for(var n="p",i=(Object.keys(this.syntax),Object.keys(this.syntax)),o=("backward"===this.parent.element.selectionDirection?e[0]:e[e.length-1]).text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(o,this.syntax[i[r]])){n=i[r];break}if("pre"===i[r]){var s=this.selection.getAllParents(this.parent.element.value),a=s[e[0].line-1],s=s[e.length+1];if(this.selection.isStartWith(a,this.syntax[i[r]].split("\n")[0])&&this.selection.isStartWith(s,this.syntax[i[r]].split("\n")[0])){n=i[r];break}}}return n},al.prototype.destroy=function(){this.removeEventListener()};var sl=al;function al(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}dl.prototype.addEventListener=function(){this.parent.observer.on(Za,this.applyCommands,this),this.parent.observer.on(m,this.keyDownHandler,this),this.parent.observer.on(f,this.destroy,this)},dl.prototype.removeEventListener=function(){this.parent.observer.off(Za,this.applyCommands),this.parent.observer.off(m,this.keyDownHandler),this.parent.observer.off(f,this.destroy)},dl.prototype.keyDownHandler=function(e){switch(e.event.action){case"bold":this.applyCommands({subCommand:"Bold",callBack:e.callBack}),e.event.preventDefault();break;case"italic":this.applyCommands({subCommand:"Italic",callBack:e.callBack}),e.event.preventDefault();break;case"strikethrough":this.applyCommands({subCommand:"StrikeThrough",callBack:e.callBack}),e.event.preventDefault();break;case"uppercase":this.applyCommands({subCommand:"UpperCase",callBack:e.callBack}),e.event.preventDefault();break;case"lowercase":this.applyCommands({subCommand:"LowerCase",callBack:e.callBack}),e.event.preventDefault();break;case"superscript":this.applyCommands({subCommand:"SuperScript",callBack:e.callBack}),e.event.preventDefault();break;case"subscript":this.applyCommands({subCommand:"SubScript",callBack:e.callBack}),e.event.preventDefault()}},dl.prototype.isBold=function(e,t){return-1!==e.search("\\"+t+"\\"+t)},dl.prototype.isItalic=function(e,t){return-1!==e.search("\\"+t)},dl.prototype.isMatch=function(e,t){var n=[""];switch(t){case this.syntax.Italic:case this.syntax.InlineCode:case this.syntax.StrikeThrough:n=e.match(this.singleCharRegx(t))}return n},dl.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+"\\"+e+")","g")},dl.prototype.singleCharRegx=function(e){return new RegExp("(\\"+e+")","g")},dl.prototype.isAppliedCommand=function(e){var t,n=!1,i=this.parent.element,o=i.selectionStart,o=(t=o,function(e){return[e.slice(0,t),e.slice(t)]}(i.value)),r=this.syntax.Bold.substr(0,1),s=this.syntax.Italic,a=this.parent.markdownSelection.getSelectedText(i);if(""!==a&&a===a.toLocaleUpperCase()&&"UpperCase"===e)return!0;if(""===a){a=i.value.substr(o[0].length-1,1),i=o[1].substr(0,1);if(""!==a&&""!==i&&a.match(/[a-z]/i)&&a===a.toLocaleUpperCase()&&i===i.toLocaleUpperCase()&&"UpperCase"===e)return!0}return this.isBold(o[0],r)||this.isItalic(o[0],s)||this.isBold(o[1],r)||this.isItalic(o[1],s)||(j.isNullOrUndefined(this.isMatch(o[0],this.syntax.StrikeThrough))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.StrikeThrough))||this.isMatch(o[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(o[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),j.isNullOrUndefined(this.isMatch(o[0],this.syntax.InlineCode))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.InlineCode))||this.isMatch(o[0],this.syntax.InlineCode).length%2!=1||this.isMatch(o[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),j.isNullOrUndefined(o[0].match(/\<sub>/g))||j.isNullOrUndefined(o[1].match(/\<\/sub>/g))||o[0].match(/\<sub>/g).length%2!=1||o[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),j.isNullOrUndefined(o[0].match(/\<sup>/g)))||j.isNullOrUndefined(o[1].match(/\<\/sup>/g))||o[0].match(/\<sup>/g).length%2!=1||o[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e||(n=!0),this.isBold(o[0],r)&&this.isBold(o[1],r)&&o[0].match(this.multiCharRegx(r)).length%2==1&&o[1].match(this.multiCharRegx(r)).length%2==1&&"Bold"===e&&(n=!0),o[0]=this.isBold(o[0],r)?o[0].replace(this.multiCharRegx(r),"$%@"):o[0],o[1]=this.isBold(o[1],r)?o[1].replace(this.multiCharRegx(r),"$%@"):o[1],j.isNullOrUndefined(this.isMatch(o[0],this.syntax.Italic))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.Italic))||this.isMatch(o[0],this.syntax.Italic).length%2!=1||this.isMatch(o[1],this.syntax.Italic).length%2!=1||"Italic"!==e||(n=!0),j.isNullOrUndefined(this.isMatch(o[0],this.syntax.StrikeThrough))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.StrikeThrough))||this.isMatch(o[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(o[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),j.isNullOrUndefined(this.isMatch(o[0],this.syntax.InlineCode))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.InlineCode))||this.isMatch(o[0],this.syntax.InlineCode).length%2!=1||this.isMatch(o[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),j.isNullOrUndefined(o[0].match(/\<sub>/g))||j.isNullOrUndefined(o[1].match(/\<\/sub>/g))||o[0].match(/\<sub>/g).length%2!=1||o[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),n=j.isNullOrUndefined(o[0].match(/\<sup>/g))||j.isNullOrUndefined(o[1].match(/\<\/sup>/g))||o[0].match(/\<sup>/g).length%2!=1||o[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e?n:!0},dl.prototype.applyCommands=function(e){this.currentAction=e.subCommand;var t,n,i,o,r,s=this.parent.element,a=(this.selection.save(s.selectionStart,s.selectionEnd),s.selectionStart),l=s.selectionEnd,d=0,c=this.parent.markdownSelection.getSelectedInlinePoints(s);this.isAppliedCommand(e.subCommand)&&""!==c.text?(o=this.syntax[e.subCommand],i="SubScript"===e.subCommand?"</sub>":"SuperScript"===e.subCommand?"</sup>":this.syntax[e.subCommand],t="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:o.length,r=s.value.substr(0,c.start).lastIndexOf(o),n=s.value.substr(c.end,s.value.length).indexOf(i),n+=c.end,o=this.replaceAt(s.value.substr(0,c.start),o,"",r,c.start),r=this.replaceAt(s.value.substr(c.end,s.value.length),i,"",0,n),s.value=o+c.text+r,this.restore(s,a-t,l-t,e)):(""===c.text||this.isApplied(c,e.subCommand)?"UpperCase"!==e.subCommand&&"LowerCase"!==e.subCommand?("SubScript"===e.subCommand||"SuperScript"===e.subCommand?(c.text=this.textReplace(c.text,e.subCommand),c.text=this.syntax[e.subCommand]+c.text+"</"+this.syntax[e.subCommand].substring(1,5)):(c.text=this.textReplace(c.text,e.subCommand),c.text=this.syntax[e.subCommand]+c.text+this.syntax[e.subCommand]),s.value=s.value.substr(0,c.start)+c.text+s.value.substr(c.end,s.value.length),d=this.syntax[e.subCommand].length,c.start===c.end?this.restore(s,a+d,l+d,e):this.restore(s,a+d,l-d,e)):this.restore(s,a,l,e):(d="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:this.syntax[e.subCommand].length,i=void 0,(n=s.value.substr(c.start-this.syntax[e.subCommand].length,this.syntax[e.subCommand].length))===e.subCommand||c.start-this.syntax[e.subCommand].length===s.value.indexOf(this.syntax[e.subCommand])&&(c.end===s.value.lastIndexOf(this.syntax[e.subCommand])||c.end===s.value.lastIndexOf("</"+this.syntax[e.subCommand].substring(1,5)))?(i="SubScript"===e.subCommand||"SuperScript"===e.subCommand?s.value.substr(c.end,this.syntax[e.subCommand].length+1):s.value.substr(c.end,this.syntax[e.subCommand].length),o=this.replaceAt(s.value.substr(0,c.start),n,"",c.start-this.syntax[e.subCommand].length,c.start),r=this.replaceAt(s.value.substr(c.end,s.value.length),i,"",0,i.length),s.value=o+c.text+r,this.restore(s,a-d,l-d,e)):("SubScript"===e.subCommand||"SuperScript"===e.subCommand?c.text=this.syntax[e.subCommand]+c.text+"</"+this.syntax[e.subCommand].substring(1,5):"UpperCase"===e.subCommand||"LowerCase"===e.subCommand?c.text="UpperCase"===e.subCommand?c.text.toUpperCase():c.text.toLowerCase():c.text=this.syntax[e.subCommand]+c.text+this.syntax[e.subCommand],s.value=s.value.substr(0,c.start)+c.text+s.value.substr(c.end,s.value.length),this.restore(s,a+d,l+d,e))),this.parent.undoRedoManager.saveData())},dl.prototype.replaceAt=function(e,t,n,i,o){return e.slice(0,i)+e.slice(i,o).replace(t,n)+e.slice(o)},dl.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},dl.prototype.textReplace=function(e,t){var n,i,o=this.singleCharRegx(this.syntax[""+t]);switch(t){case"Bold":o=this.multiCharRegx(this.syntax[""+t].substr(0,1)),e=e.replace(o,"");break;case"Italic":e=this.isBold(e,this.syntax[""+t].substr(0,1))?(i=this.multiCharRegx(this.syntax[""+t].substr(0,1)),n=(n=e).replace(i,"$%@").replace(o,""),i=new RegExp("\\$%@","g"),n.replace(i,this.syntax[""+t].substr(0,1)+this.syntax[""+t].substr(0,1))):e.replace(o,"");break;case"StrikeThrough":case"InlineCode":e=e.replace(o,"");break;case"SubScript":e=e.replace(/<sub>/g,"").replace(/<\/sub>/g,"");break;case"SuperScript":e=e.replace(/<sup>/g,"").replace(/<\/sup>/g,"")}return e},dl.prototype.isApplied=function(e,t){var n=this.singleCharRegx(this.syntax[""+t]);switch(t){case"SubScript":case"SuperScript":return(n=this.singleCharRegx(this.syntax[""+t])).test(e.text);case"Bold":case"StrikeThrough":return(n=this.multiCharRegx(this.syntax[""+t].substr(0,1))).test(e.text);case"UpperCase":case"LowerCase":return(n=new RegExp("^["+this.syntax[""+t]+"]*$","g")).test(e.text);case"Italic":var i,o=this.multiCharRegx(this.syntax[""+t].substr(0,1));return o.test(e.text)?(i=(i=e.text).replace(o,"$%#"),n.test(i)):n.test(e.text);case"InlineCode":return n.test(e.text)}},dl.prototype.destroy=function(){this.removeEventListener()};var ll=dl;function dl(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}hl.prototype.addEventListener=function(){var e=j.debounce(this.keyUp,this.undoRedoTimer);this.parent.observer.on(Gs,e,this),this.parent.observer.on(m,this.keyDown,this),this.parent.observer.on(Qs,this.onAction,this),this.parent.observer.on(Ys,this.onPropertyChanged,this),this.parent.observer.on(f,this.destroy,this)},hl.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++)switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}},hl.prototype.removeEventListener=function(){var e=j.debounce(this.keyUp,300);this.parent.observer.off(Gs,e),this.parent.observer.off(m,this.keyDown),this.parent.observer.off(Qs,this.onAction),this.parent.observer.off(Ys,this.onPropertyChanged),this.parent.observer.off(f,this.destroy)},hl.prototype.destroy=function(){this.removeEventListener()},hl.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},hl.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},hl.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},hl.prototype.saveData=function(e){var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),t.selectionStart),t=t.selectionEnd,i={text:this.parent.element.value,start:n,end:t};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),1<this.undoRedoStack.length&&this.undoRedoStack[this.undoRedoStack.length-1].start===n&&this.undoRedoStack[this.undoRedoStack.length-1].end===t||(this.undoRedoStack.push(i),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())},hl.prototype.undo=function(e){var t,n,i;0<this.steps&&(this.currentAction="Undo",t=this.undoRedoStack[this.steps-1].start,n=this.undoRedoStack[this.steps-1].end,i=this.undoRedoStack[this.steps-1].text,this.parent.element.value=i,this.parent.element.focus(),this.steps--,this.restore(this.parent.element,t,n,e))},hl.prototype.redo=function(e){var t,n;null!=this.undoRedoStack[this.steps+1]&&(this.currentAction="Redo",t=this.undoRedoStack[this.steps+1].start,n=this.undoRedoStack[this.steps+1].end,this.parent.element.value=this.undoRedoStack[this.steps+1].text,this.parent.element.focus(),this.steps++,this.restore(this.parent.element,t,n,e))},hl.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},hl.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return 0<this.steps&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e};var cl=hl;function hl(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=j.isNullOrUndefined(t)?30:t.undoRedoSteps,this.undoRedoTimer=j.isNullOrUndefined(t)?300:t.undoRedoTimer,this.selection=this.parent.markdownSelection,this.addEventListener()}ul.prototype.addEventListener=function(){this.parent.observer.on(el,this.createLink,this),this.parent.observer.on(f,this.destroy,this)},ul.prototype.removeEventListener=function(){this.parent.observer.off(el,this.createLink),this.parent.observer.off(f,this.destroy)},ul.prototype.createLink=function(e){var t=this.parent.element,n=(t.focus(),t.selectionStart),i=t.selectionEnd,o="Image"===e.subCommand?this.selection.getSelectedText(t):e.item.text,r="Image"===e.subCommand?n+2:n+1,s="Image"===e.subCommand?i+2:i+1,o="Image"===e.subCommand?"!["+o+"]("+e.item.url+")":"["+o+"]("+e.item.url+")";t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,s),this.restore(t,r,s,e)},ul.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},ul.prototype.destroy=function(){this.removeEventListener()};var pl=ul;function ul(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}N.prototype.addEventListener=function(){this.parent.observer.on(nl,this.createTable,this),this.parent.observer.on(m,this.onKeyDown,this),this.parent.observer.on(f,this.destroy,this)},N.prototype.removeEventListener=function(){this.parent.observer.off(nl,this.createTable),this.parent.observer.off(m,this.onKeyDown),this.parent.observer.off(f,this.destroy)},N.prototype.destroy=function(){this.removeEventListener()},N.prototype.onKeyDown=function(e){"insert-table"===e.event.action&&(e.item=e.value,this.createTable(e))},N.prototype.createTable=function(e){this.element=this.parent.element;var t=this.element.selectionStart,n=this.element.selectionEnd,i=this.element.value;this.locale=e,this.selection.save(t,n),this.restore(this.element.selectionStart,this.element.selectionEnd,null),this.insertTable(t,n,i,e)},N.prototype.getTable=function(){var e="";return(e+=this.textNonEmpty())+this.tableHeader(this.locale)+this.tableCell(this.locale)},N.prototype.tableHeader=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=1===n?e.item.headingText+" "+i+"|":"---------|";t+=this.insertLine()}return t},N.prototype.tableCell=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=e.item.colText+" "+this.convertToLetters(n)+i+"|";t+=this.insertLine()}return t+=this.insertLine()},N.prototype.insertLine=function(){var e=document.createElement("div");return e.innerHTML="\n",e.textContent},N.prototype.insertTable=function(e,t,n,i){var o=this.selection.getSelectedParentPoints(this.element),r=o[o.length-1].text.split(" ",2),s=this.getFormatTag();!(r.length<2)&&this.ensureFormatApply(o[o.length-1].text)?this.checkValid(e,t,this.getTable(),n,i,r,o,s):(this.element.value=this.updateValue(this.getTable()),this.makeSelection(n,e,t)),this.restore(this.element.selectionStart,this.element.selectionEnd,i)},N.prototype.makeSelection=function(e,t,n){n=t+(0<e.length?12:10),t+=0<e.length?3:1,this.selection.setSelection(this.element,t,n)},N.prototype.getFormatTag=function(){for(var e=Object.keys(this.syntaxTag.Formats),t=Object.keys(this.syntaxTag.List),n=[],i=0;i<e.length;i++)n.push(this.syntaxTag.Formats[e[i]]);for(var o=0;o<t.length;o++)n.push(this.syntaxTag.List[t[o]]);return n},N.prototype.ensureFormatApply=function(e){for(var t=this.getFormatTag(),n=e.trim().split(" ",2)[0]+" ",i=0;i<t.length;i++)if(n===t[i]||/^[\d.]+[ ]+$/.test(n))return!0;return!1},N.prototype.ensureStartValid=function(e,t){for(var n=t[0].text.split(" ",2),i=e+1;i<=e+n[0].length+1;i++)if(this.element.selectionStart===i||this.element.selectionEnd===i)return!1;return!0},N.prototype.ensureEndValid=function(e,t){for(var n=e+1;n<=e+t+1;n++)if(this.element.selectionEnd===n)return!1;return!0},N.prototype.updateValueWithFormat=function(e,t){var n=this.element.value.substring(this.element.selectionEnd,this.element.value.length);return t+=n.replace(n,e[0]+" "+n),this.element.value.substr(0,this.element.selectionStart)+t},N.prototype.updateValue=function(e){return this.element.value.substr(0,this.element.selectionStart)+e+this.element.value.substr(this.element.selectionEnd,this.element.value.length)},N.prototype.checkValid=function(e,t,n,i,o,r,s,a){this.ensureStartValid(s[0].start,s)&&this.ensureEndValid(s[s.length-1].start,r[0].length)&&(e===s[0].start?e!==t&&t!==s[s.length-1].end-1?this.element.value=this.updateValueWithFormat(r,n):this.element.value=this.updateValue(n):t===s[s.length-1].end-1?this.element.value=this.updateValue(n):this.element.value=this.updateValueWithFormat(r,n),this.makeSelection(i,e,t))},N.prototype.convertToLetters=function(e){for(var t="A".charCodeAt(0),n="";--e,n=String.fromCharCode(t+e%26)+n,0<(e=e/26>>0););return n},N.prototype.textNonEmpty=function(){var e="";return e=(this.isCursorBased()||this.isSelectionBased())&&0<this.element.value.length?(e+=this.insertLine())+this.insertLine():e},N.prototype.isCursorBased=function(){return this.element.selectionStart===this.element.selectionEnd},N.prototype.isSelectionBased=function(){return this.element.selectionStart!==this.element.selectionEnd},N.prototype.restore=function(e,t,n){this.selection.save(e,t),this.selection.restore(this.element),n&&n.callBack&&n.callBack({requestType:n.subCommand,selectedText:this.selection.getSelectedText(this.element),editorMode:"Markdown",event:n.event})};var ml=N;function N(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}fl.prototype.addEventListener=function(){this.parent.observer.on(tl,this.clear,this),this.parent.observer.on(f,this.destroy,this)},fl.prototype.removeEventListener=function(){this.parent.observer.off(tl,this.clear),this.parent.observer.off(f,this.destroy)},fl.prototype.replaceRegex=function(e){return e.replace(/\*/gi,"\\*").replace(/\&/gi,"\\&").replace(/\-/gi,"\\-").replace(/\^/gi,"\\^").replace(/\$/gi,"\\$").replace(/\./gi,"\\.").replace(/\|/gi,"\\|").replace(/\?/gi,"\\?").replace(/\+/gi,"\\+").replace(/\-/gi,"\\-").replace(/\&/gi,"\\&")},fl.prototype.clearSelectionTags=function(e){for(var t=this.parent.selectionTags,n=Object.keys(t),i=0;i<n.length;i++){var o=n[i];if(Object.prototype.hasOwnProperty.call(t,o)&&""!==t[""+o])for(var r=this.replaceRegex(t[""+o]),s=void 0,a=t[""+o].length,l="<sup>"===t[""+o]||"<sub>"===t[""+o]?t[""+o].length+1:t[""+o].length,d=(s="<sup>"===t[""+o]?new RegExp("<sup>(.*?)</sup>","ig"):"<sub>"===t[""+o]?new RegExp("<sub>(.*?)</sub>","ig"):new RegExp(r+"(.*?)"+r,"ig"),e.match(s)),c=0;d&&c<d.length&&""!==d[c];c++)e=e.replace(d[c],d[c].substr(a,d[c].length-l-a))}return e},fl.prototype.clearFormatTags=function(e){e=e.split("\n");return this.clearFormatLines(e)},fl.prototype.clearFormatLines=function(e){for(var t=[this.parent.formatTags,this.parent.listTags],n="",i=0;i<e.length;i++){for(var o=0;o<t.length;o++)for(var r=t[o],s=Object.keys(r),a=0;a<s.length;a++){var l=s[a];Object.prototype.hasOwnProperty.call(r,l)&&""!==r[""+l]&&0===e[i].indexOf(r[""+l])&&(e[i]=e[i].replace(r[""+l],""),e[i]=this.clearFormatLines([e[i]]))}n=n+e[i]+(i!==e.length-1?"\n":"")}return n},fl.prototype.clear=function(e){var t=this.parent.element,n=(t.focus(),t.selectionStart),i=t.selectionEnd,o=this.selection.getSelectedText(t),o=this.clearSelectionTags(o);o=this.clearFormatTags(o),t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,n,n+o.length),this.restore(t,n,n+o.length,e)},fl.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},fl.prototype.destroy=function(){this.removeEventListener()};var gl=fl;function fl(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}yl.prototype.addEventListener=function(){this.parent.observer.on(il,this.InsertTextExec,this),this.parent.observer.on(f,this.destroy,this)},yl.prototype.removeEventListener=function(){this.parent.observer.off(il,this.InsertTextExec),this.parent.observer.off(f,this.destroy)},yl.prototype.InsertTextExec=function(e){var t=this.parent.element,n=(t.focus(),t.selectionStart),i=t.selectionEnd,o=e.value.text,r=n+o.length,s=i+o.length;t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,s),this.restore(t,r,s,e)},yl.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},yl.prototype.destroy=function(){this.removeEventListener()};var bl=yl;function yl(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}Cl.prototype.initialize=function(){this.formatTags=xs,this.listTags=Ms,this.selectionTags=Ds},Cl.prototype.wireEvents=function(){this.observer.on(Vs,this.editorKeyDown,this),this.observer.on(Xs,this.editorKeyUp,this),this.observer.on(Js,this.onPropertyChanged,this)},Cl.prototype.unwireEvents=function(){this.observer.off(Vs,this.editorKeyDown),this.observer.off(Xs,this.editorKeyUp),this.observer.off(Js,this.onPropertyChanged)},Cl.prototype.onPropertyChanged=function(e){this.observer.notify(Ys,e)},Cl.prototype.editorKeyDown=function(e){this.observer.notify(m,e)},Cl.prototype.editorKeyUp=function(e){this.observer.notify(Gs,e)},Cl.prototype.execCommand=function(e,t,n,i,o,r){switch(e.toLocaleLowerCase()){case"lists":this.observer.notify($a,{subCommand:t,event:n,callBack:i});break;case"formats":this.observer.notify(Ws,{subCommand:t,event:n,callBack:i});break;case"actions":this.observer.notify(Qs,{subCommand:t,event:n,callBack:i});break;case"style":case"effects":case"casing":this.observer.notify(Za,{subCommand:t,event:n,callBack:i});break;case"links":case"images":this.observer.notify(el,{subCommand:t,event:n,callBack:i,item:r});break;case"table":"createtable"===t.toString().toLocaleLowerCase()&&this.observer.notify(nl,{subCommand:t,item:r,event:n,callBack:i});break;case"clear":this.observer.notify(tl,{subCommand:t,event:n,callBack:i});break;case"inserttext":this.observer.notify(il,{subCommand:t,event:n,callBack:i,value:{text:r}})}},Cl.prototype.destroy=function(){this.observer.notify(f,{}),this.unwireEvents()};var vl=Cl;function Cl(e){this.initialize(),j.extend(this,this,e,!0),this.observer=new j.Observer(this),this.markdownSelection=new Va,this.listObj=new ol({parent:this,syntax:this.listTags}),this.formatObj=new sl({parent:this,syntax:this.formatTags}),this.undoRedoManager=new cl(this,e.options),this.mdSelectionFormats=new ll({parent:this,syntax:this.selectionTags}),this.linkObj=new pl(this),this.tableObj=new ml({parent:this,syntaxTag:{Formats:this.formatTags,List:this.listTags}}),this.clearObj=new gl(this),this.insertTextObj=new bl(this),this.wireEvents()}Nl=function(e,t){return(Nl=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};(function(e,t){function n(){this.constructor=e}Nl(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(Tl,El=Ya),Tl.prototype.initialize=function(){this.keyConfig=Rs,this.formatTags=xs,this.listTags=Ms,this.selectionTags=Ds},Tl.prototype.updateFormatter=function(e,t,n){e&&(this.editorManager=new vl({element:e,formatTags:this.formatTags,listTags:this.listTags,selectionTags:this.selectionTags,options:n}))};var Nl,El,Sl=Tl;function Tl(e){var t=El.call(this)||this;return t.initialize(),j.extend(t,t,e,!0),e&&t.element&&t.updateFormatter(t.element,document,e.options),t}Ll.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.isDestroyed=!0)},Ll.prototype.addEventListener=function(){this.parent.isDestroyed||(this.saveSelection=new Va,this.parent.on(Q,this.instantiateRenderer,this),this.parent.on(n,this.render,this),this.parent.on(l,this.onPropertyChanged,this),this.parent.on(ee,this.onToolbarClick,this),this.parent.on(o,this.destroy,this),this.parent.on(tt,this.selectAll,this),this.parent.on(it,this.getSelectedHtml,this),this.parent.on(Ve,this.onSelectionSave,this),this.parent.on(Qe,this.onSelectionRestore,this),this.parent.on(ht,this.updateReadOnly,this))},Ll.prototype.updateReadOnly=function(){this.parent.readonly?(this.parent.contentModule.getEditPanel().setAttribute("readonly","readonly"),j.addClass([this.parent.element],qi)):(this.parent.contentModule.getEditPanel().removeAttribute("readonly"),j.removeClass([this.parent.element],qi))},Ll.prototype.onSelectionSave=function(){var e=this.parent.contentModule.getEditPanel();this.saveSelection.save(e.selectionStart,e.selectionEnd)},Ll.prototype.onSelectionRestore=function(e){this.contentRenderer.getEditPanel().focus();var t=this.parent.contentModule.getEditPanel();this.saveSelection.restore(t)},Ll.prototype.onToolbarClick=function(e){var t=e.item,n=this.parent.contentModule.getEditPanel(),i=("Formats"!==t.command&&n.focus(),n.selectionStart),o=n.selectionEnd,r=n.value.substring(i,o);switch(t.subCommand){case"Maximize":this.parent.notify(le,{args:e});break;case"Minimize":this.parent.notify(de,{args:e});break;case"CreateLink":this.parent.notify(Ne,{member:"link",args:e,text:r,module:"Markdown"});break;case"Image":this.parent.notify(xe,{member:"image",args:e,text:r,module:"Markdown"});break;case"CreateTable":var s={headingText:this.parent.localeObj.getConstant("TableHeadingText"),colText:this.parent.localeObj.getConstant("TableColText")};this.parent.formatter.process(this.parent,e,e.originalEvent,s);break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}},Ll.prototype.instantiateRenderer=function(){this.renderFactory.addRenderer(c.RenderType.Content,new Ca(this.parent))},Ll.prototype.removeEventListener=function(){this.parent.off(n,this.render),this.parent.off(l,this.onPropertyChanged),this.parent.off(o,this.destroy),this.parent.off(ee,this.onToolbarClick),this.parent.off(Q,this.instantiateRenderer),this.parent.off(tt,this.selectAll),this.parent.off(it,this.getSelectedHtml),this.parent.off(Ve,this.onSelectionSave),this.parent.off(Qe,this.onSelectionRestore),this.parent.off(ht,this.updateReadOnly)},Ll.prototype.render=function(){this.contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content);var e=this.contentRenderer.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};j.isNullOrUndefined(this.parent.formatter)?this.parent.formatter=new Sl({element:e,options:t}):this.parent.formatter.updateFormatter(e,this.contentRenderer.getDocument(),t),this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new Wa(this.parent)),this.parent.notify($,{})},Ll.prototype.onPropertyChanged=function(e){var t;j.isNullOrUndefined(e.newProp.formatter)||(e=this.contentRenderer.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer},this.parent.formatter.updateFormatter(e,this.contentRenderer.getDocument(),t))},Ll.prototype.getModuleName=function(){return"markdownEditor"},Ll.prototype.selectAll=function(){this.parent.formatter.editorManager.markdownSelection.setSelection(this.parent.contentModule.getEditPanel(),0,this.parent.contentModule.getEditPanel().value.length)},Ll.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()))};var Ol=Ll;function Ll(e,t){this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1}kl.prototype.getBlockNodes=function(){var e=[];if(!j.isNullOrUndefined(this.root.querySelector(".e-cell-select"))){var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if(!(j.isNullOrUndefined(t)||t.length<2)){for(var n=0;n<t.length;n++)this.addBlockNodes(t[n],e);this.wrapParagraphNodes(e)}}return e},kl.prototype.addBlockNodes=function(e,t){var n=e.childNodes;if(0===n.length)t.push(e);else for(var i=0;i<n.length;i++){var o=n[i];0<=t.indexOf(o.parentElement)||(!o.parentElement||"TD"!==o.parentElement.nodeName&&"TH"!==o.parentElement.nodeName||1!==o.parentElement.childNodes.length||"BR"!==o.nodeName&&(o.nodeType,Node.TEXT_NODE),t.push(o.parentElement))}},kl.prototype.getTextNodes=function(){var e=[];if(!j.isNullOrUndefined(this.root.querySelector(".e-cell-select"))){var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if(!(j.isNullOrUndefined(t)||t.length<2))for(var n=0;n<t.length;n++)this.addTextNodes(t[n],e)}return e},kl.prototype.addTextNodes=function(e,t){var n,i=e.childNodes;if(0!==i.length||"TD"!==e.nodeName&&"TH"!==e.nodeName)if(1!==i.length||"TD"!==e.nodeName&&"TH"!==e.nodeName||"BR"!==i[0].nodeName)for(var o=0;o<i.length;o++){var r=i[o];r.nodeType===Node.TEXT_NODE?t.push(r):r.nodeType===Node.ELEMENT_NODE&&this.addTextNodes(r,t)}else n=this.currentDocument.createTextNode(""),e.insertBefore(n,i[0]),t.push(n);else n=this.currentDocument.createTextNode(""),e.appendChild(n),t.push(n)},kl.prototype.wrapParagraphNodes=function(e){for(var t=Array.from(e),n=0;n<t.length;n++){var i,o,r=t[n];"TD"!==r.nodeName&&"TH"!==r.nodeName||(1!==r.childNodes.length||"BR"!==r.childNodes[0].nodeName&&r.childNodes[0].nodeType!==Node.TEXT_NODE?(i=e.indexOf(r),this.wrapInlineNodes(r,e,i)):(i=r.childNodes[0],o=j.createElement("p"),i.parentElement.insertBefore(o,i),o.appendChild(i),r=e.indexOf(r),e[r]=o))}for(n=0;n<e.length;n++){var s,a=e[n];"LI"===a.nodeName&&1===a.childNodes.length&&(s=a.childNodes[0]).nodeType===Node.ELEMENT_NODE&&0<=this.BASIC_FORMATS.indexOf(s.nodeName.toLocaleLowerCase())&&s.textContent===a.textContent&&(e[n]=s)}},kl.prototype.wrapInlineNodes=function(e,t,n){var i,o=e.childNodes[0],r=j.createElement("p"),s=[];if(j.isNullOrUndefined(o))e.appendChild(r),s.push(r);else for(;o;)if("BR"===o.nodeName)o.parentNode.insertBefore(r,o),r.appendChild(o),0<r.childNodes.length&&s.indexOf(r)<0&&s.push(r),o=r.nextSibling,r=j.createElement("p");else if(0<=this.BLOCK_TAGS.indexOf(o.nodeName.toLocaleLowerCase()))if(s.push(o),0<r.childNodes.length)o=r.nextSibling;else{if(o&&"LI"===o.nodeName&&0<o.querySelectorAll("li").length)for(var a=o.querySelectorAll("li"),l=0;l<a.length;l++)s.push(a[l]);o=("LI"===o.nodeName&&j.isNullOrUndefined(o.nextSibling)?o.parentElement:o).nextSibling}else if(o.nodeType===Node.TEXT_NODE)""===o.textContent.trim()&&o.textContent.indexOf("")<0?(i=o.nextSibling,j.detach(o),o=i):(o.parentNode.insertBefore(r,o),i=o,r.appendChild(i),0<r.childNodes.length&&s.indexOf(r)<0&&s.push(r),o=r.nextSibling);else if("TABLE"===o.nodeName||"UL"===o.nodeName||"OL"===o.nodeName)if("TABLE"===o.nodeName){for(var d=[],c=o.querySelectorAll("td, th"),l=0;l<c.length;l++)this.addBlockNodes(c[l],d);this.wrapParagraphNodes(d);for(l=0;l<d.length;l++)s.push(d[l]);o=o.nextSibling}else o=o.firstElementChild;else this.BLOCK_TAGS.indexOf(o.nodeName.toLocaleLowerCase())<0&&(o.parentNode.insertBefore(r,o),r.appendChild(o),0<r.childNodes.length&&s.indexOf(r)<0&&s.push(r),o=r.nextSibling);Ss(t,s,n)};var wl=kl;function kl(e,t){this.BLOCK_TAGS=["p","h1","h2","h3","h4","h5","h6","blockquote","li","pre","td","th","div","hr","section","figure"],this.BASIC_FORMATS=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.root=e,this.currentDocument=t}var L={startSelection:"e-editor-select-start",endSelection:"e-editor-select-end"},xl=(E.prototype.contents=function(e){return e&&"IFRAME"!==e.tagName?Array.prototype.slice.call(e.childNodes||[]):[]},E.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&0<=ls.indexOf(e.tagName.toLowerCase())},E.prototype.isLink=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&"a"===e.tagName.toLowerCase()},E.prototype.blockParentNode=function(e){for(;e&&e.parentNode!==this.parent&&(!e.parentNode||!this.hasClass(e.parentNode,"e-node-inner"));)if(e=e.parentNode,this.isBlockNode(e))return e;return e},E.prototype.rawAttributes=function(e){var t={},n=e.attributes;if(0<n.length)for(var i=0;i<n.length;i++){var o=n[i];t[o.nodeName]=o.value}return t},E.prototype.attributes=function(e){if(!e)return"";for(var t="",n=this.rawAttributes(e),i=Object.keys(n).sort(),o=0;o<i.length;o++){var r=i[o],s=n[""+r];s.indexOf("'")<0&&0<=s.indexOf('"')?t+=" "+r+"='"+s+"'":0<=s.indexOf('"')&&0<=s.indexOf("'")?t+=" "+r+'="'+(s=s.replace(/"/g,"&quot;"))+'"':t+=" "+r+'="'+s+'"'}return t},E.prototype.clearAttributes=function(e){for(var t=e.attributes,n=t.length-1;0<=n;n--){var i=t[n];e.removeAttribute(i.nodeName)}},E.prototype.openTagString=function(e){return"<"+e.tagName.toLowerCase()+this.attributes(e)+">"},E.prototype.closeTagString=function(e){return"</"+e.tagName.toLowerCase()+">"},E.prototype.createTagString=function(e,t,n){return"<"+e.toLowerCase()+this.attributes(t)+">"+n+"</"+e.toLowerCase()+">"},E.prototype.isList=function(e){return!!e&&0<=["UL","OL"].indexOf(e.tagName)},E.prototype.isElement=function(e){return e===this.parent},E.prototype.isEditable=function(e){return(!e.getAttribute||"true"===e.getAttribute("contenteditable"))&&["STYLE","SCRIPT"].indexOf(e.tagName)<0},E.prototype.hasClass=function(e,t){return e&&e.classList&&e.classList.contains(t)},E.prototype.replaceWith=function(e,t){e.parentNode.insertBefore(this.parseHTMLFragment(t),e),j.detach(e)},E.prototype.parseHTMLFragment=function(e){var t=j.createElement("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)},E.prototype.wrap=function(e,t){return e.parentNode.insertBefore(t,e),(t=e.previousSibling).appendChild(e),t},E.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},E.prototype.wrapInner=function(e,t){for(e.appendChild(t),(t=e.querySelector(".e-rte-wrap-inner")).classList.remove("e-rte-wrap-inner"),0===t.classList.length&&t.removeAttribute("class");e.firstChild!==t;)t.appendChild(e.firstChild);return t},E.prototype.unWrap=function(e){for(var t=e.parentNode,n=[];e.firstChild&&" "!==e.textContent;)n.push(e.firstChild),t.insertBefore(e.firstChild,e);return n=0<n.length?n:[e.parentNode],t.removeChild(e),n},E.prototype.getSelectedNode=function(e,t){return e.nodeType===Node.ELEMENT_NODE&&0<e.childNodes.length&&e.childNodes[t-1]&&e.childNodes[t-1].nodeType===Node.ELEMENT_NODE&&(e.childNodes[t-1].classList.contains(L.startSelection)||e.childNodes[t-1].classList.contains(L.endSelection))?e=e.childNodes[t-1]:e.nodeType===Node.ELEMENT_NODE&&0<e.childNodes.length&&e.childNodes[t]&&(e=e.childNodes[t]),e=e.nodeType===Node.TEXT_NODE?e.parentNode:e},E.prototype.nodeFinds=function(e,t){for(var n=[],i=0;i<t.length;i++)e.contains(t[i])&&e!==t[i]&&n.push(t[i]);return n},E.prototype.isEditorArea=function(){for(var e=this.getRangePoint(0).commonAncestorContainer;e&&!this.isElement(e);)e=e.parentNode;return!!this.isElement(e)},E.prototype.getRangePoint=function(e){var t=this.getSelection(),n=[];if(t&&t.getRangeAt&&t.rangeCount)for(var n=[],i=0;i<t.rangeCount;i++)n.push(t.getRangeAt(i));else n=[this.currentDocument.createRange()];return void 0!==e?n[e]:n},E.prototype.getSelection=function(){return this.nodeSelection.get(this.currentDocument)},E.prototype.getPreviousNode=function(e){for(e=e.previousElementSibling;e&&"\n"===e.textContent;)e=e.previousElementSibling;return e},E.prototype.encode=function(e){var t=document.createElement("div");return t.innerText=e,t.innerHTML.replace(/<br\s*[\/]?>/gi,"\n")},E.prototype.saveMarker=function(e){var t=this.parent.querySelector("."+L.startSelection),n=this.parent.querySelector("."+L.endSelection),t=(this.hasClass(t,L.startSelection)&&1<t.classList.length?(i=this.createTagString(as,t,this.encode(t.textContent)),this.replaceWith(t,i),(t=this.parent.querySelector("."+L.startSelection)).classList.remove(L.startSelection),t.childNodes):this.unWrap(t))[0],i=this.hasClass(n,L.endSelection)&&1<n.classList.length?(i=this.createTagString(as,n,this.encode(n.textContent)),this.replaceWith(n,i),(n=this.parent.querySelector("."+L.endSelection)).classList.remove(L.endSelection),n.childNodes[0]):n?this.unWrap(n)[0]:t;return e.startContainer=e.getNodeArray(t,!0),e.endContainer=e.getNodeArray(i,!1),e},E.prototype.marker=function(e,t){return'<span class="'+e+'">'+t+"</span>"},E.prototype.setMarker=function(e){var e=e.range,t=e.startContainer.childNodes,n=1<t.length&&"TABLE"===t[0].nodeName,i=1<t.length&&"IMAGE"===t[0].nodeName&&1===e.endOffset&&"#text"===e.endContainer.nodeName&&0===e.endContainer.textContent.length,n=(n?function(e){for(var t=e;0<(t=0<t.childNodes.length?t.childNodes[0]:t).childNodes.length;);return t}(t[e.startOffset+1]):t[0<e.startOffset?e.startOffset-1:e.startOffset])||e.startContainer,t=e.endContainer.childNodes[!(0<e.endOffset)||i?e.endOffset:e.endOffset-1]||e.endContainer;if(n.nodeType===Node.ELEMENT_NODE&&t.nodeType===Node.ELEMENT_NODE&&(n.contains(t)||t.contains(n))){var o=n.contains(t)?n:t;if(o.nodeType!==Node.TEXT_NODE){for(var r=[],s=[],a=o;o.contains(a);)r.indexOf(a)<0&&a.childNodes&&a.childNodes.length?(r.push(a),a=a.childNodes[0]):a.nextSibling?a=a.nextSibling:a.parentNode&&(a=a.parentNode,r.push(a)),s.indexOf(a)<0&&(a.nodeType===Node.TEXT_NODE||0<=ds.indexOf(a.parentNode.tagName.toLocaleLowerCase())&&("BR"===a.tagName||"IMG"===a.tagName))&&s.push(a);s.length&&(n=n.contains(t)?s[0]:n,t=s[s.length-1])}}n!==t?(n.nodeType!==Node.TEXT_NODE&&("BR"===n.tagName&&0<=ds.indexOf(n.parentNode.tagName.toLocaleLowerCase())||"IMG"===n.tagName)?(this.replaceWith(n,this.marker(L.startSelection,this.encode(n.textContent))),e.startContainer.querySelector("."+L.startSelection).appendChild(n)):3!==n.nodeType&&"#text"!==n.nodeName&&"BR"!==n.nodeName?(i=this.marker(L.startSelection,""),j.append([this.parseHTMLFragment(i)],n)):this.replaceWith(n,this.marker(L.startSelection,this.encode(n.textContent))),t.nodeType!==Node.TEXT_NODE&&"BR"===t.tagName&&0<=ds.indexOf(t.parentNode.tagName.toLocaleLowerCase())?(this.replaceWith(t,this.marker(L.endSelection,this.encode(t.textContent))),e.endContainer.querySelector("."+L.endSelection).appendChild(t)):this.ensureSelfClosingTag(t,L.endSelection,e)):this.ensureSelfClosingTag(n,L.startSelection,e)},E.prototype.ensureSelfClosingTag=function(e,t,n){var i=!1;if(3===e.nodeType)this.replaceWith(e,this.marker(t,this.encode(e.textContent)));else if("BR"===e.tagName){this.replaceWith(e,this.marker(t,this.encode(e.textContent)));var o=n.startContainer.querySelector("."+t);o&&o.parentElement.appendChild(e)}else{var o=j.isNullOrUndefined(e.parentElement)?"":e.parentElement.tagName.toLocaleLowerCase();if("IMG"===e.tagName&&"p"!==o&&"div"!==o&&(o=document.createElement("p"),e.parentElement.insertBefore(o,e),o.appendChild(e),e=o.children[0]),"TABLE"===e.tagName)if(i=!0,""===e.textContent){o=e.querySelectorAll("td");e=o[o.length-1],e=j.isNullOrUndefined(e.childNodes[0])?e:e.childNodes[0]}else{for(var r=e.lastChild;3!==r.nodeType&&"#text"!==r.nodeName&&"BR"!==r.nodeName;)r=r.lastChild;e=r}for(var s=0;s<Is.length;s++)e=e.tagName!==Is[s]||i?e:e.parentNode;3===e.nodeType&&"#text"===e.nodeName?this.replaceWith(e,this.marker(t,this.encode(e.textContent))):"BR"===e.nodeName?(this.replaceWith(e,this.marker(L.endSelection,this.encode(e.textContent))),n.endContainer.querySelector("."+L.endSelection).appendChild(e)):(o=this.marker(t,""),j.append([this.parseHTMLFragment(o)],e))}},E.prototype.createTempNode=function(e){var t,n,i=e.textContent;return"BR"===e.tagName?(t="<p></p>",n=e.parentNode,0<=ds.indexOf(n.tagName.toLocaleLowerCase())&&(e=this.wrap(e,this.parseHTMLFragment(t)))):(e.nodeType!==Node.TEXT_NODE&&(e.classList.contains(L.startSelection)||e.classList.contains(L.endSelection))||0<i.replace(/\n/g,"").replace(/(^ *)|( *$)/g,"").length||i.length&&i.indexOf("\n")<0)&&(n=e,e=this.wrap(e,this.parseHTMLFragment(t="<p></p>")),n.nodeType!==Node.ELEMENT_NODE||!n.firstChild||"BR"!==n.firstChild.nodeName||!n.classList.contains(L.startSelection)&&!n.classList.contains(L.endSelection))&&e.nextElementSibling&&"BR"===e.nextElementSibling.tagName&&e.appendChild(e.nextElementSibling),e},E.prototype.getImageTagInSelection=function(){var e=this.getSelection();return this.isEditorArea()&&e.rangeCount?e.focusNode.querySelectorAll("img"):null},E.prototype.gatherElementsAround=function(e,t){for(var n=j.createElement(t),i=e.previousSibling,t=e.parentElement,o=("e-editor-select-start"===t.className?t.parentNode.insertBefore(n,t):t&&t.insertBefore(n,e),0);null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var r=i.previousSibling;3!==i.nodeType&&1!==i.nodeType||(0===o?n.appendChild(i):n.insertBefore(i,n.firstChild)),i=r,o++}for(n.appendChild(e),i=n.nextSibling||n.parentElement.nextSibling;null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var s=i.nextSibling||i.parentElement.nextSibling;3!==i.nodeType&&1!==i.nodeType||n.appendChild(i),i=s}return n},E.prototype.convertToBlockNodes=function(e,t){if(1<e.length)for(var n,i,o=0,r=e[0];!j.isNullOrUndefined(r);)"BR"===r.nodeName&&(n=r.nextSibling,j.detach(r),r=n),j.isNullOrUndefined(r)||(e[o]=t?"LI"===r.nodeName||this.isBlockNode(r)?r:this.gatherElementsAround(r,t?"p":"div"):this.isBlockNode(e[o])?e[o]:this.gatherElementsAround(r,t?"p":"div"),i="#text"===(n="LI"===e[o].nodeName?e[o].parentElement:e[o]).nodeName?n.parentElement:n,null!==(r=j.isNullOrUndefined(i.querySelector(".e-editor-select-end"))&&j.isNullOrUndefined(j.closest(r,".e-editor-select-end"))?n.nextSibling:null))||j.isNullOrUndefined(n.nextSibling)||"BR"!==n.nextSibling.nodeName||j.detach(n.nextSibling),o++;else this.isBlockNode(e[0])||(e[0]=this.gatherElementsAround(e[0],t?"p":"div"),j.isNullOrUndefined(e[0].nextSibling))||"BR"!==e[0].nextSibling.nodeName||j.detach(e[0].nextSibling);return e},E.prototype.blockNodes=function(e){var t=[],n=this.getSelection();if(this.isEditorArea()&&n.rangeCount)for(var i=this.getRangePoint(),o=0;o<i.length;o++){for(var r=void 0,s=i[o],a=this.getSelectedNode(s.startContainer,s.startOffset),l=this.getSelectedNode(s.endContainer,s.endOffset),d=(this.isBlockNode(a)&&t.indexOf(a)<0&&t.push(a),r=this.blockParentNode(a),this.blockParentNode(l)),c=(r&&t.indexOf(r)<0&&(!j.isNullOrUndefined(e)&&e?"TD"===s.commonAncestorContainer.nodeName||"TD"===r.nodeName||"TD"===d.nodeName?1<(d=this.getPreBlockNodeCollection(s)).length?this.wrapWithBlockNode(d,t):0<d.length&&(a!==l&&"BR"!==a.nodeName||a===l&&"SPAN"===a.nodeName&&(a.classList.contains(L.startSelection)||a.classList.contains(L.endSelection)))&&t.push(this.createTempNode(a)):t.push(r):0<=ds.indexOf(r.tagName.toLocaleLowerCase())&&("BR"===a.tagName||a.nodeType===Node.TEXT_NODE||a.classList.contains(L.startSelection)||a.classList.contains(L.endSelection))?(d=a.previousSibling&&a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling:a,a.nextSibling||a.previousSibling||"BR"!==a.tagName?t.push(this.createTempNode(d)):t.push(d)):t.push(r)),[]),h=a;h!==l&&h!==this.parent;)c.indexOf(h)<0&&h.childNodes&&h.childNodes.length?(c.push(h),h=h.childNodes[0]):h&&8!==h.nodeType&&("BR"===h.tagName||h.nodeType===Node.TEXT_NODE&&""!==h.textContent.trim()||h.nodeType!==Node.TEXT_NODE&&(h.classList.contains(L.startSelection)||h.classList.contains(L.endSelection)))&&0<=ds.indexOf(h.parentNode.tagName.toLocaleLowerCase())?h=this.createTempNode(h):h.nextSibling&&8!==h.nextSibling.nodeType&&("BR"===h.nextSibling.tagName||h.nextSibling.nodeType===Node.TEXT_NODE||h.nextSibling.classList.contains(L.startSelection)||h.nextSibling.classList.contains(L.endSelection))&&0<=ds.indexOf(h.nextSibling.parentNode.tagName.toLocaleLowerCase())?h=this.createTempNode(h.nextSibling):h.nextSibling?h=h.nextSibling:h.parentNode&&(h=h.parentNode,c.push(h)),t.indexOf(h)<0&&h.nodeType===Node.ELEMENT_NODE&&0<=ds.indexOf(h.parentNode.tagName.toLocaleLowerCase())&&(h.classList.contains(L.startSelection)||h.classList.contains(L.endSelection))&&t.push(this.createTempNode(h)),this.isBlockNode(h)&&this.ignoreTableTag(h)&&c.indexOf(h)<0&&t.indexOf(h)<0&&(h!==l||0<s.endOffset)&&t.push(h),"IMG"===h.nodeName&&"true"===h.parentElement.contentEditable&&t.push(h);(r=this.blockParentNode(l))&&this.ignoreTableTag(r)&&t.indexOf(r)<0&&!j.isNullOrUndefined(r.previousElementSibling)&&"IMG"!==r.previousElementSibling.tagName&&t.push(r)}for(var p,u=t.length-1;0<u;u--)(c=this.nodeFinds(t[u],t)).length&&(p=t[u].querySelectorAll("ul, ol"),"LI"===t[u].tagName&&0<p.length||t.splice(u,1));n=this.tableSelection.getBlockNodes();return 0<n.length?n:t},E.prototype.ignoreTableTag=function(e){return!(0<=cs.indexOf(e.tagName.toLocaleLowerCase()))},E.prototype.getPreBlockNodeCollection=function(e){var t=this.getSelectedNode(e.startContainer,e.startOffset),e=this.getSelectedNode(e.endContainer,e.endOffset),n=[],i=t.closest("td, th");if(!j.isNullOrUndefined(i))for(var o=Array.from(i.childNodes),r=!0,s=this.getClosestInlineParent(t,i,!0),a=this.getClosestInlineParent(e,i,!1),l=0;l<o.length;l++){var d=o[l];s===a&&d===s?(n.push(d),r=!0):d===s?r=!1:d===a&&(n.push(d),r=!0),r||n.push(d)}return n},E.prototype.getClosestInlineParent=function(e,t,n){if(e.nodeType===Node.TEXT_NODE)return e;if(this.isBlockNode(e))return e;for(var i=e,o=!1;i;){var r=i;if(o){if(this.isBlockNode(i))return r;if(n&&i.previousSibling){if(this.isBlockNode(i.previousSibling)||"BR"===i.previousSibling.nodeName)return r;i=i.previousSibling}else{if(n||!i.nextSibling)return i;if(this.isBlockNode(i.nextSibling)||"BR"===i.nextSibling.nodeName)return r;i=i.nextSibling}}else(i=i.parentElement)===t&&(i=r,o=!0)}return null},E.prototype.wrapWithBlockNode=function(e,t){for(var n=j.createElement("p"),i=0;i<e.length;i++){var o=e[i];if("BR"===o.nodeName)o.parentNode.insertBefore(n,o),n.appendChild(o),0<n.childNodes.length&&t.push(n),n=j.createElement("p");else{if(this.isBlockNode(o))t.push(o);else{if("#text"===o.nodeName&&""===o.textContent.trim())continue;0===n.childElementCount&&o.parentNode.insertBefore(n,o),n.appendChild(o)}i===e.length-1&&n.nextElementSibling&&0===n.querySelectorAll("br").length&&"BR"===n.nextElementSibling.nodeName&&n.appendChild(n.nextElementSibling)}}0<n.childNodes.length&&t.indexOf(n)<0&&t.push(n)},E);function E(e,t){this.parent=e,this.nodeSelection=new bs,this.currentDocument=t,this.tableSelection=new wl(e,t)}S.prototype.addEventListener=function(){this.parent.observer.on(Ks,this.applyListsHandler,this),this.parent.observer.on(Gs,this.onKeyUp,this),this.parent.observer.on(m,this.keyDownHandler,this),this.parent.observer.on(ta,this.spaceKeyAction,this),this.parent.observer.on(f,this.destroy,this)},S.prototype.removeEventListener=function(){this.parent.observer.off(Ks,this.applyListsHandler),this.parent.observer.off(Gs,this.onKeyUp),this.parent.observer.off(m,this.keyDownHandler),this.parent.observer.off(ta,this.spaceKeyAction),this.parent.observer.off(f,this.destroy)},S.prototype.testList=function(e){var t=[/^[\d]+[.]+$/,/^(?=[MDCLXVI])M*(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})[.]$/gi,/^[a-zA-Z][.]+$/],n=j.isNullOrUndefined(e)?null:e.innerText.trim().split(".")[0]+".";if(!j.isNullOrUndefined(n))for(var i=0;i<t.length;i++)if(t[i].test(n))return!0;return!1},S.prototype.testCurrentList=function(e){var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!j.isNullOrUndefined(e.startContainer.textContent.slice(0,e.startOffset)))for(var n=e.startContainer.textContent.replace(/\u200B/g,"").slice(0,e.startOffset).trim(),i=0;i<t.length;i++)if(t[i].test(n)&&2===n.length)return!0;return!1},S.prototype.spaceList=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=(this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument),this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset)),i=(this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset),n.previousElementSibling),n=n.nextElementSibling,o=j.isNullOrUndefined(i)?null:i.innerText.trim().substring(0,1),r=j.isNullOrUndefined(n)?null:n.innerText.trim().substring(0,1),s=this.testCurrentList(t),i=this.testList(i),n=this.testList(n);i||n||"*"===o||"*"===r||(i=j.createElement("br"),s?(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(i,t.startContainer),this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault()):"*"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()&&"-"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()||(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(i,t.startContainer),this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()))},S.prototype.enterList=function(e){var t,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i="LI"===n.startContainer.nodeName?n.startContainer:n.startContainer.parentElement.closest("LI"),o="LI"===n.endContainer.nodeName?n.endContainer:n.endContainer.parentElement.closest("LI"),r=!1;j.isNullOrUndefined(i)||(t=0<(t=i.querySelectorAll(".e-video-clickelem")).length&&"IFRAME"===t[0].childNodes[0].nodeName,r=0<i.querySelectorAll("IMG").length||0<i.querySelectorAll("AUDIO").length||0<i.querySelectorAll("VIDEO").length||t),j.isNullOrUndefined(i)||j.isNullOrUndefined(o)||i!==o||"LI"!==i.tagName||""!==i.textContent.trim()||r||0<=i.innerHTML.indexOf("&nbsp;")||(65279===i.textContent.charCodeAt(0)&&(i.textContent=""),o=(t=i.parentElement).parentElement,j.isNullOrUndefined(o.closest("UL"))&&j.isNullOrUndefined(o.closest("OL"))&&(n=void(j.isNullOrUndefined(i.nextElementSibling)||(r=this.parent.domNode.blockParentNode(i),this.parent.nodeCutter.GetSpliceNode(n,r))),"DIV"===e.enterAction?(n=j.createElement("div")).innerHTML="<br>":"P"===e.enterAction?(n=j.createElement("p")).innerHTML="<br>":n=j.createElement("br"),j.isNullOrUndefined(o)||"BLOCKQUOTE"!==o.nodeName||this.parent.observer.notify("blockquote_list_handled",{}),this.parent.domNode.insertAfter(n,t),e.event.preventDefault(),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),""===t.textContent&&0===t.querySelectorAll("audio,video").length?j.detach(t):j.detach(i)),j.isNullOrUndefined(o))||j.isNullOrUndefined(o.closest("UL"))&&j.isNullOrUndefined(o.closest("OL"))||"LI"!==o.nodeName||"none"!==o.style.listStyleType||""!==o.textContent||""!==i.textContent||i!==t.firstElementChild||!j.isNullOrUndefined(i.nextSibling)||(j.detach(t),o.style.removeProperty("list-style-type"),e.event.preventDefault())},S.prototype.backspaceList=function(e){var t,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.domNode.getSelectedNode(n.startContainer,n.startOffset),o=this.parent.domNode.getSelectedNode(n.endContainer,n.endOffset);if((i="BR"===i.nodeName?i.parentElement:i)===(o="BR"===o.nodeName?o.parentElement:o)&&!j.isNullOrUndefined(j.closest(i,"li"))&&(""===i.textContent.trim()&&65279===i.textContent.charCodeAt(0)||1===i.textContent.length&&8203===i.textContent.charCodeAt(0))&&(i.textContent=""),i===o&&"LI"===i.tagName&&0===i.textContent.length&&j.isNullOrUndefined(i.previousElementSibling)&&i.removeAttribute("style"),i===o&&""===i.textContent){if("LI"===i.parentElement.tagName&&"LI"===o.parentElement.tagName)j.detach(i);else if(i.closest("ul")||i.closest("ol"))if((t=j.isNullOrUndefined(i.closest("ul"))?i.closest("ol"):i.closest("ul")).firstElementChild===i&&!j.isNullOrUndefined(t.children[1])&&("OL"===t.children[1].tagName||"UL"===t.children[1].tagName))if(t.tagName===t.children[1].tagName){for(;t.children[1].lastChild;)this.parent.domNode.insertAfter(t.children[1].lastChild,t.children[1]);j.detach(t.children[1])}else t.parentElement.insertBefore(t.children[1],t)}else if(!(j.isNullOrUndefined(i.firstChild)||"BR"!==i.firstChild.nodeName||j.isNullOrUndefined(i.childNodes[1])||"UL"!==i.childNodes[1].nodeName&&"OL"!==i.childNodes[1].nodeName))if((t=j.isNullOrUndefined(i.closest("ul"))?i.closest("ol"):i.closest("ul")).tagName===i.childNodes[1].nodeName){for(;i.childNodes[1].lastChild;)this.parent.domNode.insertAfter(i.children[1].lastChild,i);j.detach(i.childNodes[1])}else t.parentElement.insertBefore(i.children[1],t);this.removeList(n,e),this.firstListBackSpace(n,e)},S.prototype.removeList=function(e,t){var n=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset),i=!j.isNullOrUndefined(e.endContainer.parentElement.closest("li"))&&1<e.endContainer.parentElement.closest("li").childElementCount&&"#text"===e.endContainer.nodeName?e.endContainer:this.parent.domNode.getSelectedNode(e.endContainer,e.endOffset),o=("#text"===e.startContainer.nodeName?e.startContainer.parentElement:e.startContainer).closest("li"),r="";j.isNullOrUndefined(o)||j.isNullOrUndefined(o.firstChild)||o.childNodes.forEach(function(e){r+=e.textContent}),n="BR"===n.nodeName?n.parentElement:n,i="BR"===i.nodeName?i.parentElement:i,n="LI"===n.nodeName||j.isNullOrUndefined(n.closest("LI"))?n:n.closest("LI"),i="LI"===i.nodeName||"#text"===i.nodeName||j.isNullOrUndefined(i.closest("LI"))?i:i.closest("LI"),("OL"===e.commonAncestorContainer.nodeName||"UL"===e.commonAncestorContainer.nodeName||"LI"===e.commonAncestorContainer.nodeName)&&j.isNullOrUndefined(i.nextElementSibling)&&i.textContent.length===e.endOffset&&j.isNullOrUndefined(n.previousElementSibling)&&0===e.startOffset||-1!==j.Browser.userAgent.indexOf("Firefox")&&e.startContainer===e.endContainer&&e.startContainer===this.parent.editableElement&&0===e.startOffset&&1===e.endOffset?(-1!==j.Browser.userAgent.indexOf("Firefox")?j.detach(e.commonAncestorContainer.childNodes[0]):"LI"===e.commonAncestorContainer.nodeName?j.detach(e.commonAncestorContainer.parentElement):j.detach(e.commonAncestorContainer),t.event.preventDefault()):j.isNullOrUndefined(o)||e.collapsed||o.textContent!==r||(e.deleteContents(),this.parent.editableElement.querySelectorAll("li").forEach(function(e){e.firstChild&&""!==e.textContent.trim()||e.parentNode.removeChild(e)}),this.parent.editableElement.querySelectorAll("ol").forEach(function(e){e.firstChild&&""!==e.textContent.trim()||e.parentNode.removeChild(e)}),this.parent.editableElement.querySelectorAll("ul").forEach(function(e){e.firstChild&&""!==e.textContent.trim()||e.parentNode.removeChild(e)}),t.event.preventDefault())},S.prototype.onKeyUp=function(e){if(!j.isNullOrUndefined(this.commonLIParent)&&!j.isNullOrUndefined(this.commonLIParent.querySelector(".removeList"))){for(var t=this.commonLIParent.querySelector(".removeList");!j.isNullOrUndefined(t.firstChild);)this.parent.domNode.insertAfter(t.firstChild,t);j.detach(t)}if(13===e.event.keyCode)for(var n=this.parent.editableElement.querySelectorAll("UL, OL"),i=0;i<n.length;i++)j.isNullOrUndefined(n[i])||j.isNullOrUndefined(n[i].parentElement)||j.isNullOrUndefined(n[i].previousElementSibling)||"UL"!==n[i].parentElement.nodeName&&"OL"!==n[i].parentElement.nodeName||n[i].previousElementSibling.appendChild(n[i])},S.prototype.firstListBackSpace=function(e,t){var n=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset);j.isNullOrUndefined(n.closest("OL"))?j.isNullOrUndefined(n.closest("UL"))||(this.commonLIParent=n.closest("UL")):this.commonLIParent=n.closest("OL"),"LI"===n.nodeName&&0===e.startOffset&&0===e.endOffset&&j.isNullOrUndefined(n.previousSibling)&&!j.isNullOrUndefined(this.commonLIParent)&&j.isNullOrUndefined(this.commonLIParent.previousSibling)&&j.isNullOrUndefined(this.commonLIParent.parentElement.closest("OL"))&&j.isNullOrUndefined(this.commonLIParent.parentElement.closest("UL"))&&j.isNullOrUndefined(this.commonLIParent.parentElement.closest("LI"))&&((e=j.createElement("P")).innerHTML="&#8203;",n.classList.add("removeList"),this.commonLIParent.parentElement.insertBefore(e,this.commonLIParent))},S.prototype.keyDownHandler=function(e){if(13===e.event.which&&this.enterList(e),32===e.event.which&&this.spaceList(e),8===e.event.which&&this.backspaceList(e),(46===e.event.which&&"delete"===e.event.action||88===e.event.which&&"cut"===e.event.action)&&(s=(t=this.parent.nodeSelection.getRange(this.parent.currentDocument)).commonAncestorContainer,i=t.startContainer,o=t.endContainer,i=3===i.nodeType?this.domNode.blockParentNode(i):i,o=3===o.nodeType?this.domNode.blockParentNode(o):o,"UL"!==s.nodeName&&"OL"!==s.nodeName||i===o||j.isNullOrUndefined(j.closest(i,"ul"))&&j.isNullOrUndefined(j.closest(i,"ol"))||j.isNullOrUndefined(j.closest(o,"ul"))&&j.isNullOrUndefined(j.closest(o,"ol"))||s.lastElementChild!==j.closest(o,"li")||s.lastChild===o||t.collapsed||this.areAllListItemsSelected(s,t)&&j.detach(s),this.removeList(t,e)),9===e.event.which){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=(e.event.action&&"indent"===e.event.action||(this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument)),void 0),i=(t.startOffset,t.endOffset,this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset)),o=this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset);if(i!==o||"BR"!==i.nodeName&&"#text"!==i.nodeName||!(0<=ds.indexOf(i.parentNode.tagName.toLocaleLowerCase()))){e.event.action&&"indent"===e.event.action||this.domNode.setMarker(this.saveSelection);for(var n=this.domNode.blockNodes(),r=[],s=!0,a=0;a<n.length;a++)"LI"===n[a].parentNode.tagName?r.push(n[a].parentNode):"LI"===n[a].tagName&&"P"!==n[a].childNodes[0].tagName&&"OL"!==n[a].childNodes[0].tagName&&"UL"!==n[a].childNodes[0].tagName&&r.push(n[a]);1<r.length||1===r.length?(e.event.preventDefault(),e.event.stopPropagation(),this.currentAction=this.getAction(r[0]),e.event.shiftKey?(this.revertList(r,e),this.revertClean()):s=this.nestedList(r),s&&(this.cleanNode(),this.parent.editableElement.focus()),e.event.action&&"indent"===e.event.action||(this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore(),e.callBack&&e.callBack({requestType:this.currentAction,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes(),event:e.event}))):e.event.action&&"indent"===e.event.action||(e.event&&e.event.shiftKey&&"Tab"===e.event.key&&(e.event.action="tab"),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore())}}else switch(e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()}},S.prototype.spaceKeyAction=function(e){32===e.event.which&&this.spaceList(e)},S.prototype.getAction=function(e){return"OL"===e.parentNode.nodeName?"OL":"UL"},S.prototype.revertClean=function(){for(var e=this.parent.editableElement.querySelectorAll("ul, ol"),t=0;t<e.length;t++){var n=e[t].querySelectorAll("ul, ol");if(0<n.length)for(var i=0;i<n.length;i++){var o=n[i].previousSibling;o&&"LI"===o.tagName&&o.appendChild(n[i])}}},S.prototype.noPreviousElement=function(e){var t,n,i=e.querySelectorAll("ol, ul"),o=e.querySelectorAll("li"),r=this.domNode.contents(o[0])[0];if(0<o.length&&("OL"===r.nodeName||"UL"===r.nodeName)?t=o[0]:n=i[0],t)for(var s=this.domNode.contents(e)[0];s&&!this.domNode.isList(s);){var a=s.nextSibling;j.prepend([s],t),j.setStyleAttribute(e,{"list-style-type":"none"}),j.setStyleAttribute(t,{"list-style-type":""}),s=a}else if(n){var l=j.createElement("li");j.prepend([l],n);for(s=this.domNode.contents(e)[0];s&&!this.domNode.isList(s);){a=s.nextSibling;l.appendChild(s),s=a}j.prepend([n],e.parentNode),j.detach(e);var d=j.createElement("li",{styles:"list-style-type: none;"});j.prepend([d],n.parentNode),j.append([n],d)}else{d=j.createElement("li",{styles:"list-style-type: none;"}),l=(j.prepend([d],e.parentNode),j.createElement(e.parentNode.tagName));j.prepend([l],d),j.append([e],l)}},S.prototype.nestedList=function(e){for(var t=!1,n=0;n<e.length;n++){var i=this.domNode.getPreviousNode(e[n]);if(i){var t=!0,o=void 0,r=void 0,s=e[n].querySelectorAll("ol, ul"),a=e[n].querySelectorAll("li"),l=this.domNode.contents(a[0])[0];if(0<a.length&&("OL"===l.nodeName||"UL"===l.nodeName)?r=a[0]:o=s[0],o){var d=j.createElement("li");j.prepend([d],o);for(var c=this.domNode.contents(e[n])[0];c&&!this.domNode.isList(c);){var h=c.nextSibling;d.appendChild(c),c=h}j.append([o],i),j.detach(e[n])}else if(r){if("LI"===i.tagName){for(c=this.domNode.contents(e[n])[0];c&&!this.domNode.isList(c);){h=c.nextSibling;j.prepend([c],r),j.setStyleAttribute(e[n],{"list-style-type":"none"}),j.setStyleAttribute(r,{"list-style-type":""}),c=h}j.append([r.parentNode],i),j.detach(e[n])}}else"LI"===i.tagName?((d=j.createElement(e[n].parentNode.tagName)).style.listStyleType=e[n].parentNode.style.listStyleType,j.append([d],i),j.append([e[n]],d)):"OL"!==i.tagName&&"UL"!==i.tagName||j.append([e[n]],i)}else{l=e[n];t=!0,this.noPreviousElement(l)}}return t},S.prototype.applyListsHandler=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);if(-1!==j.Browser.userAgent.indexOf("Firefox")&&t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement){for(var n=t.startContainer.childNodes[0<t.startOffset?t.startOffset-1:t.startOffset]||t.startContainer,i=t.endContainer.childNodes[0<t.endOffset?t.endOffset-1:t.endOffset]||t.endContainer,o="BR"===i.lastChild.nodeName?j.isNullOrUndefined(i.lastChild.previousSibling)?i:i.lastChild.previousSibling:i.lastChild;!j.isNullOrUndefined(o)&&"#text"!==o.nodeName&&"IMG"!==o.nodeName&&"BR"!==o.nodeName&&"HR"!==o.nodeName;)o=o.lastChild;this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,n,o,0,o.textContent.length),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)}t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement&&t.startOffset===t.endOffset&&0===t.startOffset&&0===this.parent.editableElement.textContent.length&&"TABLE"!==this.parent.editableElement.childNodes[0].nodeName&&"IMG"!==this.parent.editableElement.childNodes[0].nodeName&&(i=t.startContainer.childNodes[0],this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,i,i,0,0),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)),this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument),this.currentAction=e.subCommand,this.currentAction=e.subCommand="NumberFormatList"===this.currentAction?"OL":"BulletFormatList"===this.currentAction?"UL":this.currentAction,this.domNode.setMarker(this.saveSelection);var r=this.domNode.blockNodes(!0);"BR"===e.enterAction&&(this.setSelectionBRConfig(),this.parent.domNode.convertToBlockNodes(this.parent.domNode.blockNodes(),!0),this.setSelectionBRConfig(),r=this.parent.domNode.blockNodes());for(var s=0;s<r.length;s++)"TABLE"!==r[s].tagName||t.collapsed||r.splice(s,1),0<r.length&&"LI"!==r[s].tagName&&"LI"===r[s].parentNode.tagName&&(r[s]=r[s].parentNode);this.applyLists(r,this.currentAction,e.selector,e.item,e),e.callBack&&e.callBack({requestType:this.currentAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},S.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+L.startSelection),t=this.parent.editableElement.querySelector("."+L.endSelection);j.isNullOrUndefined(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},S.prototype.applyLists=function(e,t,n,i,o){if(this.isRevert(e,t,i)&&j.isNullOrUndefined(i))this.revertList(e,o),this.removeEmptyListElements();else{this.checkLists(e,t,i);var r="";""!==e[0].style.marginLeft&&(r=' style = "margin-left: '+e[0].style.marginLeft+';"');for(var s=0;s<e.length;s++){j.isNullOrUndefined(i)||j.isNullOrUndefined(i.listStyle)||("listImage"===i.listStyle?j.setStyleAttribute(e[s],{"list-style-image":i.listImage}):(j.setStyleAttribute(e[s],{"list-style-image":"none"}),j.setStyleAttribute(e[s],{"list-style-type":i.listStyle.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}))),e[s].style.removeProperty("margin-left");var a,l,d,c,h,p,u="IMG"===e[s].tagName||e[s].classList.contains("e-editor-select-start")?"":this.domNode.attributes(e[s]);"true"===e[s].getAttribute("contenteditable")&&1===e[s].childNodes.length&&"TABLE"===e[s].childNodes[0].nodeName?((a=document.createElement(t)).innerHTML="<li><br/></li>",e[s].appendChild(a)):"LI"!==e[s].tagName&&j.isNullOrUndefined(i)&&"BLOCKQUOTE"===e[s].nodeName?(d="</"+t+">",h=e[s].innerHTML,p=(l="<"+t+r+">")+this.domNode.createTagString(c="li"+u,null,h)+d,e[s].innerHTML=p):"LI"!==e[s].tagName&&j.isNullOrUndefined(i)?(l="<"+t+r+">",d="</"+t+">",c="li"+u,h=e[s].tagName.toLowerCase()===as?e[s].innerHTML:e[s].outerHTML,p=l+this.domNode.createTagString(c,null,h)+d,this.domNode.replaceWith(e[s],p)):j.isNullOrUndefined(i)||"LI"===e[s].tagName||(l="<"+t+("IMG"===e[s].tagName?"":this.domNode.attributes(e[s]))+">",d="</"+t+">",c="li",h=e[s].tagName.toLowerCase()===as?e[s].innerHTML:e[s].outerHTML,p=l+this.domNode.createTagString(c,null,h)+d,this.domNode.replaceWith(e[s],p))}}this.cleanNode(),"BR"===o.enterAction&&document.querySelectorAll("span#removeSpan").forEach(function(e){for(var t=document.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e)}),this.parent.editableElement.focus(),vs()&&Cs(this.parent.editableElement,n),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()},S.prototype.removeEmptyListElements=function(){for(var e=this.parent.editableElement.querySelectorAll("ol, ul"),t=0;t<e.length;t++)""===e[t].textContent.trim()&&j.detach(e[t])},S.prototype.isRevert=function(e,t,n){for(var i=!0,o=0;o<e.length;o++){if("LI"!==e[o].tagName)return!1;(e[o].parentNode.tagName!==t||j.isNullOrUndefined(n)&&""!==e[o].parentNode.style.listStyleType)&&(i=!1),e[o].parentNode.tagName===t&&""!==e[o].parentNode.style.listStyleType&&(i=!0)}return i},S.prototype.checkLists=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var r=e[o].parentNode;j.isNullOrUndefined(n)||"LI"!==e[o].tagName||j.isNullOrUndefined(n.listStyle)||("listImage"===n.listStyle?j.setStyleAttribute(r,{"list-style-image":n.listImage}):(j.setStyleAttribute(r,{"list-style-image":"none"}),j.setStyleAttribute(r,{"list-style-type":n.listStyle.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}))),("LI"===e[o].tagName&&r.tagName!==t&&i.indexOf(r)<0||"LI"===e[o].tagName&&r.tagName===t&&i.indexOf(r)<0&&null!==n)&&i.push(r),j.isNullOrUndefined(n)&&(r.tagName===t||("UL"===r.tagName||"OL"===r.tagName)&&r.hasAttribute("style"))&&r.hasAttribute("style")&&r.removeAttribute("style")}for(var s=i.length-1;0<=s;s--){var a=i[s],a="<"+t.toLowerCase()+" "+this.domNode.attributes(a)+">"+a.innerHTML+"</"+t.toLowerCase()+">";this.domNode.replaceWith(i[s],a)}},S.prototype.cleanNode=function(){for(var e=this.parent.editableElement.querySelectorAll("ol + ol, ul + ul"),t=0;t<e.length;t++){for(var n,i,o=e[t],r=o;r.parentElement&&(!r.parentElement||"LI"===r.parentElement.tagName||"OL"===r.parentElement.tagName||"UL"===r.parentElement.tagName);)r=r.parentElement;if("OL"!==e[t].parentElement.parentElement.nodeName&&"UL"!==e[t].parentElement.parentElement.nodeName||(n=e[t].parentElement.parentElement.style.listStyleType,i=o.previousElementSibling),this.domNode.isList(o.previousElementSibling)&&this.domNode.openTagString(o)===this.domNode.openTagString(o.previousElementSibling)){for(var s=this.domNode.contents(o),a=0;a<s.length;a++)o.previousElementSibling.appendChild(s[a]);o.parentNode.removeChild(o)}else if(j.isNullOrUndefined(o.getAttribute("level"))){if(this.domNode.isList(o.previousElementSibling)&&r.contains(o.previousElementSibling)&&("OL"===o.tagName||"UL"===o.tagName)&&("OL"===o.previousElementSibling.nodeName||"UL"===o.previousElementSibling.nodeName)){for(s=this.domNode.contents(o),a=0;a<s.length;a++)o.previousElementSibling.appendChild(s[a]);o.parentNode.removeChild(o)}}else o.tagName===o.previousElementSibling.tagName&&o.previousElementSibling.lastChild.append(o)}if(i){i.style.listStyleType=n;for(var l=this.parent.nodeSelection.getRange(this.parent.currentDocument),d=[],d="UL"===l.commonAncestorContainer.nodeName||"OL"===l.commonAncestorContainer.nodeName?(l.commonAncestorContainer instanceof Element&&d.push(l.commonAncestorContainer),d.concat(Array.from(l.commonAncestorContainer.querySelectorAll("ol, ul")))):Array.from(l.commonAncestorContainer.querySelectorAll("ol, ul")),c=0;c<d.length;c++)for(var h=void 0,p=d[c];p;)"OL"!==p.nodeName&&"OL"!==p.nodeName||(""!==p.style.listStyleType&&"none"!==p.style.listStyleType&&"LI"!==p.nodeName?h=p.style.listStyleType:j.isNullOrUndefined(h)||""!==p.style.listStyleType&&"none"!==p.style.listStyleType||"LI"===p.nodeName||"UL"!==p.nodeName&&"OL"!==p.nodeName||(p.style.listStyleType=h)),p=p.querySelector("UL,OL")}},S.prototype.findUnSelected=function(e,t){if(0<(e=e.slice().reverse()).length){for(var n=[],i=[],o=[],r=[],o=t[t.length-1].childNodes,s=0;s<o.length;s++)if("OL"===o[s].tagName||"UL"===o[s].tagName){var a=o[s].querySelectorAll("li");if(0<a.length)for(var l=0;l<a.length;l++)r.push(a[l])}for(var d=0;d<r.length;d++){for(var c=0,h=0;h<e.length;h++)r[d].contains(e[h])||(c+=1);c===e.length&&i.push(r[d])}if(0<i.length)for(var p=0;p<i.length;p++)"OL"!==this.domNode.contents(i[p])[0].nodeName&&"UL"!==this.domNode.contents(i[p])[0].nodeName&&n.push(i[p]);0<n.length&&this.nestedList(n)}},S.prototype.revertList=function(e,t){for(var n=[],i=e.length-1;0<=i;i--)for(var o=i-1;0<=o;o--)if(e[o].contains(e[i])||e[o]===e[i]){n.push(e[i]),e.splice(i,1);break}this.findUnSelected(n,e);for(var r=[],i=0;i<e.length;i++){var s=e[i],a=(3===this.domNode.contents(s)[0].nodeType&&0===this.domNode.contents(s)[0].textContent.trim().length&&j.detach(this.domNode.contents(s)[0]),e[i].parentNode),l=s.getAttribute("class");if(0===n.length&&(h=e[i].querySelectorAll("ul, ol")[0])&&h.querySelectorAll("li")&&(c=j.createElement(h.tagName),j.append([c],h.parentNode),p=j.createElement("li",{styles:"list-style-type: none;"}),j.append([p],c),j.append([h],p)),s.parentNode.insertBefore(this.closeTag(a.tagName),s),"LI"===a.parentNode.tagName||"OL"===a.parentNode.tagName||"UL"===a.parentNode.tagName)s.parentNode.insertBefore(this.closeTag("LI"),s);else{if(0===s.querySelectorAll(ls.join(", ")).length){var d,c=j.isNullOrUndefined(l)?' class="e-rte-wrap-inner"':' class="'+l+' e-rte-wrap-inner"',h=a,p=(e.length===h.querySelectorAll("li").length&&(j.isNullOrUndefined(h.style.listStyleType)||a.style.removeProperty("list-style-type"),j.isNullOrUndefined(h.style.listStyleImage)||a.style.removeProperty("list-style-image"),0===h.style.length)&&a.removeAttribute("style"),"<"+t.enterAction+c+this.domNode.attributes(s)+"></"+t.enterAction+">");"BR"!==t.enterAction?this.domNode.wrapInner(s,this.domNode.parseHTMLFragment(p)):(d=document.createElement("br"),this.domNode.wrapInner(s,this.domNode.parseHTMLFragment("<span class=e-rte-wrap-inner id=removeSpan></span>")),s.appendChild(d))}else if(3===this.domNode.contents(s)[0].nodeType){var u=this.domNode.createTagString(as,a,this.parent.domNode.encode(this.domNode.contents(s)[0].textContent));this.domNode.replaceWith(this.domNode.contents(s)[0],u)}else if(this.domNode.contents(s)[0].classList.contains(L.startSelection)||this.domNode.contents(s)[0].classList.contains(L.endSelection)){u=this.domNode.createTagString(as,a,this.domNode.contents(s)[0].outerHTML);this.domNode.replaceWith(this.domNode.contents(s)[0],u)}else{var m=s.firstChild;if(m){var g=s.parentElement.attributes;if(0<g.length)for(var f=0;f<g.length;f++){var b=g[f],y=m.getAttribute(b.nodeName),v=s.parentElement.getAttribute(b.nodeName);m.setAttribute(b.nodeName,y?v+" "+y:v)}}(l=m.getAttribute("class"))&&m.getAttribute("class")&&j.attributes(m,{class:l+" "+m.getAttribute("class")})}j.append([this.openTag("LI")],s),j.prepend([this.closeTag("LI")],s)}this.domNode.insertAfter(this.openTag(a.tagName),s),"LI"===a.parentNode.tagName&&(a=a.parentNode.parentNode),r.indexOf(a)<0&&r.push(a)}for(i=0;i<r.length;i++){var C=r[i],N=C.innerHTML;N=(N=N.replace(/<span class="e-rte-list-close-([a-z]*)"><\/span>/g,"</$1>")).replace(/<span class="e-rte-list-open-([a-z]*)"><\/span>/g,"<$1 "+this.domNode.attributes(C)+">"),this.domNode.replaceWith(C,this.domNode.openTagString(C)+N.trim()+this.domNode.closeTagString(C))}for(var E=this.parent.editableElement.querySelectorAll("ul:empty, ol:empty"),i=0;i<E.length;i++)j.detach(E[i]);for(var S=this.parent.editableElement.querySelectorAll("li:empty"),i=0;i<S.length;i++)j.detach(S[i])},S.prototype.openTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-open-'+e.toLowerCase()+'"></span>')},S.prototype.closeTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-close-'+e.toLowerCase()+'"></span>')},S.prototype.destroy=function(){this.removeEventListener(),this.domNode&&(this.domNode=null)},S.prototype.areAllListItemsSelected=function(e,t){for(var n=e.querySelectorAll("li"),i=0;i<n.length;i++){var o=n[i];if(this.parent.currentDocument.createRange().selectNodeContents(o),!t.intersectsNode(o))return!1}return!0};var Dl=S;function S(e){this.parent=e,this.domNode=this.parent.domNode,this.addEventListener()}Ml.WrapBefore=function(e,t,n){return t.innerText=e.textContent,n?this.AppendBefore(t,e,!0):this.AppendBefore(t,e),e.parentNode&&e.parentNode.removeChild(e),t.childNodes[0]},Ml.Wrap=function(e,t){return this.AppendBefore(t,e),t.appendChild(e),e},Ml.unwrap=function(e){for(var t=e.parentNode,n=[];e.firstChild;)n.push(t.insertBefore(e.firstChild,e));return t.removeChild(e),n},Ml.AppendBefore=function(e,t,n){return t.parentNode?n?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.insertBefore(e,t):t};var F=Ml;function Ml(){}Rl.prototype.GetSpliceNode=function(e,t){return t=this.SplitNode(e,t,!0),t=this.SplitNode(e,t,!1)},Rl.prototype.SplitNode=function(e,t,n){var i,o,r;return t?(e=e.cloneRange(),i=t.parentNode,o=this.nodeSelection.getIndex(t),e.collapse(n),n?e.setStartBefore(t):e.setEndAfter(t),e=e.extractContents(),n?(t=i.childNodes[o],(e=this.spliceEmptyNode(e,!1))&&0<e.childNodes.length&&(!(1!==e.childNodes.length||"IMG"===e.childNodes[0].nodeName||0<e.querySelectorAll("img").length||!this.isRteElm(e)||""!==e.textContent.trim())||(t?F.AppendBefore(e,t):(i.appendChild(e),(r=document.createElement("div")).innerHTML="&#65279;&#65279;",t=r.firstChild,i.appendChild(t))))):(t=1<i.childNodes.length?i.childNodes[o]:i.childNodes[0],(e=this.spliceEmptyNode(e,!0))&&0<e.childNodes.length&&(!(1!==e.childNodes.length||"IMG"===e.childNodes[0].nodeName||!this.isRteElm(e)||""!==e.textContent.trim())||(t?F.AppendBefore(e,t,!0):(i.appendChild(e),(r=document.createElement("div")).innerHTML="&#65279;&#65279;",i.insertBefore(r.firstChild,i.firstChild),t=i.firstChild)))),t):null},Rl.prototype.isRteElm=function(e){var t=!0;if(1===e.childNodes.length&&"IMG"!==e.childNodes[0].nodeName)for(var n=e.childNodes[0],i=0;!j.isNullOrUndefined(n.childNodes)&&i<n.childNodes.length;i++)("IMG"===n.childNodes[i].nodeName||"SPAN"===n.childNodes[i].nodeName&&(n.childNodes[i].classList.contains("e-video-wrap")||n.childNodes[i].classList.contains("e-embed-video-wrap")||n.childNodes[i].classList.contains("e-audio-wrap")))&&(t=!1);else t=!0;return t},Rl.prototype.spliceEmptyNode=function(e,t){var n=1===e.childNodes.length&&"#text"===e.childNodes[0].nodeName&&""===e.childNodes[0].textContent||""===e.textContent?-1:e.childNodes.length-1;return-1<n&&!t?this.spliceEmptyNode(e.childNodes[n],t):-1<n?this.spliceEmptyNode(e.childNodes[0],t):3===e.nodeType||11===e.nodeType||"IMG"===e.nodeName||0<e.querySelectorAll("img").length||e.classList.contains("e-video-wrap")||e.classList.contains("e-audio-wrap")||e.parentNode.removeChild(e),e},Rl.prototype.GetCursorStart=function(e,t,n){for(var i=(e=n?e:e.reverse())[0],o=0;o<e.length&&(n?e[o]<t:e[o]>=t);o++)i=e[o];return i},Rl.prototype.GetCursorRange=function(e,t,n){for(var e=e.createRange(),i=[],o=(i.push(0),this.TrimLineBreak(n.data)),r=o.indexOf(" ",0);-1!==r;)i.indexOf(r)<0&&i.push(r),new RegExp("\\s").test(o[r-1])&&i.indexOf(r-1)<0&&i.push(r-1),new RegExp("\\s").test(o[r+1])&&i.push(r+1),r=o.indexOf(" ",r+1);return i.push(o.length),0<=i.indexOf(t.startOffset)||0<=i.indexOf(t.startOffset-1)&&(1!==t.startOffset||1===t.startOffset&&new RegExp("\\s").test(o[0]))||i[i.length-1]-1===t.startOffset&&t.endOffset!==o.length-1&&!new RegExp("\\s").test(o[0])?(e=t,this.position=1):(n=this.GetCursorStart(i,t.startOffset,!0),this.position=t.startOffset-n,0!==n&&o[n]&&" "===o[n]&&(n+=1),e.setStart(t.startContainer,n),e.setEnd(t.startContainer,this.GetCursorStart(i,t.startOffset,!1))),e},Rl.prototype.GetCursorNode=function(e,t,n){return this.GetSpliceNode(this.GetCursorRange(e,t,n),n)},Rl.prototype.TrimLineBreak=function(e){return e.replace(/(\r\n\t|\n|\r\t)/gm," ")};var Bl=Rl;function Rl(){this.enterAction="P",this.position=-1,this.nodeSelection=new bs}Il.prototype.addEventListener=function(){this.parent.observer.on(Ws,this.applyFormats,this),this.parent.observer.on(Gs,this.onKeyUp,this),this.parent.observer.on(m,this.onKeyDown,this),this.parent.observer.on(ia,this.blockQuotesHandled,this),this.parent.observer.on(f,this.destroy,this)},Il.prototype.removeEventListener=function(){this.parent.observer.off(Ws,this.applyFormats),this.parent.observer.off(Gs,this.onKeyUp),this.parent.observer.off(m,this.onKeyDown),this.parent.observer.off(f,this.destroy)},Il.prototype.getParentNode=function(e){for(;e.parentNode&&e.parentNode!==this.parent.editableElement;)e=e.parentNode;return e},Il.prototype.blockQuotesHandled=function(){this.blockquotePrevent=!0},Il.prototype.onKeyUp=function(e){var t,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=n.endContainer,o=i.lastChild;13===e.event.which&&n.startContainer===i&&3!==i.nodeType&&((t=j.createElement("p")).innerHTML="<br>",!j.isNullOrUndefined(o)&&o&&"BR"===o.nodeName&&o.previousSibling&&"TABLE"===o.previousSibling.nodeName?(i.replaceChild(t,o),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)):(o=this.parent.nodeSelection.getSelectionNodeCollectionBr(n)[0],!j.isNullOrUndefined(o)&&"BR"===o.nodeName&&o.previousSibling&&"TABLE"===o.previousSibling.nodeName&&(i.replaceChild(t,o),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)))),"BR"!==e.enterAction&&!j.isNullOrUndefined(n.startContainer)&&!j.isNullOrUndefined(n.startContainer.parentElement)&&n.startContainer===n.endContainer&&"#text"===n.startContainer.nodeName&&n.startContainer.parentElement.classList.contains("e-content")&&n.startContainer.parentElement.isContentEditable&&(t=j.createElement(e.enterAction),n.startContainer.parentElement.insertBefore(t,n.startContainer),t.appendChild(n.startContainer),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,1))},Il.prototype.getBlockParent=function(e,t){for(var n=e;e!==t;)e=(n=e).parentElement;return n},Il.prototype.onKeyDown=function(e){if(13===e.event.which&&!this.blockquotePrevent){var t=0===(s=this.parent.nodeSelection.getRange(this.parent.currentDocument)).startContainer.textContent.length||"PRE"===s.startContainer.nodeName?s.startContainer:s.startContainer.parentElement,n=0===s.endContainer.textContent.length||"PRE"===s.endContainer.nodeName?s.endContainer:s.endContainer.parentElement,i=j.closest(t,"pre"),o=j.closest(n,"pre"),t=j.closest(t,"blockquote"),r=j.closest(n,"blockquote");if(!j.isNullOrUndefined(i)&&!j.isNullOrUndefined(i.parentElement)&&"LI"===i.parentElement.tagName)return;if((j.isNullOrUndefined(i)&&!j.isNullOrUndefined(o)||!j.isNullOrUndefined(i)&&j.isNullOrUndefined(o))&&(e.event.preventDefault(),this.deleteContent(s),this.removeCodeContent(s),s=this.parent.nodeSelection.getRange(this.parent.currentDocument),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0)),13===e.event.which&&(!j.isNullOrUndefined(t)&&!j.isNullOrUndefined(r)||!j.isNullOrUndefined(t)&&j.isNullOrUndefined(r))&&(8203===(a=this.getBlockParent(s.startContainer,t)).textContent.charCodeAt(0)&&1===a.textContent.length||0===a.textContent.length&&0===a.querySelectorAll("img").length&&0===a.querySelectorAll("table").length)&&(e.event.preventDefault(),j.isNullOrUndefined(a.nextElementSibling)||(new Bl).SplitNode(s,a.parentElement,!1).cloneNode(!0),this.paraFocus(a.parentElement===this.parent.editableElement?a:a.parentElement)),13===e.event.which&&!j.isNullOrUndefined(i)&&!j.isNullOrUndefined(o)){e.event.preventDefault(),this.deleteContent(s),this.removeCodeContent(s);var s,n=(s=this.parent.nodeSelection.getRange(this.parent.currentDocument)).startContainer.childNodes[s.endOffset],r=s.startContainer.childNodes[s.endOffset-1],a=s.startContainer;if(j.isNullOrUndefined(n)||j.isNullOrUndefined(r)||!j.isNullOrUndefined(n.nextSibling)||"BR"!==n.nodeName||"BR"!==r.nodeName)if(8203===a.textContent.charCodeAt(0)&&1===a.textContent.length||0===a.textContent.length){for(;"PRE"!==a.parentElement.nodeName&&(1===a.textContent.length||0===a.textContent.length);)a=a.parentElement;!j.isNullOrUndefined(a.previousSibling)&&"BR"===a.previousSibling.nodeName&&j.isNullOrUndefined(a.nextSibling)?this.paraFocus(a.parentElement):this.isNotEndCursor(i,s)}else this.isNotEndCursor(i,s);else this.paraFocus(s.startContainer,e.enterAction)}}this.blockquotePrevent=!1},Il.prototype.removeCodeContent=function(e){var t,n=new RegExp("\ufeff","g");j.isNullOrUndefined(e.endContainer.textContent.match(n))||(t=65279===e.endContainer.textContent.charCodeAt(e.endOffset-1)?e.endOffset-2:e.endOffset,e.endContainer.textContent=e.endContainer.textContent.replace(n,""),""===e.endContainer.textContent?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer.parentElement,0):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer,t))},Il.prototype.deleteContent=function(e){e.startContainer===e.endContainer&&e.startOffset===e.endOffset||e.deleteContents()},Il.prototype.paraFocus=function(e,t){var n;"DIV"===t?(n=j.createElement("div")).innerHTML="<br>":"BR"===t?n=j.createElement("br"):(n=j.createElement("p")).innerHTML="<br>",this.parent.domNode.insertAfter(n,e),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),j.detach(e.lastChild)},Il.prototype.isNotEndCursor=function(e,t){var n,i=new Bl,o=t.startOffset===e.lastChild.textContent.length&&e.lastChild.textContent===t.startContainer.textContent;0===e.textContent.indexOf(t.startContainer.textContent)&&(0===t.startOffset&&0===t.endOffset||"PRE"===t.startContainer.nodeName)?(this.insertMarker(e,t),n=j.createElement("br"),e.childNodes[t.endOffset].parentElement.insertBefore(n,e.childNodes[t.endOffset])):(n=i.SplitNode(t,e,!0),this.insertMarker(e,t),"PRE"===(i=e.previousElementSibling).tagName&&(i.insertAdjacentHTML("beforeend","<br>"+n.innerHTML),j.detach(e))),this.setCursorPosition(o,e)},Il.prototype.setCursorPosition=function(e,t){var n=!1,i=this.parent.editableElement.querySelector(".tempSpan"),o=i.parentElement;""===i.parentNode.textContent?n=!0:this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e?n?o===t?(this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),j.detach(i)):this.focusSelectionParent(i,o):(e=j.createElement("br"),this.parent.domNode.insertAfter(e,i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),j.detach(i)):n?this.focusSelectionParent(i,o):j.detach(i)},Il.prototype.focusSelectionParent=function(e,t){j.detach(e),t.innerHTML="",this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)},Il.prototype.insertMarker=function(e,t){var n=j.createElement("span",{className:"tempSpan"});"PRE"===t.startContainer.nodeName?e.childNodes[t.endOffset].parentElement.insertBefore(n,e.childNodes[t.endOffset]):t.startContainer.parentElement.insertBefore(n,t.startContainer)},Il.prototype.applyFormats=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=!1,t=(this.parent.editableElement!==t.endContainer||j.isNullOrUndefined(this.parent.editableElement.children[t.endOffset-1])||"TABLE"!==this.parent.editableElement.children[t.endOffset-1].tagName||t.collapsed||(n=!0),this.parent.nodeSelection.save(t,this.parent.currentDocument)),i=(this.parent.domNode.setMarker(t),this.parent.domNode.blockNodes(!0));if("BR"===e.enterAction){this.setSelectionBRConfig();var o=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),r=this.parent.nodeSelection.getSelectionNodes(o),s=[];0===r.length&&r.push(i[0]);for(var a=0;a<r.length;a++){for(var l=r[a],d=void 0;!this.parent.domNode.isBlockNode(l)&&l!==this.parent.editableElement;)l=(d=l).parentElement;this.parent.domNode.isBlockNode(l)&&l===this.parent.editableElement&&s.push(d)}for(a=0;a<s.length;a++)if(!this.parent.domNode.isBlockNode(s[a])){for(var c=l=s[a];l===this.parent.editableElement;)l=(c=l).parentElement;for(var h=void 0,p=(this.parent.domNode.isBlockNode(c.parentElement)&&c.parentElement===this.parent.editableElement?(h=j.createElement("div"),c.parentElement.insertBefore(h,c),h.appendChild(c),0===c.textContent.length&&c.appendChild(j.createElement("br"))):h=c,h.previousSibling);!j.isNullOrUndefined(p)&&"BR"!==p.nodeName&&!this.parent.domNode.isBlockNode(p);)h.firstChild.parentElement.insertBefore(p,h.firstChild),p=h.previousSibling;j.isNullOrUndefined(p)||"BR"!==p.nodeName||j.detach(p);for(var u=h.nextSibling;!j.isNullOrUndefined(u)&&"BR"!==u.nodeName&&!this.parent.domNode.isBlockNode(u);)h.appendChild(u),u=h.nextSibling;j.isNullOrUndefined(u)||"BR"!==u.nodeName||j.detach(u)}this.setSelectionBRConfig(),i=this.parent.domNode.blockNodes()}for(var m=!1,g=!1,a=0;a<i.length;a++)(j.isNullOrUndefined(j.closest(i[0],"blockquote"))||j.isNullOrUndefined(j.closest(i[i.length-1],"blockquote")))&&(g=!0);for(a=0;a<i.length;a++){var f,b,y,v,C=void 0,N=void 0,N="blockquote"===e.subCommand.toLowerCase()?(C=this.getParentNode(i[a]),"BR"===e.enterAction?C.innerHTML:(!j.isNullOrUndefined(j.closest(i[a],"table"))&&this.parent.editableElement.contains(j.closest(i[a],"table"))?j.isNullOrUndefined(j.closest(i[a],"blockquote"))?i[a]:j.closest(i[a],"blockquote"):C).outerHTML):(C=i[a]).innerHTML;"blockquote"===e.subCommand.toLowerCase()&&e.subCommand.toLowerCase()===C.tagName.toLowerCase()&&g||e.subCommand.toLowerCase()===C.tagName.toLowerCase()&&("pre"!==e.subCommand.toLowerCase()&&"blockquote"!==e.subCommand.toLowerCase()||!j.isNullOrUndefined(e.exeValue)&&"dropDownSelect"===e.exeValue.name)||j.isNullOrUndefined(C.parentNode)||"TABLE"===C.tagName&&"pre"===e.subCommand.toLowerCase()||(this.cleanFormats(C,e.subCommand),f="pre"===e.subCommand.toLowerCase()&&"pre"===C.tagName.toLowerCase()?"p":e.subCommand,v=e.subCommand.toLowerCase()===C.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase()&&this.parent.domNode.isList(C.firstElementChild),y="TABLE"!==C.tagName||j.isNullOrUndefined(j.closest(i[a],"blockquote"))?C:j.closest(i[a],"blockquote"),y=e.subCommand.toLowerCase()===y.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase(),b=void 0,v?b=N.replace("<blockquote>","").replace("</blockquote>",""):y&&j.closest(i[0],"blockquote")&&j.closest(i[i.length-1],"blockquote")?j.isNullOrUndefined(i[0].previousSibling)&&j.isNullOrUndefined(i[i.length-1].nextSibling)?b=N.replace(/<blockquote[^>]*>|<\/blockquote>/g,""):(m=!0,0===a&&((v=j.createElement("span")).classList.add("e-rte-blockquote-close"),i[a].parentNode.insertBefore(v,i[a])),a===i.length-1&&((y=j.createElement("span")).classList.add("e-rte-blockquote-open"),this.parent.domNode.insertAfter(y,i[a]))):b=this.parent.domNode.createTagString(f,"blockquote"===e.subCommand.toLowerCase()?null:C,N.replace(/>\s+</g,"><")),"LI"===C.tagName?(C.innerHTML="",C.insertAdjacentHTML("beforeend",b)):m||(v=!j.isNullOrUndefined(j.closest(i[a],"table"))&&this.parent.editableElement.contains(j.closest(i[a],"table"))?j.isNullOrUndefined(j.closest(i[a],"blockquote"))?i[a]:j.closest(i[a],"blockquote"):C,this.parent.domNode.replaceWith(v,b)))}if(m)for(var E=this.parent.editableElement.querySelectorAll(".e-rte-blockquote-open, .e-rte-blockquote-close"),a=0;a<E.length;a++){var S=E[a].parentElement,T=S.innerHTML;if(T=(T=T.replace(/<span class="e-rte-blockquote-open"><\/span>/g,"<blockquote>")).replace(/<span class="e-rte-blockquote-close"><\/span>/g,"</blockquote>"),E[0].parentElement===E[1].parentElement){this.parent.domNode.replaceWith(S,this.parent.domNode.openTagString(S)+T.trim()+this.parent.domNode.closeTagString(S));break}a!==E.length-1||j.isNullOrUndefined(E[a])||j.isNullOrUndefined(E[a-1])||E[a].parentElement===E[a-1].parentElement?this.parent.domNode.replaceWith(S,this.parent.domNode.openTagString(S)+T.trim()+this.parent.domNode.closeTagString(S)):this.parent.domNode.replaceWith(S,T.trim())}this.preFormatMerge(),this.blockquotesFormatMerge(e.enterAction);var o=this.parent.editableElement.querySelector("."+L.startSelection),O=this.parent.editableElement.querySelector("."+L.endSelection);j.isNullOrUndefined(o)||j.isNullOrUndefined(O)||(o=o.lastChild,O=O.lastChild),t=this.parent.domNode.saveMarker(t),vs()&&Cs(this.parent.editableElement,e.selector),n?this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,o,O,0,O.textContent.length):t.restore(),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},Il.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+L.startSelection),t=this.parent.editableElement.querySelector("."+L.endSelection);j.isNullOrUndefined(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},Il.prototype.preFormatMerge=function(){var e=this.parent.editableElement.querySelectorAll("PRE");if(!j.isNullOrUndefined(e))for(var t=0;t<e.length;t++){var n=e[t].previousElementSibling;j.isNullOrUndefined(n)||"PRE"!==n.tagName||(n.insertAdjacentHTML("beforeend","<br>"+e[t].innerHTML),j.detach(e[t]))}},Il.prototype.blockquotesFormatMerge=function(e){var t=this.parent.editableElement.querySelectorAll("BLOCKQUOTE");if(!j.isNullOrUndefined(t))for(var n=0;n<t.length;n++){""===t[n].innerHTML.trim()&&j.detach(t[n]);var i=t[n].previousElementSibling;j.isNullOrUndefined(i)||"BLOCKQUOTE"!==i.tagName||(i.insertAdjacentHTML("beforeend",("BR"===e?"<br>":"")+t[n].innerHTML),j.detach(t[n]))}},Il.prototype.cleanFormats=function(e,t){var n=["display","font-size","margin-top","margin-bottom","margin-left","margin-right","font-weight"];t=t.toLowerCase();for(var i=0;i<n.length&&"p"!==t&&"blockquote"!==t&&"pre"!==t;i++)e.style.removeProperty(n[i])},Il.prototype.destroy=function(){this.removeEventListener()};var Al=Il;function Il(e){this.blockquotePrevent=!1,this.parent=e,this.addEventListener()}Pl.Insert=function(e,t,n,i,o){r="string"==typeof t?((r=document.createElement("div")).innerHTML=t,i?r:r.firstChild):i&&(j.isNullOrUndefined(t)||j.isNullOrUndefined(t.classList)||!t.classList.contains("pasteContent"))?((r=document.createElement("div")).appendChild(t),r):t;var r,s=new bs,a=new Bl,l=((p=s.getRange(e)).startContainer!==n||p.startContainer!==p.endContainer||0!==p.startOffset||p.startOffset!==p.endOffset||0!==n.textContent.length||"P"!==n.children[0].tagName&&"DIV"!==n.children[0].tagName&&"BR"!==n.children[0].tagName||(s.setSelectionText(e,p.startContainer.children[0],p.startContainer.children[0],0,0),p=s.getRange(e)),p.startContainer===n&&p.startContainer===p.endContainer&&0===p.startOffset&&p.startOffset===p.endOffset&&0<n.textContent.trim().length&&(l=this.findFirstTextNode(p.startContainer),j.isNullOrUndefined(l)||(s.setSelectionText(e,l,l,0,0),p=s.getRange(e))),"BR"===p.startContainer.nodeName&&0===p.startOffset&&p.startOffset===p.endOffset&&p.startContainer===p.endContainer&&(l=Array.prototype.slice.call(p.startContainer.parentElement.childNodes).indexOf(p.startContainer),s.setSelectionText(e,p.startContainer.parentElement,p.startContainer.parentElement,l,l),p=s.getRange(e)),p.startOffset===p.endOffset&&0===p.startOffset&&p.startContainer===p.endContainer),d=p.collapsed,c=this.getNodeCollection(p,s,r),h="table"===r.nodeName.toLowerCase()?j.isNullOrUndefined(c[0])?p.startContainer:this.closestEle(c[0].parentNode,n):c[0];if(h&&"LI"===h.nodeName&&"table"===r.nodeName.toLowerCase())this.insertTableInList(p,r,h,c[0],a);else if(!l||""!==p.startContainer.textContent||"BR"===p.startContainer.nodeName||"BR"===o||"#text"===r.nodeName||j.isNullOrUndefined(r.children[0])||j.isNullOrUndefined(r.children[0].tagName)||"IMG"!==r.children[0].tagName||1!==r.children.length||(p.startContainer.innerHTML=""),i||!j.isNullOrUndefined(r)&&!j.isNullOrUndefined(r.classList)&&r.classList.contains("pasteContent"))this.pasteInsertHTML(c,r,p,s,a,e,d,h,n,o);else if(n!==p.startContainer&&(!d&&(h.nodeType!==Node.ELEMENT_NODE||-1===cs.indexOf(h.tagName.toLocaleLowerCase()))||"table"===r.nodeName.toLowerCase()&&h&&-1===cs.indexOf(h.tagName.toLocaleLowerCase()))){var p,i=a.GetSpliceNode(p,h),o=i.previousSibling,u=i.parentNode;if(1===c.length||"table"===r.nodeName.toLowerCase()&&0===i.childElementCount?s.setSelectionContents(e,i):(d=a.GetSpliceNode(p,c[c.length-1].parentElement),d=j.isNullOrUndefined(d)?i:d,s.setSelectionText(e,i,d,0,(3===d.nodeType?d.textContent:d.childNodes).length)),null!==(p=s.getRange(e)).startContainer.parentElement.closest("ol,ul")&&null!==p.endContainer.parentElement.closest("ol,ul")){var m=p;if(null!==m.startContainer.parentElement.closest("ol,ul")&&null!==m.endContainer.parentElement.closest("ol,ul")){for(m.extractContents();0<("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("li :empty").length||0<("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("ol :empty").length;){var g=("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("li :empty");if(!(0<g.length))break;g.forEach(function(e){e.remove()})}h=("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("li");0<h.length&&h.forEach(function(e){j.isNullOrUndefined(e.firstChild)||"OL"!==e.firstChild.nodeName&&"UL"!==e.firstChild.nodeName||(e.style.listStyleType="none")})}}else p.extractContents();"TABLE"===t.tagName&&this.removeEmptyElements(n);for(var f=0;f<c.length;f++)3!==c[f].nodeType&&null!=c[f].parentNode&&"IMG"!==c[f].nodeName&&c[f].parentNode.removeChild(c[f]);if(j.isNullOrUndefined(o)||j.isNullOrUndefined(o.parentNode)){for(var b=null;u!==n&&u.firstChild&&""===u.textContent.trim();)b=u,u=u.parentNode;(u=null!==b?b:u).firstChild&&(u!==n||"TABLE"===r.nodeName&&l&&u===p.startContainer&&u===p.endContainer)?""===u.textContent.trim()&&u!==n?(F.AppendBefore(r,u,!1),j.detach(u)):F.AppendBefore(r,u.firstChild,!1):j.isNullOrUndefined(i.previousSibling)&&"TABLE"===t.tagName?u.prepend(r):u.appendChild(r)}else F.AppendBefore(r,o,!0);"IMG"===r.nodeName?this.imageFocus(r,s,e):3!==r.nodeType?s.setSelectionText(e,r,r,0,r.childNodes.length):s.setSelectionText(e,r,r,0,r.textContent.length)}else p.deleteContents(),l&&""===p.startContainer.textContent&&"BR"!==p.startContainer.nodeName&&(p.startContainer.innerHTML=""),j.Browser.isIE?((a=e.createDocumentFragment()).appendChild(r),p.insertNode(a)):1===p.startContainer.nodeType&&"hr"===p.startContainer.nodeName.toLowerCase()&&"hr"===p.endContainer.nodeName.toLowerCase()?(d=p.startContainer.nextElementSibling)&&(d.querySelector("br")&&j.detach(d.querySelector("br")),d.appendChild(r)):"BR"===p.startContainer.nodeName?p.startContainer.parentElement.insertBefore(r,p.startContainer):p.insertNode(r),3!==r.nodeType&&0<r.childNodes.length?s.setSelectionText(e,r,r,1,1):"IMG"===r.nodeName?this.imageFocus(r,s,e):3!==r.nodeType?s.setSelectionContents(e,r):s.setSelectionText(e,r,r,r.textContent.length,r.textContent.length)},Pl.findFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.findFirstTextNode(e.childNodes[t]);if(!j.isNullOrUndefined(n))return n}return null},Pl.pasteInsertHTML=function(e,t,n,i,o,r,s,a,l,d){for(var c,h,p,u,m=n.startOffset===n.endOffset&&n.startContainer===n.endContainer,g=(m&&n.startContainer===l&&""===l.textContent&&(L=this.getImmediateBlockNode(e[e.length-1],l),i.setSelectionText(r,L,L,0,0),n=i.getRange(r)),l!==n.startContainer&&(!s&&(a.nodeType!==Node.ELEMENT_NODE||-1===cs.indexOf(a.tagName.toLocaleLowerCase()))||"table"===t.nodeName.toLowerCase()&&a&&-1===cs.indexOf(a.tagName.toLocaleLowerCase()))&&(u=o.GetSpliceNode(n,a),j.isNullOrUndefined(u)||(h=(j.isNullOrUndefined(u.previousSibling)?u.parentNode:u).previousSibling,p=1===e.length?(i.setSelectionContents(r,u),n=i.getRange(r),!0):(c=o.GetSpliceNode(n,e[e.length-1].parentElement),c=j.isNullOrUndefined(c)?u:c,i.setSelectionText(r,u,c,0,(3===c.nodeType?c.textContent:c.childNodes).length),n=i.getRange(r),!1))),!1),f=(this.removingComments(t),t.childNodes),b=0;b<f.length;b++)if(0<=ls.indexOf(f[b].nodeName.toLocaleLowerCase())){g=!0;break}var y=document.createDocumentFragment();if(g){for(var v=n.startContainer;!j.isNullOrUndefined(v)&&"PRE"!==v.nodeName&&v!==l;)v=v.parentElement;if(j.isNullOrUndefined(t)||j.isNullOrUndefined(v)||"PRE"!==v.nodeName){this.insertTempNode(n,t,e,o,l);var C,N,E=!0,S=void 0,T=void 0,O=void 0;for(this.contentsDeleted||(s||0!==n.startContainer.parentElement.textContent.length||"BR"!==n.startContainer.nodeName||"P"!==n.startContainer.parentElement.nodeName||l.removeChild(n.startContainer.parentElement),n.deleteContents());t.firstChild;)"#text"===t.firstChild.nodeName&&""===t.firstChild.textContent.trim()?j.detach(t.firstChild):"#text"===t.firstChild.nodeName&&E||0<=this.inlineNode.indexOf(t.firstChild.nodeName.toLocaleLowerCase())&&E?(N=t.firstChild,j.isNullOrUndefined(t.previousElementSibling)&&(C="DIV"===d?j.createElement("div"):j.createElement("p"),t.parentElement.insertBefore(C,t)),"BR"===t.previousElementSibling.nodeName?t.parentElement.insertBefore(t.firstChild,t):t.previousElementSibling.appendChild(t.firstChild)):(N=t.firstChild,S="#text"===t.firstChild.nodeName||0<=this.inlineNode.indexOf(t.firstChild.nodeName.toLocaleLowerCase())?(S?(O.appendChild(t.firstChild),y.appendChild(O)):((T="DIV"===d?j.createElement("div"):j.createElement("p")).appendChild(t.firstChild),y.appendChild(T)),O=T,!0):(y.appendChild(t.firstChild),!1),E=!1);t.parentNode.replaceChild(y,t)}else n.insertNode(t),N=t.lastChild}else if(m){var L=j.createElement("span",{className:"tempSpan"}),a=j.closest(n.startContainer.parentElement,"a");for(3===n.startContainer.nodeType&&a&&j.closest(a,"span")?(0<(e=this.getImmediateBlockNode(n.startContainer,l)).querySelectorAll("br").length&&j.detach(e.querySelector("br")),j.closest(a,"span").appendChild(L)):n.insertNode(L);t.firstChild;)N=t.firstChild,y.appendChild(t.firstChild);L.parentNode.replaceChild(y,L)}else{for(;t.firstChild;)N=t.firstChild,y.appendChild(t.firstChild);p?u.parentNode.replaceChild(y,u):(o=l===n.startContainer?n.startContainer:n.startContainer.parentNode,s=Array.prototype.indexOf.call(o.childNodes,-1!==j.Browser.userAgent.indexOf("Firefox")&&l===n.startContainer?n.startContainer.firstChild:n.startContainer),n.deleteContents(),n.setStart(o,s),n.setEnd(o,s),j.isNullOrUndefined(c)||c===l||j.detach(c),j.isNullOrUndefined(h)?n.insertNode(y):(h.parentNode===l?h:h.parentNode).appendChild(y))}"TABLE"===N.nodeName&&((m=j.createElement("p")).appendChild(j.createElement("br")),N.parentElement.insertBefore(m,N.nextSibling),N=m),"#text"===N.nodeName?this.placeCursorEnd(N,t,i,r,l):this.cursorPos(N,t,i,r,l,d),this.alignCheck(l)},Pl.placeCursorEnd=function(e,t,n,i,o){for(e="BR"===e.nodeName?j.isNullOrUndefined(e.previousSibling)?e.parentNode:e.previousSibling:e;!j.isNullOrUndefined(e)&&"#text"!==e.nodeName&&"IMG"!==e.nodeName&&"BR"!==e.nodeName&&"HR"!==e.nodeName;){var r;j.isNullOrUndefined(e.lastChild)||"P"!==e.lastChild.nodeName||""!==e.lastChild.innerHTML||(r=j.createElement("br"),e.lastChild.appendChild(r)),e=e.lastChild}"IMG"===(e=j.isNullOrUndefined(e)?t:e).nodeName?this.imageFocus(e,n,i):n.setSelectionText(i,e,e,e.textContent.length,e.textContent.length),this.removeEmptyElements(o)},Pl.getNodeCollection=function(e,t,n){var i=[];return e.startOffset===e.endOffset&&e.startContainer===e.endContainer&&"BR"!==e.startContainer.nodeName&&0<e.startContainer.childNodes.length&&("TD"===e.startContainer.nodeName||3!==e.startContainer.nodeType&&n.classList&&n.classList.contains("pasteContent"))?i.push(e.startContainer.childNodes[e.endOffset]):i=t.getInsertNodeCollection(e),i},Pl.insertTempNode=function(e,t,n,i,o){if(e.startContainer!==o||j.isNullOrUndefined(e.startContainer.childNodes[e.endOffset-1])||"TABLE"!==e.startContainer.childNodes[e.endOffset-1].nodeName)if(e.startContainer!==o||j.isNullOrUndefined(e.startContainer.childNodes[e.endOffset])||"TABLE"!==e.startContainer.childNodes[e.endOffset].nodeName)if(e.startContainer===e.endContainer&&3!==e.startContainer.nodeType&&"HR"===t.firstChild.nodeName)e.startContainer.classList.contains("e-content")||"BODY"===e.startContainer.nodeName?e.startContainer.appendChild(t):e.startContainer.parentNode.insertBefore(t,e.startContainer);else{n=this.getImmediateBlockNode(n[n.length-1],o);if((j.isNullOrUndefined(n)||j.isNullOrUndefined(n.parentElement))&&3!==e.endContainer.nodeType&&(n=e.endContainer,e.setEnd(n,e.endContainer.textContent.length)),(n="BODY"===n.nodeName&&e.startContainer===e.endContainer&&1===e.startContainer.nodeType?e.startContainer:n).closest("LI")&&"TD"!==n.nodeName&&"TH"!==n.nodeName&&"TR"!==n.nodeName&&t&&t.firstElementChild&&("OL"===t.firstElementChild.tagName||"UL"===t.firstElementChild.tagName))for(var r=void 0;t.firstElementChild.lastElementChild&&"LI"===t.firstElementChild.lastElementChild.tagName;)(r=t.firstElementChild.lastElementChild).style.removeProperty("margin-left"),r.style.removeProperty("margin-top"),r.style.removeProperty("margin-bottom"),t.firstElementChild.insertAdjacentElement("afterend",r);if("TD"===n.nodeName||"TH"===n.nodeName||"TR"===n.nodeName){var s=j.createElement("span",{className:"tempSpan"});e.insertNode(s),s.parentNode.replaceChild(t,s)}else{var s=new bs,s=this.getNodeCollection(e,s,t)[this.getNodeCollection(e,s,t).length-1],a=void 0;if("BR"!==s.nodeName&&"HR"!==s.nodeName&&("#text"!==s.nodeName||j.isNullOrUndefined(s.parentElement)||"LI"!==s.parentElement.nodeName)||j.isNullOrUndefined(s.parentElement)||0!==s.parentElement.textContent.trim().length){if(("#text"===s.nodeName||"BR"===s.nodeName)&&!j.isNullOrUndefined(s.parentElement)&&("LI"===s.parentElement.nodeName||s.parentElement.closest("LI")||n===o&&s.parentElement===n)&&0<s.parentElement.textContent.trim().length)return"LI"!==(a=s).parentElement.nodeName||j.isNullOrUndefined(s.nextSibling)||"BR"!==s.nextSibling.nodeName||j.detach(s.nextSibling),e.collapsed||this.removeListfromPaste(e),e.insertNode(t),void(this.contentsDeleted=!0);a=i.GetSpliceNode(e,n)}else if("LI"!==(a=s).parentElement.nodeName||j.isNullOrUndefined(s.nextSibling)||"BR"!==s.nextSibling.nodeName||j.detach(s.nextSibling),"LI"===s.parentElement.nodeName&&""===s.parentElement.textContent)return this.removeListfromPaste(e),e.insertNode(t),void(this.contentsDeleted=!0);a.parentNode.replaceChild(t,a)}}else e.startContainer.insertBefore(t,e.startContainer.childNodes[e.endOffset]);else j.isNullOrUndefined(e.startContainer.childNodes[e.endOffset-1].nextSibling)?e.startContainer.appendChild(t):e.startContainer.insertBefore(t,e.startContainer.childNodes[e.endOffset-1].nextSibling)},Pl.cursorPos=function(e,t,n,i,o,r){e.classList.add("lastNode"),o.innerHTML=function(e,t){var n=document.createElement("div"),i=(n.innerHTML=e,n.setAttribute("class","tempDiv"),document.createElement("div"));if(0<n.childNodes.length){for(var o=void 0,r=void 0,s=void 0;n.firstChild;)"#text"===n.firstChild.nodeName&&(n.firstChild.textContent.indexOf("\n")<0||""!==n.firstChild.textContent.trim())||0<=ys.indexOf(n.firstChild.nodeName.toLocaleLowerCase())?o?(r.appendChild(n.firstChild),r=s,o=!0):"BR"===t?(i.appendChild(n.firstChild),r=i):(s=j.createElement("p"),i.appendChild(s),s.appendChild(n.firstChild),r=s,o=!0):"#text"===n.firstChild.nodeName&&("\n"===n.firstChild.textContent||0<=n.firstChild.textContent.indexOf("\n")&&""===n.firstChild.textContent.trim())?j.detach(n.firstChild):(i.appendChild(n.firstChild),o=!1);for(var a=i.querySelectorAll("table"),l=0;l<a.length;l++)if(0<a[l].classList.length&&!a[l].classList.contains("e-rte-table"))if(a[l].classList.add("e-rte-paste-table"),a[l].classList.contains("e-rte-paste-word-table"))a[l].classList.remove("e-rte-paste-word-table");else if(a[l].classList.contains("e-rte-paste-excel-table")){a[l].classList.remove("e-rte-paste-excel-table"),"0"===a[l].getAttribute("border")&&a[l].removeAttribute("border");for(var d=a[l].querySelectorAll("td"),c=0;c<d.length;c++)"none"===d[c].style.borderLeft&&d[c].style.removeProperty("border-left"),"none"===d[c].style.borderRight&&d[c].style.removeProperty("border-right"),"none"===d[c].style.borderBottom&&d[c].style.removeProperty("border-bottom"),"none"===d[c].style.borderTop&&d[c].style.removeProperty("border-top"),"none"===d[c].style.border&&d[c].style.removeProperty("border")}else a[l].classList.contains("e-rte-paste-onenote-table")?a[l].classList.remove("e-rte-paste-onenote-table"):a[l].classList.contains("e-rte-paste-html-table")&&a[l].classList.remove("e-rte-paste-html-table");for(var h=i.querySelectorAll("img"),l=0;l<h.length;l++)h[l].classList.contains("e-rte-image-unsupported")||(h[l].classList.contains("e-rte-image")||h[l].classList.add("e-rte-image"),h[l].classList.contains("e-imginline"))||h[l].classList.contains("e-imgbreak")||h[l].classList.add("e-imginline")}return i.innerHTML}(o.innerHTML,r),e=o.querySelector(".lastNode"),j.isNullOrUndefined(e)||(this.placeCursorEnd(e,t,n,i,o),e.classList.remove("lastNode"),0===e.classList.length&&e.removeAttribute("class"))},Pl.imageFocus=function(e,t,n){var i,o,r=document.createTextNode(" ");e.parentNode&&"A"===e.parentNode.nodeName?((o=(i=e.parentNode).parentNode).insertBefore(r,i.nextSibling),o.insertBefore(e,r)):e.parentNode.insertBefore(r,e.nextSibling),t.setSelectionText(n,e.nextSibling,e.nextSibling,0,0)},Pl.getImmediateBlockNode=function(e,t){for(;(e=e.parentNode)&&ls.indexOf(e.nodeName.toLocaleLowerCase())<0;);return e},Pl.removingComments=function(e){var t=(t=e.innerHTML).replace(/<!--[\s\S]*?-->/g,"");e.innerHTML=t},Pl.findDetachEmptyElem=function(e){return j.isNullOrUndefined(e.parentElement)?null:!(0<e.parentElement.textContent.length&&e.parentElement.textContent.match(/\u00a0/g)&&0<e.parentElement.textContent.match(/\u00a0/g).length)&&""===e.parentElement.textContent.trim()&&"true"!==e.parentElement.contentEditable&&j.isNullOrUndefined(e.parentElement.querySelector("img"))&&"TD"!==e.parentElement.nodeName&&"TH"!==e.parentElement.nodeName?this.findDetachEmptyElem(e.parentElement):e},Pl.removeEmptyElements=function(e){for(var e=e.querySelectorAll(":empty"),t=Array.from(e).filter(function(e){return!e.closest("svg")&&!e.closest("canvas")}),n=0;n<t.length;n++){var i=!0;"DIV"===t[n].tagName&&(i="none"===t[n].style.borderBottom||""===t[n].style.borderBottom),gs.indexOf(t[n].tagName.toLowerCase())<0&&i&&(i=this.findDetachEmptyElem(t[n]),j.isNullOrUndefined(i)||j.detach(i))}},Pl.closestEle=function(e,t){var n=e;if(j.closest(n,"li"))return j.closest(n,"li");for(;n&&1===n.nodeType;){if(n.parentNode===t||!j.isNullOrUndefined(n.parentNode.tagName)&&-1!==ds.indexOf(n.parentNode.tagName.toLocaleLowerCase()))return n;n=n.parentNode}return null},Pl.insertTableInList=function(e,t,n,i,o){var r,s;e.collapsed?(r=0===e.startOffset,s=e.startContainer.textContent.trimEnd().length===e.startOffset,r||s?r?F.AppendBefore(t,i,!1):F.AppendBefore(t,i,!0):o.SplitNode(e,n,!0).previousSibling.appendChild(t)):(e.deleteContents(),n.appendChild(t)),t.classList.add("ignore-table")},Pl.alignCheck=function(e){for(var t=e.querySelectorAll('span[style*="text-align"]'),n=0;n<t.length;n++){var i=t[n];if(i){var o=this.getImmediateBlockNode(i,null);if(o){for(var r="",s=0;s<t.length;s++){var a=t[s];o.contains(a)&&(r+=a.textContent)}o.textContent.trim()===r.trim()&&(o.style.textAlign=i.style.textAlign)}}}},Pl.removeListfromPaste=function(e){e.deleteContents();e=e.startContainer;j.isNullOrUndefined(e)||"LI"!==e.nodeName||j.isNullOrUndefined(e.parentElement)||"OL"!==e.parentElement.nodeName&&"UL"!==e.parentElement.nodeName||""!==e.textContent.trim()||e.parentElement.querySelectorAll("li").forEach(function(e){""===e.textContent.trim()&&e.remove()})},Pl.inlineNode=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"],Pl.contentsDeleted=!1;var Ul=Pl;function Pl(){}jl.prototype.addEventListener=function(){this.parent.observer.on(Kr,this.linkCommand,this),this.parent.observer.on(f,this.destroy,this)},jl.prototype.removeEventListener=function(){this.parent.observer.off(Kr,this.linkCommand),this.parent.observer.off(f,this.destroy)},jl.prototype.linkCommand=function(e){switch(e.value.toString().toLocaleLowerCase()){case"createlink":case"editlink":this.createLink(e);break;case"openlink":this.openLink(e);break;case"removelink":this.removeLink(e)}},jl.prototype.createLink=function(e){var t,n,i,o=!j.isNullOrUndefined(e.item.selectParent)&&0<e.item.selectParent.length&&j.closest(e.item.selectParent[0],"a"),o=j.isNullOrUndefined(o)?!j.isNullOrUndefined(e.item.selectParent)&&0<e.item.selectParent.length?e.item.selectParent[0]:null:o;j.isNullOrUndefined(o)||"A"!==o.tagName?("#text"!==(t=(n=new bs).getRange(this.parent.currentDocument)).endContainer.nodeName||t.startContainer.textContent.length!==t.endOffset+1||" "!==t.endContainer.textContent.charAt(t.endOffset)||j.isNullOrUndefined(t.endContainer.nextSibling)||"A"!==t.endContainer.nextSibling.nodeName||(n.setSelectionText(this.parent.currentDocument,t.startContainer,t.endContainer,t.startOffset,t.endOffset+1),t=n.getRange(this.parent.currentDocument)),n=!!j.isNullOrUndefined(e.item.text)||e.item.text.replace(/ /g,"").localeCompare(t.toString().replace(/\n/g," ").replace(/ /g,""))<0,e.event&&"keydown"===e.event.type&&(32===e.event.keyCode||13===e.event.keyCode)||"Paste"===e.item.action||t.collapsed||n?((t=this.createAchorNode(e)).innerText=""===e.item.text?e.item.url:e.item.text,n=t.innerText.replace(/  +/g,function(e){return"".repeat(e.length)}),t.innerText=n,e.item.selection.restore(),Ul.Insert(this.parent.currentDocument,t,this.parent.editableElement),!e.event||"keydown"!==e.event.type||32!==e.event.keyCode&&13!==e.event.keyCode?(i="Paste"===e.item.action?t.childNodes[0].textContent.length:0,e.item.selection.setSelectionText(this.parent.currentDocument,t.childNodes[0],t.childNodes[0],i,t.childNodes[0].textContent.length)):(n=e.item.selection.range.startContainer).textContent=this.removeText(n.textContent,e.item.text)):this.createLinkNode(e)):(t=o,n="",j.isNullOrUndefined(e.item.url)||t.setAttribute("href",e.item.url),j.isNullOrUndefined(e.item.title)||t.setAttribute("title",e.item.title),j.isNullOrUndefined(e.item.text)||""===e.item.text||(n=t.innerText,"#text"===t.firstChild.nodeName?t.innerText=e.item.text:t.firstChild.innerText=e.item.text),j.isNullOrUndefined(e.item.target)?(t.removeAttribute("target"),t.removeAttribute("aria-label")):(t.setAttribute("target",e.item.target),t.setAttribute("aria-label",e.item.ariaLabel)),n===e.item.text?(e.item.selection.setSelectionText(this.parent.currentDocument,t,t,1,1),e.item.selection.restore()):(i="Paste"===e.item.action?t.childNodes[0].textContent.length:0,o=("#text"===t.firstChild.nodeName?t.childNodes[0].textContent:t.childNodes).length,e.item.selection.setSelectionText(this.parent.currentDocument,t.childNodes[0],t.childNodes[0],i,o))),e.callBack&&e.callBack({requestType:"Links",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},jl.prototype.createLinkNode=function(e){for(var t,n=new bs,i=new Bl,o=n.getRange(this.parent.currentDocument),r=this.getSelectionNodes(n.getNodeCollection(o)),n=n.save(o,this.parent.currentDocument),s=[],a=[],l=[],d=[],c=[],h=0;h<r.length;h++)r[h]=i.GetSpliceNode(o,r[h]),s[h]=r[h];for(var p=0;p<s.length;p++)for(var u,m=!0,g=s[p];!0===m;)"A"===g.parentNode.nodeName&&(u=g.parentNode,g.parentNode.parentNode.insertBefore(u.firstChild,u),g.parentNode.removeChild(u)),this.isBlockNode(g.parentNode)||0===s.length||0===p||p===s.length-1||3===o.startContainer.nodeType?(a[p]=g,m=!1):g=g.parentNode;for(var p=0,f=0;p<a.length;p++)0===p&&(c[f]=a[p]),1<a.length&&p<a.length-1&&(a[p].parentElement===a[p+1].parentElement&&a[p]===a[p+1]||(c[f+1]=a[p+1],f++));var b=0;d[b]=this.createAchorNode(e);for(var y,p=0;p<c.length;p++)0===p&&(t=c[p].cloneNode(!0),d[p].appendChild(t)),p<c.length-1&&(c[p].parentNode===c[p+1].parentNode?(y=c[p+1].cloneNode(!0),d[b].appendChild(y)):(d[b+=1]=this.createAchorNode(e),t=c[p+1].cloneNode(!0),d[b].appendChild(t)));this.parent.nodeSelection.setRange(document,n.range);for(var p=0,v=0,C=0;p<=c.length;p++)0===p&&(c[p].parentNode.insertBefore(d[v],c[p].nextSibling),1===this.parent.domNode.blockNodes().length&&1===d.length&&this.parent.nodeSelection.setSelectionNode(this.parent.currentDocument,d[v]),l[C]=c[p],C++),p<c.length-1&&(c[p].parentNode!==c[p+1].parentNode&&c[p+1].parentNode.insertBefore(d[v+=1],c[p+1]),l[C]=c[p+1],C++);for(p=0;p<l.length;p++)l[p].parentNode&&l[p].parentNode.removeChild(l[p])},jl.prototype.createAchorNode=function(e){var t=j.createElement("a",{className:"e-rte-anchor",attrs:{href:e.item.url,title:j.isNullOrUndefined(e.item.title)||""===e.item.title?e.item.url:e.item.title}});return j.isNullOrUndefined(e.item.target)||t.setAttribute("target",e.item.target),j.isNullOrUndefined(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),t},jl.prototype.getSelectionNodes=function(e){e=e.reverse();for(var t=0;t<e.length;t++)3===e[t].nodeType&&""!==e[t].textContent.trim()||"IMG"!==e[t].nodeName&&(e.splice(t,1),t--);return e.reverse()},jl.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&0<=ls.indexOf(e.tagName.toLowerCase())},jl.prototype.removeText=function(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)n[i]===t&&(n.splice(i,1),i--);return n.join(" ")+" "},jl.prototype.openLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},jl.prototype.removeLink=function(e){var t=this.parent.domNode.blockNodes();if(t.length<2){this.parent.domNode.setMarker(e.item.selection);for(var n=j.closest(e.item.selectParent[0],"a"),i=n||e.item.selectParent[0],o=i.parentNode,r=[];i.firstChild&&o;)r.push(o.insertBefore(i.firstChild,i));o.removeChild(i),r&&1===r.length&&(e.item.selection.startContainer=e.item.selection.getNodeArray(r[r.length-1],!0),e.item.selection.endContainer=e.item.selection.startContainer),e.item.selection=this.parent.domNode.saveMarker(e.item.selection)}else for(var s=0;s<t.length;s++)for(var a=t[s].querySelectorAll("a"),l=0;l<a.length;l++)this.parent.currentDocument.getSelection().containsNode(a[l],!0)&&(a[l].outerHTML=a[l].innerHTML);e.item.selection.restore(),this.callBack(e)},jl.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},jl.prototype.destroy=function(){this.removeEventListener()};var Hl=jl;function jl(e){this.parent=e,this.addEventListener()}ql.prototype.addEventListener=function(){this.parent.observer.on(rs,this.applyAlignment,this),this.parent.observer.on(m,this.onKeyDown,this),this.parent.observer.on(f,this.destroy,this)},ql.prototype.removeEventListener=function(){this.parent.observer.off(rs,this.applyAlignment),this.parent.observer.off(m,this.onKeyDown),this.parent.observer.off(f,this.destroy)},ql.prototype.onKeyDown=function(e){switch(e.event.action){case"justify-center":this.applyAlignment({subCommand:"JustifyCenter",callBack:e.callBack}),e.event.preventDefault();break;case"justify-full":this.applyAlignment({subCommand:"JustifyFull",callBack:e.callBack}),e.event.preventDefault();break;case"justify-left":this.applyAlignment({subCommand:"JustifyLeft",callBack:e.callBack}),e.event.preventDefault();break;case"justify-right":this.applyAlignment({subCommand:"JustifyRight",callBack:e.callBack}),e.event.preventDefault()}},ql.prototype.getTableNode=function(e){e=e.startContainer.nodeType===Node.ELEMENT_NODE?e.startContainer:e.startContainer.parentNode;return[j.closest(e,"td,th")]},ql.prototype.applyAlignment=function(e){var t="Table"===e.value,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.nodeSelection.save(n,this.parent.currentDocument);if(t)j.setStyleAttribute(this.getTableNode(n)[0],{"text-align":this.alignments[e.subCommand]});else{this.parent.domNode.setMarker(i);var o=this.parent.domNode.blockNodes();"BR"===e.enterAction&&(o=this.parent.domNode.convertToBlockNodes(o,!1));for(var r=0;r<o.length;r++){var s=o[r];j.setStyleAttribute(s,{"text-align":this.alignments[e.subCommand]})}for(var a=this.parent.domNode.getImageTagInSelection(),r=0;r<a.length;r++){var l=[];l.push(a[r]),this.parent.imgObj.imageCommand({item:{selectNode:l},subCommand:e.subCommand,value:e.subCommand,callBack:e.callBack,selector:e.selector})}this.parent.editableElement.focus(),i=this.parent.domNode.saveMarker(i),vs()&&Cs(this.parent.editableElement,e.selector),i.restore()}e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:t?this.getTableNode(n):this.parent.domNode.blockNodes()})},ql.prototype.destroy=function(){this.removeEventListener()};var Fl=ql;function ql(e){this.alignments={JustifyLeft:"left",JustifyCenter:"center",JustifyRight:"right",JustifyFull:"justify"},this.parent=e,this.addEventListener()}_l.prototype.addEventListener=function(){this.parent.observer.on(ss,this.applyIndents,this),this.parent.observer.on(m,this.onKeyDown,this),this.parent.observer.on(f,this.destroy,this)},_l.prototype.removeEventListener=function(){this.parent.observer.off(ss,this.applyIndents),this.parent.observer.off(m,this.onKeyDown),this.parent.observer.off(f,this.destroy)},_l.prototype.onKeyDown=function(e){switch(e.event.action){case"indents":this.applyIndents({subCommand:"Indent",callBack:e.callBack}),e.event.preventDefault();break;case"outdents":this.applyIndents({subCommand:"Outdent",callBack:e.callBack}),e.event.preventDefault()}},_l.prototype.applyIndents=function(e){for(var t=this.parent.editableElement,n=t.classList.contains("e-rtl"),i=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.nodeSelection.save(i,this.parent.currentDocument),o=(this.parent.domNode.setMarker(i),this.parent.domNode.blockNodes()),r=(o="BR"===e.enterAction?this.parent.domNode.convertToBlockNodes(o,!1):o).slice(),s=[],a=0;a<r.length;a++)"LI"!==r[a].tagName&&"LI"===r[a].parentNode.tagName?(o.splice(o.indexOf(r[a]),1),s.push(r[a].parentNode)):"LI"===r[a].tagName&&(o.splice(o.indexOf(r[a]),1),s.push(r[a]));0<s.length&&this.parent.observer.notify(m,{event:{preventDefault:function(){},stopPropagation:function(){},shiftKey:"Indent"!==e.subCommand,which:9,action:"indent"}});for(a=0;a<o.length;a++){var l=o[a],d=n?l.style.marginRight:l.style.marginLeft,c=void 0,c="Indent"===e.subCommand?""===d?this.indentValue+"px":parseInt(d,null)+this.indentValue+"px":""===d||"0px"===d||"0in"===d?"":parseInt(d,null)-this.indentValue+"px";n?l.style.marginRight=c:l.style.marginLeft=c}t.focus(),vs()&&Cs(t,e.selector),(i=this.parent.domNode.saveMarker(i)).restore(),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},_l.prototype.destroy=function(){this.removeEventListener()};var zl=_l;function _l(e){this.indentValue=20,this.parent=e,this.addEventListener()}var Vl="e-imgright",Ql="e-imgleft",Wl="e-imgcenter",Kl="e-video-right",Gl="e-video-left",Xl="e-video-center",Yl="e-imgbreak",Jl="e-audio-break",$l="e-video-break",T="e-img-caption",Zl="e-caption-inline",ed="e-imginline",td="e-audio-inline",nd="e-clickelem",id="e-video-clickelem",od="e-rte-audio",rd="e-rte-video",sd="e-audio-wrap",ad="e-video-wrap",ld="e-embed-video-wrap",dd="e-audio-focus",cd="e-video-focus",hd="e-video-inline",pd=(ud.prototype.addEventListener=function(){this.parent.observer.on(_r,this.imageCommand,this),this.parent.observer.on(f,this.destroy,this)},ud.prototype.removeEventListener=function(){this.parent.observer.off(_r,this.imageCommand),this.parent.observer.off(f,this.destroy)},ud.prototype.imageCommand=function(e){switch(e.value.toString().toLowerCase()){case"image":case"replace":this.createImage(e);break;case"insertlink":this.insertImageLink(e);break;case"openimagelink":this.openImageLink(e);break;case"editimagelink":this.editImageLink(e);break;case"removeimagelink":this.removeImageLink(e);break;case"remove":this.removeImage(e);break;case"alttext":this.insertAltTextImage(e);break;case"dimension":this.imageDimension(e);break;case"caption":this.imageCaption(e);break;case"justifyleft":this.imageJustifyLeft(e);break;case"justifycenter":this.imageJustifyCenter(e);break;case"justifyright":this.imageJustifyRight(e);break;case"inline":this.imageInline(e);break;case"break":this.imageBreak(e)}},ud.prototype.createImage=function(e){var t,n,i,o=this,r=!1;e.item.url=j.isNullOrUndefined(e.item.url)||"undefined"===e.item.url?e.item.src:e.item.url,j.isNullOrUndefined(e.item.selectParent)||"IMG"!==e.item.selectParent[0].tagName?(t=j.createElement("img"),this.setStyle(t,e),j.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),j.isNullOrUndefined(e.selector)||"pasteCleanupModule"!==e.selector?Ul.Insert(this.parent.currentDocument,t,this.parent.editableElement):j.isNullOrUndefined(this.parent.currentDocument)||e.callBack({requestType:"Images",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:[t]})):(t=e.item.selectParent[0],this.setStyle(t,e,r=!0)),e.callBack&&(j.isNullOrUndefined(e.selector)||!j.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)&&(t=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],n="Replace"===e.value||r?e.item.selectParent[0]:j.Browser.isIE?t.previousSibling:t.previousElementSibling,i=function(){j.isNullOrUndefined(o.parent.currentDocument)||e.callBack({requestType:"Replace"===e.value?e.item.subCommand="Replace":"Images",editorMode:"HTML",event:e.event,range:o.parent.nodeSelection.getRange(o.parent.currentDocument),elements:[n]}),n.removeEventListener("load",i)},n.addEventListener("load",i))},ud.prototype.setStyle=function(e,t,n){var i;if(j.isNullOrUndefined(t.item.url)||e.setAttribute("src",t.item.url),n)for(var o={"e-imgcenter":"e-imgcenter","e-imgright":"e-imgright","e-imgleft":"e-imgleft"},r=e.classList,s=0;s<r.length;s++)j.isNullOrUndefined(o[r[s]])||(i=o[r[s]]);e.setAttribute("class","e-rte-image"+(j.isNullOrUndefined(t.item.cssClass)?"":" "+t.item.cssClass)+(j.isNullOrUndefined(i)?"":" "+i)),j.isNullOrUndefined(t.item.altText)||e.setAttribute("alt",t.item.altText.replace(/\.[a-zA-Z0-9]+$/,"")),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.width)||e.setAttribute("width",this.calculateStyleValue(t.item.width.width)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.height)||e.setAttribute("height",this.calculateStyleValue(t.item.height.height)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.minWidth)||(e.style.minWidth=this.calculateStyleValue(t.item.width.minWidth)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.maxWidth)||(e.style.maxWidth=this.calculateStyleValue(t.item.width.maxWidth)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.minHeight)||(e.style.minHeight=this.calculateStyleValue(t.item.height.minHeight)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.maxHeight)||(e.style.maxHeight=this.calculateStyleValue(t.item.height.maxHeight))},ud.prototype.calculateStyleValue=function(e){e="string"==typeof e&&(e.indexOf("px")||e.indexOf("%")||e.indexOf("auto"))?e:e+"px";return e},ud.prototype.insertImageLink=function(e){var t=j.createElement("a",{attrs:{href:e.item.url}});e.item.selectNode[0].parentElement.classList.contains("e-img-wrap")&&(e.item.selection.restore(),t.setAttribute("contenteditable","true")),t.appendChild(e.item.selectNode[0]),j.isNullOrUndefined(e.item.target)||t.setAttribute("target",e.item.target),j.isNullOrUndefined(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),Ul.Insert(this.parent.currentDocument,t,this.parent.editableElement),this.callBack(e)},ud.prototype.openImageLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},ud.prototype.removeImageLink=function(e){var t,n,i,o=e.item.selectParent[0];o.classList.contains("e-img-caption")?(t=j.select(".e-img-wrap",o),i=(n=j.select(".e-img-inner",o)).cloneNode(!0),j.detach(j.select("a",o)),j.detach(n),t.appendChild(e.item.insertElement),t.appendChild(i)):(j.detach(o),j.Browser.isIE&&e.item.selection&&e.item.selection.restore(),Ul.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement)),this.callBack(e)},ud.prototype.editImageLink=function(e){e.item.selectNode[0].parentElement.href=e.item.url,j.isNullOrUndefined(e.item.target)?(e.item.selectNode[0].parentElement.removeAttribute("target"),e.item.selectNode[0].parentElement.removeAttribute("aria-label")):(e.item.selectNode[0].parentElement.target=e.item.target,e.item.selectNode[0].parentElement.setAttribute("aria-label",e.item.ariaLabel)),this.callBack(e)},ud.prototype.removeImage=function(e){j.closest(e.item.selectNode[0],"a")&&("A"!==e.item.selectNode[0].parentElement.nodeName||j.isNullOrUndefined(e.item.selectNode[0].parentElement.innerText))?j.detach(j.closest(e.item.selectNode[0],"a")):j.isNullOrUndefined(j.closest(e.item.selectNode[0],"."+T))?j.detach(e.item.selectNode[0]):j.detach(j.closest(e.item.selectNode[0],"."+T)),this.callBack(e)},ud.prototype.insertAltTextImage=function(e){e.item.selectNode[0].setAttribute("alt",e.item.altText),this.callBack(e)},ud.prototype.imageDimension=function(e){var t=e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width?t.style.width=j.formatUnit(e.item.width):t.removeAttribute("width"),"auto"!==e.item.height?t.style.height=j.formatUnit(e.item.height):t.removeAttribute("height"),this.callBack(e)},ud.prototype.imageCaption=function(e){Ul.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement),this.callBack(e)},ud.prototype.imageJustifyLeft=function(e){var t=e.item.selectNode[0];j.isNullOrUndefined(t)||(t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+T))||(j.removeClass([j.closest(t,"."+T)],Vl),j.addClass([j.closest(t,"."+T)],Ql)),"A"===t.parentElement.nodeName&&(j.removeClass([t.parentElement],Vl),j.addClass([t.parentElement],Ql)),j.addClass([t],Ql),this.callBack(e))},ud.prototype.imageJustifyCenter=function(e){var t=e.item.selectNode[0];j.isNullOrUndefined(t)||(t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+T))||(j.removeClass([j.closest(t,"."+T)],Ql),j.removeClass([j.closest(t,"."+T)],Vl),j.addClass([j.closest(t,"."+T)],Wl)),"A"===t.parentElement.nodeName&&(j.removeClass([t.parentElement],Ql),j.removeClass([t.parentElement],Vl),j.addClass([t.parentElement],Wl)),j.addClass([t],Wl),this.callBack(e))},ud.prototype.imageJustifyRight=function(e){var t=e.item.selectNode[0];j.isNullOrUndefined(t)||(t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+T))||(j.removeClass([j.closest(t,"."+T)],Ql),j.addClass([j.closest(t,"."+T)],Vl)),"A"===t.parentElement.nodeName&&(j.removeClass([t.parentElement],Ql),j.addClass([t.parentElement],Vl)),j.addClass([t],Vl),this.callBack(e))},ud.prototype.imageInline=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.addClass([t],ed),j.isNullOrUndefined(j.closest(t,"."+T))||(j.removeClass([j.closest(t,"."+T)],Yl),j.removeClass([j.closest(t,"."+T)],Wl),j.removeClass([j.closest(t,"."+T)],Ql),j.removeClass([j.closest(t,"."+T)],Vl),j.addClass([j.closest(t,"."+T)],Zl)),this.callBack(e)},ud.prototype.imageBreak=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),j.addClass([t],Yl),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+T))||(j.removeClass([j.closest(t,"."+T)],Zl),j.removeClass([j.closest(t,"."+T)],Wl),j.removeClass([j.closest(t,"."+T)],Ql),j.removeClass([j.closest(t,"."+T)],Vl),j.addClass([j.closest(t,"."+T)],Yl)),this.callBack(e)},ud.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},ud.prototype.destroy=function(){this.removeEventListener()},ud);function ud(e){this.parent=e,this.addEventListener()}gd.prototype.addEventListener=function(){this.parent.observer.on(Vr,this.audioCommand,this),this.parent.observer.on(f,this.destroy,this)},gd.prototype.removeEventListener=function(){this.parent.observer.off(Vr,this.audioCommand),this.parent.observer.off(f,this.destroy)},gd.prototype.audioCommand=function(e){var t,n=e.value.toString().toLowerCase();switch("inline"!==n&&"break"!==n&&"audioremove"!==n||(t=e.item.selectNode[0]),n){case"audio":case"audioreplace":this.createAudio(e);break;case"inline":t.removeAttribute("class"),t.closest("."+sd).style.display="inline-block",j.addClass([t],[od,td,dd]),this.callBack(e);break;case"break":t.removeAttribute("class"),t.closest("."+sd).style.display="block",j.addClass([t],[Jl,od,dd]),this.callBack(e);break;case"audioremove":j.detach(t),this.callBack(e)}},gd.prototype.createAudio=function(e){var t,n,i,o,r,s=this,a=!1;!j.isNullOrUndefined(e.item.selectParent)&&e.item.selectParent[0].classList&&(e.item.selectParent[0].classList.contains(nd)||e.item.selectParent[0].classList.contains(sd))?(t=e.item.selectParent[0].querySelector("source"),this.setStyle(t,e),a=!0):(t=j.createElement("span",{className:sd,attrs:{contentEditable:"false",title:j.isNullOrUndefined(e.item.title)?j.isNullOrUndefined(e.item.fileName)?"":e.item.fileName:e.item.title}}),o=j.createElement("audio",{className:od+" "+td,attrs:{controls:""}}),i=j.createElement("source"),n=j.createElement("span",{className:nd}),this.setStyle(i,e),o.appendChild(i),n.appendChild(o),t.appendChild(n),j.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),Ul.Insert(this.parent.currentDocument,t,this.parent.editableElement),null===t.nextElementSibling&&(i=j.createElement("br"),t.parentNode.insertBefore(i,t.nextSibling))),e.callBack&&(j.isNullOrUndefined(e.selector)||!j.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)&&(o=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],(r="AudioReplace"===e.value||a?e.item.selectParent[0].querySelector("audio"):j.Browser.isIE?o:o.querySelector("audio")).addEventListener("loadeddata",function(){"AudioReplace"===e.value&&a||j.isNullOrUndefined(s.parent.currentDocument)||e.callBack({requestType:"Audios",editorMode:"HTML",event:e.event,range:s.parent.nodeSelection.getRange(s.parent.currentDocument),elements:[r]})}),a)&&r.load()},gd.prototype.setStyle=function(e,t){j.isNullOrUndefined(t.item.url)||e.setAttribute("src",t.item.url);var n=t.item.fileName?t.item.fileName.split(".").pop().toLowerCase():t.item.url?t.item.url.split(".").pop().toLowerCase():"";e.type="opus"===n?"audio/ogg":"m4a"===n?"audio/mp4":t.item.fileName&&0<t.item.fileName.split(".").length?"audio/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&0<t.item.url.split(".").length?"audio/"+t.item.url.split(".")[t.item.url.split(".").length-1]:""},gd.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},gd.prototype.destroy=function(){this.removeEventListener()};var md=gd;function gd(e){this.parent=e,this.addEventListener()}bd.prototype.addEventListener=function(){this.parent.observer.on(Qr,this.videoCommand,this),this.parent.observer.on(f,this.destroy,this)},bd.prototype.removeEventListener=function(){this.parent.observer.off(Qr,this.videoCommand),this.parent.observer.off(f,this.destroy)},bd.prototype.videoCommand=function(e){var t,n,i,o=e.value.toString().toLowerCase();switch("video"!==o&&"videoreplace"!==o&&(n=(t=e.item.selectNode[0]).closest("."+ld),i=t.closest("."+id)),o){case"video":case"videoreplace":this.createVideo(e);break;case"videodimension":this.videoDimension(e);break;case"inline":t.removeAttribute("class"),n&&(n.style.display="inline-block"),i&&(t.parentElement.style.cssFloat=""),j.addClass([t],[rd,hd,cd]),this.callBack(e);break;case"break":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),j.addClass([t],[$l,rd,cd]),this.callBack(e);break;case"justifyleft":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat="left"),j.addClass([t],[rd,Gl]),this.callBack(e);break;case"justifycenter":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),j.addClass([t],[rd,Xl]),this.callBack(e);break;case"justifyright":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat="right"),j.addClass([t],[rd,Kl]),this.callBack(e);break;case"videoremove":j.detach(t.parentElement),this.callBack(e)}},bd.prototype.wrapVideo=function(e){var t,n,i;return e.item.isEmbedUrl?(t=j.createElement("span",{className:ld,attrs:{contentEditable:"false"}}),n=j.createElement("span",{className:id}),(i=j.createElement("template")).innerHTML=e.item.fileName,n.appendChild(i.content),this.vidElement=i=n.firstElementChild,this.setStyle(i,e,this.vidElement),t.style.display=e.item.cssClass===hd?"inline-block":"block",t.appendChild(n)):(t=j.createElement("span",{className:ad,attrs:{contentEditable:"false",title:j.isNullOrUndefined(e.item.title)?j.isNullOrUndefined(e.item.fileName)?"":e.item.fileName:e.item.title}}),this.vidElement=j.createElement("video",{className:rd+" "+hd,attrs:{controls:""}}),i=j.createElement("source"),this.setStyle(i,e,this.vidElement),this.vidElement.appendChild(i),t.appendChild(this.vidElement)),t},bd.prototype.createVideo=function(e){var t,n,i,o,r=this,s=!1;"VideoReplace"!==e.value||j.isNullOrUndefined(e.item.selectParent)||"VIDEO"!==e.item.selectParent[0].tagName?"VideoReplace"===e.value&&!j.isNullOrUndefined(e.item.selectParent)&&j.isNullOrUndefined(e.item.selectParent[0].querySelector("iframe"))&&e.item.selectParent[0].classList&&e.item.selectParent[0].classList.contains(id)?(e.item.selectParent[0].innerHTML=e.item.fileName,this.setStyle(e.item.selectParent[0].firstElementChild,e,e.item.selectParent[0].firstElementChild)):"VideoReplace"!==e.value||j.isNullOrUndefined(e.item.selectParent)||j.isNullOrUndefined(e.item.selectParent[0].querySelector("iframe"))||e.item.isEmbedUrl?(t=(e.item.isEmbedUrl,this.wrapVideo(e)),j.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),Ul.Insert(this.parent.currentDocument,t,this.parent.editableElement),null===t.nextElementSibling&&(n=j.createElement("br"),t.parentNode.insertBefore(n,t.nextSibling))):(t=this.wrapVideo(e),(i=e.item.selection.range.startContainer).parentNode.replaceChild(t,i)):e.item.isEmbedUrl?(t=this.wrapVideo(e),(i=e.item.selection.range.startContainer).parentNode.replaceChild(t,i)):(n=e.item.selectParent[0].querySelector("source"),this.setStyle(n,e,n),s=!0),e.callBack&&(j.isNullOrUndefined(e.selector)||!j.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)&&(i=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],"VideoReplace"===e.value||s?e.item.isEmbedUrl?e.item.isEmbedUrl?j.isNullOrUndefined(t)||(o=t.querySelector("iframe")):o=e.item.selectParent[0].querySelector("iframe"):o=e.item.selectParent[0]:o=e.item.isEmbedUrl?i.querySelector("iframe"):i.lastElementChild,o.addEventListener("IFRAME"!==o.tagName?"loadeddata":"load",function(){"VideoReplace"===e.value&&s||(e.item.isEmbedUrl&&o&&o.classList.add("e-rte-embed-url"),j.isNullOrUndefined(r.parent.currentDocument))||e.callBack({requestType:"Videos",editorMode:"HTML",event:e.event,range:r.parent.nodeSelection.getRange(r.parent.currentDocument),elements:[o]})}),s&&o.load(),-1!==j.Browser.userAgent.indexOf("Firefox"))&&(this.vidElement.addEventListener("play",function(){r.editAreaVideoClick(e)}),this.vidElement.addEventListener("pause",function(){r.editAreaVideoClick(e)}))},bd.prototype.editAreaVideoClick=function(e){e.callBack({requestType:"VideosPlayPause",editorMode:"HTML",event:e.event})},bd.prototype.setStyle=function(e,t,n){""!==t.item.url&&!j.isNullOrUndefined(t.item.url)&&j.isNullOrUndefined(e)||"iframe"===e.nodeName.toLowerCase()||e.setAttribute("src",t.item.url),t.item.isEmbedUrl||(e.type=t.item.fileName&&0<t.item.fileName.split(".").length?"video/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&0<t.item.url.split(".").length?"video/"+t.item.url.split(".")[t.item.url.split(".").length-1]:""),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.width)||n.setAttribute("width",j.formatUnit(t.item.width.width)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.height)||n.setAttribute("height",j.formatUnit(t.item.height.height)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.minWidth)||(n.style.minWidth=j.formatUnit(t.item.width.minWidth)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.maxWidth)||(n.style.maxWidth=j.formatUnit(t.item.width.maxWidth)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.minHeight)||(n.style.minHeight=j.formatUnit(t.item.height.minHeight)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.maxHeight)||(n.style.maxHeight=j.formatUnit(t.item.height.maxHeight)),j.isNullOrUndefined(t.item.cssClass)||(t.item.cssClass===$l?(j.addClass([n],[$l]),j.removeClass([n],[hd])):(j.addClass([n],[hd]),j.removeClass([n],[$l])))},bd.prototype.videoDimension=function(e){var t=e.item.selectNode[0].classList.contains(id)?e.item.selectNode[0].querySelector("iframe"):e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width?t.style.width=j.formatUnit(e.item.width):t.removeAttribute("width"),"auto"!==e.item.height?t.style.height=j.formatUnit(e.item.height):t.removeAttribute("height"),this.callBack(e)},bd.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},bd.prototype.destroy=function(){this.removeEventListener()};var fd=bd;function bd(e){this.parent=e,this.addEventListener()}O.prototype.addEventListener=function(){this.parent.observer.on(Wr,this.createTable,this),this.parent.observer.on(Gr,this.insertRow,this),this.parent.observer.on(Xr,this.insertColumn,this),this.parent.observer.on(Yr,this.deleteRow,this),this.parent.observer.on(Jr,this.deleteColumn,this),this.parent.observer.on($r,this.removeTable,this),this.parent.observer.on(Zr,this.tableHeader,this),this.parent.observer.on(es,this.tableVerticalAlign,this),this.parent.observer.on(ts,this.cellMerge,this),this.parent.observer.on(is,this.HorizontalSplit,this),this.parent.observer.on(ns,this.VerticalSplit,this),this.parent.observer.on(os,this.tableMove,this),this.parent.observer.on(f,this.destroy,this)},O.prototype.removeEventListener=function(){this.parent.observer.off(Wr,this.createTable),this.parent.observer.off(Gr,this.insertRow),this.parent.observer.off(Xr,this.insertColumn),this.parent.observer.off(Yr,this.deleteRow),this.parent.observer.off(Jr,this.deleteColumn),this.parent.observer.off($r,this.removeTable),this.parent.observer.off(Zr,this.tableHeader),this.parent.observer.off(es,this.tableVerticalAlign),this.parent.observer.off(ts,this.cellMerge),this.parent.observer.off(is,this.HorizontalSplit),this.parent.observer.off(ns,this.VerticalSplit),this.parent.observer.off(os,this.tableMove),this.parent.observer.off(f,this.destroy)},O.prototype.createTable=function(e){for(var t,n=j.createElement("table",{className:"e-rte-table"}),i=j.createElement("tbody"),o=(j.isNullOrUndefined(e.item.width.width)||(n.style.width=this.calculateStyleValue(e.item.width.width)),j.isNullOrUndefined(e.item.width.minWidth)||(n.style.minWidth=this.calculateStyleValue(e.item.width.minWidth)),j.isNullOrUndefined(e.item.width.maxWidth)||(n.style.maxWidth=this.calculateStyleValue(e.item.width.maxWidth)),100<parseInt(e.item.width.width,10)?100/e.item.columns:parseInt(e.item.width.width,10)/e.item.columns),r=0;r<e.item.rows;r++){for(var s=j.createElement("tr"),a=0;a<e.item.columns;a++){var l=j.createElement("td");l.appendChild(j.createElement("br")),l.style.width=o+"%",s.appendChild(l)}i.appendChild(s)}return n.appendChild(i),e.item.selection.restore(),Ul.Insert(this.parent.currentDocument,n,this.parent.editableElement),e.item.selection.setSelectionText(this.parent.currentDocument,n.querySelector("td"),n.querySelector("td"),0,0),null!==n.nextElementSibling||n.classList.contains("ignore-table")||(t=void 0,"DIV"===e.enterAction?(t=j.createElement("div")).appendChild(j.createElement("br")):"BR"===e.enterAction?t=j.createElement("br"):(t=j.createElement("p")).appendChild(j.createElement("br")),this.insertAfter(t,n)),n.classList.contains("ignore-table")&&g([n],["ignore-table"]),n.querySelector("td").classList.add("e-cell-select"),e.callBack&&e.callBack({requestType:"Table",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:[n]}),n},O.prototype.calculateStyleValue=function(e){e="string"==typeof e&&(0<=e.indexOf("px")||0<=e.indexOf("%")||0<=e.indexOf("auto"))?e:e+"px";return e},O.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},O.prototype.getSelectedCellMinMaxIndex=function(e){for(var t=this.curTable.querySelectorAll(".e-cell-select"),n=0,i=e.length,o=0,r=e[0].length,s=0;n<t.length;n++)var a=this.getCorrespondingIndex(t[n],e),l=this.FindIndex(a[0],a[1],e),i=Math.min(a[0],i),o=Math.max(l[0],o),r=Math.min(a[1],r),s=Math.max(l[1],s);return{startRow:i,endRow:o,startColumn:r,endColumn:s}},O.prototype.insertRow=function(e){var t="InsertRowBefore"!==e.item.subCommand,n=e.item.selection.range.startContainer;if("th"!==(n="TH"!==n.nodeName&&"TD"!==n.nodeName?j.closest(n.parentElement,"td,th"):n).nodeName.toLowerCase()||"InsertRowBefore"!==e.item.subCommand){if(this.curTable=j.closest(this.parent.nodeSelection.range.startContainer.parentElement,"table"),0===this.curTable.querySelectorAll(".e-cell-select").length){var n=this.curTable.rows[this.curTable.rows.length-1],i=n.cloneNode(!0);i.removeAttribute("rowspan"),this.insertAfter(i,n)}else{for(var o,r=this.getCorrespondingColumns(),i=this.getSelectedCellMinMaxIndex(r),s=t?i.endRow:i.startRow,a=j.createElement("tr"),l=0<this.curTable.querySelectorAll("th.e-cell-select").length,d=0;d<r[s].length;d++)t&&s<r.length-1&&r[s][d]===r[s+1][d]||!t&&0<s&&r[s][d]===r[s-1][d]?(0===d||0<d&&r[s][d]!==r[s][d-1])&&r[s][d].setAttribute("rowspan",(parseInt(r[s][d].getAttribute("rowspan"),10)+1).toString()):((o=j.createElement("td")).appendChild(j.createElement("br")),a.appendChild(o),o.setAttribute("style",r[l&&t&&r[s+1]?s+1:s][d].getAttribute("style")));n=void 0,n=l&&t?this.curTable.querySelector("tbody").childNodes[0]:this.curTable.rows[s];"InsertRowBefore"===e.item.subCommand||l?n.parentElement.insertBefore(a,n):this.insertAfter(a,n)}e.item.selection.setSelectionText(this.parent.currentDocument,e.item.selection.range.startContainer,e.item.selection.range.startContainer,0,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},O.prototype.insertColumn=function(e){for(var t=e.item.selection.range.startContainer,n=("TH"!==t.nodeName&&"TD"!==t.nodeName&&(t=j.closest(t.parentElement,"td,th")),j.closest(t,"tr")),i=j.closest(n,"table").rows,o=Array.prototype.slice.call(n.querySelectorAll(":scope > td, :scope > th")).indexOf(t),r=parseInt(e.item.width,10)/n.querySelectorAll(":scope > td, :scope > th").length,s=parseInt(e.item.width,10)/(n.querySelectorAll(":scope > td, :scope > th").length+1),a=j.closest(n,"table"),l=j.closest(n,"table").querySelectorAll("th,td"),d=0;d<l.length;d++)l[d].dataset.oldWidth=l[d].offsetWidth/a.offsetWidth*100+"%";for(d=0;d<i.length;d++){var c,h=(c=i[d].querySelectorAll(":scope > td, :scope > th")[o]).cloneNode(!0);h.innerHTML="",h.appendChild(j.createElement("br")),h.removeAttribute("class"),h.removeAttribute("colspan"),h.removeAttribute("rowspan"),"InsertColumnLeft"===e.item.subCommand?c.parentElement.insertBefore(h,c):this.insertAfter(h,c),h.style.width=s.toFixed(4)+"%",delete h.dataset.oldWidth}for(d=0;d<l.length;d++)l[d].style.width=(Number(l[d].dataset.oldWidth.split("%")[0])*s/r).toFixed(4)+"%",delete l[d].dataset.oldWidth;e.item.selection.setSelectionText(this.parent.currentDocument,t,t,0,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},O.prototype.deleteColumn=function(e){var t=e.item.selection.range.startContainer,n=(3===t.nodeType&&(t=j.closest(t.parentElement,"td,th")),j.closest(t,"TH"===t.tagName?"thead":"tbody")),i=n&&Array.prototype.indexOf.call(n.childNodes,t.parentNode);if(this.curTable=j.closest(t,"table"),1===j.closest(t,"tr").querySelectorAll("th,td").length)e.item.selection.restore(),j.detach(j.closest(t.parentElement,"table"));else{for(var o=void 0,r=this.getCorrespondingColumns(),t=this.getSelectedCellMinMaxIndex(r),s=t.startColumn,a=t.endColumn,l=0;l<r.length;l++)for(var d=r[l],c=0;c<d.length;c++){var h=d[c],p=this.getCorrespondingIndex(h,r),u=parseInt(h.getAttribute("colspan"),10)||1;p[1]+(u-1)>=s&&p[1]<=a&&(1<u?h.setAttribute("colspan",(u-1).toString()):(j.detach(h),o=c,j.Browser.isIE&&(e.item.selection.setSelectionText(this.parent.currentDocument,this.curTable.querySelector("td"),this.curTable.querySelector("td"),0,0),this.curTable.querySelector("td, th").classList.add("e-cell-select"))))}-1<o&&(n=(t=n.children[i])&&t.children[o<=t.children.length-1?o:o-1])&&(e.item.selection.setSelectionText(this.parent.currentDocument,n,n,0,0),n.classList.add("e-cell-select"))}e.callBack&&("TD"!==(i=this.parent.nodeSelection.getRange(this.parent.currentDocument).startContainer).nodeName&&(t=this.parent.nodeSelection.getRange(this.parent.currentDocument).startOffset,n=i.children[t])&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)}))},O.prototype.deleteRow=function(e){var t,n,i,o,r,s=e.item.selection.range.startContainer,a=(3===s.nodeType&&(s=j.closest(s.parentElement,"td,th")),Array.prototype.indexOf.call(s.parentNode.childNodes,s)),l=(this.curTable=j.closest(s,"table"),this.getCorrespondingColumns()),d=this.getSelectedCellMinMaxIndex(l);if(1===this.curTable.rows.length)e.item.selection.restore(),j.detach(j.closest(s.parentElement,"table"));else for(t=d.endRow;t>=d.startRow;t--){for(p=this.curTable.rows[t],n=0;n<l[t].length;n++)if(0!==n&&l[t][n]===l[t][n-1]||1<parseInt(l[t][n].getAttribute("rowspan"),10)&&(1===(i=parseInt(l[t][n].getAttribute("rowspan"),10)-1)?(l[t][n].removeAttribute("rowspan"),(o=this.getMergedRow(this.getCorrespondingColumns())[n])&&((r=o.cloneNode(!0)).innerHTML="<br>",o.parentElement)&&o.parentElement.insertBefore(r,o)):l[t][n].setAttribute("rowspan",i.toString())),t<l.length-1&&l[t][n]===l[t+1][n]&&(0===t||l[t][n]!==l[t-1][n]))for(var c=l[t][n],h=void 0,h=n;0<h&&l[t][h]===l[t][h-1];h--)0===h?this.curTable.rows[t+1].prepend(c):l[t+1][h-1].insertAdjacentElement("afterend",c);var p=p.rowIndex,p=(this.curTable.deleteRow(p),j.isNullOrUndefined(this.curTable.rows[p])?this.curTable.querySelectorAll("tbody tr")[p-1]:this.curTable.querySelectorAll("tbody tr")[p]),p=p&&p.querySelectorAll("td")[a];(p?(e.item.selection.setSelectionText(this.parent.currentDocument,p,p,0,0),p):(e.item.selection.setSelectionText(this.parent.currentDocument,this.curTable.querySelector("td"),this.curTable.querySelector("td"),0,0),this.curTable.querySelector("td, th"))).classList.add("e-cell-select")}e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},O.prototype.getMergedRow=function(e){for(var t,n=0;n<e.length;n++)e[n].length!==this.curTable.rows[0].childNodes.length&&(t=e[n]);return t},O.prototype.removeTable=function(e){var t=3===(t=e.item.selection.range.startContainer).nodeType?t.parentNode:t,t=j.closest(t.parentElement,"table");t&&(e.item.selection.restore(),j.detach(t)),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},O.prototype.tableHeader=function(e){var t=!1,n=3===(n=e.item.selection.range.startContainer).nodeType?n.parentNode:n,i=j.closest(n.parentElement,"table");if([].slice.call(i.childNodes).forEach(function(e){"THEAD"===e.nodeName&&(t=!0)}),i&&!t){for(var o=i.querySelector("tr").childElementCount,r=0,s=0;s<o;s++)r+=parseInt(i.querySelector("tr").children[s].getAttribute("colspan"),10)||1;for(var a=i.createTHead().insertRow(0),l=0;l<r;l++){var d=j.createElement("th");d.appendChild(j.createElement("br")),a.appendChild(d)}}else i.deleteTHead();e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},O.prototype.tableVerticalAlign=function(e){var t="";switch(e.item.subCommand){case"AlignTop":t="top";break;case"AlignMiddle":t="middle";break;case"AlignBottom":t="bottom"}(e.item.tableCell.style.verticalAlign=t)&&""!==t&&e.item.tableCell.getAttribute("valign")&&e.item.tableCell.removeAttribute("valign"),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},O.prototype.cellMerge=function(e){j.isNullOrUndefined(this.curTable)&&(this.curTable=j.closest(this.parent.nodeSelection.range.startContainer.parentElement,"table"));var t=this.curTable.querySelectorAll(".e-cell-select");if(!(t.length<2)){this.mergeCellContent();for(var n=this.getSelectedMinMaxIndexes(this.getCorrespondingColumns()),i=t[0],o=i.parentElement.querySelectorAll(".e-cell-select"),r=0,s=0;s<o.length;s++){var a=o[s].offsetHeight;r<a&&(r=a)}n.startColumn<n.endColumn&&i.setAttribute("colspan",(n.endColumn-n.startColumn+1).toString()),n.startRow<n.endRow&&i.setAttribute("rowspan",(n.endRow-n.startRow+1).toString());for(var l,d,c=0,s=o.length-1;0<=s;s--)j.isNullOrUndefined(o[s].style.width)||""===o[s].style.width?(c+=o[s].offsetWidth/this.curTable.offsetWidth*100,d="%"):(d||(d=(l=o[s].style.width.match(/^([\d.]+)([a-z%]+)$/i))?l[2]:"%"),c+=parseFloat(o[s].style.width));i.style.width=c+d,i.style.height=r+"px";for(var h=1;h<=t.length-1;h++)j.detach(t[h]);for(h=0;h<this.curTable.rows.length;h++)""===this.curTable.rows[h].innerHTML.trim()&&j.detach(this.curTable.rows[h]);g(this.curTable.querySelectorAll("table td, table th"),"e-multi-cells-select"),g(this.curTable.querySelectorAll("table td, table th"),"e-cell-select-end"),this.updateRowSpanStyle(n.startRow,n.endRow,this.getCorrespondingColumns()),this.updateColSpanStyle(n.startColumn,n.endColumn,this.getCorrespondingColumns()),e.item.selection.setSelectionText(this.parent.currentDocument,e.item.selection.range.startContainer,e.item.selection.range.startContainer,0,0),this.parent.nodeSelection&&i&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},O.prototype.updateColSpanStyle=function(e,t,n){var i,o,r,s,a,l=0,d=n;if(e<(t=Math.min(t,d[0].length-1))){for(o=e;o<=t;o++)if(s=Math.min(parseInt(d[0][o].getAttribute("colspan"),10)||1,t-e+1),!(e<o&&d[0][o]===d[0][o-1])&&1<s&&d[0][o]===d[0][o+1])for(l=s-1,i=1;i<d.length;i++){if(d[i][o]!==d[i-1][o])for(r=o;r<o+s;r++)if(1<(a=parseInt(d[i][r].getAttribute("colspan"),10)||1)&&d[i][r]===d[i][r+1])r+=l=Math.min(l,a-1);else if(0===(l=Math.max(0,l-1)))break;if(!l)break}l&&this.updateCellAttribute(d,l,"colspan",0,d.length-1,e,t)}},O.prototype.updateRowSpanStyle=function(e,t,n){var i,o,r,s,a=0,l=0,d=n;if(e<(t=Math.min(t,d.length-1))){for(i=e;i<=t;i++)if(!(e<i&&d[i][0]===d[i-1][0])&&d[i][0]&&1<(a=Math.min(parseInt(d[i][0].getAttribute("rowspan"),10)||1,t-e+1))&&d[i][0]===d[i+1][0])for(l=a-1,o=1;o<d[0].length;o++)if(d[i][o]!==d[i][o-1]){for(r=i;r<i+a;r++)if(1<(s=parseInt(d[r][o].getAttribute("rowspan"),10)||1)&&d[r][o]===d[r+1][o])r+=l=Math.min(l,s-1);else if(!(l=Math.max(0,l-1)))break;if(!l)break}l&&this.updateCellAttribute(d,l,"rowspan",e,t,0,d[0].length-1)}},O.prototype.updateCellAttribute=function(e,t,n,i,o,r,s){for(var a,l,d=i;d<=o;d++)for(a=r;a<=s;a++)l=parseInt(e[d][a].getAttribute(n),10)||1,(i<d&&e[d][a]===e[d-1][a]||r<a&&e[d][a]===e[d][a-1]||1<l)&&(1<l-t?e[d][a].setAttribute(n,(l-t).toString()):e[d][a].removeAttribute(n))},O.prototype.mergeCellContent=function(){for(var e=this.curTable.querySelectorAll(".e-cell-select"),t="<br>"===e[0].innerHTML?"":e[0].innerHTML,n=1;n<e.length;n++)"<br>"!==e[n].innerHTML&&(t=t?t+"<br>"+e[n].innerHTML:t+e[n].innerHTML);e[0].innerHTML=t},O.prototype.getSelectedMinMaxIndexes=function(e){var t=this.curTable.querySelectorAll(".e-cell-select");if(0<t.length){for(var n=e.length,i=0,o=e[0].length,r=0,s=0;s<t.length;s++)var a=this.getCorrespondingIndex(t[s],e),l=this.FindIndex(a[0],a[1],e),n=Math.min(a[0],n),i=Math.max(l[0],i),o=Math.min(a[1],o),r=Math.max(l[1],r);return{startRow:n,endRow:i,startColumn:o,endColumn:r}}return null},O.prototype.HorizontalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=j.closest(t.parentElement,"table"),!(1<this.curTable.querySelectorAll(".e-cell-select").length)){this.activeCell=this.curTable.querySelector(".e-cell-select");var t=this.activeCell.cloneNode(!0),n=(t.removeAttribute("class"),t.innerHTML="</br>",this.getCorrespondingIndex(this.activeCell,this.getCorrespondingColumns())),i=this.getCorrespondingColumns(),o=this.activeCell.getAttribute("rowspan")?parseInt(this.activeCell.getAttribute("rowspan"),10):1;if(1<o){for(var r=Math.ceil(o/2),s=(1<r?this.activeCell.setAttribute("rowspan",r.toString()):this.activeCell.removeAttribute("rowspan"),1<o-r?t.setAttribute("rowspan",(o-r).toString()):t.removeAttribute("rowspan"),void 0),a=n[0]+Math.ceil(o/2),s=0===n[1]?n[1]:n[1]-1;0<=s&&(i[a][s]===i[a][s-1]||0<a&&i[a][s]===i[a-1][s]);)s--;-1===s?this.curTable.rows[a].firstChild?this.curTable.rows[a].prepend(t):this.curTable.appendChild(t):i[a][s].insertAdjacentElement("afterend",t)}else{for(var r=j.createElement("tr"),l=(r.appendChild(t),i[n[0]]),d=0;d<=l.length-1;d++)l[d]!==l[d-1]&&l[d]!==this.activeCell&&l[d].setAttribute("rowspan",((parseInt(l[d].getAttribute("rowspan"),10)?parseInt(l[d].getAttribute("rowspan"),10):1)+1).toString());this.activeCell.parentNode.insertAdjacentElement("afterend",r)}e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},O.prototype.VerticalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=j.closest(t.parentElement,"table"),!(1<this.curTable.querySelectorAll(".e-cell-select").length)){this.activeCell=this.curTable.querySelector(".e-cell-select");var n=this.curTable.rows,t=this.activeCell.cloneNode(!0),i=(t.removeAttribute("class"),t.innerHTML="</br>",this.getCorrespondingIndex(this.activeCell,this.getCorrespondingColumns())),o=this.getCorrespondingColumns(),r=parseInt(this.activeCell.getAttribute("colspan"),10)||1;if(1<r){var s=Math.ceil(r/2),a=this.getColSizes(this.curTable),l=this.getSplitColWidth(i[1],i[1]+s-1,a),a=this.getSplitColWidth(i[1]+s,i[1]+r-1,a),d=this.convertPixelToPercentage(this.activeCell.offsetWidth,this.curTable.offsetWidth),a=d-l<a?d-l:a;1<s?this.activeCell.setAttribute("colspan",s.toString()):this.activeCell.removeAttribute("colspan"),1<r-s?t.setAttribute("colspan",(r-s).toString()):t.removeAttribute("colspan"),this.activeCell.style.width=l+"%",t.style.width=a+"%"}else{for(var c,d=parseFloat(this.activeCell.style.width)/2,h=0;h<=n.length-1;h++)0!==h&&o[h][i[1]]===o[h-1][i[1]]||(c=o[h][i[1]])!==this.activeCell&&c.setAttribute("colspan",((parseInt(c.getAttribute("colspan"),10)?parseInt(c.getAttribute("colspan"),10):1)+1).toString());this.activeCell.style.width=d+"%",t.style.width=d+"%"}this.activeCell.parentNode.insertBefore(t,this.activeCell.nextSibling),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},O.prototype.getSplitColWidth=function(e,t,n){for(var i=0,o=e;o<=t;o++)i+=n[o];return this.convertPixelToPercentage(i,this.curTable.offsetWidth)},O.prototype.getColSizes=function(e){for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var o=new Array(n),r=new Map,s=0;s<e.rows.length;s++)for(var a=0,l=0;l<e.rows[s].cells.length;l++){for(var d=1;d<e.rows[s].cells[l].rowSpan;d++)r.set(""+(s+d)+a,e.rows[s].cells[l]);var c=this.getCellIndex(r,s,l),c=(a<c&&(a=c),e.rows[s].cells[l].offsetWidth);(!o[a]||c<o[a])&&(o[a]=c),a+=1+e.rows[s].cells[l].colSpan-1}return o},O.prototype.getCellIndex=function(e,t,n){var i=e.get(""+t+n);return i?this.getCellIndex(e,t,n+i.colSpan):n},O.prototype.convertPixelToPercentage=function(e,t){return e/t*100},O.prototype.getCorrespondingColumns=function(){for(var e=[],t=this.curTable.rows,n=0;n<=t.length-1;n++)for(var i=t[n],o=0,r=0;r<=i.children.length-1;r++){for(var s=i.children[r],a=s,l=parseInt(a.getAttribute("colspan"),10)||1,d=parseInt(a.getAttribute("rowspan"),10)||1,c=n;c<n+d;c++)for(var h=o;h<o+l;h++)e[c]||(e[c]=[]),e[c][h]?o++:e[c][h]=s;o+=0}return e},O.prototype.FindIndex=function(e,t,n){for(var i=e+1,o=t+1;i<n.length;){if(n[i][t]!==n[e][t]){i--;break}i++}for(i===n.length&&i--;o<n[e].length;){if(n[e][o]!==n[e][t]){o--;break}o++}return o===n[e].length&&o--,[i,o]},O.prototype.getCorrespondingIndex=function(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(t[n][i]===e)return[n,i];return[]},O.prototype.highlightCells=function(e,t,n,i,o){for(var r,s,a,l=e,d=t,c=n,h=i,p=new vd,u=l;u<=d;u++){for(s=this.getCorrespondingIndex(o[u][c],o),a=this.FindIndex(s[0],s[1],o),((1<(parseInt(o[u][c].getAttribute("rowspan"),10)||1)||1<(parseInt(o[u][c].getAttribute("colspan"),10)||1))&&a||(1<(parseInt(o[u][h].getAttribute("rowspan"),10)||1)||1<(parseInt(o[u][h].getAttribute("colspan"),10)||1))&&(s=this.getCorrespondingIndex(o[u][h],o),a=this.FindIndex(s[0],s[1],o)))&&(l=Math.min(s[0],l),d=Math.max(a[0],d),c=Math.min(s[1],c),h=Math.max(a[1],h)),r=c;r<=h;r++)s=this.getCorrespondingIndex(o[l][r],o),a=this.FindIndex(s[0],s[1],o),((1<(parseInt(o[l][r].getAttribute("rowspan"),10)||1)||1<(parseInt(o[l][r].getAttribute("colspan"),10)||1))&&a||(1<(parseInt(o[d][r].getAttribute("rowspan"),10)||1)||1<(parseInt(o[d][r].getAttribute("colspan"),10)||1))&&(s=this.getCorrespondingIndex(o[d][r],o),a=this.FindIndex(s[0],s[1],o)))&&(l=Math.min(s[0],l),d=Math.max(a[0],d),c=Math.min(s[1],c),h=Math.max(a[1],h));p=l===e&&d===t&&c===n&&h===i?{startRow:e,endRow:t,startColumn:n,endColumn:i}:this.highlightCells(l,d,c,h,o)}return p},O.prototype.restoreRange=function(e){!this.parent.currentDocument.getSelection().rangeCount||"TD"!==e.nodeName&&"TH"!==e.nodeName||this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0)},O.prototype.tableMove=function(e){this.activeCell=e.selectNode[0];var t=e.event.target,n=this.activeCell.tagName,i=t.tagName;if(this.curTable=j.closest(t,"table"),"TD"===t.tagName||"TH"===t.tagName||n===i){n=j.closest(this.activeCell,"table");if(!j.isNullOrUndefined(this.curTable)&&!j.isNullOrUndefined(n)&&n===this.curTable){for(var o=this.getCorrespondingColumns(),i=this.getCorrespondingIndex(this.activeCell,o),n=this.getCorrespondingIndex(t,o),r=this.curTable.querySelectorAll(".e-cell-select, .e-multi-cells-select, .e-cell-select-end"),s=r.length-1;0<=s;s--)this.activeCell!==r[s]&&g([r[s]],["e-cell-select"]),g([r[s]],["e-multi-cells-select"]),g([r[s]],["e-cell-select-end"]);if(i[0]===n[0]&&i[1]===n[1])1<r.length&&this.restoreRange(t);else{for(var a=this.highlightCells(Math.min(i[0],n[0]),Math.max(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[1],n[1]),o),l=a.startRow;l<=a.endRow;l++)for(var d=a.startColumn;d<=a.endColumn;d++)o[l][d].classList.add("e-cell-select"),o[l][d].classList.add("e-multi-cells-select");t.classList.add("e-cell-select-end"),e.event.type&&e.event.preventDefault(),this.restoreRange(t)}}}},O.prototype.destroy=function(){this.removeEventListener()};var yd=O;function O(e){this.parent=e,this.addEventListener()}var vd=function(){},Cd=(Nd.applyFormat=function(e,t,n,i,o,r,s,a){this.enterAction=i;if(-1<["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","fontcolor","fontname","fontsize","backgroundcolor","inlinecode"].indexOf(t)||"formatPainter"===r){"backgroundcolor"===t&&""===r&&(r="transparent");var l=new bs,d=new xl(n,e),c=new Bl,h=new zr,p=l.getRange(e),u=p.startContainer.parentElement;if(!p.collapsed||j.isNullOrUndefined(u)||"A"!==u.tagName||p.startOffset!==u.textContent.length&&0!==p.startOffset||(m=document.createTextNode(""),0===p.startOffset?u.parentNode.insertBefore(m,u):j.isNullOrUndefined(u.nextSibling)?u.parentNode.appendChild(m):u.parentElement.insertBefore(m,u.nextSibling),u=e.createRange(),p.setStart(m,0),p.setEnd(m,0),p.collapse(!0),l.setRange(e,u)),-1!==j.Browser.userAgent.indexOf("Firefox")&&p.startContainer===p.endContainer&&!j.isNullOrUndefined(n)&&p.startContainer===n){for(var m=p.startContainer.childNodes[0<p.startOffset?p.startOffset-1:p.startOffset]||p.startContainer,u=p.endContainer.childNodes[0<p.endOffset?p.endOffset-1:p.endOffset]||p.endContainer,g="BR"===u.lastChild.nodeName?j.isNullOrUndefined(u.lastChild.previousSibling)?u:u.lastChild.previousSibling:u.firstChild;!j.isNullOrUndefined(g)&&"#text"!==g.nodeName&&"IMG"!==g.nodeName&&"BR"!==g.nodeName&&"HR"!==g.nodeName;)g=g.lastChild;l.setSelectionText(e,m,g,0,0),p=l.getRange(e)}for(var f,b,u=l.save(p,e),y=void 0,v=!1,C=((y=n&&o&&"#text"!==n.nodeName?o.getTextNodes():y)&&0<y.length?v=!0:y=p.collapsed?l.getSelectionNodeCollection(p):l.getSelectionNodeCollectionBr(p),!1),N=!1,m=!1,E=-1<["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(t),S=(!v&&p.collapsed&&(o=h.getFormattedNode(p.startContainer,t,n),b=j.isNullOrUndefined(o)?null:null===o.getAttribute("style")?o.nodeName:o.nodeName+"[style='"+o.getAttribute("style")+"']",0<y.length?(C=!0,p=c.GetCursorRange(e,p,y[0])):3===p.startContainer.nodeType&&(0<p.startContainer.parentElement.childElementCount&&0<p.startOffset&&"br"!==p.startContainer.parentElement.firstElementChild.tagName.toLowerCase()||!j.isNullOrUndefined(o)&&o===p.startContainer.parentElement.closest(b)&&0!==p.startContainer.parentElement.closest(b).textContent.replace(new RegExp("","g"),"").trim().length)?(C=!0,p=c.GetCursorRange(e,p,p.startContainer),y.push(p.startContainer)):(o=this.insertCursorNode(e,l,p,h,c,t,r,n),l.endContainer=l.startContainer=l.getNodeArray(o,!0),b="BR"===o.nodeName&&o.parentNode.childNodes,j.isNullOrUndefined(b)||1!==b.length||"BR"!==b[0].nodeName||0!==y.length?l.endOffset=l.startOffset=1:(l.setSelectionText(e,p.startContainer,p.endContainer,0,0),m=!0),"BR"===o.nodeName&&0===o.parentNode.textContent.length&&(m=!0))),f=!v&&p.collapsed,!1),T=0;T<y.length;T++){var O=h.getFormattedNode(y[T],t,n);null===O&&("subscript"===t?S=null!==(O=h.getFormattedNode(y[T],"superscript",n)):"superscript"===t&&(S=null!==(O=h.getFormattedNode(y[T],"subscript",n)))),0===T&&null===O&&(N=!0),y[T]=null===O||N&&!E?this.insertFormat(e,y,T,O,f,v,N,E,p,c,t,r,a,d,n):this.removeFormat(y,T,O,f,v,N,E,p,c,t,r,l,n,d),v||(l=this.applySelection(y,l,c,T,C))}vs()&&Cs(n,s),m||v||u.restore(),S&&this.applyFormat(e,t,n,i)}},Nd.insertCursorNode=function(e,t,n,i,o,r,s,a){var l=t.getNodeCollection(n),d=new xl(a,e),i=0<l.length?1<l.length&&n.startContainer===n.endContainer?this.getCursorFormat(i,l,r,a):""===s&&"fontsize"===r&&null==i.getFormattedNode(l[0],r,a)&&"SPAN"===l[0].parentElement.nodeName?l[0].parentElement:i.getFormattedNode(l[0],r,a):null,c=null;if(i){if(c=l[0],8203===i.firstChild.textContent.charCodeAt(0)&&3===i.firstChild.nodeType){var a=new RegExp("","g"),h=void 0;if("#text"!==c.nodeName)for(var p=0;p<l.length;p++)l[p].nodeType===Node.TEXT_NODE&&(c=l[p]);0===(h=i.firstChild===c?(c.textContent=i.parentElement&&(d.isBlockNode(i.parentElement)&&i.parentElement.textContent.length<=1?1<i.parentElement.childElementCount:0===i.childElementCount)&&(1<i.parentElement.textContent.length||i.parentElement.firstChild&&1===i.parentElement.firstChild.nodeType)?c.textContent:c.textContent.replace(a,""),c):(i.firstChild.textContent=i.firstChild.textContent.replace(a,""),i.firstChild)).textContent.length&&(j.isNullOrUndefined(h.previousSibling)?j.isNullOrUndefined(h.parentElement)||0!==h.parentElement.textContent.length||(a=document.createElement("BR"),h.parentElement.appendChild(a),j.detach(h),t.setCursorPoint(e,(c=a).parentElement,0)):(c=h.previousSibling,a=h.textContent.length-1,t.setCursorPoint(e,h,a)))}-1<["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(r)?("fontcolor"===r?i.style.color=s:"fontname"===r?i.style.fontFamily=s:"fontsize"===r?i.style.fontSize=s:i.style.backgroundColor=s,c=i):F.unwrap(i)}else{if(1<l.length&&0<n.startOffset&&l[0].firstElementChild&&"br"===l[0].firstElementChild.tagName.toLowerCase()&&(l[0].innerHTML=""),1!==l.length||0!==n.startOffset||"BR"!==l[0].nodeName&&(j.isNullOrUndefined(l[0].nextSibling)||"BR"!==l[0].nextSibling.nodeName)||j.detach("#text"===l[0].nodeName?l[0].nextSibling:l[0]),!j.isNullOrUndefined(l[0].parentElement)&&-1!==zr.inlineTags.indexOf(l[0].parentElement.tagName.toLowerCase())&&l[0].textContent.includes("")){t=this.GetFormatNode(r,s),h=l[0];if("fontsize"===r)for(var u=l[0];u;){var m=u.parentElement.textContent.trim()===l[0].textContent.trim(),g=u.parentElement;if(d.isBlockNode(g)||!m||"SPAN"===g.nodeName&&g.classList.contains("e-img-inner"))break;l[0]=u=g}return this.applyStyles(l,0,t),h}c=this.getInsertNode(e,n,r,s).firstChild}return c},Nd.getCursorFormat=function(e,t,n,i){for(var o,r=0;r<t.length;r++)o=t[r].lastElementChild||t[r];return"fontsize"===n&&null==e.getFormattedNode(o,n,i)&&"SPAN"===o.parentElement.nodeName?o.parentElement:e.getFormattedNode(o,n,i)},Nd.removeFormat=function(e,t,n,i,o,U,r,s,a,l,d,c,h,p){var u,m,g=null,f="#text"===s.startContainer.nodeName?s.startContainer.textContent.substring(s.startOffset,s.startContainer.textContent.length):s.startContainer.textContent,P=e[t].textContent;if(s.startContainer!==s.endContainer||0!==s.startOffset||s.endOffset!==s.startContainer.length){for(var b=[],y=e[t],v=y;b.push(c.getIndex(y)),(y=y.parentNode)&&y!==n;);if("BR"!==e[t].nodeName&&("#text"===v.nodeName&&v.textContent.includes("")&&v.remove(),o||(y=g=i&&n.textContent.length-1===s.startOffset?a.SplitNode(s,n,!0):a.GetSpliceNode(s,n))),i){for(var C=g;null!==C.firstChild&&3!==C.firstChild.nodeType;)C=C.firstChild;C.innerHTML="&#8203;",e[t]=C.firstChild}else{for(;y&&0<y.childNodes.length&&0<=b.length-1&&y.childNodes.length>b[b.length-1];)y=y.childNodes[b[b.length-1]],b.pop();"BR"!==e[t].nodeName&&(3!==y.nodeType||i&&""===y.nodeValue?((v=document.createElement("div")).innerHTML="&#8203;",3!==y.nodeType?(y.insertBefore(v.firstChild,y.firstChild),e[t]=y.firstChild):(y.parentNode.insertBefore(v.firstChild,y),e[t]=y.previousSibling,y.parentNode.removeChild(y))):e[t]=y)}}else if(r&&!e[t].contains(n)&&3===e[t].nodeType&&e[t].textContent!==n.textContent){for(var o=e[t].textContent===e[t].wholeText,N=e[t],g=this.GetFormatNode(l,d);N&&N.textContent===N.parentElement.textContent;)N=N.parentElement;if(o&&n.textContent!==N.textContent)return i=[],(v=this.getPriorityFormatNode(N,h))&&v.textContent===N.textContent&&(N=v),i.push(N),this.applyStyles(i,0,g),e[t]}"backgroundcolor"===l&&(u=n.style.fontSize),"fontsize"===l&&(o=j.closest(e[t].parentElement,"span[style*=background-color]"),j.isNullOrUndefined(o)||(m=o.style.backgroundColor));var E,S=n.getAttribute("style"),T=n.tagName;if("A"===T&&"underline"===l?(n.style.textDecoration="none",E=[n]):-1!==zr.inlineTags.indexOf(T.toLowerCase())&&r&&"span"!==T.toLocaleLowerCase()?((v=n.style).color&&"fontcolor"===l?"A"===n.nodeName?v.color=d:v.color="":v.backgroundColor&&"backgroundcolor"===l?v.backgroundColor="":v.fontSize&&"fontsize"===l?v.fontSize="":v.fontFamily&&"fontname"===l&&(v.fontFamily=""),""===n.getAttribute("style")&&n.removeAttribute("style"),E=[n]):(E=F.unwrap(n),w=e[t].parentElement,j.isNullOrUndefined(w)||"li"===w.tagName.toLowerCase()||(w=j.closest(w,"li")),j.isNullOrUndefined(w)||"li"!==w.tagName.toLowerCase()||w.textContent.trim()!==e[t].textContent.trim()?j.isNullOrUndefined(w)||"li"!==w.tagName.toLowerCase()||w.textContent.trim()===e[t].textContent.trim()||Nd.conCatenateTextNode(w,l,"","normal",d):"bold"===l?w.style.fontWeight="normal":"italic"===l&&(w.style.fontStyle="normal")),E[0]&&!r)for(var O=N=E[t]||E[0];N&&N.parentElement&&N.parentElement!==h;){var H=void 0,H="SPAN"===n.nodeName?N.parentElement.tagName.toLocaleLowerCase()===n.tagName.toLocaleLowerCase()&&N.parentElement.getAttribute("style")===S:N.parentElement.tagName.toLocaleLowerCase()===n.tagName.toLocaleLowerCase();N=!(N.parentElement&&H&&(1<N.parentElement.childElementCount||1<s.startOffset))||(O.parentElement&&O.parentElement.tagName.toLocaleLowerCase()===n.tagName.toLocaleLowerCase()&&s.startOffset===s.endOffset&&1!==O.nodeType&&!j.isNullOrUndefined(O.textContent)&&1<O.parentElement.childElementCount&&(s.setStart(O,0),s.setEnd(O,O.textContent.length),a.SplitNode(s,O.parentElement,!1)),"span"===N.parentElement.tagName.toLocaleLowerCase()&&"underline"===n.style.textDecoration&&"underline"!==N.parentElement.style.textDecoration)||(F.unwrap(N.parentElement),j.isNullOrUndefined(N.parentElement))||p.isBlockNode(N.parentElement)?N.parentElement:O}if(0<E.length&&r&&!("fontname"===l&&""===d||"fontsize"===l&&""===d)){for(var L=0;L<E.length;L++)(3!==E[L].nodeType||E[L].textContent&&0<E[L].textContent.trim().length)&&(E[L]=F.Wrap(E[L],this.GetFormatNode(l,d,T,S)),w=e[t].parentElement,j.isNullOrUndefined(w)||"li"===w.tagName.toLowerCase()||(w=j.closest(w,"li")),j.isNullOrUndefined(w)||"li"!==w.tagName.toLowerCase()||w.textContent.trim()!==e[t].textContent.trim()||"fontname"===l&&(w.style.fontFamily=d),j.isNullOrUndefined(w)||"li"!==w.tagName.toLowerCase()||w.textContent.trim()===e[t].textContent.trim()||Nd.conCatenateTextNode(w,l,w.textContent,l,d),E[L].textContent===f)&&(0===L?s.setStartBefore(E[L]):L===E.length-1&&s.setEndAfter(E[L]));i=e[t].parentElement;if(j.isNullOrUndefined(u)||""===u||(i.style.fontSize=u),j.isNullOrUndefined(m)||""===m||(i.style.backgroundColor=m),"backgroundcolor"!==l||j.isNullOrUndefined(u)||""===u||i.parentElement.innerHTML!==i.outerHTML||((g=i.parentElement).parentElement.insertBefore(i,g),j.detach(g)),"fontsize"===l||"fontcolor"===l){for(var w=e[t].parentElement,k=e[t].parentElement;!j.isNullOrUndefined(k)&&"li"!==k.tagName.toLowerCase();)w=k=k.parentElement;for(var L=t,x="";0<=L&&!j.isNullOrUndefined(w)&&"li"===w.tagName.toLowerCase()&&w.contains(e[L])&&w.textContent.replace("//g","").trim().includes(e[L].textContent.trim());)x=" "+e[L].textContent.trim()+x,L--;var D=!1,M=0,B=!1;if(!j.isNullOrUndefined(w)&&w.childNodes)for(var R=0;R<w.childNodes.length;R++)"OL"===w.childNodes[R].nodeName&&(M++,D=!0);if(j.isNullOrUndefined(w)||"li"!==w.tagName.toLowerCase()||w.textContent.split("").join("").trim()!==x.split("").join("").trim()){if(!j.isNullOrUndefined(w)&&"li"===w.tagName.toLowerCase()&&D){if(D&&0<M)for(var A=0;A<w.childNodes.length;A++)e[t].textContent===w.childNodes[A].textContent&&e[t].textContent===P&&w.textContent.replace("//g","").trim().includes(x.split("").join("").trim())&&(B=!0);if(B){for(var I=0;I<w.childNodes.length;I++)"OL"===w.childNodes[I].nodeName&&(w.childNodes[I].style.fontSize="initial");"fontsize"===l?w.style.fontSize=d:(w.style.color=d,w.style.textDecoration="inherit")}}}else"fontsize"===l?w.style.fontSize=d:(w.style.color=d,w.style.textDecoration="inherit")}}return e[t]},Nd.insertFormat=function(e,t,n,i,o,r,s,a,l,d,c,h,p,u,m){if(o)"uppercase"!==c&&"lowercase"!==c?(g=this.getInsertNode(e,l,c,h),t[n]=g.firstChild,d.position=1):d.position=l.startOffset;else if(null===i&&s||a){if(r||"BR"===t[n].nodeName||(t[n]=d.GetSpliceNode(l,t[n]),t[n].textContent=d.TrimLineBreak(t[n].textContent)),"uppercase"===c||"lowercase"===c)t[n].textContent="uppercase"===c?t[n].textContent.toLocaleUpperCase():t[n].textContent.toLocaleLowerCase();else if(!0!==a||""!==h){var g=this.GetFormatNode(c,h);if("formatPainter"===h||a){for(var f=t[n].parentElement,b=t[n].parentElement;!j.isNullOrUndefined(b)&&"li"!==b.tagName.toLowerCase();)f=b=b.parentElement;if("fontcolor"===c||"fontname"===c||"fontsize"===c){var y=t[n].parentElement;if(!j.isNullOrUndefined(y)&&y.childNodes)for(var v=0;v<y.childNodes.length;v++){if(this.concatenateTextExcludingList(t,n)===t[n].textContent){var C=void 0;if("LI"===y.tagName?C=y:y.closest("li")&&(C=y.closest("li")),!j.isNullOrUndefined(C))switch(c){case"fontcolor":C.style.color=h;break;case"fontname":C.style.fontFamily=h;break;case"fontsize":C.style.fontSize=h}}var N=y.childNodes[v];if("OL"===N.tagName||"UL"===N.tagName)switch(c){case"fontcolor":N.style.color="initial";break;case"fontname":N.style.fontFamily="initial";break;case"fontsize":N.style.fontSize="initial"}}}if(j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()!==t[n].textContent.trim()||("fontsize"===c?f.style.fontSize=h:"fontcolor"===c?(f.style.color=h,f.style.textDecoration="inherit"):"fontname"===c&&(f.style.fontFamily=h)),"formatPainter"===h)return this.insertFormatPainterElem(t,n,l,d,p,u);o=t[n],e=this.getPriorityFormatNode(o,m);if(!j.isNullOrUndefined(e)||a){var E=j.isNullOrUndefined(e)?o:e,E=j.isNullOrUndefined(e)||""===e.style.fontSize?E:E.firstChild;if(j.isNullOrUndefined(e)||"fontsize"===c)for(;E;){var S=E.parentElement.textContent.trim()===t[n].textContent.trim(),T=E.parentElement;if(u.isBlockNode(T)||!S||"SPAN"===T.nodeName&&T.classList.contains("e-img-inner"))break;E=T}i=[];"fontcolor"===c&&(s=j.closest(t[n].parentElement,"A"),j.isNullOrUndefined(s)||s.firstChild.textContent.trim()!==t[n].textContent.trim()||(E=t[n])),t[n].textContent.trim()!==E.textContent.trim()&&(E=t[n]),i[0]=E,this.applyStyles(i,0,g),j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()===t[n].textContent.trim()||Nd.conCatenateTextNode(f,c,f.textContent,c,h)}else t[n]=this.applyStyles(t,n,g)}else{t[n]=this.applyStyles(t,n,g);f=t[n].parentElement;j.isNullOrUndefined(f)||"li"===f.tagName.toLowerCase()||(f=j.closest(f,"li")),j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()!==t[n].textContent.trim()?j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()===t[n].textContent.trim()||Nd.conCatenateTextNode(f,c,f.textContent,c):"bold"===c?f.style.fontWeight="bold":"italic"===c&&(f.style.fontStyle="italic")}}}else r||(t[n]=d.GetSpliceNode(l,t[n]));return t[n]},Nd.applyStyles=function(e,t,n){return"BR"===e[t].nodeName&&"BR"===this.enterAction||(e[t]=t===e.length-1||"BR"===e[t].nodeName?F.Wrap(e[t],n):F.WrapBefore(e[t],n,!0),e[t]=this.getChildNode(e[t],n)),e[t]},Nd.getPriorityFormatNode=function(e,t){var n,i,o=new zr,r=o.getFormattedNode(e,"fontsize",t);return j.isNullOrUndefined(r)?(n=o.getFormattedNode(e,"backgroundcolor",t),j.isNullOrUndefined(n)?(i=o.getFormattedNode(e,"fontname",t),j.isNullOrUndefined(i)?(o=o.getFormattedNode(e,"fontcolor",t),j.isNullOrUndefined(o)?null:o):i):n):r},Nd.getInsertNode=function(e,t,n,i){n=this.GetFormatNode(n,i);return n.innerHTML="&#8203;",j.Browser.isIE?((i=e.createDocumentFragment()).appendChild(n),t.insertNode(i)):t.insertNode(n),n},Nd.getChildNode=function(e,t){return null==e&&(t.innerHTML="&#8203;",e=t.firstChild),e},Nd.applySelection=function(e,t,n,i,o){return 1!==e.length||o?1===e.length&&o?(t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=n.position,t.endOffset=n.position):0===i?(t.startContainer=t.getNodeArray(e[i],!0),t.startOffset=0):i===e.length-1&&(t.endContainer=t.getNodeArray(e[i],!1),t.endOffset=e[i].textContent.length):(t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=0,t.endOffset=e[i].textContent.length),t},Nd.GetFormatNode=function(e,t,n,i){var o;switch(e){case"bold":return document.createElement("strong");case"italic":return document.createElement("em");case"underline":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.textDecoration="underline",o;case"strikethrough":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.textDecoration="line-through",o;case"superscript":return document.createElement("sup");case"subscript":return document.createElement("sub");case"fontcolor":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.color=t,o.style.textDecoration="inherit",o;case"fontname":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.fontFamily=t,o;case"fontsize":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.fontSize=t,o;case"inlinecode":return document.createElement("code");default:return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.backgroundColor=t,o}},Nd.updateStyles=function(e,t,n){null!==n&&"SPAN"===t&&e.setAttribute("style",n)},Nd.insertFormatPainterElem=function(e,t,n,i,o,r){var s=r.isBlockNode(e[t].parentElement)?e[t]:e[t].parentElement;if(!r.isBlockNode(s))for(;s.textContent.trim()===s.parentElement.textContent.trim()&&!r.isBlockNode(s.parentElement);)s=s.parentElement;j.isNullOrUndefined(s)||1!==s.nodeType||s.classList.contains("e-rte-img-caption")||s.classList.contains("e-img-inner")||this.formatPainterCleanup(t,e,s,n,i,r);var a,n=o.element;return j.isNullOrUndefined(n)||(0<(a=(n=n.cloneNode(!(i=void 0))).querySelectorAll(o.lastChild.nodeName)).length?i=a[a.length-1]:j.isNullOrUndefined(n)||n.nodeName!==o.lastChild.nodeName||(i=n),i.textContent=e[t].textContent,a=i.childNodes[0],e[t]=F.Wrap(e[t],n),e[t].textContent="",e[t]=a),e[t]},Nd.formatPainterCleanup=function(e,t,n,i,o,r){var s=["A","AUDIO","IMG","VIDEO","IFRAME"];if(0===e&&n.textContent.trim()!==t[e].textContent.trim()){o.SplitNode(i,n,!0);for(var a=t[e].parentElement.childNodes,l=0;l<a.length;l++)if(a[l].textContent.trim()===t[l].textContent.trim()){n.parentNode.insertBefore(a[l],n);break}for(var d=n.parentElement.childNodes,c=0;c<d.length;c++)""!==d[c].textContent.trim()&&0!==d[c].textContent.length||160===d[c].textContent.charCodeAt(0)||j.detach(d[c])}else if(n.textContent.trim()!==t[e].textContent.trim())n.parentElement.insertBefore(t[e],n);else for(;!j.isNullOrUndefined(n)&&3!==n.nodeType&&!r.isBlockNode(n);){for(var h=void 0,l=0;l<n.childNodes.length;l++){var p=n.childNodes[l];0!==p.textContent.trim().length&&3!==p.nodeType&&(h=n.childNodes[l])}-1===s.indexOf(n.tagName)&&F.unwrap(n),n=h}},Nd.concatenateTextExcludingList=function(e,t){var n="",i="#text"===e[t].nodeName?j.closest(e[t].parentElement,"li"):j.closest(e[t],"li");if(!j.isNullOrUndefined(i))for(var o=0;o<i.childNodes.length;o++){var r=i.childNodes[o];(3===r.nodeType||1===r.nodeType&&"OL"!==r.tagName&&"UL"!==r.tagName)&&(n+=r.textContent)}return n},Nd.conCatenateTextNode=function(e,t,n,i,o){var r="",s="",a="",l="";switch(t){case"bold":e.querySelectorAll("strong").forEach(function(e){r+=e.textContent}),r===n&&(e.style.fontWeight=i);break;case"italic":e.querySelectorAll("em").forEach(function(e){r+=e.textContent}),r===n&&(e.style.fontStyle=i);break;case"fontcolor":e.querySelectorAll("span").forEach(function(e){(s=e.style.color)===o&&(r+=e.textContent)}),r===n&&(e.style.color=s,e.style.textDecoration="inherit");break;case"fontsize":e.querySelectorAll("span").forEach(function(e){(a=e.style.getPropertyValue("font-size"))===o&&(r+=e.textContent)}),r===n&&(e.style.fontSize=a);break;case"fontname":e.querySelectorAll("span").forEach(function(e){(l=(l=e.style.getPropertyValue("font-family")).replace(/ /g,""))===o&&(r+=e.textContent)}),r===n&&(e.style.fontFamily=l)}},Nd.enterAction="P",Nd);function Nd(){}Sd.prototype.addEventListener=function(){this.parent.observer.on(hs,this.applySelection,this),this.parent.observer.on(m,this.keyDownHandler,this),this.parent.observer.on(f,this.destroy,this)},Sd.prototype.removeEventListener=function(){this.parent.observer.off(hs,this.applySelection),this.parent.observer.off(m,this.keyDownHandler),this.parent.observer.off(f,this.destroy)},Sd.prototype.keyDownHandler=function(e){(e.event.ctrlKey||e.event.metaKey)&&-1<["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","inlinecode"].indexOf(e.event.action)&&(e.event.preventDefault(),Cd.applyFormat(this.parent.currentDocument,e.event.action,this.parent.editableElement,e.enterAction,this.parent.tableCellSelection),this.callBack(e,e.event.action))},Sd.prototype.applySelection=function(e){Cd.applyFormat(this.parent.currentDocument,e.subCommand.toLocaleLowerCase(),this.parent.editableElement,e.enterAction,this.parent.tableCellSelection,e.value,e.selector),this.callBack(e,e.subCommand)},Sd.prototype.callBack=function(e,t){e.callBack&&e.callBack({requestType:t,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},Sd.prototype.destroy=function(){this.removeEventListener()};var Ed=Sd;function Sd(e){this.parent=e,this.addEventListener()}Od.prototype.addEventListener=function(){this.parent.observer.on(ps,this.applyHtml,this),this.parent.observer.on(f,this.destroy,this)},Od.prototype.removeEventListener=function(){this.parent.observer.off(ps,this.applyHtml),this.parent.observer.off(f,this.destroy)},Od.prototype.applyHtml=function(e){var t,n;Ul.Insert(this.parent.currentDocument,e.value,this.parent.editableElement,!0,e.enterAction),"pasteCleanup"===e.subCommand?(t=this.parent.editableElement.querySelectorAll(".pasteContent_RTE"),t=[].slice.call(t),n=this.parent.editableElement.querySelectorAll(".pasteContent_Img"),n=[].slice.call(n),e.callBack({requestType:e.subCommand,editorMode:"HTML",elements:t,imgElem:n})):e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},Od.prototype.destroy=function(){this.removeEventListener()};var Td=Od;function Od(e){this.parent=e,this.addEventListener()}wd.clear=function(e,t,n,i,o){this.domNode=new xl(t,e),this.defaultTag="P"===n?this.defaultTag:"div";var n=new bs,r=new Bl,s=n.getRange(e),a=s.collapsed?n.getSelectionNodeCollection(s):n.getSelectionNodeCollectionBr(s),l=n.save(s,e),d=!1;if(s.collapsed&&"ClearFormat"!==o&&(d=!0,s=r.GetCursorRange(e,s,a[0])),!s.collapsed){o=void 0,o=0<a.length&&"BR"===a[0].nodeName&&j.closest(a[0],"table")?r.GetSpliceNode(s,j.closest(a[0],"table")):r.GetSpliceNode(s,a[1<a.length&&"IMG"===a[0].nodeName?1:0]);if(1===a.length)n.setSelectionContents(e,o),s=n.getRange(e);else if(1<a.length){for(var c=1,h=a[a.length-c];a.length<=c&&"BR"===a[a.length-c].nodeName;)h=a[a.length-++c];var p=r.GetSpliceNode(s,h);p&&n.setSelectionText(e,o,p,0,(3===p.nodeType?p.textContent:p.childNodes).length),s=n.getRange(e)}o=n.getNodeCollection(s),p=o.slice(),p=(this.clearInlines(n.getSelectionNodes(p),p,n.getRange(e),r,t),this.reSelection(e,l,o),s=n.getRange(e),(o=n.getNodeCollection(s)).slice());this.clearBlocks(e,p,t,r,n),vs()&&Cs(t,i),this.reSelection(e,l,o)}d&&n.setCursorPoint(e,s.endContainer,s.endOffset)},wd.reSelection=function(e,t,n){n=t.getInsertNodes(n),t.startContainer=t.getNodeArray(n[0],!0,e),t.startOffset=0,t.endContainer=t.getNodeArray(n[n.length-1],!1,e),e=n[n.length-1];t.endOffset=(3===e.nodeType?e.textContent:e.childNodes).length,t.restore()},wd.clearBlocks=function(e,t,n,i,o){for(var r=[],s=0;s<t.length;s++)-1<this.BLOCK_TAGS.indexOf(t[s].nodeName.toLocaleLowerCase())&&-1===r.indexOf(t[s])?r.push(t[s]):-1<this.BLOCK_TAGS.indexOf(t[s].parentNode.nodeName.toLocaleLowerCase())&&-1===r.indexOf(t[s].parentNode)&&n!==t[s].parentNode&&r.push(t[s].parentNode);r=this.spliceParent(r,t)[0],r=this.removeParent(r),this.unWrap(e,r,i,o)},wd.spliceParent=function(e,t){for(var n=0;n<e.length;n++)for(var i=e[n].childNodes.length,o=0;o<i;o++)if((t=0<t.indexOf(e[n].childNodes[o])&&0<e[n].childNodes[o].childNodes.length?this.spliceParent([e[n].childNodes[o]],t)[1]:t).indexOf(e[n].childNodes[o])<=-1&&""!==e[n].childNodes[o].textContent.trim()){for(var r=0;r<i;r++)-1<t.indexOf(e[n].childNodes[r])&&t.splice(t.indexOf(e[n].childNodes[r]),1);var o=e[n].childNodes.length,s=e.indexOf(e[n].parentNode),a=t.indexOf(e[n].parentNode),s=(-1<s&&e.splice(s,1),-1<a&&t.splice(a,1),t.indexOf(e[n]));-1<s&&t.splice(s,1),e.splice(n,1),n--}return[e,t]},wd.removeChild=function(e,t){var n=t.childNodes.length;if(0<n)for(var i=0;i<n;i++)-1<e.indexOf(t.childNodes[i])&&(e=this.removeChild(e,t.childNodes[i])).splice(e.indexOf(t.childNodes[i]),1);return e},wd.removeParent=function(e){for(var t=0;t<e.length;t++)-1<e.indexOf(e[t].parentNode)&&((e=this.removeChild(e,e[t])).splice(t,1),t--);return e},wd.unWrap=function(e,t,n,i){for(var o=0;o<t.length;o++)if(-1<this.NONVALID_TAGS.indexOf(t[o].nodeName.toLowerCase())&&t[o].parentNode&&-1<this.NONVALID_PARENT_TAGS.indexOf(t[o].parentNode.nodeName.toLowerCase())&&(i.setSelectionText(e,t[o],t[o],0,t[o].childNodes.length),F.unwrap(n.GetSpliceNode(i.getRange(e),t[o].parentNode))),"p"!==t[o].nodeName.toLocaleLowerCase()){!(this.NONVALID_PARENT_TAGS.indexOf(t[o].nodeName.toLowerCase())<0&&"p"!==t[o].parentNode.nodeName.toLocaleLowerCase())||("blockquote"===t[o].nodeName.toLocaleLowerCase()||"li"===t[o].nodeName.toLocaleLowerCase())&&-1<this.IGNORE_PARENT_TAGS.indexOf(t[o].childNodes[0].nodeName.toLocaleLowerCase())||1===t[o].childNodes.length&&"p"===t[o].childNodes[0].nodeName.toLocaleLowerCase()||F.Wrap(t[o],e.createElement(this.defaultTag));var r=F.unwrap(t[o]);1===r.length&&"p"===r[0].parentNode.nodeName.toLocaleLowerCase()&&(F.Wrap(t[o],e.createElement(this.defaultTag)),F.unwrap(t[o]));for(var s,a=0;a<r.length;a++)-1<this.NONVALID_TAGS.indexOf(r[a].nodeName.toLowerCase())?this.unWrap(e,[r[a]],n,i):-1<this.BLOCK_TAGS.indexOf(r[a].nodeName.toLocaleLowerCase())&&"p"!==r[a].nodeName.toLocaleLowerCase()?(s=this.removeParent([r[a]]),this.unWrap(e,s,n,i)):-1<this.BLOCK_TAGS.indexOf(r[a].nodeName.toLocaleLowerCase())&&r[a].parentNode.nodeName.toLocaleLowerCase()===r[a].nodeName.toLocaleLowerCase()?F.unwrap(r[a]):-1<this.BLOCK_TAGS.indexOf(r[a].nodeName.toLocaleLowerCase())&&"p"===r[a].nodeName.toLocaleLowerCase()&&(F.Wrap(r[a],e.createElement(this.defaultTag)),F.unwrap(r[a]))}else F.Wrap(t[o],e.createElement(this.defaultTag)),F.unwrap(t[o])},wd.clearInlines=function(e,t,n,i,o){for(var r=0;r<e.length;r++){for(var s=e[r],a=void 0;!this.domNode.isBlockNode(s)&&s.parentElement&&!s.parentElement.classList.contains("e-img-inner");)s=(a=s).parentElement;a&&-1<zr.inlineTags.indexOf(a.nodeName.toLocaleLowerCase())&&(i.GetSpliceNode(n,a),this.removeInlineParent(a))}},wd.removeInlineParent=function(e){for(var t=F.unwrap(e),n=0;n<t.length;n++)1===t[n].parentNode.childNodes.length&&!t[n].parentNode.classList.contains("e-img-inner")&&-1<zr.inlineTags.indexOf(t[n].parentNode.nodeName.toLocaleLowerCase())?this.removeInlineParent(t[n].parentNode):-1<zr.inlineTags.indexOf(t[n].nodeName.toLocaleLowerCase())&&this.removeInlineParent(t[n])},wd.BLOCK_TAGS=["address","article","aside","blockquote","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","li","main","nav","noscript","ol","p","pre","section","ul"],wd.NONVALID_PARENT_TAGS=["thead","tbody","ul","ol","table","tfoot","tr"],wd.IGNORE_PARENT_TAGS=["ul","ol","table"],wd.NONVALID_TAGS=["thead","tbody","figcaption","td","tr","th","tfoot","figcaption","li"],wd.defaultTag="p";var Ld=wd;function wd(){}xd.prototype.addEventListener=function(){this.parent.observer.on(ms,this.applyClear,this),this.parent.observer.on(m,this.onKeyDown,this),this.parent.observer.on(f,this.destroy,this)},xd.prototype.removeEventListener=function(){this.parent.observer.off(ms,this.applyClear),this.parent.observer.off(m,this.onKeyDown),this.parent.observer.off(f,this.destroy)},xd.prototype.onKeyDown=function(e){"clear-format"===e.event.action&&(this.applyClear({subCommand:"ClearFormat",callBack:e.callBack,enterAction:e.enterAction}),e.event.preventDefault())},xd.prototype.applyClear=function(e){"ClearFormat"===e.subCommand&&(Ld.clear(this.parent.currentDocument,this.parent.editableElement,e.enterAction,e.selector,e.subCommand),e.callBack)&&e.callBack({requestType:e.subCommand,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},xd.prototype.destroy=function(){this.removeEventListener()};var kd=xd;function xd(e){this.parent=e,this.addEventListener()}Md.prototype.addEventListener=function(){this.debounceListener=j.debounce(this.keyUp,this.undoRedoTimer),this.parent.observer.on(Gs,this.debounceListener,this),this.parent.observer.on(m,this.keyDown,this),this.parent.observer.on(Qs,this.onAction,this),this.parent.observer.on(Ys,this.onPropertyChanged,this),this.parent.observer.on(f,this.destroy,this)},Md.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++)switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}},Md.prototype.removeEventListener=function(){this.parent.observer.off(Gs,this.keyUp),this.parent.observer.off(m,this.keyDown),this.parent.observer.off(Qs,this.onAction),this.parent.observer.off(Ys,this.onPropertyChanged),this.parent.observer.off(f,this.destroy),this.debounceListener=null},Md.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},Md.prototype.destroy=function(){this.removeEventListener(),this.element=null,this.steps=null,this.undoRedoStack=[],this.undoRedoSteps=null,this.undoRedoTimer=null},Md.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},Md.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},Md.prototype.getTextContentFromFragment=function(e){for(var t="",n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];i.nodeType===Node.TEXT_NODE?t+=i.textContent:i.nodeType===Node.ELEMENT_NODE&&(t+=this.getTextContentFromFragment(i))}return t},Md.prototype.isElementStructureEqual=function(e,t){if(e.childNodes.length!==t.childNodes.length)return!1;for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n],o=t.childNodes[n];if(!i||!o)return!1;if(i.nodeType!==o.nodeType)return!1;if(i.outerHTML!==o.outerHTML)return!1}return!0},Md.prototype.saveData=function(e){if(this.parent.currentDocument){for(var t=(new bs).getRange(this.parent.currentDocument),n=this.parent.editableElement===t.startContainer.parentElement?t.startContainer.parentElement:t.startContainer,i=n.childNodes.length-1;0<=i;i--)!j.isNullOrUndefined(n.childNodes[i])&&"#text"===n.childNodes[i].nodeName&&0===n.childNodes[i].textContent.length&&"IMG"!==n.childNodes[i].nodeName&&"BR"!==n.childNodes[i].nodeName&&n.childNodes[i].nodeName&&j.detach(n.childNodes[i]);for(var t=(new bs).getRange(this.parent.currentDocument),o=(new bs).save(t,this.parent.currentDocument),r=this.parent.editableElement.cloneNode(!0),s=document.createDocumentFragment();r.firstChild;)s.appendChild(r.firstChild);var a={text:s,range:o};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),1<this.undoRedoStack.length&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.collapsed===t.collapsed&&this.undoRedoStack[this.undoRedoStack.length-1].range.startOffset===o.range.startOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.endOffset===o.range.endOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.startContainer===o.range.startContainer&&this.getTextContentFromFragment(this.undoRedoStack[this.undoRedoStack.length-1].text).trim()===this.getTextContentFromFragment(a.text).trim()&&this.isElementStructureEqual(this.undoRedoStack[this.undoRedoStack.length-1].text,a.text)||(this.undoRedoStack.push(a),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())}},Md.prototype.undo=function(e){var t,n;0<this.steps&&(t=this.undoRedoStack[this.steps-1].range,n=this.undoRedoStack[this.steps-1].text,this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),Es(this.parent.currentDocument,this.parent.editableElement),vs()&&Cs(this.parent.editableElement,e.selector),t.restore(),this.steps--,e.callBack)&&e.callBack({requestType:"Undo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})},Md.prototype.redo=function(e){var t,n;null!=this.undoRedoStack[this.steps+1]&&(t=this.undoRedoStack[this.steps+1].range,n=this.undoRedoStack[this.steps+1].text,this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),Es(this.parent.currentDocument,this.parent.editableElement),vs()&&Cs(this.parent.editableElement,e.selector),t.restore(),this.steps++,e.callBack)&&e.callBack({requestType:"Redo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})},Md.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return 0<this.steps&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e};var Dd=Md;function Md(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=j.isNullOrUndefined(t)?30:t.undoRedoSteps,this.undoRedoTimer=j.isNullOrUndefined(t)?300:t.undoRedoTimer,this.addEventListener()}w.prototype.addEventListener=function(){this.parent.observer.on($s,this.wordCleanup,this),this.parent.observer.on(f,this.destroy,this)},w.prototype.removeEventListener=function(){this.parent.observer.off($s,this.wordCleanup),this.parent.observer.off(f,this.destroy)},w.prototype.wordCleanup=function(e){var t=j.isNullOrUndefined(e.allowedStylePropertiesArray)?[]:e.allowedStylePropertiesArray,n=[],i=e.args.clipboardData.getData("text/HTML"),o=e.args.clipboardData.getData("text/rtf"),r=j.createElement("p"),s=(r.setAttribute("id","MSWord-Content"),r.innerHTML=i,this.addDoubleBr(r),/style='mso-width-source:/i),a=this.findSource(r);/class='?Mso|style='[^ ]*\bmso-/i.test(i)||/class="?Mso|style="[^ ]*\bmso-/i.test(i)||/(class="?Mso|class='?Mso|class="?Xl|class='?Xl|class=Xl|style="[^"]*\bmso-|style='[^']*\bmso-|w:WordDocument)/gi.test(i)||s.test(i)?(i=i.replace(/<img[^>]+>/i,""),this.addListClass(r),n=this.cleanUp(r,n),j.isNullOrUndefined(n[0])||"UL"===n[0].parentElement.tagName||"OL"===n[0].parentElement.tagName||this.listConverter(n),this.imageConversion(r,o),this.cleanList(r,"UL"),this.cleanList(r,"OL"),this.styleCorrection(r,t),this.removingComments(r),this.removeUnwantedElements(r),this.removeEmptyElements(r),this.removeEmptyAnchorTag(r),this.breakLineAddition(r),this.processMargin(r),this.removeClassName(r),s.test(i)&&this.addTableBorderClass(r),e.callBack(r.innerHTML,this.cropImageDimensions,a)):e.callBack(r.innerHTML,null,a)},w.prototype.addDoubleBr=function(e){var t=e.querySelector(".Apple-interchange-newline");if(!j.isNullOrUndefined(t)&&-1!==j.Browser.userAgent.indexOf("Chrome")&&"P"===t.parentElement.nodeName&&e!==t.parentElement)for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.COMMENT_NODE&&i.nodeValue.includes("StartFragment")){var o=document.createElement("p"),r=(o.innerHTML="<br>",t.parentElement.style.cssText),s=o.getAttribute("style")||"";o.setAttribute("style",s+r),e.insertBefore(o,i.nextSibling),j.detach(t);break}}},w.prototype.cleanList=function(e,t){for(var n=e.querySelectorAll(t+" div"),i=n.length-1;0<=i;i--){for(var o=n[i].parentNode;n[i].firstChild;)o.insertBefore(n[i].firstChild,n[i]);var r=this.findClosestListElem(n[i]);r&&this.insertAfter(n[i],r)}},w.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},w.prototype.findClosestListElem=function(e){for(var t;!j.isNullOrUndefined(e);)e=j.isNullOrUndefined(e.closest("ul"))||"UL"===e.tagName?"OL"!==e.tagName?e.closest("ol"):null:e.closest("ul"),t=j.isNullOrUndefined(e)?t:e;return t},w.prototype.addListClass=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++)!j.isNullOrUndefined(t[n].getAttribute("style"))&&0<=t[n].getAttribute("style").replace(/ /g,"").replace("\n","").indexOf("mso-list:l")&&-1===t[n].className.toLowerCase().indexOf("msolistparagraph")&&"H"!==t[n].tagName.charAt(0)&&"LI"!==t[n].tagName&&"OL"!==t[n].tagName&&"UL"!==t[n].tagName&&t[n].classList.add("msolistparagraph")},w.prototype.addTableBorderClass=function(e){for(var t=e.querySelectorAll("table"),n=!1,i=0;i<t.length;i++){for(var o=0;o<this.borderStyle.length;o++)if(0<=t[i].innerHTML.indexOf(this.borderStyle[o])){n=!0;break}n&&(t[i].classList.add("e-rte-table-border"),n=!1)}},w.prototype.imageConversion=function(e,t){this.checkVShape(e);for(var n=e.querySelectorAll("img"),i=0;i<n.length;i++)!j.isNullOrUndefined(n[i].getAttribute("v:shapes"))&&n[i].getAttribute("v:shapes").indexOf("Picture")<0&&n[i].getAttribute("v:shapes").indexOf("")<0&&n[i].getAttribute("v:shapes").indexOf("Grafik")<0&&n[i].getAttribute("v:shapes").toLowerCase().indexOf("image")<0&&n[i].getAttribute("v:shapes").indexOf("Graphic")<0&&n[i].getAttribute("v:shapes").indexOf("_x0000_s")<0&&n[i].getAttribute("v:shapes").indexOf("_x0000_i")<0&&n[i].getAttribute("v:shapes").indexOf("img1")<0&&n[i].classList.add("e-rte-image-unsupported"),n[i].removeAttribute("v:shapes");n=e.querySelectorAll("img");var o=[],r=[],s=[],a=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.)|(blob\:))(\S+))/gi);if(0<n.length){for(i=0;i<n.length;i++)o.push(n[i].getAttribute("src")),s.push(n[i].getAttribute("src").split("/")[n[i].getAttribute("src").split("/").length-1].split(".")[0]);for(var l=this.hexConversion(t),i=0;i<l.length;i++)r.push({base64Data:j.isNullOrUndefined(l[i].hex)?null:this.convertToBase64(l[i]),isCroppedImage:l[i].isCroppedImage}),l[i].isCroppedImage&&this.cropImageDimensions.push({goalWidth:l[i].goalWidth,goalHeight:l[i].goalHeight,cropLength:l[i].cropLength,cropTop:l[i].cropTop,cropR:l[i].cropR,cropB:l[i].cropB});for(n=e.querySelectorAll("img:not(.e-rte-image-unsupported"),i=0;i<n.length;i++)o[i].match(a)?n[i].setAttribute("src",o[i]):(j.isNullOrUndefined(r[i])||j.isNullOrUndefined(r[i].base64Data)?(n[i].removeAttribute("src"),n[i].classList.add("e-rte-image-unsupported")):n[i].setAttribute("src",r[i].base64Data),!j.isNullOrUndefined(r[i])&&r[i].isCroppedImage&&n[i].classList.add("e-img-cropped")),n[i].setAttribute("id","msWordImg-"+s[i]);n=e.querySelectorAll(".e-rte-image-unsupported");for(i=0;i<n.length;i++)n[i].removeAttribute("src")}},w.prototype.checkVShape=function(e){for(var t,n,i=e.querySelectorAll("*"),o=0;o<i.length;o++)switch(i[o].nodeName){case"V:SHAPETYPE":j.detach(i[o]);break;case"V:SHAPE":"V:IMAGEDATA"===i[o].firstElementChild.nodeName&&(t=i[o].firstElementChild.getAttribute("src"),(n=j.createElement("img")).setAttribute("src",t),i[o].parentElement.insertBefore(n,i[o]),j.detach(i[o]))}},w.prototype.convertToBase64=function(e){var t=this.conHexStringToBytes(e.hex),t=this.conBytesToBase64(t);return e.type?"data:"+e.type+";base64,"+t:null},w.prototype.conBytesToBase64=function(e){for(var t="",n=e.length,i=0;i<n;i+=3){var o=e.slice(i,i+3),r=o.length,s=[];if(r<3)for(var a=r;a<3;a++)o[a]=0;s[0]=(252&o[0])>>2,s[1]=(3&o[0])<<4|o[1]>>4,s[2]=(15&o[1])<<2|(192&o[2])>>6,s[3]=63&o[2];for(a=0;a<4;a++)t+=a<=r?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s[a]):"="}return t},w.prototype.conHexStringToBytes=function(e){for(var t=[],n=e.length/2,i=0;i<n;i++)t.push(parseInt(e.substr(2*i,2),16));return t},w.prototype.hexConversion=function(e){var t,n=RegExp,i=new n("\\{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?(\\{\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s\\}]*?"),n=new n("(?:("+i.source+"))([\\da-fA-F\\s]+)\\}","g"),o=e.match(n),r=[];if(!j.isNullOrUndefined(o))for(var s=0;s<o.length;s++)if(-1===o[s].indexOf("fIsBullet")||-1!==o[s].indexOf("wzName")){var a,l=0,d=0,c=0,h=0,p=0,u=0;if(i.test(o[s])){if(-1!==o[s].indexOf("\\pngblip"))t="image/png";else if(-1!==o[s].indexOf("\\jpegblip"))t="image/jpeg";else{if(-1===o[s].indexOf("\\emfblip"))continue;t=null}(a=!!(0<this.extractCropValue("cropl",o[s])&&0<this.extractCropValue("cropt",o[s])||0<this.extractCropValue("cropr",o[s])||this.extractCropValue("cropb",o[s])))&&(l=this.extractCropValue("wgoal",o[s]),d=this.extractCropValue("hgoal",o[s]),c=this.extractCropValue("cropl",o[s]),h=this.extractCropValue("cropt",o[s]),p=this.extractCropValue("cropr",o[s]),u=this.extractCropValue("cropb",o[s])),r.push({hex:t?o[s].replace(i,"").replace(/[^\da-fA-F]/g,""):null,type:t,isCroppedImage:a,goalWidth:l,goalHeight:d,cropLength:c,cropTop:h,cropR:p,cropB:u})}}return r},w.prototype.extractCropValue=function(e,t){e=new RegExp("\\\\pic"+e+"(\\-?\\d+)\\\\").exec(t.replace(/\r\n\\/g,"\\").replace(/\n/g,"\\"))[1];return parseInt(e,10)},w.prototype.removeClassName=function(e){for(var t=e.querySelectorAll("*[class]:not(.e-img-cropped):not(.e-rte-image-unsupported)"),n=0;n<t.length;n++)t[n].removeAttribute("class")},w.prototype.breakLineAddition=function(e){for(var t,n,i=e.querySelectorAll("*"),o=0;o<i.length;o++)0!==i[o].children.length||"&nbsp;"!==i[o].innerHTML||"&nbsp;"!==i[o].innerHTML||i[o].closest("li")||i[o].closest("td")||!("SPAN"!==i[o].nodeName||"SPAN"===i[o].nodeName&&j.isNullOrUndefined(i[o].previousElementSibling)&&j.isNullOrUndefined(i[o].nextElementSibling))||(t=this.findDetachElem(i[o]),n=j.createElement("br"),0<t.textContent.length&&t.textContent.match(/\u00a0/g)&&0<t.textContent.match(/\u00a0/g).length)||j.isNullOrUndefined(t.parentElement)||(t.parentElement.insertBefore(n,t),j.detach(t))},w.prototype.findDetachElem=function(e){e=!j.isNullOrUndefined(e.parentElement)&&""===e.parentElement.textContent.trim()&&"TD"!==e.parentElement.tagName&&j.isNullOrUndefined(e.parentElement.querySelector("img"))?this.findDetachElem(e.parentElement):e;return e},w.prototype.removeUnwantedElements=function(e){for(var t=e.querySelector("style"),n=(j.isNullOrUndefined(t)||j.detach(t),e.innerHTML),i=0;i<this.removableElements.length;i++){var o=RegExp,r=new o("<"+this.removableElements[i]+"\\s*[^>]*>","g"),o=new o("</"+this.removableElements[i]+">","g");n=(n=n.replace(r,"")).replace(o,"")}e.innerHTML=n,e.querySelectorAll(":empty")},w.prototype.findDetachEmptyElem=function(e){return j.isNullOrUndefined(e.parentElement)?null:0<e.parentElement.textContent.length&&e.parentElement.textContent.match(/\u00a0/g)&&0<e.parentElement.textContent.match(/\u00a0/g).length||""!==e.parentElement.textContent.trim()||"MSWord-Content"===e.parentElement.getAttribute("id")||this.hasParentWithClass(e,"MsoListParagraph")||!j.isNullOrUndefined(e.parentElement.querySelector("img"))?e:this.findDetachEmptyElem(e.parentElement)},w.prototype.hasParentWithClass=function(e,t){for(var n=e.parentElement;!j.isNullOrUndefined(n);){if(n.classList.contains(t))return!0;n=n.parentElement}return!1},w.prototype.removeEmptyElements=function(e){for(var t=e.querySelectorAll(":empty"),n=0;n<t.length;n++){j.isNullOrUndefined(t[n].closest("td"))||j.isNullOrUndefined(t[n].closest("td").querySelector(".MsoNormal"))||(t[n].innerHTML="-");var i=!0;"DIV"===t[n].tagName&&(i="none"===t[n].style.borderBottom||""===t[n].style.borderBottom),"IMG"!==t[n].tagName&&"BR"!==t[n].tagName&&"IFRAME"!==t[n].tagName&&"TD"!==t[n].tagName&&"HR"!==t[n].tagName&&i&&(i=this.findDetachEmptyElem(t[n]),j.isNullOrUndefined(i)||j.detach(i))}},w.prototype.styleCorrection=function(e,t){var n=e.querySelectorAll("style"),i=[];if(0<n.length){j.isNullOrUndefined(n[0].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi))?1<n.length&&(i=n[1].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi)):i=n[0].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi);var o=j.isNullOrUndefined(i)?null:this.findStyleObject(i);if(!j.isNullOrUndefined(o)){var r=Object.keys(o),s=r.map(function(e){return o[""+e]}),s=this.removeUnwantedStyle(s,t);this.filterStyles(e,t);for(var a=void 0,l=!1,d=/^(p|div|li)\.(1|10|11)$/,c=0;c<r.length;c++){if(""===r[c].split(".")[0])a=e.getElementsByClassName(r[c].split(".")[1]),l=!0;else{if(1===r[c].split(".").length&&0<=r[c].split(".")[0].indexOf("@")||d.test(r[c]))continue;a=1===r[c].split(".").length&&r[c].split(".")[0].indexOf("@")<0?e.getElementsByTagName(r[c]):e.querySelectorAll(r[c])}for(var h=0;h<a.length;h++)if(!a[h].closest("li")||"p"!==r[c]){var p=a[h].getAttribute("style");if(j.isNullOrUndefined(p)||""===p.trim())s[c]=s[c].replace(/text-indent:-(.*?)(?=;|$)/gm,""),a[h].setAttribute("style",s[c]);else{var u=s[c].split(";");if(!l)for(var m=0;m<u.length;m++)0<=p.indexOf(u[m].split(":")[0])&&(u.splice(m,1),m--);var g=p+u.join(";")+";";a[h].setAttribute("style",g)}}l=!1}for(var f=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"],c=0;c<f.length;c++)if(-1<r.indexOf("li."+f[c]))for(var b=e.querySelectorAll("ol."+f[c]+", ul."+f[c]),h=0;h<b.length;h++){p=b[h].getAttribute("style");if(!j.isNullOrUndefined(p)&&""!==p.trim()&&""!==b[h].style.marginLeft)for(var y,v,u=s[r.indexOf("li."+f[c])].split(";"),m=0;m<u.length;m++)0<="margin-left".indexOf(u[m].split(":")[0])&&!j.isNullOrUndefined(u[m].split(":")[1])&&0<=u[m].split(":")[1].indexOf("in")&&0<=b[h].style.marginLeft.indexOf("in")&&(y=parseFloat(u[m].split(":")[1].split("in")[0]),v=parseFloat(b[h].style.marginLeft.split("in")[0]),b[h].style.marginLeft=v-y+"in")}}}},w.prototype.filterStyles=function(e,t){for(var n=e.querySelectorAll("*[style]"),i=0;i<n.length;i++){for(var o=n[i].getAttribute("style").split(";"),r="",s=0;s<o.length;s++)0<=t.indexOf(o[s].split(":")[0].trim())&&(r+=o[s]+";");n[i].setAttribute("style",r)}},w.prototype.removeUnwantedStyle=function(e,t){for(var n=0;n<e.length;n++){var i=e[n].split(";");e[n]="";for(var o=0;o<i.length;o++)0<=t.indexOf(i[o].split(":")[0])&&(e[n]+=i[o]+";")}return e},w.prototype.findStyleObject=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n],o=i.replace(/([\S ]+\s+){[\s\S]+?}/gi,"$1"),r=i.replace(/[\S ]+\s+{([\s\S]+?)}/gi,"$1"),o=o.replace(/^[\s]|[\s]$/gm,""),r=r.replace(/^[\s]|[\s]$/gm,"");o=o.replace(/\n|\r|\n\r/g,""),r=r.replace(/\n|\r|\n\r/g,"");for(var s=o.split(", "),a=0;a<s.length;a++)t[s[a]]=r}return t},w.prototype.removingComments=function(e){var t=(t=e.innerHTML).replace(/<!--[\s\S]*?-->/g,"");e.innerHTML=t},w.prototype.cleanUp=function(e,t){for(var n,i=[],o=e.querySelectorAll("*"),r=0;r<o.length;r++)-1===this.ignorableNodes.indexOf(o[r].nodeName)||3===o[r].nodeType&&""===o[r].textContent.trim()?i.push(o[r]):(o[r].className&&-1!==o[r].className.toLowerCase().indexOf("msolistparagraph")&&!j.isNullOrUndefined(o[r].getAttribute("style"))&&0<=o[r].getAttribute("style").indexOf("mso-list:")&&(0<=o[r].className.indexOf("MsoListParagraphCxSpFirst")&&0<t.length&&null!==t[t.length-1]&&t.push(null),t.push(o[r])),!n||-1===this.blockNode.indexOf(o[r].nodeName.toLowerCase())||o[r].className&&-1!==o[r].className.toLowerCase().indexOf("msolistparagraph")&&!j.isNullOrUndefined(o[r].getAttribute("style"))&&0<=o[r].getAttribute("style").indexOf("mso-list:")||t.push(null),-1!==this.blockNode.indexOf(o[r].nodeName.toLowerCase())&&(n=!!(o[r].className&&-1!==o[r].className.toLowerCase().indexOf("msolistparagraph")&&!j.isNullOrUndefined(o[r].getAttribute("style"))&&0<=o[r].getAttribute("style").indexOf("mso-list:"))));return t.length&&null!==t[t.length-1]&&t.push(null),t},w.prototype.listConverter=function(e){for(var t,n,i=[],o=[],r="",s="",a=0;a<e.length;a++)if(null===e[a])i.push({content:this.makeConversion(o),node:e[a-1]}),o=[];else{e[a].getAttribute("style")&&-1!==e[a].getAttribute("style").indexOf("mso-outline-level")&&e[a].setAttribute("style",e[a].getAttribute("style").replace("mso-outline-level","mso-outline")),t=(r=e[a].getAttribute("style"))&&-1!==r.indexOf("level")?parseInt(r.charAt(r.indexOf("level")+5),null):1,r&&-1!==r.indexOf("mso-list:")&&(l=void 0,l=!r.match(/mso-list:[^;]+;?/)||(l=r.replace(new RegExp("\\n","g"),"").split(" ").join("").match(/mso-list:[^;]+;?/)[0].split(":l"),j.isNullOrUndefined(l))?null:parseInt(l[1].split("level")[0],10)),this.listContents=[],this.getListContent(e[a]);var l,d=void 0,c=void 0;if(!j.isNullOrUndefined(this.listContents[0])){var h=1<this.listContents[0].trim().length?"ol":"ul",p=this.getlistStyleType(this.listContents[0],h);"ol"!=h||0!==a&&null!==e[a-1]||(g=this.listContents[0].split(".")[0],-1===["A","a","I","i","","1","01","1-"].indexOf(g)&&("decimal"===p?isNaN(parseInt(g,10))||(d=parseInt(g,10)):"upper-alpha"===p?d=g.split(".")[0].charCodeAt(0)-64:"lower-alpha"===p?d=g.split(".")[0].charCodeAt(0)-96:"upper-roman"===p?d=this.upperRomanNumber.indexOf(this.listContents[0].split(".")[0])+1:"lower-roman"===p?d=this.lowerRomanNumber.indexOf(this.listContents[0].split(".")[0])+1:"lower-greek"===p&&(d=this.lowerGreekNumber.indexOf(this.listContents[0].split(".")[0])+1))),""!==e[a].style.marginLeft&&(c=e[a].style.marginLeft);for(var u=[],m=1;m<this.listContents.length;m++)u.push(this.listContents[m]);var g=void 0;j.isNullOrUndefined(e[a].className)||(g=e[a].className),j.isNullOrUndefined(e[a].getAttribute("style"))||(e[a].setAttribute("style",e[a].getAttribute("style").replace("text-align:start;","")),e[a].style.textIndent="",s=e[a].getAttribute("style")),o.push({listType:h,content:u,nestedLevel:t,listFormatOverride:l,class:g,listStyle:s,listStyleTypeName:p,start:d,styleMarginLeft:c})}}for(n=e.shift();n;){for(var f=[],b=0;b<i.length;b++)if(i[b].node===n){for(var y=0;y<i[b].content.childNodes.length;y++)f.push(i[b].content.childNodes[y]);for(y=0;y<f.length;y++)n.parentElement.insertBefore(f[y],n);break}n.remove(),n=(n=e.shift())||e.shift()}},w.prototype.getlistStyleType=function(e,t){var n;if("ol"===t){t=e.split(".")[0].charCodeAt(0);switch(!0){case-1<this.upperRomanNumber.indexOf(e.split(".")[0]):n="upper-roman";break;case-1<this.lowerRomanNumber.indexOf(e.split(".")[0]):n="lower-roman";break;case-1<this.lowerGreekNumber.indexOf(e.split(".")[0]):n="lower-greek";break;case 64<t&&t<91:n="upper-alpha";break;case 96<t&&t<123:n="lower-alpha";break;case 1<e.split(".")[0].length&&"0"===e.split(".")[0][0]&&!isNaN(Number(e.split(".")[0])):n="decimal-leading-zero";break;default:n="decimal"}}else switch(e.split(".")[0]){case"o":n="circle";break;case"":n="square";break;default:n="disc"}return n},w.prototype.makeConversion=function(e){for(var t,n,i=j.createElement("div"),o=1,r=0,s=e[0].listFormatOverride,a=0;a<e.length;a++){for(var l=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"],d=!1,c=0;c<l.length;c++)if(0<=l[c].indexOf(e[a].class)){d=!0;break}j.isNullOrUndefined(u)||0===a||e[a-1].listType===e[a].listType||d||(u=null);var h=j.createElement("p",{className:"MsoNoSpacing"});if(h.innerHTML=e[a].content.join(" "),1!==e[a].nestedLevel||0!==r&&s===e[a].listFormatOverride||!e[a].content){if(e[a].nestedLevel===o&&s===e[a].listFormatOverride)j.isNullOrUndefined(u)||j.isNullOrUndefined(u.parentElement)||u.parentElement.tagName.toLowerCase()!==e[a].listType?j.isNullOrUndefined(u)?((t=j.createElement(e[a].listType)).style.listStyleType=e[a].listStyleTypeName,(u=j.createElement("li")).appendChild(h),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),i.appendChild(t)):((t=j.createElement(e[a].listType)).style.listStyleType=e[a].listStyleTypeName,u.parentElement.parentElement.appendChild(t),(u=j.createElement("li")).appendChild(h),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString())):(u.parentElement.appendChild(u=j.createElement("li")),u.appendChild(h));else if(e[a].nestedLevel>o){if(j.isNullOrUndefined(u))if(e[a].nestedLevel>o&&d){var p=j.createElement(e[a].listType),u=j.createElement("li");p.appendChild(u),p.style.listStyleType="none";for(m=0;m<e[a].nestedLevel-1;m++)u.appendChild(t=j.createElement(e[a].listType)),u=j.createElement("li"),t.appendChild(u),t.style.listStyleType="none";u.appendChild(h),i.appendChild(p),t.setAttribute("level",e[a].nestedLevel.toString())}else i.appendChild(t=j.createElement(e[a].listType)),(u=j.createElement("li")).appendChild(h),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),"msolistparagraph"!==e[a].class?t.style.marginLeft=e[a].styleMarginLeft:j.addClass([t],"marginLeftIgnore");else{for(var m=0;m<e[a].nestedLevel-o;m++)u.appendChild(t=j.createElement(e[a].listType)),u=j.createElement("li"),m!==e[a].nestedLevel-o-1&&1<e[a].nestedLevel-o&&(u.style.listStyleType="none"),t.appendChild(u);u.appendChild(h),t.setAttribute("level",e[a].nestedLevel.toString())}t.style.listStyleType=e[a].listStyleTypeName}else if(1===e[a].nestedLevel)i.lastChild.tagName.toLowerCase()===e[a].listType?t=i.lastChild:(i.appendChild(t=j.createElement(e[a].listType)),t.style.listStyleType=e[a].listStyleTypeName),(u=j.createElement("li")).appendChild(h),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString());else for(n=u;n.parentElement;)if((n=n.parentElement).attributes.getNamedItem("level")){if(parseInt(n.attributes.getNamedItem("level").textContent,10)===e[a].nestedLevel&&s===e[a].listFormatOverride){(u=j.createElement("li")).appendChild(h),n.appendChild(u);break}if(parseInt(n.attributes.getNamedItem("level").textContent,null)===e[a].nestedLevel&&s!==e[a].listFormatOverride){if(t=j.createElement(e[a].listType),u=j.createElement("li"),t.appendChild(u),1<e[a].nestedLevel)for(var g=0;g<e[a].nestedLevel-1;g++)u.appendChild(t=j.createElement(e[a].listType)),u=j.createElement("li"),t.appendChild(u),t.style.listStyleType="none";u.appendChild(h),n.appendChild(t),t.setAttribute("level",e[a].nestedLevel.toString()),t.style.listStyleType=e[a].listStyleTypeName;break}if(e[a].nestedLevel>parseInt(n.attributes.getNamedItem("level").textContent,10)){n.appendChild(t=j.createElement(e[a].listType)),(u=j.createElement("li")).appendChild(h),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),t.style.listStyleType=e[a].listStyleTypeName;break}}}else i.appendChild(t=j.createElement(e[a].listType,{className:e[a].class})),(u=j.createElement("li")).appendChild(h),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),"msolistparagraph"!==e[a].class?t.style.marginLeft=e[a].styleMarginLeft:j.addClass([t],"marginLeftIgnore"),t.style.listStyleType=e[a].listStyleTypeName;u.setAttribute("class",e[a].class),u.setAttribute("style",j.isNullOrUndefined(e[a].listStyle)?"":e[a].listStyle),o=e[a].nestedLevel,s=e[a].listFormatOverride,r++,j.isNullOrUndefined(e[a].start&&1!==e[a].start&&"ol"===e[a].listType)||t.setAttribute("start",e[a].start.toString())}return i},w.prototype.getListContent=function(e){var t=e.firstElementChild;if(""!==t.textContent.trim()||j.isNullOrUndefined(t.firstElementChild)||"IMG"!==t.firstElementChild.nodeName){if(0<t.childNodes.length){for(var n=t.querySelectorAll('[style*="mso-list"]'),i=0;i<n.length;i++)n[i].setAttribute("style",n[i].getAttribute("style").replace(/\n/g,""));var t=t.querySelector('span[style="mso-list:Ignore"]');j.isNullOrUndefined(t)||(this.listContents.push(t.textContent.trim()),j.detach(t),this.removingComments(e),this.removeUnwantedElements(e))}}else t=e.innerHTML.trim(),this.listContents.push(""),this.listContents.push(t);this.listContents.push(e.innerHTML)},w.prototype.processMargin=function(e){var t=e.querySelectorAll("li");if(0<t.length)for(var n=0;n<t.length;n++)j.isNullOrUndefined(t[n].style.marginLeft)||t[n].parentElement.classList.contains("marginLeftIgnore")||(t[n].style.marginLeft="");var i=e.querySelectorAll("table");if(0<i.length)for(n=0;n<i.length;n++)!j.isNullOrUndefined(i[n].style.marginLeft)&&0<=i[n].style.marginLeft.indexOf("-")&&(i[n].style.marginLeft="");var o=e.querySelectorAll(".marginLeftIgnore li");if(0<o.length)for(var r,n=0;n<o.length;n++)j.isNullOrUndefined(o[n].style.marginLeft)||""===o[n].style.marginLeft||(r=o[n].style.marginLeft,r=parseFloat(r.split("in")[0])-.5,o[n].style.marginLeft=r.toString()+"in")},w.prototype.removeEmptyAnchorTag=function(e){for(var t=e.querySelectorAll("a:not([href])"),n=t.length-1;0<=n;n--){for(var i=t[n].parentNode;t[n].firstChild;)i.insertBefore(t[n].firstChild,t[n]);i.removeChild(t[n])}},w.prototype.findSource=function(e){for(var t=e.querySelectorAll("meta"),n=0;n<t.length;n++){var i=t[n],o=i.getAttribute("content"),i=i.getAttribute("name");if(i&&0<=i.toLowerCase().indexOf("generator")&&o&&0<=o.toLowerCase().indexOf("microsoft"))for(var r=0;r<fs.length;r++)if(0<=o.toLowerCase().indexOf(fs[r]))return fs[r]}return"html"},w.prototype.destroy=function(){this.removeEventListener()};var Bd=w;function w(e){this.olData=["decimal","decimal-leading-zero","lower-alpha","lower-roman","upper-alpha","upper-roman","lower-greek"],this.ulData=["disc","square","circle","disc","square","circle"],this.ignorableNodes=["A","APPLET","B","BLOCKQUOTE","BR","BUTTON","CENTER","CODE","COL","COLGROUP","DD","DEL","DFN","DIR","DIV","DL","DT","EM","FIELDSET","FONT","FORM","FRAME","FRAMESET","H1","H2","H3","H4","H5","H6","HR","I","IMG","IFRAME","INPUT","INS","LABEL","LI","OL","OPTION","P","PARAM","PRE","Q","S","SELECT","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","TEXTAREA","TFOOT","TH","THEAD","TITLE","TR","TT","U","UL"],this.blockNode=["div","p","h1","h2","h3","h4","h5","h6","address","blockquote","button","center","dd","dir","dl","dt","fieldset","frameset","hr","iframe","isindex","li","map","menu","noframes","noscript","object","ol","pre","table","tbody","td","tfoot","th","thead","tr","ul","header","article","nav","footer","section","aside","main","figure","figcaption"],this.borderStyle=["border-top","border-right","border-bottom","border-left"],this.upperRomanNumber=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"],this.lowerRomanNumber=["i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"],this.lowerGreekNumber=["","","","","","","","","","","","","","","","","","","","","","","",""],this.removableElements=["o:p","style","w:sdt"],this.listContents=[],this.cropImageDimensions=[],this.parent=e,this.addEventListener()}Ad.prototype.addEventListener=function(){this.parent.observer.on(us,this.insertText,this),this.parent.observer.on(f,this.destroy,this)},Ad.prototype.removeEventListener=function(){this.parent.observer.off(us,this.insertText),this.parent.observer.off(f,this.destroy)},Ad.prototype.insertText=function(e){var t=document.createTextNode(e.value);Ul.Insert(this.parent.currentDocument,t,this.parent.editableElement),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},Ad.prototype.destroy=function(){this.removeEventListener()};var Rd=Ad;function Ad(e){this.parent=e,this.addEventListener()}Ud.prototype.addEventListener=function(){this.parent.observer.on(oa,this.emojiInsert,this),this.parent.observer.on(f,this.destroy,this)},Ud.prototype.removeEventListener=function(){this.parent.observer.off(oa,this.emojiInsert),this.parent.observer.off(f,this.destroy)},Ud.prototype.emojiInsert=function(e){for(var t=document.createTextNode(e.value),n=this.parent.currentDocument.getSelection(),i=n.getRangeAt(0).startOffset,o=i-1;i-15<=o;o--){var r=n.focusNode.textContent.substring(o-1,o);if(/:$/.test(r)){this.beforeApplyFormat(!0);break}}var s=/:$/.test(n.focusNode.textContent.charAt(i-1)),a=n.focusNode.textContent.charAt(i-2),a=/\s/.test(a);s&&(a||1===n.focusOffset)&&this.beforeApplyFormat(!0),Ul.Insert(this.parent.currentDocument,t,this.parent.editableElement),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},Ud.prototype.beforeApplyFormat=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection.getNodeCollection(t)[0],i=!(":"===n.parentElement.innerHTML.replace(/&nbsp;|<br>/g,"").trim()||0===n.textContent.trim().indexOf("/")),o=n;if(i&&e)for(;o!==this.parent.editableElement;)o=o.parentElement;for(var r=t.startOffset;-1===this.parent.nodeSelection.getRange(document).toString().indexOf(":");)this.parent.nodeSelection.setSelectionText(document,n,n,r,t.endOffset),r--;i=this.parent.nodeSelection.getRange(this.parent.currentDocument),e=this.parent.nodeCutter.GetSpliceNode(i,n);e.parentNode.removeChild(e)},Ud.prototype.destroy=function(){this.removeEventListener()};var Id=Ud;function Ud(e){this.parent=e,this.addEventListener()}k.prototype.addEventListener=function(){this.parent.observer.on(na,this.actionHandler,this),this.parent.observer.on(Ys,this.onPropertyChanged,this),this.parent.observer.on(f,this.destroy,this)},k.prototype.onPropertyChanged=function(e){e&&"formatPainter"===e.module&&(j.isNullOrUndefined(e.newProp.formatPainterSettings.allowedFormats)||(this.settings.allowedFormats=e.newProp.formatPainterSettings.allowedFormats),j.isNullOrUndefined(e.newProp.formatPainterSettings.deniedFormats)||(this.settings.deniedFormats=e.newProp.formatPainterSettings.deniedFormats,this.setDeniedFormats()))},k.prototype.removeEventListener=function(){this.parent.observer.off(na,this.actionHandler),this.parent.observer.off(Ys,this.onPropertyChanged),this.parent.observer.off(f,this.destroy)},k.prototype.destroy=function(){this.removeEventListener(),this.INVALID_TAGS=null,this.copyCollection=null,this.deniedFormatsCollection=null,this.newElem=null,this.newElemLastChild=null,this.settings=null,this.parent=null},k.prototype.actionHandler=function(e){if(this.settings.allowedContext=["Text","List","Table"],!j.isNullOrUndefined(e)&&!j.isNullOrUndefined(e.item)&&!j.isNullOrUndefined(e.item.formatPainterAction)){switch(e.item.formatPainterAction){case"format-copy":this.copyAction();break;case"format-paste":this.pasteAction();break;case"escape":this.escapeAction()}this.callBack(e)}},k.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:"FormatPainter",action:e.item.formatPainterAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},k.prototype.generateElement=function(){for(var e,t=this.copyCollection.slice(),n=(t.reverse(),t.length),i=j.createElement("div",{className:"e-format-paste-wrapper"}),o=0;o<n;o++){var r=t[o],s=r.attrs,a=r.className,l=r.styles,r=r.tagName,d=j.createElement(r);""!==a&&(d.className=a);for(var c=0;c<s.length;c++){var h=s[c].name,p=s[c].value;d.setAttribute(h,p)}for(var u=0;u<l.length;u++){var h=l[u].property,p=l[u].value,m=l[u].priority;d.style.setProperty(h,p,m)}e=((0===i.childElementCount?i:e).append(d),d)}for(var g=this.removeDeniedFormats(i),f=g;f;)f=null===f.firstChild?void(e=f):f.firstChild;this.newElem=g,this.newElemLastChild=e},k.prototype.pasteAction=function(){j.isNullOrUndefined(this.copyCollection)||0===this.copyCollection.length?this.paintPlainTextFormat():this.insertFormatNode(this.newElem,this.newElemLastChild)},k.prototype.removeDeniedFormats=function(e){if(!j.isNullOrUndefined(this.deniedFormatsCollection)&&0<this.deniedFormatsCollection.length)for(var t=this.deniedFormatsCollection,n=t.length,i=0;i<n;i++){var o=t[i].tag;if(t[i].tag)for(var r=e.querySelectorAll(o),s=0;s<r.length;s++){if(0<t[i].classes.length){for(var a=t[i].classes,l=a.length,d=0;d<l;d++)r[s].classList.contains(a[d])&&j.removeClass([r[s]],a[d].trim());0===r[s].classList.length&&r[s].removeAttribute("class")}if(0<t[i].styles.length){for(var c=t[i].styles,h=c.length,d=0;d<h;d++)r[s].style.removeProperty(c[d].trim());0===r[s].style.length&&r[s].removeAttribute("style")}if(0<t[i].attributes.length)for(var p=t[i].attributes,u=p.length,d=0;d<u;d++)r[s].removeAttribute(p[d].trim())}}return e.firstElementChild},k.prototype.copyAction=function(){var e=[],t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(0!==i.length||0!==n.getSelectionNodeCollectionBr(t).length){for(var o=(i=0===i.length?n.getSelectionNodeCollectionBr(t):i)[0].parentElement,n=this.findCurrentContext(o),r=-1<this.settings.allowedFormats.indexOf(";")?this.settings.allowedFormats.split(";"):[this.settings.allowedFormats],s=0;s<r.length;s++)r[s]=r[s].trim();var i=this.getRangeParentElem(n,o),a=i[0],i=i[1];if(!j.isNullOrUndefined(n=null===n?i:n)&&-1<this.settings.allowedContext.indexOf(n)){var l=o="#text"===t.startContainer.nodeName?t.startContainer.parentElement:o;do{if(-1<r.indexOf(o.nodeName.toLowerCase())){for(var d=o.attributes,c=[],s=0;s<d.length;s++)"class"!==d[s].name&&"style"!==d[s].name&&c.push(d[s]);for(var h=o.className,p=o.style,u=[],s=0;s<p.length;s++){var m=p[s],g=p.getPropertyValue(m),f=p.getPropertyPriority(m);u.push({property:m,value:g,priority:f})}e.push({attrs:c,className:h,styles:u,tagName:o.nodeName})}}while((a===o?o=void 0:j.isNullOrUndefined(o.parentElement)||(o=o.parentElement),l!==o)&&(!j.isNullOrUndefined(o)||o===this.parent.editableElement));this.copyCollection=e}this.generateElement()}},k.prototype.getRangeParentElem=function(e,t){var n,i=t;switch(3===i.nodeType&&(i=i.parentElement),e){case"Table":n=j.closest(i,"td"),j.isNullOrUndefined(n)&&(n=j.closest(i,"th"));break;case"List":n=j.closest(i,"li");break;case"Text":n=j.closest(i,"p")}return j.isNullOrUndefined(n)&&(t=this.getNearestBlockParentElement(t),j.isNullOrUndefined(t)||"UL"===t||"OL"===t||"LI"===t||(n=j.closest(i,t),e="Text")),[n="List"===e?n.parentElement:n,e]},k.prototype.getNearestBlockParentElement=function(e){var t=e;for(3===t.nodeType&&(t=t.parentNode);t&&t!==this.parent.editableElement;){if(!j.isNullOrUndefined(t)&&this.isBlockElement(t))return t.nodeName;t=t.parentNode}return null},k.prototype.isBlockElement=function(e){return-1<["P","DIV","UL","OL","LI","H1","H2","H3","H4","H5","H6","ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","FIGCAPTION","FIGURE","FOOTER","HEADER","HR","MAIN","NAV","SECTION","SUMMARY","PRE"].indexOf(e.nodeName)},k.prototype.escapeAction=function(){this.copyCollection=[]},k.prototype.paintPlainTextFormat=function(){var e,t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(1<i.length)for(var o=0;o<i.length;o++)e=this.validateELementTag(i[o]);else e=this.validateELementTag(t.startContainer)&&this.validateELementTag(t.endContainer);e||this.parent.execCommand("Clear","ClearFormat",null,null)},k.prototype.validateELementTag=function(e){return 3===e.nodeType&&(e=e.parentElement),-1<this.INVALID_TAGS.indexOf(e.tagName)},k.prototype.findCurrentContext=function(e){var t=j.closest(e,"p"),n=j.closest(e,"li");return t&&!n?"Text":j.closest(e,"li")?j.isNullOrUndefined(t)||j.isNullOrUndefined(n)||t.textContent.trim()===n.textContent.trim()?"List":"Text":j.closest(e,"td")||j.closest(e,"tr")||j.closest(e,"th")?"Table":null},k.prototype.insertFormatNode=function(e,t){for(var n,i=e.cloneNode(!0),e=(this.isBlockElement(e)||((o=j.createElement("P")).appendChild(e),i=o.cloneNode(!0)),this.parent.editableElement),o=this.parent.currentDocument,r=i.firstChild;r;){if(!this.isBlockElement(r)){n=r.parentNode.removeChild(r);break}r=r.firstChild}Cd.applyFormat(o,null,e,"P",null,"formatPainter",null,{element:n,lastChild:t});var e=this.parent.nodeSelection.getRange(o),t=e.collapsed,s=this.parent.domNode.blockNodes();if(this.isListCopied())for(var a=0;a<s.length;a++)j.closest(s[a],"li")&&(s[a]=j.closest(s[a],"li"));var l=!1;1===s.length&&(l=s[0].textContent.trim()===e.toString().trim()),(this.isBlockElement(i)&&t||1<s.length||l)&&this.insertBlockNode(i,e,o,s)},k.prototype.isListCopied=function(){for(var e=!1,t=0;t<this.copyCollection.length;t++)if("OL"===this.copyCollection[t].tagName||"UL"===this.copyCollection[t].tagName){e=!0;break}return e},k.prototype.insertBlockNode=function(e,t,n,i){for(var o,r,n=this.parent.nodeSelection.save(t,n),s=(this.parent.domNode.setMarker(n),!1),a=("UL"!==e.nodeName&&"OL"!==e.nodeName||(o=(r=e.cloneNode(!0)).firstChild),j.isNullOrUndefined(r)?e:e.firstChild),l=0;l<i.length;l++)if(!(-1<this.INVALID_TAGS.indexOf(i[l].nodeName)||0<i[l].querySelectorAll("img,audio,video,iframe").length)){for(var d=a.cloneNode(!1);i[l].firstChild;)0!==i[l].textContent.trim().length?d.appendChild(i[l].firstChild):i[l].removeChild(i[l].firstChild);if("TD"===i[l].nodeName||"TH"===i[l].nodeName)(j.isNullOrUndefined(r)||0!==l||j.isNullOrUndefined(r)?i[l]:(i[l].appendChild(r),r)).appendChild(d);else if(j.isNullOrUndefined(r)||(s=this.isSameListType(e,i[l])),"LI"!==d.nodeName||s?s?this.insertSameList(i,l,r,d):i[l].parentNode.replaceChild(d,i[l]):this.insertNewList(t,i,l,r,d),"LI"!==d.nodeName&&("OL"===d.parentElement.nodeName||"UL"===d.parentElement.nodeName)){var c=d.parentElement;if(this.parent.nodeCutter.SplitNode(t,c,!0),j.isNullOrUndefined(c.previousElementSibling))c.parentElement.prepend(d);else if(c.previousElementSibling.after(d),1<d.childNodes.length)for(var h=0;h<d.childNodes.length;h++){var p=d.childNodes[h];"OL"!==p.nodeName&&"UL"!==p.nodeName||d.after(p)}}}j.isNullOrUndefined(o)||j.detach(o),this.cleanEmptyLists(),this.parent.domNode.saveMarker(n).restore()},k.prototype.insertNewList=function(e,t,n,i,o){if(0===n){var r,s=t[n].nodeName,s=(t[n]=t[n].parentNode.replaceChild(i,t[n]),"LI"===s?i.parentElement:i);if(this.parent.nodeCutter.SplitNode(e,s,!0),"LI"!==t[n].nodeName||j.isNullOrUndefined(s))if(j.isNullOrUndefined(s))i.append(o);else if(j.isNullOrUndefined(s.previousElementSibling)||s.previousElementSibling.nodeName!==i.nodeName)if(j.isNullOrUndefined(s.nextElementSibling)||s.nextElementSibling.nodeName!==i.nodeName)i.append(o);else for((r=s.nextElementSibling).prepend(o);r.firstChild;)i.append(r.firstChild);else for((r=s.previousElementSibling).append(o);r.firstChild;)i.append(r.firstChild);else i.append(o),j.isNullOrUndefined(s.parentNode)||s.parentNode.insertBefore(i,s)}else i.append(o);this.detachEmptyBlockNodes(t[n])},k.prototype.insertSameList=function(e,t,n,i){if(0===t){if(!j.isNullOrUndefined(e[t].parentNode)&&("UL"===e[t].parentNode.nodeName||"OL"===e[t].parentNode.nodeName)){if(1===e.length){for(;i.firstChild;)e[t].append(i.firstChild);for(var o=0;o<e[t].parentNode.childNodes.length;o++){var r=e[t].parentNode.childNodes[o];n.append(r.cloneNode(!0))}}else n.append(i);e[t].parentNode.parentNode.replaceChild(n,e[t].parentNode)}}else n.append(i);this.detachEmptyBlockNodes(e[t])},k.prototype.isSameListType=function(e,t){var n=!1,t=j.closest(t,"ol, ul");return n=!j.isNullOrUndefined(t)&&0<t.querySelectorAll("li").length?t.nodeName===e.nodeName:n},k.prototype.cleanEmptyLists=function(){for(var e=this.parent.editableElement.querySelectorAll("ol, ul"),t=0;t<e.length;t++)""===e[t].textContent.trim()&&j.detach(e[t])},k.prototype.setDeniedFormats=function(){var e=[];if(!j.isNullOrUndefined(this.settings)&&!j.isNullOrUndefined(this.settings.deniedFormats)){for(var t=-1<this.settings.deniedFormats.indexOf(";")?this.settings.deniedFormats.split(";"):[this.settings.deniedFormats],n=t.length,i=0;i<n;i++){var o=t[i];""!==o&&(o.trim(),o=this.makeDeniedFormatsCollection(o),j.isNullOrUndefined(o)||e.push(o))}this.deniedFormatsCollection=e}},k.prototype.detachEmptyBlockNodes=function(e){j.isNullOrUndefined(e)||""!==e.textContent.trim()||j.detach(e)},k.prototype.makeDeniedFormatsCollection=function(e){var t,n=e.indexOf("("),i=e.indexOf(")"),o=e.indexOf("["),r=e.indexOf("]"),s=e.indexOf("{"),a=e.indexOf("}"),l=[],d=[],c=[],i=(-1<n&&-1<i&&(l=e.substring(n+1,i).split(" ")[0].split(")")[0].split(",")),-1<o&&-1<r&&(d=e.substring(o+1,r).split(",")),-1<s&&-1<a&&(c=e.substring(s+1,a).split(",")),[n,o,s]),r=(i=i.filter(function(e){return-1<e})).length;return 1===r?t=i[0]:2===r?t=Math.min(i[0],i[1]):3===r&&(t=Math.min(i[0],i[1],i[2])),{tag:e.substring(0,t).trim(),styles:c,classes:l,attributes:d}};var Pd=k;function k(e,t){this.INVALID_TAGS=["A","AUDIO","IMG","VIDEO","IFRAME"],this.parent=e,this.settings=t,this.addEventListener(),this.setDeniedFormats()}jd.prototype.wireEvents=function(){this.observer.on(Vs,this.editorKeyDown,this),this.observer.on(Xs,this.editorKeyUp,this),this.observer.on(Xs,this.editorKeyUp,this),this.observer.on(Js,this.onPropertyChanged,this),this.observer.on(Zs,this.onWordPaste,this),this.observer.on(ea,this.onBegin,this),this.observer.on(ra,this.editorMouseDown,this),this.observer.on(sa,this.destroy,this)},jd.prototype.unwireEvents=function(){this.observer.off(Vs,this.editorKeyDown),this.observer.off(Xs,this.editorKeyUp),this.observer.off(Xs,this.editorKeyUp),this.observer.off(Js,this.onPropertyChanged),this.observer.off(Zs,this.onWordPaste),this.observer.off(ea,this.onBegin),this.observer.off(ra,this.editorMouseDown),this.observer.off(sa,this.destroy)},jd.prototype.onWordPaste=function(e){this.observer.notify($s,e)},jd.prototype.onPropertyChanged=function(e){this.observer.notify(Ys,e)},jd.prototype.editorKeyDown=function(e){this.observer.notify(m,e)},jd.prototype.editorKeyUp=function(e){this.observer.notify(Gs,e)},jd.prototype.onBegin=function(e){this.observer.notify(ta,e)},jd.prototype.execCommand=function(e,t,n,i,o,r,s,a){switch(e.toLowerCase()){case"lists":this.observer.notify(Ks,{subCommand:t,event:n,callBack:i,selector:s,item:r,enterAction:a});break;case"formats":this.observer.notify(Ws,{subCommand:t,event:n,callBack:i,selector:s,exeValue:r,enterAction:a});break;case"alignments":this.observer.notify(rs,{subCommand:t,event:n,callBack:i,selector:s,value:r,enterAction:a});break;case"indents":this.observer.notify(ss,{subCommand:t,event:n,callBack:i,selector:s,enterAction:a});break;case"links":this.observer.notify(Kr,{command:e,value:t,item:r,event:n,callBack:i});break;case"files":this.observer.notify(_r,{command:e,value:"Image",item:r,event:n,callBack:i,selector:s});break;case"images":this.observer.notify(_r,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"audios":this.observer.notify(Vr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"videos":this.observer.notify(Qr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"table":switch(t.toString().toLocaleLowerCase()){case"createtable":this.observer.notify(Wr,{item:r,event:n,callBack:i,enterAction:a});break;case"insertrowbefore":case"insertrowafter":this.observer.notify(Gr,{item:r,event:n,callBack:i});break;case"insertcolumnleft":case"insertcolumnright":this.observer.notify(Xr,{item:r,event:n,callBack:i});break;case"deleterow":this.observer.notify(Yr,{item:r,event:n,callBack:i});break;case"deletecolumn":this.observer.notify(Jr,{item:r,event:n,callBack:i});break;case"tableremove":this.observer.notify($r,{item:r,event:n,callBack:i});break;case"tableheader":this.observer.notify(Zr,{item:r,event:n,callBack:i});break;case"aligntop":case"alignmiddle":case"alignbottom":this.observer.notify(es,{item:r,event:n,callBack:i});break;case"merge":this.observer.notify(ts,{item:r,event:n,callBack:i});break;case"horizontalsplit":this.observer.notify(is,{item:r,event:n,callBack:i});break;case"verticalsplit":this.observer.notify(ns,{item:r,event:n,callBack:i})}break;case"font":case"style":case"effects":case"casing":this.observer.notify(hs,{subCommand:t,event:n,callBack:i,value:o,selector:s,enterAction:a});break;case"inserthtml":this.observer.notify(ps,{subCommand:t,callBack:i,value:o,enterAction:a});break;case"inserttext":this.observer.notify(us,{subCommand:t,callBack:i,value:o});break;case"clear":this.observer.notify(ms,{subCommand:t,event:n,callBack:i,selector:s,enterAction:a});break;case"actions":this.observer.notify(Qs,{subCommand:t,event:n,callBack:i,selector:s});break;case"formatpainter":this.observer.notify(na,{item:r,subCommand:t,event:n,callBack:i});break;case"emojipicker":this.observer.notify(oa,{item:r,subCommand:t,value:o,event:n,callBack:i})}},jd.prototype.editorMouseDown=function(e){3===e.args.detail&&this.tripleClickSelection(e.args)},jd.prototype.tripleClickSelection=function(e){var t,n=this.nodeSelection.getRange(this.currentDocument),i=this.nodeSelection.get(this.currentDocument);0<i.rangeCount&&""!==i.toString()&&(i=this.getParentBlockNode(n.startContainer),n=this.getParentBlockNode(n.endContainer),i)&&n&&i===n&&(t=this.currentDocument.createRange(),i=this.getFirstTextNode(i),n=this.getLastTextNode(n),i)&&n&&(t.setStart(i,0),t.setEnd(n,n.textContent.length),this.nodeSelection.setRange(this.currentDocument,t),e.preventDefault())},jd.prototype.getParentBlockNode=function(e){var t=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return window.getComputedStyle(e).display.indexOf("inline")<0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t.currentNode=e,t.parentNode()},jd.prototype.getLastTextNode=function(e){for(var t=this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),n=null,i=t.nextNode();i;)n=i,i=t.nextNode();return n},jd.prototype.getFirstTextNode=function(e){return this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null).nextNode()},jd.prototype.destroy=function(){this.isDestroyed||(this.unwireEvents(),this.observer.notify(f),this.editableElement&&(this.editableElement=null),this.currentDocument=null,this.nodeCutter&&(this.nodeCutter=null),this.domNode&&(this.domNode=null),this.listObj&&(this.listObj=null),this.formatObj&&(this.formatObj=null),this.alignmentObj&&(this.alignmentObj=null),this.indentsObj&&(this.indentsObj=null),this.linkObj&&(this.linkObj=null),this.imgObj&&(this.imgObj=null),this.audioObj&&(this.audioObj=null),this.videoObj&&(this.videoObj=null),this.selectionObj&&(this.selectionObj=null),this.inserthtmlObj&&(this.inserthtmlObj=null),this.insertTextObj&&(this.insertTextObj=null),this.clearObj&&(this.clearObj=null),this.tableObj&&(this.tableObj=null),this.msWordPaste&&(this.msWordPaste=null),this.formatPainterEditor&&(this.formatPainterEditor=null),this.emojiPickerObj&&(this.emojiPickerObj=null),this.tableCellSelection&&(this.tableCellSelection=null),this.isDestroyed=!0)},jd.prototype.beforeSlashMenuApplyFormat=function(){for(var e=this.nodeSelection.getRange(this.currentDocument),t=this.nodeSelection.getNodeCollection(e)[0],n=e.startOffset;-1===this.nodeSelection.getRange(document).toString().indexOf("/");)this.nodeSelection.setSelectionText(document,t,t,n,e.endOffset),n--;var i=this.nodeSelection.getRange(this.currentDocument),i=this.nodeCutter.GetSpliceNode(i,t),o=i.previousSibling;i.parentElement&&1===i.parentElement.innerHTML.length&&i.parentElement.appendChild(document.createElement("br")),i.parentNode.removeChild(i),o&&this.nodeSelection.setCursorPoint(document,o,o.textContent.length)};var Hd=jd;function jd(e){this.currentDocument=e.document,this.editableElement=e.editableElement,this.nodeSelection=new bs,this.nodeCutter=new Bl,this.domNode=new xl(this.editableElement,this.currentDocument),this.observer=new j.Observer(this),this.listObj=new Dl(this),this.formatObj=new Al(this),this.alignmentObj=new Fl(this),this.indentsObj=new zl(this),this.linkObj=new Hl(this),this.imgObj=new pd(this),this.audioObj=new md(this),this.videoObj=new fd(this),this.selectionObj=new Ed(this),this.inserthtmlObj=new Td(this),this.insertTextObj=new Rd(this),this.clearObj=new kd(this),this.tableObj=new yd(this),this.undoRedoManager=new Dd(this,e.options),this.msWordPaste=new Bd(this),this.formatPainterEditor=new Pd(this,e.formatPainterSettings),this.emojiPickerObj=new Id(this),this.tableCellSelection=new wl(this.editableElement,this.currentDocument),this.wireEvents(),this.isDestroyed=!1}Fd=function(e,t){return(Fd=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};(function(e,t){function n(){this.constructor=e}Fd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(_d,qd=Ya),_d.prototype.initialize=function(){this.keyConfig=Bs},_d.prototype.updateFormatter=function(e,t,n,i){e&&t&&(this.editorManager=new Hd({document:t,editableElement:e,options:n,formatPainterSettings:i}))};var Fd,qd,zd=_d;function _d(e){var t=qd.call(this)||this;return t.initialize(),j.extend(t,t,e,!0),t.currentDocument&&t.element&&t.updateFormatter(t.element,t.currentDocument,e.options,e.formatPainterSettings),t}Qd.prototype.addEventListener=function(){this.parent.on(X,this.onRefreshHandler,this),this.parent.on(o,this.removeEventListener,this)},Qd.prototype.removeEventListener=function(){this.toolbarStatus=null,this.prevToolbarStatus=null,this.parent.off(X,this.onRefreshHandler),this.parent.off(o,this.removeEventListener)},Qd.prototype.onRefreshHandler=function(e){var t,n,i;this.parent.readonly||(t=[],n=[],i=[],this.parent.fontSize.items.forEach(function(e){t.push(e.value)}),this.parent.fontFamily.items.forEach(function(e){n.push(e.value)}),this.parent.format.types.forEach(function(e){i.push(e.value.toLocaleLowerCase())}),this.toolbarStatus=Os.get(this.parent.contentModule.getDocument(),this.parent.contentModule.getEditPanel(),i,t,n,e.documentNode),e=JSON.stringify(this.toolbarStatus),this.parent.notify(J,this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==e&&(this.parent.notify(Vt,{html:JSON.parse(e),markdown:null}),this.prevToolbarStatus=JSON.parse(e)))};var Vd=Qd;function Qd(e){this.parent=e,this.toolbarStatus=this.prevToolbarStatus=Ns(),this.addEventListener()}Kd.prototype.addEventListener=function(){this.parent.on(It,this.enableXhtmlValidation,this),this.parent.on(o,this.removeEventListener,this)},Kd.prototype.removeEventListener=function(){this.parent.off(It,this.enableXhtmlValidation),this.parent.off(o,this.removeEventListener)},Kd.prototype.enableXhtmlValidation=function(){this.parent.enableXhtml&&(j.isNullOrUndefined(this.parent.inputElement)?this.currentElement=this.parent.element:this.currentElement=this.parent.inputElement,this.clean(this.currentElement),this.ImageTags(),this.removeTags(),this.RemoveUnsupported(),this.currentElement.innerHTML=this.selfEncloseValidation(this.currentElement.innerHTML,("\n"===this.currentElement.innerText?this.currentElement.innerText:this.currentElement.innerText.trim()).length),this.parent.setProperties({value:this.currentElement.innerHTML},!0))},Kd.prototype.selfEncloseValidation=function(e,t){0===t&&e.indexOf("table")<0&&e.indexOf("img")<0&&e.includes("&nbsp;")&&((t=e.split("&nbsp;"))[t.length-1]="&#8203;"+t[t.length-1],e=t.join("")),e=e.replace(/<br>/g,"<br/>").replace(/<hr>/g,"<hr/>").replace(/ /g," ");for(var n,i=[],o=[/<img(.*?)>/gi,/<area(.*?)>/gi,/<base(.*?)>/gi,/<col (.*?)>/gi,/<embed(.*?)>/gi,/<input(.*?)>/gi,/<link(.*?)>/gi,/<meta(.*?)>/gi,/<param(.*?)>/gi,/<source(.*?)>/gi,/<track(.*?)>/gi,/<wbr(.*?)>/gi],r=0;r<o.length;r++){for(n=o[r].exec(e);null!==n;)i.push(n[0].toString()),n=o[r].exec(e);for(var s=i.slice(0),a=0;a<i.length;a++)-1!==i[a].indexOf("/")&&i[a].lastIndexOf("/")===i[a].length-2||(i[a]=i[a].substr(0,i[a].length-1)+" /"+i[a].substr(i[a].length-1,i[a].length));for(var l=0;l<=i.length-1;l++)e=e.replace(s[l],i[l])}return e},Kd.prototype.clean=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];8===n.nodeType||"V:IMAGE"===n.nodeName?(e.removeChild(n),t--):1===n.nodeType&&this.clean(n)}return this.currentElement.innerHTML},Kd.prototype.ImageTags=function(){for(var e=this.currentElement.querySelectorAll("IMG"),t=e.length-1;0<=t;t--)e[t].hasAttribute("alt")||e[t].setAttribute("alt","")},Kd.prototype.removeTags=function(){for(var e=[["br","ul"],["br","ol"],["table","span"],["div","span"],["p","span"]],t=0;t<e.length;t++)this.RemoveElementNode(e[t][0],e[t][1])},Kd.prototype.RemoveElementNode=function(e,t){for(var n=this.currentElement.querySelectorAll(t),i=0;i<n.length;i++)for(var o=n[i].querySelectorAll(e),r=o.length;0<r;r--)j.detach(o[r-1])},Kd.prototype.RemoveUnsupported=function(){for(var e=this.currentElement.querySelectorAll("u"),t=e.length-1;0<=t;t--){var n=this.parent.createElement("span");n.style.textDecoration="underline",n.innerHTML=e[t].innerHTML,e[t].parentNode.insertBefore(n,e[t]),j.detach(e[t])}for(var i=this.currentElement.querySelectorAll("strong"),t=i.length-1;0<=t;t--){var o=this.parent.createElement("b");o.innerHTML=i[t].innerHTML,i[t].parentNode.insertBefore(o,i[t]),j.detach(i[t])}for(var r=["language","role","target","contenteditable","cellspacing","cellpadding","border","valign","colspan"],t=0;t<=r.length;t++)this.RemoveAttributeByName(r[t])},Kd.prototype.RemoveAttributeByName=function(e){if(null!==this.currentElement.firstChild&&3!==this.currentElement.firstChild.nodeType)for(var t=0;t<this.currentElement.childNodes.length;t++){var n=this.currentElement.childNodes[t];if(3!==n.nodeType&&"TABLE"!==n.nodeName&&"TBODY"!==n.nodeName&&"THEAD"!==n.nodeName&&"TH"!==n.nodeName&&"TR"!==n.nodeName&&"TD"!==n.nodeName&&(n.hasAttribute(e)&&n.removeAttribute(e),n.hasChildNodes()))for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(3!==o.nodeType&&"TABLE"!==o.nodeName&&"TBODY"!==o.nodeName&&"THEAD"!==o.nodeName&&"TH"!==o.nodeName&&"TR"!==o.nodeName&&"TD"!==o.nodeName&&o.hasAttribute(e)&&!o.classList.contains("e-mention-chip")&&o.removeAttribute(e),o.hasChildNodes())for(var r=0;r<o.childNodes.length;r++)3!==o.childNodes[r].nodeType&&"TABLE"!==o.childNodes[r].nodeName&&"TBODY"!==o.childNodes[r].nodeName&&"THEAD"!==o.childNodes[r].nodeName&&"TH"!==o.childNodes[r].nodeName&&"TR"!==o.childNodes[r].nodeName&&"TD"!==o.childNodes[r].nodeName&&o.childNodes[r].hasAttribute(e)&&o.childNodes[r].removeAttribute(e)}}};var Wd=Kd;function Kd(e){this.parent=e,this.addEventListener()}x.prototype.destroy=function(){this.isDestroyed||(this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null),this.removeEventListener(),this.locator=null,this.contentRenderer=null,this.renderFactory=null,this.toolbarUpdate=null,this.nodeSelectionObj=null,this.isCopyAll=null,0<this.rangeCollection.length&&(this.rangeCollection=[]),this.rangeElement&&(this.rangeElement=null),this.oldRangeElement&&(this.oldRangeElement=null),this.deleteRangeElement&&(this.deleteRangeElement=null),this.deleteOldRangeElement&&(this.deleteOldRangeElement=null),this.saveSelection&&(this.saveSelection=null),this.xhtmlValidation&&(this.xhtmlValidation=null),this.isDestroyed=!0)},x.prototype.sanitizeHelper=function(e){return e=Ar(e,this.parent)},x.prototype.addEventListener=function(){this.parent.isDestroyed||(this.nodeSelectionObj=new bs,this.parent.on(Q,this.instantiateRenderer,this),this.parent.on(Z,this.onToolbarClick,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(ne,this.onKeyUp,this),this.parent.on(n,this.render,this),this.parent.on(l,this.onPropertyChanged,this),this.parent.on(o,this.destroy,this),this.parent.on(tt,this.selectAll,this),this.parent.on(nt,this.selectRange,this),this.parent.on(it,this.getSelectedHtml,this),this.parent.on(Ve,this.onSelectionSave,this),this.parent.on(Qe,this.onSelectionRestore,this),this.parent.on(ht,this.updateReadOnly,this),this.parent.on(rt,this.onPaste,this),this.parent.on(_,this.isTableClassAdded,this),this.parent.on(vn,this.onHandleFontsizeChange,this))},x.prototype.updateReadOnly=function(){this.parent.readonly?(j.attributes(this.parent.contentModule.getEditPanel(),{contenteditable:"false"}),j.addClass([this.parent.element],qi)):(j.attributes(this.parent.contentModule.getEditPanel(),{contenteditable:"true"}),j.removeClass([this.parent.element],qi))},x.prototype.onSelectionSave=function(){var e=this.contentRenderer.getDocument(),t=this.nodeSelectionObj.getRange(e);this.saveSelection=this.nodeSelectionObj.save(t,e)},x.prototype.onSelectionRestore=function(e){this.parent.isBlur=!1,(j.isNullOrUndefined(e.items)||e.items)&&this.saveSelection.restore()},x.prototype.isTableClassAdded=function(){for(var e=this.parent.inputElement.querySelectorAll("table"),t=0;t<e.length;t++)e[t].classList.contains("e-rte-table")||e[t].classList.contains("e-rte-paste-table")||e[t].classList.add("e-rte-table")},x.prototype.onHandleFontsizeChange=function(e){var t,n,i,o,r,s,e=e.args,a={name:"dropDownSelect",item:{command:"Font",subCommand:"FontSize"}},l=this.parent.fontSize.items,d=(n=this.parent.toolbarModule&&this.parent.toolbarModule.dropDownModule&&this.parent.toolbarModule.dropDownModule.fontSizeDropDown&&!j.isNullOrUndefined(this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent)&&""!==this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent?this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent:(r=void 0,r=(d=this.parent.contentModule.getDocument().getSelection())&&d.focusNode&&d.focusNode.parentElement?document.defaultView.getComputedStyle(d.focusNode.parentElement,null).getPropertyValue("font-size"):this.parent.fontSize.width,d=(r=j.isNullOrUndefined(r)?this.parent.fontSize.width:r).match(/^([\d.]+)(\D+)$/),t=parseInt(d[1],10),r=d[2],d=(d=l[1].value.match(/^([\d.]+)(\D+)$/))[2]===r?l.findIndex(function(e){e=e.value;return parseInt(e,10)>=t}):(i=this.convertFontSize(t,r,d[2]),l.findIndex(function(e){e=e.value;return parseInt(e,10)>=i})),l[d].text),l.findIndex(function(e){return e.text===("Font Size"===n?"Default":n)}));"increase-fontsize"===e.action&&-1!==d?d>=l.length-1?((s=l[d].value.match(/^([\d.]+)(\D+)$/))&&(o=parseInt(s[1],10),r=s[2],s=o%10==0?10*Math.ceil((o+1)/10):10*Math.ceil(o/10),a.item.value=s.toLocaleString()+r,a.item.text=s.toLocaleString()+" "+r),this.parent.fontSize.items.push(a.item)):(a.item.value=l[d+1].value,a.item.text=l[d+1].text):"decrease-fontsize"===e.action&&-1!==d&&0<d?(a.item.value=l[d-1].value,a.item.text=l[d-1].text):0<=d&&d<l.length&&l[d]&&(a.item.value=l[d].value,a.item.text=l[d].text),this.parent.formatter.process(this.parent,a,e)},x.prototype.convertFontSize=function(e,t,n){return-1===bn.indexOf(t)&&-1===bn.indexOf(n)||(t="px"),e*yn[t][n]},x.prototype.onKeyUp=function(e){var e=e.args,t=this.parent.getRange(),n=new RegExp("","g"),i=t.startContainer===t.endContainer&&t.startOffset===t.endOffset&&1===t.startOffset&&1===t.startContainer.textContent.length&&8203===t.startContainer.textContent.charCodeAt(0)&&0===t.startContainer.textContent.replace(n,"").length,o=!1;if(t.startContainer===t.endContainer&&t.startOffset===t.endOffset&&t.startContainer!==this.parent.inputElement&&0!==t.startOffset&&(r=3===t.startContainer.nodeType?t.startContainer:t.startContainer.childNodes[t.startOffset-1],o=16===e.keyCode&&8203===r.textContent.charCodeAt(0)&&!j.isNullOrUndefined(r.previousSibling)&&"false"===r.previousSibling.contentEditable),!this.isCopyAll){var r=!1;if([8,9,13,17,18,20,27,37,38,39,40,44,45,46,91,112,113,114,115,116,117,118,119,120,121,122,123].indexOf(e.keyCode)<0&&!e.shiftKey&&!e.ctrlKey&&!e.altKey&&!i&&!o){l=t.startOffset,"#text"===t.startContainer.nodeName?t.startContainer.parentElement!==this.parent.inputElement?t.startContainer.parentElement.classList.add("currentStartMark"):r=!0:t.startContainer.classList.add("currentStartMark"),8203===t.startContainer.textContent.charCodeAt(0)&&(e=t.startContainer.textContent.length,i=t.startOffset,t.startContainer.textContent=t.startContainer.textContent.replace(n,""),l=0===i?i:i-(e-t.startContainer.textContent.length),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),t.startContainer,l));var o=this.parent.inputElement.innerHTML.length,i=this.parent.inputElement.innerHTML.replace(n,"").length,s=t.startContainer;if(i<o&&!r){0!==s.textContent.trim().length&&s.previousSibling&&((e=document.createElement("span")).className="tempSpan",t.insertNode(e));for(var a=this.parent.inputElement.firstChild;!j.isNullOrUndefined(a);)a=("#text"===a.nodeName||0<a.textContent.replace(n,"").trim().length&&a.textContent.includes("")&&(a.innerHTML=a.innerHTML.replace(n,"")),a.nextElementSibling);var l,i=this.parent.inputElement.querySelector(".tempSpan"),d=(i&&i.previousSibling&&0!==s.textContent.trim().length&&(s=i.previousSibling,l=i.previousSibling.textContent.length,i.parentNode.removeChild(i),0),this.parent.inputElement.querySelector(".currentStartMark").childNodes);if(1<d.length)for(var c=0;c<d.length;c++)"#text"===d[c].nodeName&&0===d[c].textContent.length&&(j.detach(d[c]),c--),j.isNullOrUndefined(d[c])||s.textContent.replace(n,"")!==d[c].textContent||(l=1<s.textContent.length?s.textContent===d[c].textContent?l:l-(s.textContent.length-s.textContent.replace(n,"").length):s.textContent.length,s=d[c]);else 1===d.length&&s.textContent.replace(n,"")===d[0].textContent&&(s=d[0]);this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),s,l)}o=this.parent.inputElement.querySelector(".currentStartMark");j.isNullOrUndefined(o)||(o.classList.remove("currentStartMark"),""===o.getAttribute("class").trim()&&o.removeAttribute("class")),!j.isNullOrUndefined(t.startContainer.previousSibling)&&!j.isNullOrUndefined(t.startContainer.previousSibling.parentElement)&&t.startContainer.parentElement===t.startContainer.previousSibling.parentElement&&8203===t.startContainer.previousSibling.textContent.charCodeAt(0)&&t.startContainer.previousSibling.textContent.length<=1&&(t.startContainer.previousSibling.textContent=t.startContainer.previousSibling.textContent.replace(n,"")),8203===t.endContainer.textContent.charCodeAt(t.endOffset)&&(l=t.startOffset,t.endContainer.textContent=t.endContainer.textContent.replace(n,""),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),t.startContainer,l))}}},x.prototype.onKeyDown=function(t){var e,n,i,o,r=this,s=(t.args.ctrlKey&&65===t.args.keyCode?this.isCopyAll=!0:this.isCopyAll=!1,t.args);if(1<this.parent.inputElement.querySelectorAll(".e-cell-select").length&&(8===s.keyCode||32===s.keyCode||13===s.keyCode))this.tableSelectionKeyAction(t);else{if("chrome"===j.Browser.info.name&&(e=this.parent.getRange(),this.backSpaceCleanup(t,e),this.deleteCleanup(t,e)),9===s.keyCode&&this.parent.enableTabKey&&(this.parent.formatter.saveData(t),!j.isNullOrUndefined(s.target)&&j.isNullOrUndefined(j.closest(s.target,".e-rte-toolbar"))&&(a=this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()),"LI"===(l=this.nodeSelectionObj.getParentNodeCollection(a))[0].nodeName||j.closest(l[0],"li")||j.closest(l[0],"table")||(s.preventDefault(),l=this.contentRenderer.getDocument().getSelection().getRangeAt(0),n=this.parent.formatter.editorManager.domNode.blockNodes(),"BR"===this.parent.enterKey?l.startOffset!==l.endOffset&&0===l.startOffset?(a=this.nodeSelectionObj.save(a,this.contentRenderer.getDocument()),this.parent.formatter.editorManager.domNode.setMarker(a),n=this.parent.formatter.editorManager.domNode.blockNodes(),this.parent.formatter.editorManager.domNode.convertToBlockNodes(n,!1),this.marginTabAdd(s.shiftKey,n),(a=this.parent.formatter.editorManager.domNode.saveMarker(a)).restore()):(Ul.Insert(this.contentRenderer.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;"),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()))):s.shiftKey?0<this.rangeCollection.length&&4===this.rangeCollection[this.rangeCollection.length-1].startContainer.textContent.length?(a=this.rangeCollection[this.rangeCollection.length-1].startContainer,this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(),a,a,0,a.textContent.length),Ul.Insert(this.contentRenderer.getDocument(),document.createTextNode("")),this.rangeCollection.pop()):this.marginTabAdd(s.shiftKey,n):l.startOffset!==l.endOffset&&0===l.startOffset?this.marginTabAdd(s.shiftKey,n):(Ul.Insert(this.contentRenderer.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;"),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()))))),this.parent.formatter.saveData(t)),("space"===t.args.action||"enter"===t.args.action||13===t.args.keyCode)&&(this.spaceLink(t.args),"HTML"===this.parent.editorMode)&&!this.parent.readonly){var a=this.parent.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length,l=this.parent.getSelection().length;if(!(-1===this.parent.maxLength||a-l+1<=this.parent.maxLength||13!==t.args.keyCode))return void t.args.preventDefault();this.parent.notify(ut,{args:t.args}),Es(this.parent.contentModule.getDocument(),this.parent.inputElement)}"space"===t.args.action&&(a=(n=this.parent.getRange()).startContainer.textContent.slice(0,n.startOffset),i=this.isOrderedList(a),l=this.isUnOrderedList(a),!this.hasMultipleTextNode(n))&&(i&&!l||l&&!i)&&(a={cancel:!(o={callBack:null,event:t.args,name:"keydown-handler"}),item:{command:"Lists",subCommand:i?"OL":"UL"},name:"actionBegin",originalEvent:t.args,requestType:i?"OL":"UL"},this.parent.trigger(Oe,a,function(e){e.cancel||(r.parent.formatter.editorManager.observer.notify(ea,o),r.parent.trigger(Le,{editorMode:r.parent.editorMode,elements:r.parent.formatter.editorManager.domNode.blockNodes(),event:t.args,name:Le,range:r.parent.getRange(),requestType:i?"OL":"UL"}))})),"chrome"!==j.Browser.info.name||(j.isNullOrUndefined(this.rangeElement)||j.isNullOrUndefined(this.oldRangeElement))&&(j.isNullOrUndefined(this.deleteRangeElement)||j.isNullOrUndefined(this.deleteOldRangeElement))||"TD"===e.startContainer.parentElement.tagName||"TH"===e.startContainer.parentElement.tagName||(this.rangeElement=null,this.oldRangeElement=null,this.deleteRangeElement=null,this.deleteOldRangeElement=null,this.isImageDelete||s.preventDefault(),s.preventDefault())}this.parent.autoResize()},x.prototype.isOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!j.isNullOrUndefined(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},x.prototype.isUnOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[*]$/,/^[-]$/];if(!j.isNullOrUndefined(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},x.prototype.hasMultipleTextNode=function(e){if(e&&e.startContainer&&e.startContainer.parentNode){e=e.startContainer.parentNode;if("BR"===this.parent.enterKey||j.closest(e,"table"))return!1;for(var t=e.childNodes,n=[],i=0;i<t.length;i++){var o=t[i];if(o&&o.nodeType===Node.TEXT_NODE&&(n.push(o),1<n.length))return!0}}return!1},x.prototype.backSpaceCleanup=function(e,t){var n=!1,i=!0,o=(j.isNullOrUndefined(t.startContainer.previousSibling)||"SPAN"!==t.startContainer.previousSibling.nodeName||(i="false"!==t.startContainer.previousSibling.contentEditable),"#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer),r=!j.closest("#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,"li")||"li"!==o.nodeName&&j.isNullOrUndefined(o.previousSibling);if("Backspace"===e.args.code&&8===e.args.keyCode&&0===t.startOffset&&0===t.endOffset&&0===this.parent.getSelection().length&&0<t.startContainer.textContent.length&&"TD"!==t.startContainer.parentElement.tagName&&"TH"!==t.startContainer.parentElement.tagName&&i&&r&&(this.parent.formatter.editorManager.domNode.isBlockNode(o)||j.isNullOrUndefined(o.previousSibling)||"BR"!==o.previousSibling.nodeName)&&(j.isNullOrUndefined(t.startContainer.previousSibling)||"BR"!==t.startContainer.previousSibling.nodeName)){if(this.rangeElement=this.getRootBlockNode(t.startContainer),"OL"===this.rangeElement.tagName||"UL"===this.rangeElement.tagName){e=this.getRangeLiNode(t.startContainer);e.previousElementSibling&&0<e.previousElementSibling.childElementCount&&(this.oldRangeElement="BR"===e.previousElementSibling.lastElementChild.nodeName?e.previousElementSibling:e.previousElementSibling.lastChild,!j.isNullOrUndefined(e.lastElementChild)&&"BR"!==e.lastElementChild.nodeName&&j.isNullOrUndefined(e.lastElementChild.previousSibling)&&"#text"!==e.lastChild.nodeName?(this.rangeElement=e.lastElementChild,n=!0):this.rangeElement=e)}else{if(this.rangeElement===this.parent.inputElement||"TABLE"===this.rangeElement.tagName||!j.isNullOrUndefined(this.rangeElement.previousElementSibling)&&"TABLE"===this.rangeElement.previousElementSibling.tagName)return;this.oldRangeElement=this.rangeElement.previousElementSibling}i=this.parent.formatter.editorManager.domNode.blockNodes();if(!j.isNullOrUndefined(i[0])&&t.collapsed&&0===t.startOffset&&0===t.endOffset&&""!==i[0].style.marginLeft&&(i[0].style.marginLeft=parseInt(i[0].style.marginLeft,10)<=20?"":parseInt(i[0].style.marginLeft,10)-20+"px"),!j.isNullOrUndefined(this.oldRangeElement)){"OL"!==this.oldRangeElement.tagName&&"UL"!==this.oldRangeElement.tagName||(this.oldRangeElement=this.oldRangeElement.lastElementChild.lastElementChild||this.oldRangeElement.lastElementChild);for(var s=this.oldRangeElement.lastChild||this.oldRangeElement;3!==s.nodeType&&"#text"!==s.nodeName&&"BR"!==s.nodeName&&!j.isNullOrUndefined(s.lastChild);)s=s.lastChild;if("IMG"===s.nodeName?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),s.parentElement,s.parentElement.childNodes.length):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),s,s.textContent.length),"#text"!==this.oldRangeElement.nodeName&&1===this.oldRangeElement.querySelectorAll("BR").length&&j.detach(this.oldRangeElement.querySelector("BR")),!j.isNullOrUndefined(this.rangeElement)&&this.oldRangeElement!==this.rangeElement){for(;this.rangeElement.firstChild;)("#text"===this.oldRangeElement.nodeName?this.oldRangeElement.parentElement:this.oldRangeElement).appendChild(this.rangeElement.childNodes[0]);n?j.detach(this.rangeElement.parentElement):j.detach(this.rangeElement),this.oldRangeElement.normalize()}}}},x.prototype.deleteCleanup=function(e,t){var n,i,o=!1;if("Delete"===e.args.code&&46===e.args.keyCode&&0!==this.parent.contentModule.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length&&0===this.parent.getSelection().length&&"TD"!==t.startContainer.parentElement.tagName&&"TH"!==t.startContainer.parentElement.tagName){if(this.deleteRangeElement=i=this.getRootBlockNode(t.startContainer),"OL"===this.deleteRangeElement.tagName||"UL"===this.deleteRangeElement.tagName)(n=this.getRangeLiNode(t.startContainer)).nextElementSibling&&0<n.nextElementSibling.childElementCount&&!n.nextElementSibling.querySelector("BR")?j.isNullOrUndefined(n.lastElementChild)?this.deleteRangeElement=n:(this.deleteRangeElement=n.lastElementChild,o=!0):this.deleteRangeElement=this.getRangeElement(n);else if(3===this.deleteRangeElement.nodeType||"TABLE"===this.deleteRangeElement.tagName||!j.isNullOrUndefined(this.deleteRangeElement.nextElementSibling)&&"TABLE"===this.deleteRangeElement.nextElementSibling.tagName)return;var r=!1;if(0<this.deleteRangeElement.querySelectorAll("img").length&&""===this.deleteRangeElement.textContent.trim()&&(r=!0),this.getCaretIndex(t,this.deleteRangeElement)!==this.deleteRangeElement.textContent.length||r)this.deleteRangeElement=null;else if(j.isNullOrUndefined(n)?this.deleteOldRangeElement=this.deleteRangeElement.nextElementSibling:o||!j.isNullOrUndefined(n.nextElementSibling)?this.deleteOldRangeElement=this.getRangeElement(n.nextElementSibling):this.deleteOldRangeElement=i.nextElementSibling,!j.isNullOrUndefined(this.deleteOldRangeElement)){0===t.startOffset&&1===t.endOffset&&"IMG"===this.deleteRangeElement.childNodes[0].nodeName?(this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),this.deleteRangeElement,this.deleteRangeElement,0,1),this.isImageDelete=!0):(this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),this.deleteRangeElement,this.deleteRangeElement.childNodes.length),this.isImageDelete=!1);r=this.deleteRangeElement.querySelector("BR");if(r&&r.classList.contains("e-rte-image-remove-focus"))j.removeClass([r],["e-rte-image-focus"]);else if(r&&(j.detach(r),e.args.preventDefault()),j.isNullOrUndefined(this.deleteRangeElement)||"OL"===this.deleteOldRangeElement.tagName||"UL"===this.deleteOldRangeElement.tagName||this.deleteOldRangeElement===this.deleteRangeElement)this.deleteRangeElement=null,this.deleteOldRangeElement=null;else{for(;this.deleteOldRangeElement.firstChild;)this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);o?j.detach(this.deleteOldRangeElement.parentElement):j.detach(this.deleteOldRangeElement),this.deleteRangeElement.normalize()}}}},x.prototype.getCaretIndex=function(e,t){var n,i=0;return 0!==this.parent.contentModule.getDocument().getSelection().rangeCount&&((n=e.cloneRange()).selectNodeContents(t),n.setEnd(e.endContainer,e.endOffset),i=n.toString().length),i},x.prototype.getRangeElement=function(e){return e.lastElementChild?"BR"===e.lastElementChild.tagName?e.lastElementChild.previousElementSibling||e:e.lastElementChild:e},x.prototype.getRootBlockNode=function(e){for(;e&&this.parent&&this.parent.inputElement!==e&&e.parentElement!==this.parent.inputElement;)e=e.parentElement;return e},x.prototype.getRangeLiNode=function(e){for(var t=e.parentElement;t!==this.parent.inputElement&&(1!==t.nodeType||"LI"!==t.tagName);)t=t.parentElement;return t},x.prototype.onPaste=function(e){var t=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);if(e.text.match(t)&&!e.isWordPaste){e.args.preventDefault();for(var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=(this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),new RegExp(/([^\S]|^)(((https?\:\/\/)))/gi)),i=new RegExp(/([^\S]|^)(((www\.))(\S+))/gi),o=e.text.split("\n"),r="",s=0;s<o.length;s++)if(""===o[s].trim())r+=Mr(this.parent);else{for(var a="",l=!0,d=o[s].split(" "),c=0;c<d.length;c++)""===d[c].trim()?a+=l?"&nbsp;":" ":(l=!1,a+=d[c]+" ");r+=0===s?"<span>"+a.trim()+"</span>":"<p>"+a.trim()+"</p>"}for(var t=this.parent.createElement("div"),h=(t.setAttribute("class","pasteContent"),t.style.display="inline",t.innerHTML=r.replace("&para","&amp;para"),t.querySelectorAll("span, p")),s=0;s<h.length;s++){for(var p=h[s].innerHTML.split(" "),u="",c=0;c<p.length;c++)p[c].match(n)||p[c].match(i)?u+='<a class="e-rte-anchor" href="'+p[c]+'" title="'+p[c]+'" target="_blank" aria-label="'+this.parent.serviceLocator.getService("rteLocale").getConstant("linkAriaLabel")+'">'+p[c]+" </a>":u+=p[c]+" ";h[s].innerHTML=u.trim()}var m=t.childNodes[0];j.isNullOrUndefined(m)||j.isNullOrUndefined(m.childNodes[0])||"SPAN"!==m.nodeName||"A"!==m.childNodes[0].nodeName||(t.innerHTML=t.innerHTML.replace("<span>","").replace("</span>","")),j.isNullOrUndefined(this.parent.pasteCleanupModule)?this.parent.formatter.editorManager.execCommand("insertHTML",null,null,null,t):e.callBack(t.innerHTML)}},x.prototype.spaceLink=function(e){var t=this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()),n=this.nodeSelectionObj.getParentNodeCollection(t),i=t.startContainer.textContent.substr(0,t.endOffset),o=i.split(" "),r=o[o.length-1],i=t.startOffset-(i.length-o[o.length-1].length),r=r.slice(0,i),o=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);"A"!==n[0].nodeName&&r.match(o)&&(i=this.nodeSelectionObj.save(t,this.parent.contentModule.getDocument()),n=-1<r.indexOf("http")?r:"http://"+r,o=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),this.parent.formatter.process(this.parent,{item:{command:"Links",subCommand:"CreateLink"}},e,{url:n,selection:i,selectParent:o,text:r,title:"",target:"_blank"}))},x.prototype.onToolbarClick=function(e){var t,n,i,o=this,r=e.item,s=j.closest(e.originalEvent.target,".e-rte-quick-popup"),a=e.originalEvent.target;if(this.parent.notify(un,{target:a}),"FormatPainter"!==r.command)if(!s||s.classList.contains("e-rte-inline-popup")||s.classList.contains("e-rte-text-popup")){var l,a=document.getElementById(this.parent.getID()+"_rtelink"),s=document.getElementById(this.parent.getID()+"_image");switch("SourceCode"!==r.subCommand&&"Preview"!==r.subCommand&&"FontColor"!==r.subCommand&&"BackgroundColor"!==r.subCommand&&"NumberFormatList"!==r.subCommand&&"BulletFormatList"!==r.subCommand&&(l=this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument()),j.isNullOrUndefined(a)&&j.isNullOrUndefined(s)&&(t=this.nodeSelectionObj.save(l,this.parent.contentModule.getDocument())),n=this.nodeSelectionObj.getNodeCollection(l),i=this.nodeSelectionObj.getParentNodeCollection(l)),r.subCommand){case"Maximize":this.parent.notify(le,{args:e});break;case"Minimize":this.parent.notify(de,{args:e});break;case"CreateLink":this.parent.notify(Ne,{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"RemoveLink":this.parent.notify(Ee,{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"Print":this.parent.print();break;case"Image":this.parent.notify(xe,{member:"image",args:e,selectNode:n,selection:t,selectParent:i});break;case"Audio":this.parent.notify(De,{member:"audio",args:e,selectNode:n,selection:t,selectParent:i});break;case"Video":this.parent.notify(Me,{member:"video",args:e,selectNode:n,selection:t,selectParent:i});break;case"CreateTable":this.parent.notify(at,{member:"table",args:e,selection:t});break;case"SourceCode":this.parent.notify(qe,{member:"viewSource",args:e});break;case"Preview":this.parent.notify(ze,{member:"updateSource",args:e});break;case"FontColor":case"BackgroundColor":break;case"File":this.parent.notify(jt,{member:"fileManager",args:e,selectNode:n,selection:t,selectParent:i});break;case"EmojiPicker":this.parent.notify(rn,{member:"emojiPicker",args:e});break;case"ImportWord":this.parent.notify(ie,{});break;case"ExportWord":this.parent.notify(oe,{member:"ExportWord",args:e});break;case"ExportPdf":this.parent.notify(oe,{member:"ExportPdf",args:e});break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}}else"SourceCode"!==r.subCommand&&"Preview"!==r.subCommand&&"FontColor"!==r.subCommand&&"BackgroundColor"!==r.subCommand&&(vs()&&"Images"===r.command&&this.nodeSelectionObj.restore(),l=this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument()),t=this.nodeSelectionObj.save(l,this.parent.contentModule.getDocument()),n=this.nodeSelectionObj.getNodeCollection(l),i=this.nodeSelectionObj.getParentNodeCollection(l)),"Images"===r.command&&this.parent.notify(ue,{member:"image",args:e,selectNode:n,selection:t,selectParent:i}),"Audios"===r.command&&this.parent.notify(me,{member:"audio",args:e,selectNode:n,selection:t,selectParent:i}),"Videos"===r.command&&this.parent.notify(ge,{member:"video",args:e,selectNode:n,selection:t,selectParent:i}),"Links"===r.command&&this.parent.notify(fe,{member:"link",args:e,selectNode:n,selection:t,selectParent:i}),"Table"===r.command&&this.parent.notify(dt,{member:"table",args:e,selectNode:n,selection:t,selectParent:i});else 1===e.originalEvent.detail?(clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(function(){o.parent.notify(nn,{member:"formatPainter",args:e})},200)):(clearTimeout(this.clickTimeout),this.parent.notify(on,{member:"formatPainter",args:e}))},x.prototype.instantiateRenderer=function(){this.parent.iframeSettings.enable?this.renderFactory.addRenderer(c.RenderType.Content,new ya(this.parent)):this.renderFactory.addRenderer(c.RenderType.Content,new Hr(this.parent))},x.prototype.removeEventListener=function(){this.parent.off(n,this.render),this.parent.off(l,this.onPropertyChanged),this.parent.off(Z,this.onToolbarClick),this.parent.off(o,this.destroy),this.parent.off(h,this.onKeyDown),this.parent.off(Q,this.instantiateRenderer),this.parent.off(tt,this.selectAll),this.parent.off(nt,this.selectRange),this.parent.off(it,this.getSelectedHtml),this.parent.off(Ve,this.onSelectionSave),this.parent.off(Qe,this.onSelectionRestore),this.parent.off(ht,this.updateReadOnly),this.parent.off(rt,this.onPaste),this.parent.off(_,this.isTableClassAdded)},x.prototype.render=function(){this.contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content);var e,t=this.contentRenderer.getEditPanel(),n={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};j.isNullOrUndefined(this.parent.formatter)?(e=new zd({currentDocument:this.contentRenderer.getDocument(),element:t,options:n,formatPainterSettings:this.parent.formatPainterSettings}),this.parent.setProperties({formatter:e},!0)):this.parent.formatter.updateFormatter(t,this.contentRenderer.getDocument(),n),this.parent.enableXhtml&&this.parent.notify(It,{}),this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new Vd(this.parent)),this.parent.inlineMode.enable&&(j.isNullOrUndefined(this.parent.fontFamily.default)||(t.style.fontFamily=this.parent.fontFamily.default),j.isNullOrUndefined(this.parent.fontSize.default)||(t.style.fontSize=this.parent.fontSize.default)),this.parent.notify($,{})},x.prototype.onPropertyChanged=function(e){var t;j.isNullOrUndefined(e)||j.isNullOrUndefined(e.newProp.toolbarSettings)||j.isNullOrUndefined(e.newProp.toolbarSettings.enable)||(this.toolbarUpdate=new Vd(this.parent)),j.isNullOrUndefined(e.newProp.formatter)||(e=this.contentRenderer.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer},this.parent.formatter.updateFormatter(e,this.contentRenderer.getDocument(),t))},x.prototype.getModuleName=function(){return"htmlEditor"},x.prototype.selectAll=function(){var e=wr(this.parent.contentModule.getDocument(),this.parent.contentModule.getEditPanel());0<e.length&&this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),e[0],e[e.length-1],0,e[e.length-1].textContent.length)},x.prototype.selectRange=function(e){this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(),e.range)},x.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString())},x.prototype.tableSelectionKeyAction=function(e){for(var t=e.args,n=this.parent.inputElement.querySelectorAll(".e-cell-select"),i=0;i<n.length;i++){var o=n[i];g([o],[zi,Vi,_i]),0===i?(32===t.keyCode?o.innerHTML="&#8203;<br>":o.innerHTML="<br>",this.nodeSelectionObj.setCursorPoint(this.parent.contentModule.getDocument(),o.firstChild,0)):o.innerHTML="<br>"}},x.prototype.marginTabAdd=function(e,t){for(var n=0;n<t.length;n++){var i,o=t[n];o.closest("li")||(o.style.marginLeft?(i=parseInt(o.style.marginLeft,10),e?i-=20:i+=20,o.style.marginLeft=i.toString()+"px","0px"===o.style.marginLeft&&o.removeAttribute("style")):e||(o.style.marginLeft="20px"))}};var Gd=x;function x(e,t){this.rangeCollection=[],this.isImageDelete=!1,this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.xhtmlValidation=new Wd(e),this.addEventListener(),this.isDestroyed=!1,this.isCopyAll=!1}D.prototype.addEventListener=function(){this.nodeSelectionObj=new bs,this.parent.isDestroyed||(this.parent.on(pt,this.pasteClean,this),this.parent.on(tn,this.setCssClass,this),this.parent.on(o,this.destroy,this),this.parent.on(lt,this.docClick,this))},D.prototype.destroy=function(){this.isDestroyed||(this.fireFoxUploadTime&&(clearTimeout(this.fireFoxUploadTime),this.fireFoxUploadTime=null),this.refreshPopupTime&&(clearTimeout(this.refreshPopupTime),this.refreshPopupTime=null),this.popupCloseTime&&(clearTimeout(this.popupCloseTime),this.popupCloseTime=null),this.failureTime&&(clearTimeout(this.failureTime),this.failureTime=null),this.iframeUploadTime&&(clearTimeout(this.iframeUploadTime),this.iframeUploadTime=null),this.removeEventListener(),this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.destroy(),this.popupObj=null),this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),this.uploadObj=null),this.keepRadioButton&&!this.keepRadioButton.isDestroyed&&(this.keepRadioButton.destroy(),this.keepRadioButton=null),this.cleanRadioButton&&!this.cleanRadioButton.isDestroyed&&(this.cleanRadioButton.destroy(),this.cleanRadioButton=null),this.plainTextRadioButton&&!this.plainTextRadioButton.isDestroyed&&(this.plainTextRadioButton.destroy(),this.plainTextRadioButton=null),this.isDestroyed=!0)},D.prototype.removeEventListener=function(){this.parent.off(pt,this.pasteClean),this.parent.off(tn,this.setCssClass),this.parent.off(o,this.destroy),this.parent.off(lt,this.docClick)},D.prototype.pasteClean=function(t){var n,i=this,o={requestType:"Paste",editorMode:this.parent.editorMode,event:t},r=null,e=!1;if(t.args&&!j.isNullOrUndefined(t.args.clipboardData)&&(r=t.args.clipboardData.getData("text/html")),this.parent.trigger(zt,{value:r}),t.args&&null!==r&&"HTML"===this.parent.editorMode){0===r.length?(s=new RegExp(/<\/[a-z][\s\S]*>/i),r=t.args.clipboardData.getData("text/plain"),this.isNotFromHtml=""!==r,r=(r=r.replace(/</g,"&lt;")).replace(/>/g,"&gt;"),this.containsHtml=s.test(r),a=t&&t.args.clipboardData&&0<t.args.clipboardData.items.length?null===t.args.clipboardData.items[0].getAsFile()?j.isNullOrUndefined(t.args.clipboardData.items[1])?null:t.args.clipboardData.items[1].getAsFile():t.args.clipboardData.items[0].getAsFile():null,this.parent.notify(rt,{file:a,args:t.args,text:r,callBack:function(e){"object"==typeof(n=e)?i.parent.formatter.editorManager.execCommand("Images","Image",t.args,i.imageFormatting.bind(i,o),"pasteCleanup",n,"pasteCleanupModule"):r=n}}),s.test(r)||((a=this.parent.createElement("div")).innerHTML=this.splitBreakLine(r),r=a.innerHTML,e=!0)):0<r.length&&this.parent.formatter.editorManager.observer.notify(Zs,{args:t.args,text:t.text,allowedStylePropertiesArray:this.parent.pasteCleanupSettings.allowedStyleProps,callBack:function(e,t,n){o.pasteTableSource=n,r=e.trim(),i.cropImageData=t}}),this.contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content);for(var s=this.contentRenderer.getDocument(),a=this.nodeSelectionObj.getRange(s),a=(this.saveSelection=this.nodeSelectionObj.save(a,s),this.parent.createElement("div")),l=(a.innerHTML=r,a.querySelectorAll(".e-rte-image-unsupported")),d=0;d<l.length;d++)l[d].setAttribute("alt",this.i10n.getConstant("unsupportedImage")),l[d].classList.remove("e-rte-image-unsupported");r=a.innerHTML;s=""!==a.textContent||!j.isNullOrUndefined(a.querySelector("img"))||!j.isNullOrUndefined(a.querySelector("table"));this.parent.notify(ln,{value:r,callBack:function(e){r=e}}),this.parent.pasteCleanupSettings.prompt?s&&(t.args.preventDefault(),this.pasteDialog(r,o,e)):this.parent.pasteCleanupSettings.plainText?(t.args.preventDefault(),this.plainFormatting(r,o,e)):this.parent.pasteCleanupSettings.keepFormat?(t.args.preventDefault(),this.formatting(r,!1,o)):(t.args.preventDefault(),this.formatting(r,!0,o))}},D.prototype.splitBreakLine=function(e){for(var t,n=e.split("\n"),i="",o="P"===this.parent.enterKey?"<p>":"DIV"===this.parent.enterKey?"<div>":"",r="P"===this.parent.enterKey?"</p>":"DIV"===this.parent.enterKey?"</div>":"<br>",s=0;s<n.length;s++)""===n[s].trim()?i+=Mr(this.parent):(t=this.makeSpace(n[s]),i+=(0===s&&"BR"!==this.parent.enterKey?"<span>":o)+(""===t.trim()?"<br>":t.trim())+(n.length-1===s&&"BR"===this.parent.enterKey?"":0===s&&"BR"!==this.parent.enterKey?"</span>":r));return i},D.prototype.makeSpace=function(e){for(var t="",n=!0,i=(e=e.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")).split(" "),o=0;o<i.length;o++)""===i[o].trim()?t+=n?"&nbsp;":" ":(n=!1,t+=i[o]+" ");return t},D.prototype.imgUploading=function(e){var t=e.querySelectorAll(".pasteContent_Img");if(this.parent.insertImageSettings.saveUrl&&0<t.length){for(var n=[],i=[],o=[],r=0;r<t.length;r++)!j.isNullOrUndefined(t[r].getAttribute("src"))&&0<=t[r].getAttribute("src").split(",")[0].indexOf("base64")&&(n.push(t[r].getAttribute("src")),i.push(j.getUniqueID("rte_image")),o.push(t[r]));for(var s=[],r=0;r<n.length;r++)s.push(this.base64ToFile(n[r],i[r]));for(r=0;r<s.length;r++)this.uploadMethod(s[r],o[r]);j.isNullOrUndefined(this.parent.insertImageSettings.path)&&"Blob"===this.parent.insertImageSettings.saveFormat&&this.getBlob(t)}else"Blob"===this.parent.insertImageSettings.saveFormat&&this.getBlob(t);for(var a=e.querySelectorAll(".pasteContent_Img"),r=0;r<a.length;r++)a[r].classList.remove("pasteContent_Img"),""===a[r].getAttribute("class").trim()&&t[r].removeAttribute("class")},D.prototype.getBlob=function(e){for(var t,n=0;n<e.length;n++)!j.isNullOrUndefined(e[n].getAttribute("src"))&&0<=e[n].getAttribute("src").split(",")[0].indexOf("base64")&&(t=URL.createObjectURL(Ir(e[n].getAttribute("src"))),e[n].setAttribute("src",t))},D.prototype.toolbarEnableDisable=function(e){this.parent.inlineMode.enable||this.parent.toolbarModule.baseToolbar.toolbarObj.disable(e)},D.prototype.uploadMethod=function(e,t){var n=this,i=(t.style.opacity="0.5",this.parent.createElement("div")),o=(this.parent.rootContainer.appendChild(i),this.parent.createElement("input",{id:this.parent.getID()+"_upload",attrs:{type:"File",name:"UploadFiles"}})),r=this.parent.iframeSettings.enable?-50:-90,i=(this.popupObj=new U.Popup(i,{relateTo:t,height:"85px",width:"300px",offsetY:r,content:o,viewPortElement:this.parent.element,position:{X:"center",Y:"top"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){n.parent.isBlur=!1,n.popupObj.destroy(),j.detach(n.popupObj.element)}}),this.popupObj.element.style.display="none",j.addClass([this.popupObj.element],[uo,po]),j.isNullOrUndefined(this.parent.cssClass)||j.addClass([this.popupObj.element],this.parent.cssClass.replace(/\s+/g," ").trim().split(" ")),1e6<e.size?300:100),r=(this.refreshPopupTime=setTimeout(function(){n.refreshPopup(t,n.popupObj)},i),this.uploadObj=new P.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},cssClass:yo,dropArea:this.parent.inputElement,allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),success:function(e){n.popupClose(n.popupObj,n.uploadObj,t,e)},uploading:function(e){n.parent.isServerRendered||n.parent.trigger(St,e,function(e){e.cancel?(j.isNullOrUndefined(t)||j.detach(t),j.isNullOrUndefined(n.popupObj.element)||j.detach(n.popupObj.element)):n.parent.inputElement.contentEditable="false"})},beforeUpload:function(e){n.parent.trigger(Ut,e),n.toolbarEnableDisable(!0)},failure:function(e){n.failureTime=setTimeout(function(){n.uploadFailure(t,n.uploadObj,n.popupObj,e)},900)},canceling:function(){n.parent.inputElement.contentEditable="true"," "===t.nextSibling.textContent&&j.detach(t.nextSibling),j.detach(t),n.popupObj.close()},selected:function(e){e.cancel=!0},removing:function(){n.parent.inputElement.contentEditable="true"," "===t.nextSibling.textContent&&j.detach(t.nextSibling),j.detach(t),n.popupObj.close()}}),this.uploadObj.appendTo(this.popupObj.element.childNodes[0]),[{name:e.name,rawFile:e,size:e.size,type:e.type,status:"Ready to Upload",validationMessages:{minSize:"",maxSize:""},statusCode:"1"}]);this.uploadObj.createFileList(r),this.uploadObj.upload(r),this.popupObj.element.getElementsByClassName("e-file-select-wrap")[0].style.display="none",j.detach(this.popupObj.element.querySelector(".e-rte-dialog-upload .e-file-select-wrap"))},D.prototype.uploadFailure=function(e,t,n,i){this.parent&&this.parent.isDestroyed||(this.parent.inputElement.contentEditable="true",j.detach(e),n&&n.close(),this.parent.trigger(Ot,i),t&&document.body.contains(t.element)&&t.destroy())},D.prototype.popupClose=function(e,t,n,i){var o=this,r=(this.parent.inputElement.contentEditable="true",i.element=n,i.detectImageSource=c.ImageInputSource.Pasted,i.file);"2"===r.statusCode?this.parent.trigger(Tt,i,function(e){var t;j.isNullOrUndefined(o.parent.insertImageSettings.path)||(t=o.parent.insertImageSettings.path+e.file.name,n.src=t,n.setAttribute("alt",e.file.name))}):"5"===r.statusCode&&this.parent.trigger(Lt,i,function(e){j.isNullOrUndefined(e.element.src)||(e.element.src="")}),this.popupCloseTime=setTimeout(function(){e.close(),n.style.opacity="1",o.toolbarEnableDisable(!1),t&&document.body.contains(t.element)&&t.destroy()},1500)},D.prototype.refreshPopup=function(e,t){var n=this.parent.iframeSettings.enable?this.parent.element.offsetTop+e.offsetTop:e.offsetTop;this.parent.element.offsetTop+this.parent.element.offsetHeight<n?(t.relateTo=this.parent.inputElement,t.offsetY=this.parent.iframeSettings.enable?-30:-65,t.element.style.display="block"):t&&(t.refreshPosition(e),t.element.style.display="block")},D.prototype.base64ToFile=function(e,t){for(var e=e.split(","),n=e[0].match(/:(.*?);/)[1].split("/")[1],i=atob(e[1]),o=i.length,r=new Uint8Array(o);o--;)r[o]=i.charCodeAt(o);return j.Browser.isIE||-1<navigator.appVersion.indexOf("Edge")?(e=new Blob([r],{type:n}),j.extend(e,{name:t+"."+(j.isNullOrUndefined(n)?"":n)}),e):new File([r],t+"."+(j.isNullOrUndefined(n)?"":n),{type:n})},D.prototype.imageFormatting=function(e,t){j.isNullOrUndefined(t.elements[0].getAttribute("src"))||t.elements[0].classList.add("pasteContent_Img");var n=this.parent.createElement("span"),t=(n.appendChild(t.elements[0]),n.innerHTML),n=(this.contentRenderer=this.renderFactory.getRenderer(c.RenderType.Content),this.contentRenderer.getDocument()),i=this.nodeSelectionObj.getRange(n);this.saveSelection=this.nodeSelectionObj.save(i,n),this.parent.pasteCleanupSettings.prompt?this.pasteDialog(t,e,!1):this.parent.pasteCleanupSettings.plainText?this.plainFormatting(t,e,!1):this.parent.pasteCleanupSettings.keepFormat?this.formatting(t,!1,e):this.formatting(t,!0,e)},D.prototype.radioRender=function(){this.keepRadioButton=new H.RadioButton({label:this.i10n.getConstant("keepFormat"),name:"pasteOption",checked:!0}),this.keepRadioButton.isStringTemplate=!0;var e=this.parent.element.querySelector("#keepFormating"),e=(this.keepRadioButton.appendTo(e),this.cleanRadioButton=new H.RadioButton({label:this.i10n.getConstant("cleanFormat"),name:"pasteOption"}),this.cleanRadioButton.isStringTemplate=!0,this.parent.element.querySelector("#cleanFormat")),e=(this.cleanRadioButton.appendTo(e),this.plainTextRadioButton=new H.RadioButton({label:this.i10n.getConstant("plainText"),name:"pasteOption"}),this.plainTextRadioButton.isStringTemplate=!0,this.parent.element.querySelector("#plainTextFormat"));this.plainTextRadioButton.appendTo(e)},D.prototype.selectFormatting=function(e,t,n,i,o){n?this.formatting(e,!1,t):i?this.formatting(e,!0,t):this.plainFormatting(e,t,o)},D.prototype.pasteDialog=function(i,o,r){var s=this,e={buttons:[{click:function(){var e,t,n;s.dialogObj.isDestroyed||(e=s.parent.element.querySelector("#keepFormating").checked,t=s.parent.element.querySelector("#cleanFormat").checked,s.dialogObj.hide(),n=s.dialogObj,s.dialogRenderObj.close(n),s.dialogObj.destroy(),s.selectFormatting(i,o,e,t,r))},buttonModel:{isPrimary:!0,cssClass:"e-flat "+eo,content:this.i10n.getConstant("pasteDialogOk")}},{click:function(){var e;s.dialogObj.isDestroyed||(s.dialogObj.hide(),e=s.dialogObj,s.dialogRenderObj.close(e),s.dialogObj.destroy())},buttonModel:{cssClass:"e-flat "+to,content:this.i10n.getConstant("pasteDialogCancel")}}],header:this.i10n.getConstant("pasteFormat"),content:this.i10n.getConstant("pasteFormatContent")+'<br/><div><div style="padding-top:24px;"><input type="radio" class="'+Ji+'" id="keepFormating"/></div><div style="padding-top:20px;"><input type="radio" class="'+$i+'" id="cleanFormat"/></div><div style="padding-top:20px;"><input type="radio" class="'+Zi+'" id="plainTextFormat"/></div></div>',target:this.parent.element,width:"300px",height:"265px",cssClass:no,isModal:j.Browser.isDevice,visible:!1},e=(this.dialogObj=this.dialogRenderObj.render(e),this.parent.element.querySelector("#"+this.parent.getID()+"_pasteCleanupDialog"));null!==e&&""!==e.innerHTML&&this.destroyDialog(e),null===e&&(e=this.parent.createElement("div",{id:this.parent.getID()+"_pasteCleanupDialog"}),this.parent.rootContainer.appendChild(e)),this.dialogObj.appendTo(e),this.radioRender(),this.dialogObj.show(),this.setCssClass({cssClass:this.parent.getCssClass()})},D.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},D.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)||j.removeClass([this.popupObj.element],e.oldCssClass),j.addClass([this.popupObj.element],e.cssClass)),this.updateCss(this.dialogObj,e),this.updateCss(this.uploadObj,e),this.updateCss(this.plainTextRadioButton,e),this.updateCss(this.cleanRadioButton,e),this.updateCss(this.keepRadioButton,e)},D.prototype.destroyDialog=function(e){for(var t=this.parent.element.querySelector(".e-rte-dialog-minheight"),n=(j.detach(t),e.children.length),i=0;i<n;i++)j.detach(e.children[0])},D.prototype.docClick=function(e){e=e.args.target;e&&e.classList&&this.dialogObj&&!j.closest(e,"[id='"+this.dialogObj.element.id+"']")&&!e.classList.contains("e-toolbar-item")&&this.dialogObj&&this.dialogObj.hide()},D.prototype.cleanAppleClass=function(e){for(var t=e.querySelectorAll("br.Apple-interchange-newline"),n=0;n<t.length;n++)j.detach(t[n]);return e},D.prototype.formatting=function(t,e,n){for(var i=this,o=this.parent.createElement("div",{className:"pasteContent",styles:"display:inline;"}),e=(this.isNotFromHtml&&this.containsHtml&&(t=this.splitBreakLine(t)),o.innerHTML=t,o=this.cleanAppleClass(o),null!==this.parent.pasteCleanupSettings.deniedTags&&(o=this.deniedTags(o)),(e||null!==this.parent.pasteCleanupSettings.deniedAttrs)&&(o=this.deniedAttributes(o,e)),null!==this.parent.pasteCleanupSettings.allowedStyleProps&&(o=this.allowedStyle(o)),this.saveSelection.restore(),o.innerHTML.split("&").join("&amp;")),r=(o.innerHTML=this.sanitizeHelper(e),o.querySelectorAll("img")),s=0;s<r.length;s++)j.isNullOrUndefined(r[s].getAttribute("src"))||r[s].classList.add("pasteContent_Img"),this.setImageProperties(r[s]);if(this.addTempClass(o),0<o.querySelectorAll("picture").length&&this.processPictureElement(o),""!==o.textContent||!j.isNullOrUndefined(o.querySelector("img"))||!j.isNullOrUndefined(o.querySelector("table"))){var e=this.parent.createElement("div"),a=(e.innerHTML=t,[]);if(!j.isNullOrUndefined(e.querySelector("img"))){for(var l=e.querySelectorAll("img"),d=[],c=[],h=[],s=0;s<l.length;s++)l[s].getAttribute("src")&&0<=l[s].getAttribute("src").split(",")[0].indexOf("base64")&&(d.push(l[s].getAttribute("src")),c.push(j.getUniqueID("rte_image")),h.push(l[s]));for(var p,u=[],s=0;s<d.length;s++)u.push(this.base64ToFile(d[s],c[s])),p={name:u[s].name,rawFile:u[s],size:u[s].size,type:u[s].type,status:"",validationMessages:{minSize:"",maxSize:""},statusCode:"1"},a.push(p)}this.parent.trigger(_t,{value:o.innerHTML,filesData:a},function(e){t=e.value}),o.innerHTML=this.parent.addAnchorAriaLabel(t),o=this.addTableClass(o,n.pasteTableSource),this.parent.formatter.editorManager.execCommand("inserthtml","pasteCleanup",n,function(e){j.extend(n,{elements:e.elements,imageElements:e.imgElem},!0),i.parent.formatter.onSuccess(i.parent,n)},o,null,null,this.parent.enterKey),this.parent.notify(mn,{}),Es(this.parent.contentModule.getDocument(),this.parent.inputElement),this.removeTempClass(),this.parent.notify(X,{}),this.cropImageHandler(this.parent.inputElement)}},D.prototype.convertBlobToBase64=function(e){for(var r=e.querySelectorAll("img"),t=0;t<r.length;t++)!function(n){var e,i,o;r[n].getAttribute("src")&&r[n].getAttribute("src").startsWith("blob")&&(e=r[n].getAttribute("src"),i=new Image,o=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),t=(e.width=i.width,e.height=i.height,t.drawImage(i,0,0),e.toDataURL("image/png"));r[n].src=t,i.removeEventListener("load",o)},i.src=e,i.addEventListener("load",o))}(t)},D.prototype.cropImageHandler=function(e){var l=this,d=e.querySelectorAll(".e-img-cropped");if(0<d.length)for(var t=0;t<d.length;t++)!function(o){var r,s,a;0<=d[o].getAttribute("src").split(",")[0].indexOf("base64")&&((r=new Image).src=d[o].getAttribute("src"),s=document.createElement("canvas"),a=s.getContext("2d"),r.onload=function(){var e=l.cropImageData[o].goalWidth/r.naturalWidth,t=l.cropImageData[o].goalHeight/r.naturalHeight,n=l.cropImageData[o].cropLength/e,i=l.cropImageData[o].cropTop/t,e=(l.cropImageData[o].goalWidth-l.cropImageData[o].cropLength-l.cropImageData[o].cropR)/e,t=(l.cropImageData[o].goalHeight-l.cropImageData[o].cropTop-l.cropImageData[o].cropB)/t,n=(s.width=e,s.height=t,a.drawImage(r,n,i,e,t,0,0,e,t),s.toDataURL("image/png"));d[o].setAttribute("src",n),d[o].classList.remove("e-img-cropped"),l.imgUploading(l.parent.inputElement),l.parent.iframeSettings.enable&&l.parent.updateValue()})}(t);else!j.isNullOrUndefined(this.parent.insertImageSettings.saveUrl)&&!j.isNullOrUndefined(this.parent.insertImageSettings.path)&&0<this.parent.inputElement.querySelectorAll("img").length&&this.parent.inputElement.querySelectorAll("img")[0].src.startsWith("blob")?(this.convertBlobToBase64(this.parent.inputElement),this.iframeUploadTime=setTimeout(function(){l.imgUploading(l.parent.inputElement),l.parent.iframeSettings.enable&&l.parent.updateValue()},20)):(this.imgUploading(this.parent.inputElement),this.parent.iframeSettings.enable&&this.parent.updateValue())},D.prototype.addTableClass=function(e,t){for(var n=e.querySelectorAll("table"),i=0;i<n.length;i++){var o="FIGURE"===n[i].parentElement.nodeName;this.parent.pasteCleanupSettings.keepFormat&&t&&!o?n[i].classList.add("e-rte-paste-"+t+"-table"):n[i].classList.contains("e-rte-table")||n[i].classList.add("e-rte-table")}return e},D.prototype.setImageProperties=function(e){"auto"!==this.parent.insertImageSettings.width&&e.setAttribute("width",this.parent.insertImageSettings.width),"0"!==this.parent.insertImageSettings.minWidth&&0!==this.parent.insertImageSettings.minWidth&&(e.style.minWidth=this.parent.insertImageSettings.minWidth.toString()),null!==this.parent.insertImageSettings.maxWidth&&(e.style.maxWidth=this.parent.getInsertImgMaxWidth().toString()),"auto"!==this.parent.insertImageSettings.height&&e.setAttribute("height",this.parent.insertImageSettings.height),"0"!==this.parent.insertImageSettings.minHeight&&0!==this.parent.insertImageSettings.minHeight&&(e.style.minHeight=this.parent.insertImageSettings.minHeight.toString()),null!==this.parent.insertImageSettings.maxHeight&&(e.style.maxHeight=this.parent.insertImageSettings.maxHeight.toString())},D.prototype.addTempClass=function(e){for(var t=e.children,n=0;n<t.length;n++)t[n].classList.add("pasteContent_RTE")},D.prototype.removeTempClass=function(){for(var e=this.parent.inputElement.querySelectorAll(".pasteContent_RTE"),t=0;t<e.length;t++)e[t].classList.remove("pasteContent_RTE"),""===e[t].getAttribute("class")&&e[t].removeAttribute("class")},D.prototype.sanitizeHelper=function(e){return e=Ar(e,this.parent)},D.prototype.plainFormatting=function(t,n,e){var i=this,o=this.parent.createElement("div",{className:"pasteContent",styles:"display:inline;"});if(o.innerHTML=t,this.detachInlineElements(o),this.getTextContent(o),""!==o.textContent.trim()){if(!j.isNullOrUndefined(o.firstElementChild)&&"BR"!==o.firstElementChild.tagName){var r=o.firstElementChild;if(!j.isNullOrUndefined(o.firstElementChild)){for(var s=this.parent.createElement("span"),a=0,l=0;a<r.childNodes.length;a++,l++){if("#text"===r.childNodes[a].nodeName)s.appendChild(r.childNodes[a]),o.insertBefore(s,o.firstElementChild);else{if("#text"===r.childNodes[a].nodeName||0!==l)break;for(var d=0;d<r.childNodes[a].childNodes.length;d++)s.appendChild(r.childNodes[a].childNodes[d]),o.insertBefore(s,o.firstElementChild),d--}a--}r.hasChildNodes()||j.detach(r)}}this.removeEmptyElements(o),this.saveSelection.restore(),o.innerHTML=this.sanitizeHelper(o.innerHTML),this.addTempClass(o),this.removingComments(o),"BR"!==this.parent.enterKey||e?"DIV"===this.parent.enterKey&&(o.innerHTML=o.innerHTML.replace(/<p class="pasteContent_RTE">/g,"<div>").replace(/<\/p>/g,"</div>")):o=this.reframeToBrContent(o),this.parent.trigger(_t,{value:o.innerHTML,filesData:null},function(e){t=e.value}),o.innerHTML=t,this.parent.formatter.editorManager.execCommand("inserthtml","pasteCleanup",n,function(e){j.extend(n,{elements:e.elements,imageElements:e.imgElem},!0),i.parent.formatter.onSuccess(i.parent,n)},o,null,null,this.parent.enterKey),this.removeTempClass()}else this.saveSelection.restore(),j.extend(n,{elements:[]},!0),this.parent.formatter.onSuccess(this.parent,n)},D.prototype.removingComments=function(e){var t=(t=e.innerHTML).replace(/<!--[\s\S]*?-->/g,"");e.innerHTML=t},D.prototype.reframeToBrContent=function(e){for(var t=this.parent.createElement("div",{className:"pasteContent",styles:"display:inline;"});!j.isNullOrUndefined(e.firstChild);){var n,i=this.parent.createElement("br"),o=e.firstChild;"#text"===o.nodeName?(n=!j.isNullOrUndefined(o.nextSibling),t.appendChild(o),n&&t.appendChild(i)):((n="BR"===o.nodeName)?t.appendChild(o):t.appendChild(o.childNodes[0]),j.isNullOrUndefined(o)||j.isNullOrUndefined(o.nextSibling)||t.appendChild(i),n||j.isNullOrUndefined(o)||j.detach(o))}return t},D.prototype.getTextContent=function(e){for(var t=0;t<this.blockNode.length;t++)for(var n=e.querySelectorAll(this.blockNode[t]),i=0;i<n.length;i++){for(var o,r=void 0,s=0,a=void 0;s<n[i].childNodes.length;s++,0)"DIV"===n[i].childNodes[s].nodeName||"P"===n[i].childNodes[s].nodeName||"#text"===n[i].childNodes[s].nodeName&&"&nbsp;"!==n[i].childNodes[s].nodeValue.replace(/\u00a0/g,"&nbsp;")&&""===n[i].childNodes[s].textContent.trim()?(r=n[i].childNodes[s].parentElement,n[i].childNodes[s].parentElement.parentElement.insertBefore(n[i].childNodes[s],n[i].childNodes[s].parentElement),s--):(r=n[i].childNodes[s].parentElement,"text"===a?r.previousElementSibling.appendChild(n[i].childNodes[s]):((o=this.parent.createElement("div",{id:"newDiv"})).appendChild(n[i].childNodes[s]),r.parentElement.insertBefore(o,r)),s--,a="text");j.isNullOrUndefined(r)||j.detach(r)}for(var l=e.querySelectorAll("*"),t=0;t<l.length;t++)for(var d=l[t].attributes,i=0;i<d.length;i++)l[t].removeAttribute(d[i].name),i--},D.prototype.detachInlineElements=function(e){for(var t=0;t<this.inlineNode.length;t++)for(var n=e.querySelectorAll(this.inlineNode[t]),i=0;i<n.length;i++)if(n[i]!==e.firstChild||"SPAN"!==n[i].nodeName){for(var o=void 0,r=0;r<n[i].childNodes.length;r++)o=n[i].childNodes[r].parentElement,n[i].childNodes[r].parentElement.parentElement.insertBefore(n[i].childNodes[r],n[i].childNodes[r].parentElement),r--;j.isNullOrUndefined(o)||j.detach(o)}},D.prototype.findDetachEmptyElem=function(e){return j.isNullOrUndefined(e)||j.isNullOrUndefined(e.parentElement)?null:0<e.parentElement.textContent.length&&e.parentElement.textContent.match(/\u00a0/g)&&0<e.parentElement.textContent.match(/\u00a0/g).length||""!==e.parentElement.textContent.trim()||"pasteContent"===e.parentElement.getAttribute("class")?e:this.findDetachEmptyElem(e.parentElement)},D.prototype.removeEmptyElements=function(e){for(var t,n=e.querySelectorAll(":empty"),i=0;i<n.length;i++)"BR"!==n[i].tagName&&(t=this.findDetachEmptyElem(n[i]),j.isNullOrUndefined(t)||j.detach(t))},D.prototype.tagGrouping=function(e){for(var t=e.slice(),n=Object.keys(As),i=n.map(function(e){return As[""+e]}),o=[],r=0;r<t.length;r++)if(1<t[r].split("[").length&&(t[r]=t[r].split("[")[0].trim()),-1<n.indexOf(t[r]))for(var s=0;s<i[n.indexOf(t[r])].length;s++)t.indexOf(i[n.indexOf(t[r])][s])<0&&o.indexOf(i[n.indexOf(t[r])][s])<0&&o.push(i[n.indexOf(t[r])][s]);return e.concat(o)},D.prototype.attributesfilter=function(e){for(var t=0;t<e.length;t++)if(1<e[t].split("[").length){for(var n=e[t].split("[")[1].split("]")[0].split(","),i=[],o=[],r=0;r<n.length;r++)n[r].indexOf("!")<0?i.push(n[r].trim()):o.push(n[r].split("!")[1].trim());var s,a=1<i.length?i.join("]["):i.join(),l=1<o.length?o.join("]["):o.join();0<l.length?(s=""!==a?e[t].split("[")[0]+"["+a+"]":e[t].split("[")[0],e[t]=s+":not(["+l+"])"):e[t]=e[t].split("[")[0]+"["+a+"]"}return e},D.prototype.deniedTags=function(e){var t=j.isNullOrUndefined(this.parent.pasteCleanupSettings.deniedTags)?[]:this.parent.pasteCleanupSettings.deniedTags.slice(),t=this.attributesfilter(t);t=this.tagGrouping(t);for(var n=0;n<t.length;n++)for(var i=e.querySelectorAll(t[n]),o=i.length-1;0<=o;o--){for(var r=i[o].parentNode;i[o].firstChild;)r.insertBefore(i[o].firstChild,i[o]);r.removeChild(i[o])}return e},D.prototype.deniedAttributes=function(e,t){var n=j.isNullOrUndefined(this.parent.pasteCleanupSettings.deniedAttrs)?[]:this.parent.pasteCleanupSettings.deniedAttrs.slice();t&&n.push("style");for(var i=0;i<n.length;i++)for(var o=e.querySelectorAll("["+n[i]+"]"),r=0;r<o.length;r++)o[r].removeAttribute(n[i]);return e},D.prototype.allowedStyle=function(e){for(var t=j.isNullOrUndefined(this.parent.pasteCleanupSettings.allowedStyleProps)?[]:this.parent.pasteCleanupSettings.allowedStyleProps.slice(),n=(t.push("list-style-type","list-style"),e.querySelectorAll("[style]")),i=0;i<n.length;i++){for(var o,r=[],s=n[i].getAttribute("style").split(";"),a=0;a<s.length;a++)0<=t.indexOf(s[a].split(":")[0].trim())&&r.push(s[a]);n[i].removeAttribute("style"),(o=""===r.join(";").trim()?r.join(";"):r.join(";")+";")&&n[i].setAttribute("style",o)}return e},D.prototype.processPictureElement=function(e){for(var t=e.querySelectorAll("picture"),n=0;n<t.length;n++){var i=t[n].querySelector("img"),o=t[n].querySelectorAll("source");if(i&&i.getAttribute("src"))for(var i=i.getAttribute("src"),r=new URL(i),s=0;s<o.length;s++){var a=o[s].getAttribute("srcset");a&&-1===a.indexOf("http")&&(a=r.origin+a,o[s].setAttribute("srcset",a))}}},D.prototype.getModuleName=function(){return"pasteCleanup"};var Xd=D;function D(e,t){this.inlineNode=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"],this.blockNode=["div","h1","h2","h3","h4","h5","h6","address","blockquote","button","center","dd","dir","dl","dt","fieldset","frameset","hr","iframe","isindex","li","map","menu","noframes","noscript","object","ol","pre","td","tr","th","tbody","tfoot","thead","table","ul","header","article","nav","footer","section","aside","main","figure","figcaption"],this.isNotFromHtml=!1,this.containsHtml=!1,this.cropImageData=[],this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.i10n=t.getService("rteLocale"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1}Jd.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(n,this.renderResizable,this),this.parent.on(o,this.destroy,this))},Jd.prototype.renderResizable=function(){var e=this.parent.enableRtl?Lo:oo;this.resizer=this.parent.createElement("div",{id:this.parent.getID()+"-resizable",className:"e-icons "+io+" "+e}),this.parent.element.classList.add(vo),this.parent.rootContainer.appendChild(this.resizer),this.parent.rootContainer.classList.add("e-resize-enabled"),this.parent.iframeSettings.enable&&this.parent.inputElement.classList.add("e-resize-enabled"),this.touchStartEvent="msie"===j.Browser.info.name?"pointerdown":"touchstart",j.EventHandler.add(this.resizer,"mousedown",this.resizeStart,this),j.EventHandler.add(this.resizer,this.touchStartEvent,this.resizeStart,this)},Jd.prototype.resizeStart=function(e){var t=this,e=(e.cancelable&&e.preventDefault(),this.wireResizeEvents(),this.parent.notify(Ht,{}),{event:e,requestType:"editor"});this.parent.trigger(ye,e,function(e){e.cancel&&t.unwireResizeEvents()})},Jd.prototype.performResize=function(e){var t,n,i=this,o=(this.parent.trigger(ve,{event:e,requestType:"editor"},function(e){e.cancel&&i.unwireResizeEvents()}),this.parent.element.getBoundingClientRect());this.isMouseEvent(e)?(this.parent.element.style.height=e.clientY-o.top+"px",this.parent.element.style.width=this.parent.enableRtl?o.right-e.clientX+"px":e.clientX-o.left+"px",n=this.parent.toolbarModule.getToolbarElement(),j.isNullOrUndefined(n)||j.isNullOrUndefined(n.parentElement)||n.parentElement.classList.contains(kn)&&this.parent.toolbarSettings.enableFloating&&this.parent.getToolbar()&&!this.parent.inlineMode.enable&&(t=this.parent.contentModule.getPanel().getBoundingClientRect().width,n.style.width=t+"px")):(n="msie"!==j.Browser.info.name?e.touches[0]:e,this.parent.element.style.height=n.clientY-o.top+"px",this.parent.element.style.width=this.parent.enableRtl?o.right-n.clientX+"px":n.clientX-o.left+"px"),this.parent.refreshUI()},Jd.prototype.stopResize=function(e){this.parent.refreshUI(),this.unwireResizeEvents(),this.parent.trigger(Ce,{event:e,requestType:"editor"})},Jd.prototype.getEventType=function(e){return-1<e.indexOf("mouse")?"mouse":"touch"},Jd.prototype.isMouseEvent=function(e){var t=!1;return t="mouse"!==this.getEventType(e.type)&&(j.isNullOrUndefined(e.pointerType)||"mouse"!==this.getEventType(e.pointerType))?t:!0},Jd.prototype.wireResizeEvents=function(){j.EventHandler.add(document,"mousemove",this.performResize,this),j.EventHandler.add(document,"mouseup",this.stopResize,this),this.touchMoveEvent="msie"===j.Browser.info.name?"pointermove":"touchmove",this.touchEndEvent="msie"===j.Browser.info.name?"pointerup":"touchend",j.EventHandler.add(document,this.touchMoveEvent,this.performResize,this),j.EventHandler.add(document,this.touchEndEvent,this.stopResize,this)},Jd.prototype.unwireResizeEvents=function(){j.EventHandler.remove(document,"mousemove",this.performResize),j.EventHandler.remove(document,"mouseup",this.stopResize),j.EventHandler.remove(document,this.touchMoveEvent,this.performResize),j.EventHandler.remove(document,this.touchEndEvent,this.stopResize)},Jd.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.resizer&&(j.detach(this.resizer),this.resizer=null),this.isDestroyed=!0)},Jd.prototype.removeEventListener=function(){this.parent.off(n,this.renderResizable),this.parent.element.classList.remove(vo),this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-resize-enabled")&&this.parent.rootContainer.classList.remove("e-resize-enabled"),this.parent.iframeSettings.enable&&!j.isNullOrUndefined(this.parent.inputElement)&&this.parent.inputElement.classList.remove("e-resize-enabled"),this.resizer&&(j.EventHandler.remove(this.resizer,"mousedown",this.resizeStart),j.EventHandler.remove(this.resizer,this.touchStartEvent,this.resizeStart),j.detach(this.resizer)),this.parent.off(o,this.destroy)},Jd.prototype.getModuleName=function(){return"resize"};var Yd=Jd;function Jd(e){this.parent=e,this.addEventListener(),this.isDestroyed=!1}Zd.prototype.initialize=function(){this.contentModule=this.rendererFactory.getRenderer(c.RenderType.Content)},Zd.prototype.render=function(e){var t=e.selectNode&&"IMG"===e.selectNode[0].nodeName?this.parent.localeObj.getConstant("dialogUpdate"):this.i10n.getConstant("dialogInsert"),n=this.parent.localeObj.getConstant("fileDialogHeader"),i=this.i10n.getConstant("dialogCancel"),t=(this.dlgButtons=[{click:this.insertImageBoundFn,buttonModel:{content:t,cssClass:"e-flat e-insertImage",isPrimary:!0,disabled:!0}},{click:this.cancelDialogBoundFn,buttonModel:{cssClass:"e-flat e-cancel",content:i}}],this.selectObj={selection:e.selection,args:e.args,selectParent:e.selectParent},this.parent.createElement("div",{className:"e-rte-file-manager-dialog",id:this.parent.getID()+"_file-manager-dialog",attrs:{"aria-owns":this.parent.getID()}})),i=(document.body.appendChild(t),this.fileWrap=this.parent.createElement("div",{id:this.parent.getID()+"_rte-file-manager",className:"e-img-file-wrap"}),t.appendChild(this.fileWrap),t.appendChild(this.getInputUrlElement()),{visible:!1,isModal:!0,header:n,target:document.body,locale:this.parent.locale,enableRtl:this.parent.enableRtl,cssClass:Ei,animationSettings:{effect:"None"},showCloseIcon:!0,closeOnEscape:!0,width:"720px",height:"auto",position:{X:"center",Y:"center"},buttons:this.dlgButtons,created:this.renderFileManagerBoundFn,close:this.dialogClosedBoundFn});this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),this.dialogObj.show(!!j.Browser.isDevice),this.setCssClass({cssClass:this.parent.getCssClass()})},Zd.prototype.setCssClass=function(e){this.dialogObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)?this.dialogObj.setProperties({cssClass:(this.dialogObj.cssClass+" "+e.cssClass).trim()}):this.dialogObj.setProperties({cssClass:(this.dialogObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},Zd.prototype.dialogClosed=function(e){this.parent.isBlur=!1,e&&e.event.returnValue&&this.selectObj.selection.restore(),this.destroyComponents(),this.parent.element.ownerDocument.removeEventListener("mousedown",this.onDocumentClickBoundFn),this.dialogRenderObj.close(e)},Zd.prototype.renderFileManager=function(){var t=this;this.fileObj=new z.FileManager({allowMultiSelection:!1,locale:this.parent.locale,enableRtl:this.parent.enableRtl,path:this.parent.fileManagerSettings.path,view:this.parent.fileManagerSettings.view,enablePersistence:this.parent.enablePersistence,cssClass:this.parent.fileManagerSettings.cssClass,sortOrder:this.parent.fileManagerSettings.sortOrder,ajaxSettings:this.parent.fileManagerSettings.ajaxSettings,showThumbnail:this.parent.fileManagerSettings.showThumbnail,rootAliasName:this.parent.fileManagerSettings.rootAliasName,uploadSettings:this.parent.fileManagerSettings.uploadSettings,searchSettings:this.parent.fileManagerSettings.searchSettings,toolbarSettings:this.parent.fileManagerSettings.toolbarSettings,showHiddenItems:this.parent.fileManagerSettings.showHiddenItems,allowDragAndDrop:this.parent.fileManagerSettings.allowDragAndDrop,showFileExtension:this.parent.fileManagerSettings.showFileExtension,detailsViewSettings:this.parent.fileManagerSettings.detailsViewSettings,contextMenuSettings:this.parent.fileManagerSettings.contextMenuSettings,navigationPaneSettings:this.parent.fileManagerSettings.navigationPaneSettings,beforeSend:this.parent.fileManagerSettings.beforeSend,fileSelect:function(e){e=e.fileDetails;e.isFile&&-1<t.parent.insertImageSettings.allowedTypes.indexOf(e.type)?(t.inputUrl.value=t.parent.fileManagerSettings.ajaxSettings.getImageUrl+"?path="+(e.filterPath&&e.filterPath.replace(/\\/g,"/"))+e.name,t.dlgButtons[0].buttonModel.disabled=!1):(t.inputUrl.value="",t.dlgButtons[0].buttonModel.disabled=!0),t.dialogObj.setProperties({buttons:t.dlgButtons})},created:function(){t.inputUrl.removeAttribute("disabled")},success:function(){t.fileObj.refreshLayout()}}),j.Browser.isDevice&&(this.fileObj.height="85%"),this.fileObj.appendTo(this.fileWrap),this.parent.element.ownerDocument.addEventListener("mousedown",this.onDocumentClickBoundFn)},Zd.prototype.getInputUrlElement=function(){var e=this.parent.createElement("div",{className:"imgUrl"}),t=this.parent.createElement("div",{className:"e-rte-label"}),t=(t.innerHTML='<label for="rteSample_img_url">'+this.i10n.getConstant("linkWebUrl")+"</label>",e.appendChild(t),this.i10n.getConstant("imageUrl"));return this.inputUrl=this.parent.createElement("input",{className:"e-input e-img-url",attrs:{placeholder:t,spellcheck:"false",disabled:"true"}}),e.appendChild(this.inputUrl),e},Zd.prototype.insertImageUrl=function(e){var t,n=this.inputUrl.value;0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),""!==n&&("HTML"===this.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selectObj.selection.range.startContainer.parentNode,"#"+this.contentModule.getPanel().id))&&(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),this.selectObj.selection=this.parent.formatter.editorManager.nodeSelection.save(t,this.contentModule.getDocument()),this.selectObj.selectParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)),t=j.isNullOrUndefined(n.match(t=/[\w-]+.(jpg|png|jpeg|gif)/g))||"HTML"!==this.parent.editorMode?"":n.match(t)[0],n={cssClass:"inline"===this.parent.insertImageSettings.display?ui:ii,url:n,selection:this.selectObj.selection,altText:t,selectParent:this.selectObj.selectParent,width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.parent.getInsertImgMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}},this.parent.formatter.process(this.parent,this.selectObj.args,this.selectObj.args.originalEvent,n),this.dialogObj.hide({returnValue:!1}))},Zd.prototype.cancelDialog=function(){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0})},Zd.prototype.onDocumentClick=function(e){var e=e.target,t="#document"!==e.nodeName&&!j.isNullOrUndefined(e.previousElementSibling)&&e.previousElementSibling;j.isNullOrUndefined(this.dialogObj)||j.closest(e,"#"+this.parent.getID()+"_file-manager-dialog")||j.closest(e,"#"+this.parent.getID()+"_rte-file-manager_tb_sortby-popup")||j.closest(e,"#"+this.parent.getID()+"_rte-file-manager_tb_view-popup")||j.closest(e,"#"+this.parent.getID()+"_rte-file-manager_contextmenu")||!j.isNullOrUndefined(j.closest(e,".e-contextmenu-wrapper"))&&j.closest(e,".e-contextmenu-wrapper").querySelector("#"+this.parent.getID()+"_rte-file-manager_contextmenu")||j.isNullOrUndefined(t)||t.classList.contains("e-rte-file-manager-dialog")||j.isNullOrUndefined(t)||t.id===this.parent.getID()+"_rte-file-manager_contextmenu"?this.parent.isRTE=!0:(this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Or(this.parent.element,"focusout"))},Zd.prototype.addEventListener=function(){this.parent.on(n,this.initialize,this),this.parent.on(jt,this.render,this),this.parent.on(tn,this.setCssClass,this),this.parent.on(o,this.destroy,this)},Zd.prototype.removeEventListener=function(){this.parent.element.ownerDocument.removeEventListener("mousedown",this.onDocumentClickBoundFn),this.parent.off(n,this.initialize),this.parent.off(jt,this.render),this.parent.off(tn,this.setCssClass),this.parent.off(o,this.destroy)},Zd.prototype.destroyComponents=function(){this.fileObj&&(this.fileObj.destroy(),this.fileObj=null),this.dialogObj&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element))},Zd.prototype.destroy=function(){this.isDestroyed||(this.destroyComponents(),this.removeEventListener(),this.dlgButtons=null,this.isDestroyed=!0,this.insertImageBoundFn=null,this.cancelDialogBoundFn=null,this.renderFileManagerBoundFn=null,this.dialogClosedBoundFn=null,this.onDocumentClickBoundFn=null)},Zd.prototype.getModuleName=function(){return"fileManager"};var $d=Zd;function Zd(e,t){z.FileManager.Inject(z.ContextMenu,z.DetailsView,z.NavigationPane,z.Toolbar),this.parent=e,this.i10n=t.getService("rteLocale"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.rendererFactory=t.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1,this.insertImageBoundFn=this.insertImageUrl.bind(this),this.cancelDialogBoundFn=this.cancelDialog.bind(this),this.renderFileManagerBoundFn=this.renderFileManager.bind(this),this.dialogClosedBoundFn=this.dialogClosed.bind(this),this.onDocumentClickBoundFn=this.onDocumentClick.bind(this)}tc.prototype.showFullScreen=function(t){var n=this;!0!==this.parent.toolbarSettings.enable||"Markdown"===this.parent.editorMode||j.isNullOrUndefined(this.parent.quickToolbarModule)||this.parent.quickToolbarModule.hideQuickToolbars(),this.parent.showTooltip&&!j.isNullOrUndefined(document.querySelector(".e-tooltip-wrap"))&&this.parent.notify(sn,{args:t}),this.scrollableParent=U.getScrollableParent(this.parent.element),this.parent.element.classList.contains(Mn)||this.parent.trigger(Oe,{cancel:!1,requestType:"Maximize",targetItem:"Maximize",args:t},function(e){e.cancel||(n.parent.toolbarSettings.enableFloating&&!n.parent.inlineMode.enable&&n.parent.toolbarSettings.enable&&(n.parent.getToolbarElement().style.width="100%",n.parent.getToolbarElement().style.top="0px"),n.parent.element.classList.add(Mn),n.toggleParentOverflow(!0),n.parent.toolbarModule&&(n.parent.getBaseToolbarObject().toolbarObj.items[0].properties||n.parent.getBaseToolbarObject().toolbarObj.removeItems(0),j.Browser.isDevice&&n.parent.toolbarModule.removeFixedTBarClass(),n.parent.toolbarModule.updateItem({targetItem:"Maximize",updateItem:"Minimize",baseToolbar:n.parent.getBaseToolbarObject()})),n.parent.refreshUI(),n.parent.trigger(Le,{requestType:"Maximize",targetItem:"Maximize",args:t}))})},tc.prototype.hideFullScreen=function(i){var o=this;!0!==this.parent.toolbarSettings.enable||"Markdown"===this.parent.editorMode||j.isNullOrUndefined(this.parent.quickToolbarModule)||this.parent.quickToolbarModule.hideQuickToolbars(),this.parent.showTooltip&&!j.isNullOrUndefined(document.querySelector(".e-tooltip-wrap"))&&this.parent.notify(sn,{args:i}),this.parent.element.classList.contains(Mn)&&this.parent.trigger(Oe,{cancel:!1,requestType:"Minimize",targetItem:"Minimize",args:i},function(e){if(!e.cancel){o.parent.element.classList.remove(Mn);for(var t=document.querySelectorAll(".e-rte-overflow"),n=0;n<t.length;n++)j.removeClass([t[n]],["e-rte-overflow"]);o.parent.toolbarModule&&(o.parent.getBaseToolbarObject().toolbarObj.items[0].properties||o.parent.getBaseToolbarObject().toolbarObj.removeItems(0),o.parent.toolbarModule.updateItem({targetItem:"Minimize",updateItem:"Maximize",baseToolbar:o.parent.getBaseToolbarObject()}),j.Browser.isDevice)&&o.parent.inlineMode.enable&&o.parent.toolbarModule.addFixedTBarClass(),o.parent.refreshUI(),o.parent.trigger(Le,{requestType:"Minimize",targetItem:"Minimize",args:i})}})},tc.prototype.toggleParentOverflow=function(e){if(!j.isNullOrUndefined(this.scrollableParent))for(var t,n=0;n<this.scrollableParent.length;n++)t="#document"===this.scrollableParent[n].nodeName?document.querySelector("body"):this.scrollableParent[n],j.addClass([t],["e-rte-overflow"])},tc.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"full-screen":this.showFullScreen(e.args),t.preventDefault();break;case"escape":this.hideFullScreen(e.args),t.preventDefault()}},tc.prototype.addEventListener=function(){this.parent.on(h,this.onKeyDown,this),this.parent.on(o,this.destroy,this)},tc.prototype.removeEventListener=function(){this.parent.off(h,this.onKeyDown),this.parent.off(o,this.destroy)},tc.prototype.destroy=function(){if(!j.isNullOrUndefined(this.parent)){this.parent.element.classList.contains(Mn)&&this.toggleParentOverflow(!1);for(var e=document.querySelectorAll(".e-rte-overflow"),t=0;t<e.length;t++)j.removeClass([e[t]],["e-rte-overflow"]);this.removeEventListener()}};var ec=tc;function tc(e){this.parent=e,this.addEventListener()}function nc(e,t,n,i){var o;if(o=n?t.contentModule.getDocument().querySelector("body"):t.element,Object.keys(e).length)for(var r=0,s=Object.keys(e);r<s.length;r++){var a=s[r];"class"===a?o.classList.add(e[""+a]):"disabled"===a&&"disabled"===e[""+a]?(t.enabled=!1,t.setEnable()):"readonly"===a&&"readonly"===e[""+a]?(t.readonly=!0,t.setReadOnly(i)):"style"===a?o.setAttribute("style",e[""+a]):"tabindex"===a?t.inputElement.setAttribute("tabindex",e[""+a]):"placeholder"===a?(t.placeholder=e[""+a],t.setPlaceHolder()):(-1<["name","required"].indexOf(a)?t.valueContainer:o).setAttribute(a,e[""+a])}}oc.prototype.addEventListener=function(){this.parent.on(nn,this.toolbarClick,this),this.parent.on(on,this.toolbarDoubleClick,this),this.parent.on(Xe,this.editAreaClick,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(o,this.destroy,this)},oc.prototype.toolbarClick=function(e){this.parent.focusIn(),this.isSticky?(e.args.action="escape",this.actionHandler(e,"keyBoard")):(this.isActive=!0,this.actionHandler(e,"click")),this.parent.quickToolbarModule&&!j.isNullOrUndefined(this.parent.quickToolbarSettings.text)&&this.parent.element.ownerDocument.contains(this.parent.quickToolbarModule.textQTBar.element)&&this.parent.quickToolbarModule.textQTBar.hidePopup()},oc.prototype.toolbarDoubleClick=function(e){this.isActive=!0,this.isSticky=!0,this.parent.focusIn(),this.actionHandler(e,"dbClick")},oc.prototype.onKeyDown=function(e){var t=e.args;(j.isNullOrUndefined(t)||j.isNullOrUndefined(t.action)||"format-copy"!==t.action&&"format-paste"!==t.action)&&("escape"!==t.action||"format-copy"!==this.previousAction&&"format-paste"!==this.previousAction)||("format-copy"!==t.action&&"format-paste"!==t.action||t.stopPropagation(),-1!==j.Browser.userAgent.indexOf("Firefox")&&t.preventDefault(),this.actionHandler(e,"keyBoard"))},oc.prototype.actionHandler=function(e,t){var n,i,o,r=!1;switch(t){case"dbClick":o=e.args.item,i=e.args.originalEvent,n="format-copy";break;case"keyBoard":i=e.args,r=!null,"escape"===(n=e.args.action)&&(this.isSticky=!1,this.isActive=!1);break;case"click":o=e.args.item,i=e.args.originalEvent,n="format-copy";break;case"docClick":i=e,n="format-paste"}this.updateCursor(r);this.updateToolbarBtn("docClick"!==t&&"escape"!==n);t={requestType:"FormatPainter",originalEvent:i,name:n,item:o=j.isNullOrUndefined(o)?{command:"FormatPainter",subCommand:"FormatPainter"}:o};this.parent.formatter.process(this.parent,t,i,{formatPainterAction:n}),this.previousAction=n},oc.prototype.updateCursor=function(e){this.parent.inputElement.classList.contains("e-rte-cursor-brush")||e?this.isSticky||j.removeClass([this.parent.inputElement],"e-rte-cursor-brush"):j.addClass([this.parent.inputElement],"e-rte-cursor-brush")},oc.prototype.updateToolbarBtn=function(e){var t;j.isNullOrUndefined(this.parent.element.querySelector(".e-rte-format-painter"))||(t=this.parent.element.querySelector(".e-rte-format-painter").parentElement.parentElement,e?j.addClass([t],"e-active"):this.isSticky||j.removeClass([t],"e-active"))},oc.prototype.editAreaClick=function(e){this.isActive&&(this.isSticky||(this.isActive=!1),this.actionHandler(e,"docClick"),this.updateToolbarBtn(!1))},oc.prototype.destroy=function(){this.isDestroyed||(this.parent.off(nn,this.toolbarClick),this.parent.off(Xe,this.editAreaClick),this.parent.off(on,this.toolbarDoubleClick),this.parent.off(h,this.onKeyDown),this.parent.off(o,this.destroy),this.parent=null,this.isSticky=null,this.isActive=null,this.previousAction=null,this.isDestroyed=!0)},oc.prototype.getModuleName=function(){return"formatPainter"};var ic=oc;function oc(e){this.isSticky=!1,this.isActive=!1,this.parent=e,this.addEventListener(),this.isDestroyed=!1}sc.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.isDestroyed=!0)},sc.prototype.childDestroy=function(){var e;this.isPopupDestroyed||(this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.element&&this.popupObj.element.querySelector(".e-rte-emoji-search")&&(e=j.getComponent(this.popupObj.element.querySelector(".e-rte-emoji-search"),"textbox"))&&!e.isDestroyed&&e.destroy(),this.popupObj.element&&this.popupObj.element.querySelector(".e-rte-emojipicker-toolbar")&&(e=j.getComponent(this.popupObj.element.querySelector(".e-rte-emojipicker-toolbar"),"toolbar"))&&!e.isDestroyed&&e.destroy(),e=this.popupObj.element.querySelector(".e-clear-icon"),j.isNullOrUndefined(e)||j.EventHandler.remove(e,"mousedown",this.searchFilter),this.popupObj.destroy(),this.isPopupDestroyed=!0),this.popDiv&&(j.EventHandler.remove(this.popDiv,"keydown",this.onKeyDown),j.EventHandler.remove(this.popDiv,"keyup",this.searchFilter),this.popDiv.querySelector(".e-rte-emojipicker-btn"))&&(e=this.popDiv.querySelector(".e-rte-emojipicker-btn"),j.EventHandler.remove(e,"scroll",this.scrollEvent),j.EventHandler.remove(e,"click",this.emojiBtnClick)))},sc.prototype.addEventListener=function(){this.parent.on(rn,this.toolbarClick,this),this.parent.on(lt,this.docClick,this),this.parent.on(h,this.onkeyPress,this),this.parent.on(ne,this.onkeyUp,this),this.parent.on(Je,this.contentscroll,this),this.parent.on(Ye,this.contentscroll,this),this.parent.on(o,this.destroy,this)},sc.prototype.toolbarClick=function(e){var t,n=this,i=(j.isNullOrUndefined(this.parent.element.querySelector(".e-emoji"))?this.parent.inlineMode.enable&&(i=this.parent.element.ownerDocument.querySelector(".e-emoji")):i=this.parent.element.querySelector(".e-emoji"),this.divElement=i.closest("div"),this.parent.inputElement.contains(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).startContainer)||this.parent.contentModule.getEditPanel().focus(),this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())),o=(this.save=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument()),this.clickEvent=e.args,this.parent.emojiPickerSettings.iconsSet);if(this.popupObj){if(j.removeClass([this.divElement],"e-active"),this.popupObj.element.querySelector(".e-rte-emoji-search")||!this.parent.emojiPickerSettings.showSearchBox)return void this.popupObj.hide();this.popupObj.hide()}this.popDiv=this.parent.createElement("div",{className:"e-rte-emojipicker-popup",id:this.parent.getID()+"_emojiPicker"}),j.isNullOrUndefined(this.parent.getToolbar())||this.parent.inlineMode.enable?this.parent.inlineMode.enable&&this.parent.rootContainer.appendChild(this.popDiv):this.parent.getToolbar().parentElement.appendChild(this.popDiv),j.EventHandler.add(this.popDiv,"keydown",this.onKeyDown,this),j.EventHandler.add(this.popDiv,"keyup",this.searchFilter,this);for(var i=this.parent.element.querySelector(".e-toolbar-extended"),r=(i=j.isNullOrUndefined(i)?"10001":window.getComputedStyle(i).getPropertyValue("z-index"),j.isNullOrUndefined(e.args)||this.parent.inlineMode.enable||!j.isNullOrUndefined(this.parent.quickToolbarSettings.text)?j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y)&&!this.parent.inlineMode.enable&&j.isNullOrUndefined(this.parent.quickToolbarSettings.text)?(f=this.parent.inputElement,0<this.parent.contentModule.getDocument().getSelection().rangeCount&&(r=(b=this.getCoordinates()).left,s=b.top)):j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y)&&(this.parent.inlineMode.enable||!j.isNullOrUndefined(this.parent.quickToolbarSettings.text))?(this.parent.notify(an,{}),0<this.parent.contentModule.getDocument().getSelection().rangeCount&&(r=(b=this.getCoordinates()).left,s=b.top)):(f=this.parent.inputElement,r=e.x,s=e.y):(f=(f=e.args.originalEvent.target).classList.contains("e-toolbar-item")?f.firstChild:f.parentElement,r="left",s="bottom"),this.popupObj=new U.Popup(this.popDiv,{targetType:"relative",relateTo:f,collision:{X:"fit",Y:"none"},offsetY:8,viewPortElement:this.parent.element,position:{X:r,Y:s},enableRtl:this.parent.enableRtl,zIndex:parseInt(i,10)+1,actionOnScroll:"hide",close:function(){n.parent.isBlur=!1,n.childDestroy(),j.detach(n.popupObj.element),n.popupObj=null}}),this.isPopupDestroyed=!1,j.addClass([this.popupObj.element],"e-popup-open"),this.popupObj.refreshPosition(f),(!j.isNullOrUndefined(e.args)||j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y))&&this.parent.emojiPickerSettings.showSearchBox&&(b=j.createElement("input",{id:"e-rte-emoji-search",className:"e-rte-emoji-search"}),this.popDiv.append(b),new P.TextBox({placeholder:this.i10n.getConstant("emojiPickerTypeToFind"),showClearButton:!0}).appendTo(b),b.focus()),this.popupObj.element.querySelector(".e-clear-icon")),s=(j.isNullOrUndefined(r)||j.EventHandler.add(r,"mousedown",this.searchFilter,this),this.parent.createElement("div",{className:"e-rte-emojipicker-toolbar"})),a=(this.popDiv.appendChild(s),[]),l=0;l<this.parent.emojiPickerSettings.iconsSet.length;l++)j.isNullOrUndefined(this.parent.emojiPickerSettings.iconsSet[l].iconCss)?a.push({text:"&#x"+this.parent.emojiPickerSettings.iconsSet[l].code+";",htmlAttributes:((t={}).title=this.parent.emojiPickerSettings.iconsSet[l].name,t)}):a.push({prefixIcon:this.parent.emojiPickerSettings.iconsSet[l].iconCss,htmlAttributes:((t={}).title=this.parent.emojiPickerSettings.iconsSet[l].name,t)});new A.Toolbar({items:a,clicked:this.emojiToolbarClick.bind(this)}).appendTo(s);var d=this.parent.createElement("div",{className:"e-rte-emojipicker-btn"}),i=(this.popDiv.appendChild(d),window.getComputedStyle(this.popDiv));r=(!j.isNullOrUndefined(e.args)||j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y))&&this.parent.emojiPickerSettings.showSearchBox?(f=this.parent.element.querySelector(".e-rte-emoji-search").parentElement,b=window.getComputedStyle(f),this.popDiv.getBoundingClientRect().height-s.getBoundingClientRect().height-f.getBoundingClientRect().height-parseFloat(b.marginTop)-parseFloat(b.marginBottom)-2*parseFloat(i.borderWidth)+"px"):this.popDiv.getBoundingClientRect().height-s.getBoundingClientRect().height-2*parseFloat(i.borderWidth)+"px",d.style.setProperty("height",r,"important");for(l=0;l<o.length;l++){var c=this.parent.createElement("div",{className:"e-rte-emojipicker-group"}),h=(d.appendChild(c),this.parent.createElement("div",{className:"e-rte-emojipicker-name"})),p=(h.innerText=this.parent.emojiPickerSettings.iconsSet[l].name,h.setAttribute("aria-label",this.parent.emojiPickerSettings.iconsSet[l].name),c.appendChild(h),this.parent.createElement("div",{className:"e-rte-emojipickerbtn-group"}));c.appendChild(p);for(var u=0;u<o[l].icons.length;u++){var m=this.parent.createElement("button",{className:"e-btn  e-control"});m.innerHTML=this.buttoncode(this.parent.emojiPickerSettings.iconsSet[l].icons[u].code),m.setAttribute("aria-label",this.parent.emojiPickerSettings.iconsSet[l].icons[u].desc),m.setAttribute("title",this.parent.emojiPickerSettings.iconsSet[l].icons[u].desc),p.appendChild(m),2<m.innerHTML.length&&(m.style.fontSize="17px")}}j.EventHandler.add(d,"scroll",this.scrollEvent,this),j.EventHandler.add(d,"click",this.emojiBtnClick,this);var g,f=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),b=(j.isNullOrUndefined(this.parent.element.querySelector(".e-rte-emoji-search"))&&!j.isNullOrUndefined(e.args)&&(f[0].focus(),j.addClass([f[0]],"e-focus")),this.parent.element.querySelector(".e-rte-emojipicker-btn")),s=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button");(g=j.isNullOrUndefined(b)?g:Math.round(b.scrollTop))<s[0].offsetHeight&&j.addClass([s[0]],"e-selected"),this.popupObj&&j.addClass([this.divElement],"e-active")},sc.prototype.buttoncode=function(e){return e.split("-").map(function(e){return String.fromCodePoint(parseInt(e,16))}).join("")},sc.prototype.docClick=function(e){e=e.args.target;e&&e.classList&&this.popupObj&&!j.closest(e,"[id='"+this.popupObj.element.id+"']")&&!e.classList.contains("e-emoji")&&!e.classList.contains("e-toolbar-item")&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide())},sc.prototype.scrollEvent=function(){for(var e,t=this.parent.element.querySelector(".e-rte-emojipicker-btn"),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),i=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button"),o=(j.isNullOrUndefined(t)||(e=Math.round(t.scrollTop)),0),r=0;r<i.length;r++)e<i[0].offsetHeight&&(j.isNullOrUndefined(i[r+1])||j.removeClass([i[r+1]],"e-selected"),j.addClass([i[0]],"e-selected"));for(var s=0;s<n.length;s++)if((o+=Math.round(n[s].offsetHeight))<=e){for(var a=0;a<i.length;a++)i[a].classList.contains("e-selected")&&j.removeClass([i[a]],"e-selected");j.isNullOrUndefined(i[s+1])||j.addClass([i[s+1]],"e-selected")}},sc.prototype.contentscroll=function(){j.isNullOrUndefined(this.clickEvent)&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide())},sc.prototype.emojiToolbarClick=function(e){for(var o={text:e.item.htmlAttributes.title}.text,e=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),t=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button"),i=0;i<n.length;i++)n[i].classList.contains("e-selected")&&j.removeClass([n[i]],"e-selected");for(i=0;i<t.length;i++)t[i].classList.contains("e-focus")&&j.removeClass([t[i]],"e-focus");var r=this.parent.element.querySelector(".e-rte-emojipicker-btn"),s=0;e.forEach(function(e){var t=e.childNodes[0],n=e.childNodes[1].childNodes[0],i=t.getAttribute("aria-label");o===i?t&&(r.scrollTop=s+10,j.addClass([n],"e-focus"),n.focus()):(s+=e.scrollHeight,j.removeClass([n],"e-focus"))})},sc.prototype.onKeyDown=function(e){var t=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),n=this.parent.element.querySelectorAll(".e-rte-emojipickerbtn-group"),i=this.parent.element.querySelector(".e-rte-emojisearch-btn button"),o=(27===e.keyCode&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide()),13===e.keyCode&&document.activeElement.classList.contains("e-btn")&&(this.emojiBtnClick(e),e.preventDefault()),e.srcElement);if(!j.isNullOrUndefined(o)&&o.classList.contains("e-rte-emoji-search")&&40===e.keyCode)for(var r=0;r<t.length;r++)t[r].classList.contains("e-focus")&&j.removeClass([t[r]],"e-focus");if(j.isNullOrUndefined(i))for(r=0;r<t.length;r++){var s=r;if(t[r].classList.contains("e-focus"))if(40===e.keyCode){if(t.length-4>r){for(var a=0,l=0;l<n.length;l++)for(var d=0;d<n[l].childNodes.length;d++)if(n[l].childNodes[d].classList.contains("e-focus")&&1!==a){var c=d,h=n[l].lastChild,p=Math.floor(d%6),u=n[l].childNodes.length-1,u=Math.floor(u%6);if(-1!==c){var m=c+6;if(j.isNullOrUndefined(n[l].childNodes[m])){if(j.isNullOrUndefined(n[l].childNodes[m])&&!h.classList.contains("e-focus")&&u<p){var g=t[r],f=(j.removeClass([g],"e-focus"),n[l].lastChild);j.addClass([f],"e-focus"),f.focus(),a=1;break}var g=t[r],f=(j.removeClass([g],"e-focus"),n[l+1].childNodes[p]);j.addClass([f],"e-focus"),f.focus(),a=1;break}var g=t[r],f=(j.removeClass([g],"e-focus"),t[s+=6]);j.addClass([f],"e-focus"),f.focus();break}}break}}else{if(38===e.keyCode){if(6<=r){for(a=0,l=0;l<n.length;l++)for(d=0;d<n[l].childNodes.length;d++)if(n[l].childNodes[d].classList.contains("e-focus")&&1!==a){var c=d,b=j.isNullOrUndefined(n[l-1])?null:n[l-1].childNodes.length%6||6;if(-1!==c){if(j.isNullOrUndefined(n[l].childNodes[c-6])){if(j.isNullOrUndefined(n[l-1].childNodes[n[l-1].childNodes.length-(b-d)])){g=t[r],f=(j.removeClass([g],"e-focus"),n[l-1].lastChild);j.addClass([f],"e-focus"),f.focus(),a=1;break}g=t[r],f=(j.removeClass([g],"e-focus"),n[l-1].childNodes[n[l-1].childNodes.length-(b-d)]);j.addClass([f],"e-focus"),f.focus(),a=1;break}var g=t[r],f=(j.removeClass([g],"e-focus"),t[s-=6]);j.addClass([f],"e-focus"),f.focus();break}}}else{var g=t[r],f=(j.removeClass([g],"e-focus"),t[--s]),y=this.popupObj.element.querySelector(".e-rte-emoji-search");if(j.isNullOrUndefined(f)&&!j.isNullOrUndefined(y)){y.focus();break}j.addClass([f],"e-focus"),f.focus()}break}if(39===e.keyCode){t.length!==r+1&&(g=t[r],j.removeClass([g],"e-focus"),f=t[s+=1],j.addClass([f],"e-focus"),t[s].focus());break}if(37===e.keyCode){0<r&&(g=t[r],j.removeClass([g],"e-focus"),f=t[--s],j.addClass([f],"e-focus"),t[s].focus());break}}}else this.filterKeyHandler(e);40===e.keyCode&&(g=this.parent.element.querySelector(".e-focus"),j.isNullOrUndefined(g))&&(f=t[0],j.addClass([f],"e-focus"),t[0].focus())},sc.prototype.filterKeyHandler=function(e){var t=this.parent.element.querySelectorAll(".e-rte-emojisearch-btn button"),n=this.parent.element.querySelector(".e-focus");if(j.isNullOrUndefined(n)&&40===e.keyCode){var i=t[0];j.addClass([i],"e-focus"),t[0].focus()}else for(var o=0;o<t.length;o++){var r=o;if(t[o].classList.contains("e-focus"))if(38===e.keyCode){if(6<=o){var s=t[o],i=(j.removeClass([s],"e-focus"),t[r-=6]);j.addClass([i],"e-focus"),i.focus();break}var s=t[o],i=(j.removeClass([s],"e-focus"),t[--r]),a=this.popupObj.element.querySelector(".e-rte-emoji-search");if(j.isNullOrUndefined(i)&&!j.isNullOrUndefined(a)){a.focus();break}j.addClass([i],"e-focus"),i.focus()}else if(40===e.keyCode){if(t.length-6>o){a=t[o],i=(j.removeClass([a],"e-focus"),t[r+=6]);j.addClass([i],"e-focus"),i.focus();break}}else{if(39===e.keyCode){t.length!==o+1&&(l=t[o],j.removeClass([l],"e-focus"),i=t[r+=1],j.addClass([i],"e-focus"),t[r].focus());break}if(37===e.keyCode&&0<o){var l=t[o],i=(j.removeClass([l],"e-focus"),t[--r]);j.addClass([i],"e-focus"),t[r].focus();break}}}},sc.prototype.searchFilter=function(e,t){var n=this.parent.element.querySelector(".e-rte-emoji-search"),i=this.parent.element.querySelector(".e-content");if(document.activeElement===n||document.activeElement===i){for(var i=void 0,o=(":"===t||j.isNullOrUndefined(t)?j.isNullOrUndefined(t)||(i=t):i=t.replace(/^:/,""),j.isNullOrUndefined(n)?i:n.value),i=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),n=this.parent.element.querySelector(".e-rte-emojipicker-btn"),r=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),s=this.parent.element.querySelector(".e-rte-emojipicker-toolbar"),a=this.parent.element.querySelector(".e-rte-emojisearch-btn"),l=this.popDiv.childNodes[0],d=window.getComputedStyle(l),l="SPAN"===l.nodeName?l.getBoundingClientRect().height+parseFloat(d.marginTop)+parseFloat(d.marginBottom):0,d=window.getComputedStyle(this.popDiv),c=j.isNullOrUndefined(a)?i:Array.from(i).filter(function(e){return!a.contains(e)}),h=(""===o||":"===t?(s.style.display="",n.style.height=this.popDiv.getBoundingClientRect().height-s.getBoundingClientRect().height-l-2*parseFloat(d.borderWidth)+"px",r.forEach(function(e){e.style.display=""})):(r.forEach(function(e){e.style.display="none"}),s.style.display="none",n.style.height=this.popDiv.getBoundingClientRect().height-l-2*parseFloat(d.borderWidth)+"px"),this.parent.createElement("div",{className:"e-rte-emojisearch-btn"})),i=this.parent.element.querySelector(".e-rte-emojisearch-btn"),r=(i&&i.remove(),this.parent.createElement("div",{className:"e-rte-emojiSearch-noEmoji"})),p=!0,u=0;u<c.length;u++)if(!j.isNullOrUndefined(c[u].getAttribute("title")))for(var m=c[u].getAttribute("title").toLowerCase().split(" "),g=0;g<m.length;g++)if(m[g].startsWith(o.toLowerCase())&&""!==o){var f=c[u].cloneNode(!0);h.appendChild(f),p=!1;break}p&&!this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")&&""!==o&&":"!==t&&": :"!==t?(r.innerHTML='<span style="color: rgba(0, 0, 0, 0.75); font-weight: 500; font-size: 16px;">'+this.i10n.getConstant("emojiPickerNoResultFound")+'  </span><br><span style="color: rgba(0, 0, 0, 0.75);"> '+this.i10n.getConstant("emojiPickerTrySomethingElse")+" ? </span>",r.style.margin="55px",n.appendChild(r)):(!p&&this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")||""===o&&":"===t||""===o&&this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji"))&&n.removeChild(this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")),n.appendChild(h)}},sc.prototype.emojiBtnClick=function(e){for(var t=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0}),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-popup [data-tooltip-id]"),i=0;i<n.length;i++)n[i].dispatchEvent(t);var o,r=e.target;"BUTTON"===r.tagName&&(r.focus(),o=this.save.startOffset,o=this.save.range.startContainer.textContent.substring(o,o+1),j.isNullOrUndefined(this.clickEvent)&&":"===o||this.save.restore(),this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide()),this.parent.formatter.process(this.parent,{item:{command:"EmojiPicker",subCommand:"EmojiPicker",value:r.innerHTML}},e,e))},sc.prototype.onkeyPress=function(e){var t,n,i,e=e.args,o=(this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow:this.parent.contentModule.getDocument()).getSelection();o.rangeCount<=0||(n=o.getRangeAt(0).startOffset,i=o.focusNode.textContent.substring(n-1,n),i=/\s/.test(i),t=":"===o.focusNode.textContent.substring(n-1,n),n=":"===o.focusNode.textContent.charAt(n-1),186===e.keyCode&&e.shiftKey&&(i||0===o.focusOffset)&&(i=this.getCoordinates(),this.parent.showEmojiPicker(i.left,i.top)),8===e.keyCode&&n&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide()),32===e.keyCode&&t&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),o=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument(),this.parent.showTooltip&&!j.isNullOrUndefined(o.querySelector(".e-tooltip-wrap"))&&this.parent.notify(sn,{args:event}),this.popupObj.hide()),!this.popupObj)||37!==e.keyCode&&38!==e.keyCode&&39!==e.keyCode&&27!==e.keyCode&&40!==e.keyCode||(this.onKeyDown(e),e.preventDefault())},sc.prototype.onkeyUp=function(e){var t=e.args,n=(this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow:this.parent.contentModule.getDocument()).getSelection();if(!(n.rangeCount<=0)){for(var i,o=n.getRangeAt(0),r=o.startOffset,s=0,a=r-1;r-15<=a;a--){var l=n.focusNode.textContent.substring(a-1,a);/:$/.test(l)&&!j.isNullOrUndefined(this.popDiv)&&0===s&&(i=o.startContainer.textContent.substring(a-1,r),this.searchFilter(t,i),s=1)}e=n.focusNode.textContent.substring(r-1,r);":"!==e||j.isNullOrUndefined(this.popupObj)||this.searchFilter(t,i=e)}},sc.prototype.getCoordinates=function(){var e,t=(this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow:window).getSelection().getRangeAt(0),t=("P"!==t.startContainer.nodeName&&"DIV"!==t.startContainer.nodeName||"#text"!==t.startContainer.childNodes[0].nodeName&&(n=t.startContainer.childNodes[0]),(j.isNullOrUndefined(n)?t:n).getBoundingClientRect()),n=this.parent.element.querySelector(".e-rte-content"),i=this.parent.element,o=i.offsetHeight-n.offsetHeight,r=t.top-this.parent.inputElement.getBoundingClientRect().top,s=t.left-this.parent.inputElement.getBoundingClientRect().left,a=window.innerHeight,s=s+t.width;return i.getBoundingClientRect().top<0&&!this.parent.inlineMode.enable&&(r=r+n.getBoundingClientRect().top-o),t.top<330||t.top+330>a&&(r-=350),e=this.parent.inputElement?{top:r+60,left:s+8}:e},sc.prototype.removeEventListener=function(){this.parent.off(rn,this.toolbarClick),this.parent.off(lt,this.docClick),this.parent.off(h,this.onkeyPress),this.parent.off(ne,this.onkeyUp),this.parent.off(Je,this.contentscroll),this.parent.off(Ye,this.contentscroll),this.parent.off(o,this.destroy)},sc.prototype.getModuleName=function(){return"emojiPicker"};var rc=sc;function sc(e,t){this.parent=e,this.locator=t,this.i10n=t.getService("rteLocale"),this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1,this.isPopupDestroyed=!1}lc.prototype.addEventListener=function(){this.parent.on(ie,this.onImport,this),this.parent.on(oe,this.onExport,this),this.parent.on(o,this.destroy,this)},lc.prototype.onImport=function(){var t=this,e=(this.uploaderObj=new P.Uploader({allowedExtensions:".doc,.docx,.rtf,.dot,.dotx,.docm,.dotm",asyncSettings:{saveUrl:this.parent.importWord.serviceUrl},success:function(e){t.parent.executeCommand("insertHTML",e.e.currentTarget.response,{undo:!0})}}),this.parent.setProperties({enableXhtml:!0},!0),this.parent.createElement("div",{className:"e-import-uploadwrap e-droparea"+this.parent.getCssClass(!0)})),n=this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"},className:this.parent.getCssClass()});e.appendChild(n),this.uploaderObj.appendTo(n),this.uploaderObj.element.click(),this.uploaderObj.element.closest(".e-upload").style.display="none"},lc.prototype.onExport=function(i){var t,n,e,o=this,r=(this.parent.setProperties({enableXhtml:!0},!0),this.parent.getHtml()),r=("ExportWord"===i.member?(t=this.parent.exportWord.fileName,n=this.parent.exportWord.serviceUrl,e="<html><head><style>"+this.parent.exportWord.stylesheet+"</style></head><body>"+r+"</body></html>"):"ExportPdf"===i.member&&(t=this.parent.exportPdf.fileName,n=this.parent.exportPdf.serviceUrl,e="<html><head><style>"+this.parent.exportPdf.stylesheet+"</style></head><body>"+r+"</body></html>"),{requestType:i.member,exportValue:e,cancel:!1});this.parent.trigger(Oe,r,function(e){e.cancel||fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e.exportValue})}).then(function(e){if(e.ok)return e.blob().then(function(e){return{blob:e,filename:t}});throw new Error("HTTP error! Status: "+e.status)}).then(function(e){var t=e.blob,e=e.filename,t=window.URL.createObjectURL(t),n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t),o.parent.trigger(Le,{requestType:i.member})}).catch(function(e){console.error("Fetch error:",e)})})},lc.prototype.destroy=function(){this.parent.isDestroyed||(this.parent.off(ie,this.onImport),this.parent.off(oe,this.onExport),this.parent.off(o,this.destroy),this.uploaderObj&&!this.uploaderObj.isDestroyed&&(this.uploaderObj.destroy(),this.uploaderObj=null))},lc.prototype.getModuleName=function(){return"importExport"};var ac=lc;function lc(e){this.parent=e,this.addEventListener()}var dc={bold:{command:"Style",subCommand:"Bold",value:"strong"},italic:{command:"Style",subCommand:"Italic",value:"em"},underline:{command:"Style",subCommand:"Underline",value:"span"},strikeThrough:{command:"Style",subCommand:"StrikeThrough",value:"span"},insertCode:{command:"Formats",subCommand:"Pre",value:"pre"},superscript:{command:"Effects",subCommand:"SuperScript",value:"sup"},subscript:{command:"Effects",subCommand:"SubScript",value:"sub"},uppercase:{command:"Casing",subCommand:"UpperCase"},lowercase:{command:"Casing",subCommand:"LowerCase"},fontColor:{command:"font",subCommand:"fontcolor",value:"#ff0000"},fontName:{command:"font",subCommand:"fontname",value:"Segoe UI"},fontSize:{command:"font",subCommand:"fontsize",value:"10pt"},backColor:{command:"font",subCommand:"backgroundcolor",value:"#ffff00"},justifyCenter:{command:"Alignments",subCommand:"JustifyCenter"},justifyFull:{command:"Alignments",subCommand:"JustifyFull"},justifyLeft:{command:"Alignments",subCommand:"JustifyLeft"},justifyRight:{command:"Alignments",subCommand:"JustifyRight"},undo:{command:"Actions",subCommand:"Undo"},redo:{command:"Actions",subCommand:"Redo"},createLink:{command:"Links",subCommand:"createLink"},editLink:{command:"Links",subCommand:"createLink"},createImage:{command:"Images",subCommand:"Images"},formatBlock:{command:"Formats",value:"P"},heading:{command:"Formats",value:"H1"},indent:{command:"Indents",subCommand:"Indent"},outdent:{command:"Indents",subCommand:"Outdent"},insertHTML:{command:"InsertHTML",subCommand:"InsertHTML",value:""},insertText:{command:"InsertText",subCommand:"InsertText",value:""},insertHorizontalRule:{command:"InsertHTML",subCommand:"InsertHTML",value:"<hr/>"},insertImage:{command:"Images",subCommand:"Image"},insertAudio:{command:"Audios",subCommand:"Audio"},insertVideo:{command:"Videos",subCommand:"Video"},editImage:{command:"Images",subCommand:"Image"},insertTable:{command:"Table",subCommand:"CreateTable"},insertBrOnReturn:{command:"InsertHTML",subCommand:"InsertHTML",value:"<br/>"},insertOrderedList:{command:"Lists",value:"OL"},insertUnorderedList:{command:"Lists",value:"UL"},insertParagraph:{command:"Formats",value:"P"},removeFormat:{command:"Clear",subCommand:"ClearFormat"},copyFormatPainter:{command:"FormatPainter",value:"format-copy"},applyFormatPainter:{command:"FormatPainter",value:"format-paste"},escapeFormatPainter:{command:"FormatPainter",value:"escape"},InlineCode:{command:"Style",subCommand:"inlinecode",value:"inlinecode"}},cc=(hc.prototype.register=function(e,t){j.isNullOrUndefined(this.services[""+e])&&(this.services[""+e]=t)},hc.prototype.getService=function(e){if(j.isNullOrUndefined(this.services[""+e]))throw"The service "+e+" is not registered";return this.services[""+e]},hc.prototype.destroy=function(){this.services={}},hc);function hc(){this.services={}}uc.prototype.addRenderer=function(e,t){e=j.getEnumValue(c.RenderType,e);j.isNullOrUndefined(this.rendererMap[""+e])&&(this.rendererMap[""+e]=t)},uc.prototype.getRenderer=function(e){e=j.getEnumValue(c.RenderType,e);if(j.isNullOrUndefined(this.rendererMap[""+e]))throw"The renderer "+e+" is not found";return this.rendererMap[""+e]},uc.prototype.destroy=function(){this.rendererMap={}};var pc=uc;function uc(){this.rendererMap={}}mc=function(e,t){return(mc=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var mc,gc,fc=function(e,t){function n(){this.constructor=e}mc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},M=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},e=(gc=j.ChildProperty,fc(bc,gc),M([j.Property(!0)],bc.prototype,"enable",void 0),M([j.Property(!0)],bc.prototype,"enableFloating",void 0),M([j.Property(c.ToolbarType.Expand)],bc.prototype,"type",void 0),M([j.Property(e)],bc.prototype,"items",void 0),M([j.Property({})],bc.prototype,"itemConfigs",void 0),bc);function bc(){return null!==gc&&gc.apply(this,arguments)||this}yc=j.ChildProperty,fc(Cc,yc),M([j.Property(null)],Cc.prototype,"serviceUrl",void 0);var yc,vc=Cc;function Cc(){return null!==yc&&yc.apply(this,arguments)||this}Nc=j.ChildProperty,fc(Sc,Nc),M([j.Property(null)],Sc.prototype,"serviceUrl",void 0),M([j.Property("Sample.docx")],Sc.prototype,"fileName",void 0),M([j.Property(null)],Sc.prototype,"stylesheet",void 0);var Nc,Ec=Sc;function Sc(){return null!==Nc&&Nc.apply(this,arguments)||this}Tc=j.ChildProperty,fc(Lc,Tc),M([j.Property(null)],Lc.prototype,"serviceUrl",void 0),M([j.Property("Sample.pdf")],Lc.prototype,"fileName",void 0),M([j.Property(null)],Lc.prototype,"stylesheet",void 0);var Tc,Oc=Lc;function Lc(){return null!==Tc&&Tc.apply(this,arguments)||this}wc=j.ChildProperty,fc(xc,wc),M([j.Property([".jpeg",".jpg",".png"])],xc.prototype,"allowedTypes",void 0),M([j.Property("inline")],xc.prototype,"display",void 0),M([j.Property("Blob")],xc.prototype,"saveFormat",void 0),M([j.Property("auto")],xc.prototype,"width",void 0),M([j.Property("auto")],xc.prototype,"height",void 0),M([j.Property(null)],xc.prototype,"saveUrl",void 0),M([j.Property(null)],xc.prototype,"path",void 0),M([j.Property(!0)],xc.prototype,"resize",void 0),M([j.Property(null)],xc.prototype,"removeUrl",void 0),M([j.Property(0)],xc.prototype,"minWidth",void 0),M([j.Property(null)],xc.prototype,"maxWidth",void 0),M([j.Property(0)],xc.prototype,"minHeight",void 0),M([j.Property(null)],xc.prototype,"maxHeight",void 0),M([j.Property(!1)],xc.prototype,"resizeByPercent",void 0);var wc,kc=xc;function xc(){return null!==wc&&wc.apply(this,arguments)||this}Dc=j.ChildProperty,fc(Bc,Dc),M([j.Property([".wav",".mp3",".m4a",".wma"])],Bc.prototype,"allowedTypes",void 0),M([j.Property("Inline")],Bc.prototype,"layoutOption",void 0),M([j.Property("Blob")],Bc.prototype,"saveFormat",void 0),M([j.Property(null)],Bc.prototype,"saveUrl",void 0),M([j.Property(null)],Bc.prototype,"removeUrl",void 0),M([j.Property(null)],Bc.prototype,"path",void 0);var Dc,Mc=Bc;function Bc(){return null!==Dc&&Dc.apply(this,arguments)||this}Rc=j.ChildProperty,fc(Ic,Rc),M([j.Property([".mp4",".mov",".wmv",".avi"])],Ic.prototype,"allowedTypes",void 0),M([j.Property("Inline")],Ic.prototype,"layoutOption",void 0),M([j.Property("Blob")],Ic.prototype,"saveFormat",void 0),M([j.Property("auto")],Ic.prototype,"width",void 0),M([j.Property("auto")],Ic.prototype,"height",void 0),M([j.Property(null)],Ic.prototype,"saveUrl",void 0),M([j.Property(null)],Ic.prototype,"path",void 0),M([j.Property(!0)],Ic.prototype,"resize",void 0),M([j.Property(null)],Ic.prototype,"removeUrl",void 0),M([j.Property(0)],Ic.prototype,"minWidth",void 0),M([j.Property(null)],Ic.prototype,"maxWidth",void 0),M([j.Property(0)],Ic.prototype,"minHeight",void 0),M([j.Property(null)],Ic.prototype,"maxHeight",void 0),M([j.Property(!1)],Ic.prototype,"resizeByPercent",void 0);var Rc,Ac=Ic;function Ic(){return null!==Rc&&Rc.apply(this,arguments)||this}Uc=j.ChildProperty,fc(Hc,Uc),M([j.Event()],Hc.prototype,"beforeSend",void 0),M([j.Complex({getImageUrl:null,url:null,uploadUrl:null},z.AjaxSettings)],Hc.prototype,"ajaxSettings",void 0),M([j.Property(!1)],Hc.prototype,"allowDragAndDrop",void 0),M([j.Complex({visible:!0,file:["Open","|","Cut","Copy","|","Delete","Rename","|","Details"],folder:["Open","|","Cut","Copy","Paste","|","Delete","Rename","|","Details"],layout:["SortBy","View","Refresh","|","Paste","|","NewFolder","Upload","|","Details","|","SelectAll"]},z.ContextMenuSettings)],Hc.prototype,"contextMenuSettings",void 0),M([j.Property("")],Hc.prototype,"cssClass",void 0),M([j.Complex({},z.DetailsViewSettings)],Hc.prototype,"detailsViewSettings",void 0),M([j.Property(!1)],Hc.prototype,"enable",void 0),M([j.Complex({maxWidth:"650px",minWidth:"240px",visible:!0},z.NavigationPaneSettings)],Hc.prototype,"navigationPaneSettings",void 0),M([j.Property("/")],Hc.prototype,"path",void 0),M([j.Property(null)],Hc.prototype,"rootAliasName",void 0),M([j.Complex({},z.SearchSettings)],Hc.prototype,"searchSettings",void 0),M([j.Property(!0)],Hc.prototype,"showFileExtension",void 0),M([j.Property(!1)],Hc.prototype,"showHiddenItems",void 0),M([j.Property(!0)],Hc.prototype,"showThumbnail",void 0),M([j.Property("Ascending")],Hc.prototype,"sortOrder",void 0),M([j.Complex({visible:!0,items:["NewFolder","Upload","Cut","Copy","Paste","Delete","Download","Rename","SortBy","Refresh","Selection","View","Details"]},z.ToolbarSettings)],Hc.prototype,"toolbarSettings",void 0),M([j.Complex({autoUpload:!0,minFileSize:0,maxFileSize:3e7,allowedExtensions:"",autoClose:!1},z.UploadSettings)],Hc.prototype,"uploadSettings",void 0),M([j.Property("LargeIcons")],Hc.prototype,"view",void 0);var Uc,Pc=Hc;function Hc(){return null!==Uc&&Uc.apply(this,arguments)||this}jc=j.ChildProperty,fc(qc,jc),M([j.Property("100%")],qc.prototype,"width",void 0),M([j.Property(Xo)],qc.prototype,"styles",void 0),M([j.Property(!0)],qc.prototype,"resize",void 0),M([j.Property(0)],qc.prototype,"minWidth",void 0),M([j.Property(null)],qc.prototype,"maxWidth",void 0);var jc,Fc=qc;function qc(){return null!==jc&&jc.apply(this,arguments)||this}zc=j.ChildProperty,fc(Vc,zc),M([j.Property(!0)],Vc.prototype,"enable",void 0),M([j.Property(!1)],Vc.prototype,"showOnRightClick",void 0),M([j.Property("hide")],Vc.prototype,"actionOnScroll",void 0),M([j.Property(["Open","Edit","UnLink"])],Vc.prototype,"link",void 0),M([j.Property(["Replace","Align","Caption","Remove","-","InsertLink","OpenImageLink","EditImageLink","RemoveImageLink","Display","AltText","Dimension"])],Vc.prototype,"image",void 0),M([j.Property(["AudioReplace","AudioRemove","AudioLayoutOption"])],Vc.prototype,"audio",void 0),M([j.Property(["VideoReplace","VideoAlign","VideoRemove","VideoLayoutOption","VideoDimension"])],Vc.prototype,"video",void 0),M([j.Property(null)],Vc.prototype,"text",void 0),M([j.Property(["TableHeader","TableRows","TableColumns","BackgroundColor","-","TableRemove","Alignments","TableCellVerticalAlign","Styles"])],Vc.prototype,"table",void 0);var zc,_c=Vc;function Vc(){return null!==zc&&zc.apply(this,arguments)||this}Qc=j.ChildProperty,fc(Kc,Qc),M([j.Property("b; em; font; sub; sup; kbd; i; s; u; code; strong; span; p; div; h1; h2; h3; h4; h5; h6; blockquote; ol; ul; li; pre;")],Kc.prototype,"allowedFormats",void 0),M([j.Property(null)],Kc.prototype,"deniedFormats",void 0);var Qc,Wc=Kc;function Kc(){return null!==Qc&&Qc.apply(this,arguments)||this}Gc=j.ChildProperty,fc(Xc,Gc),M([j.Property(rr)],Xc.prototype,"iconsSet",void 0),M([j.Property(!0)],Xc.prototype,"showSearchBox",void 0);var Gc,rr=Xc;function Xc(){return null!==Gc&&Gc.apply(this,arguments)||this}Yc=j.ChildProperty,fc($c,Yc),M([j.Property(!1)],$c.prototype,"prompt",void 0),M([j.Property(null)],$c.prototype,"deniedAttrs",void 0),M([j.Property(["background","background-color","border","border-bottom","border-left","border-radius","border-right","border-style","border-top","border-width","clear","color","cursor","direction","display","float","font","font-family","font-size","font-weight","font-style","height","left","line-height","list-style-type","margin","margin-top","margin-left","margin-right","margin-bottom","max-height","max-width","min-height","min-width","overflow","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","position","right","table-layout","text-align","text-decoration","text-transform","text-indent","top","vertical-align","visibility","white-space","width"])],$c.prototype,"allowedStyleProps",void 0),M([j.Property(null)],$c.prototype,"deniedTags",void 0),M([j.Property(!0)],$c.prototype,"keepFormat",void 0),M([j.Property(!1)],$c.prototype,"plainText",void 0);var Yc,Jc=$c;function $c(){return null!==Yc&&Yc.apply(this,arguments)||this}Zc=j.ChildProperty,fc(th,Zc),M([j.Property(null)],th.prototype,"default",void 0),M([j.Property("72px")],th.prototype,"width",void 0),M([j.Property(Yo)],th.prototype,"items",void 0);var Zc,eh=th;function th(){return null!==Zc&&Zc.apply(this,arguments)||this}nh=j.ChildProperty,fc(ih,nh),M([j.Property(null)],ih.prototype,"default",void 0),M([j.Property("60px")],ih.prototype,"width",void 0),M([j.Property(Jo)],ih.prototype,"items",void 0);var nh,Jo=ih;function ih(){return null!==nh&&nh.apply(this,arguments)||this}oh=j.ChildProperty,fc(sh,oh),M([j.Property(null)],sh.prototype,"default",void 0),M([j.Property("65px")],sh.prototype,"width",void 0),M([j.Property($o)],sh.prototype,"types",void 0);var oh,rh=sh;function sh(){return null!==oh&&oh.apply(this,arguments)||this}ah=j.ChildProperty,fc(lh,ah),M([j.Property("#ff0000")],lh.prototype,"default",void 0),M([j.Property("Palette")],lh.prototype,"mode",void 0),M([j.Property(10)],lh.prototype,"columns",void 0),M([j.Property(Zo)],lh.prototype,"colorCode",void 0),M([j.Property(!1)],lh.prototype,"modeSwitcher",void 0);var ah,Zo=lh;function lh(){return null!==ah&&ah.apply(this,arguments)||this}dh=j.ChildProperty,fc(ch,dh),M([j.Property("#ffff00")],ch.prototype,"default",void 0),M([j.Property("Palette")],ch.prototype,"mode",void 0),M([j.Property(10)],ch.prototype,"columns",void 0),M([j.Property(er)],ch.prototype,"colorCode",void 0),M([j.Property(!1)],ch.prototype,"modeSwitcher",void 0);var dh,er=ch;function ch(){return null!==dh&&dh.apply(this,arguments)||this}hh=j.ChildProperty,fc(uh,hh),M([j.Property(tr)],uh.prototype,"types",void 0);var hh,ph=uh;function uh(){return null!==hh&&hh.apply(this,arguments)||this}mh=j.ChildProperty,fc(gh,mh),M([j.Property(nr)],gh.prototype,"types",void 0);var mh,fc=gh;function gh(){return null!==mh&&mh.apply(this,arguments)||this}fh=function(e,t){return(fh=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var fh,bh,M=function(e,t){function n(){this.constructor=e}fh(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},yh=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},vh=(bh=j.ChildProperty,M(Ch,bh),yh([j.Property([])],Ch.prototype,"styles",void 0),yh([j.Property([])],Ch.prototype,"scripts",void 0),Ch);function Ch(){return null!==bh&&bh.apply(this,arguments)||this}Nh=j.ChildProperty,M(Eh,Nh),yh([j.Property(!1)],Eh.prototype,"enable",void 0),yh([j.Property(null)],Eh.prototype,"attributes",void 0),yh([j.Complex({},vh)],Eh.prototype,"resources",void 0),yh([j.Property([])],Eh.prototype,"metaTags",void 0),yh([j.Property(null)],Eh.prototype,"sandbox",void 0);var Nh,M=Eh;function Eh(){return null!==Nh&&Nh.apply(this,arguments)||this}Sh=function(e,t){return(Sh=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Sh,Th,vh=function(e,t){function n(){this.constructor=e}Sh(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},yh=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},vh=(Th=j.ChildProperty,vh(Oh,Th),yh([j.Property(!1)],Oh.prototype,"enable",void 0),yh([j.Property(!0)],Oh.prototype,"onSelection",void 0),Oh);function Oh(){return null!==Th&&Th.apply(this,arguments)||this}wh.prototype.addEventListener=function(){this.parent.on(ut,this.enterHandler,this),this.parent.on(o,this.destroy,this)},wh.prototype.destroy=function(){j.isNullOrUndefined(this.parent)||this.removeEventListener()},wh.prototype.removeEventListener=function(){this.parent.off(ut,this.enterHandler),this.parent.off(o,this.destroy)},wh.prototype.getRangeNode=function(){this.range=this.parent.getRange(),this.startNode="#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement:this.range.startContainer,this.endNode="#text"===this.range.endContainer.nodeName?this.range.endContainer.parentElement:this.range.endContainer},wh.prototype.enterHandler=function(b){var y=this,v=(this.getRangeNode(),!0),e=(this.formatTags=["h1","h2","h3","h4","h5","h6","blockquote"],this.processedTableImageCursor());if(!e.start&&!e.end||"TABLE"!==e.startName&&"TABLE"!==e.endName)if(!e.start&&!e.end&&"IMG"!==this.range.startContainer.nodeName||"BR"!==this.parent.enterKey||"IMG"!==e.startName&&"IMG"!==e.endName&&"IMG"!==this.range.startContainer.nodeName){if(!j.isNullOrUndefined(this.startNode.closest("TABLE"))&&!j.isNullOrUndefined(this.endNode.closest("TABLE"))){for(var v=!1,t=this.startNode,n=t;!this.parent.formatter.editorManager.domNode.isBlockNode(t);)n=t=t.parentElement;v="TH"!==n.tagName&&"TD"!==n.tagName&&"TBODY"!==n.tagName}var C,i=b.args;13!==i.which||i.ctrlKey||(j.Browser.isDevice?"Enter"!==i.key:"Enter"!==i.code&&"NumpadEnter"!==i.code)||j.isNullOrUndefined(this.startNode.closest("LI, UL, OL"))&&j.isNullOrUndefined(this.endNode.closest("LI, UL, OL"))&&j.isNullOrUndefined(this.startNode.closest(".e-img-inner"))&&v&&j.isNullOrUndefined(this.startNode.closest("PRE"))&&j.isNullOrUndefined(this.endNode.closest("PRE"))&&j.isNullOrUndefined(this.startNode.closest("BLOCKQUOTE"))&&j.isNullOrUndefined(this.endNode.closest("BLOCKQUOTE"))&&(C=b.args.shiftKey,i={cancel:!1,name:Oe,requestType:C?"ShiftEnterAction":"EnterAction",originalEvent:b.args},this.parent.trigger(Oe,i,function(e){if(!e.cancel){if(0===y.parent.formatter.getUndoRedoStack().length&&y.parent.formatter.saveData(),y.range.startOffset!==y.range.endOffset||y.range.startContainer!==y.range.endContainer)if("SPAN"===y.range.startContainer.nodeName&&(y.range.startContainer.classList.contains("e-video-wrap")||y.range.startContainer.classList.contains("e-audio-wrap"))||y.range.deleteContents(),"#text"===y.range.startContainer.nodeName&&0===y.range.startContainer.textContent.length&&y.range.startContainer.parentElement!==y.parent.inputElement)"BR"===y.parent.enterKey?y.range.startContainer.parentElement.innerHTML="&#8203;":y.range.startContainer.parentElement.innerHTML="<br>";else if(y.range.startContainer===y.parent.inputElement&&""===y.range.startContainer.innerHTML){y.range.startContainer.innerHTML="<br>";var t=y.range.startContainer.childNodes[y.range.startOffset];y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),t,0)}else if(y.parent.inputElement===y.range.startContainer){if("#text"===(t=y.range.startContainer.childNodes[y.range.startOffset]).nodeName&&0===t.textContent.length)y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),t,0===t.textContent.length?0:t.previousSibling.textContent.length);else if(y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),t,0<=t.textContent.length?0:1),0===t.previousSibling.textContent.length){if(j.detach(t.previousSibling),!C){for(var n=j.isNullOrUndefined(t.lastChild)?t:t.lastChild;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName&&"BR"!==n.nodeName;)n=n.lastChild;"BR"!==n.nodeName&&0===n.parentElement.textContent.length&&0===n.parentElement.innerHTML.length&&"BR"!==n.parentElement.nodeName&&n.parentElement.appendChild(y.parent.createElement("BR")),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),"BR"===n.nodeName?n:n.parentElement,0<=n.parentElement.textContent.length||"BR"===n.nodeName?0:1)}}else if(0===t.textContent.length){for(n="#text"===t.previousSibling.nodeName?t.previousSibling:t.previousSibling.lastChild;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName;)n=n.lastChild;y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),n,n.textContent.length),j.detach(t)}else if("BR"!==y.parent.enterKey&&0!==t.previousSibling.textContent.length&&0!==t.textContent.length)return void b.args.preventDefault();y.getRangeNode()}if(y.range.startContainer===y.range.endContainer&&y.range.startOffset===y.range.endOffset&&y.range.startContainer===y.parent.inputElement){if(1!==y.parent.inputElement.childNodes.length||"TABLE"!==y.parent.inputElement.childNodes[0].nodeName)if(j.isNullOrUndefined(y.range.startContainer.childNodes[y.range.startOffset])){for(var i=y.range.startContainer.childNodes[y.range.startOffset-1];null!==i.lastChild&&"#text"!==i.nodeName;)i=i.lastChild;y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),i,"BR"===i.nodeName?0:i.textContent.length)}else y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),y.range.startContainer.childNodes[y.range.startOffset],0);y.getRangeNode()}if("P"===y.parent.enterKey&&!C||"DIV"===y.parent.enterKey&&!C||"P"===y.parent.shiftEnterKey&&C||"DIV"===y.parent.shiftEnterKey&&C){if(1===y.range.startOffset&&1===y.parent.inputElement.childNodes.length&&"TABLE"===y.parent.inputElement.childNodes[0].nodeName||"BR"===y.parent.enterKey&&C)(a=y.createInsertElement(C)).appendChild(y.parent.createElement("BR")),y.parent.inputElement.appendChild(a),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),a,0);else{var e=void 0,e=v&&y.parent.formatter.editorManager.domNode.isBlockNode(y.startNode)?y.startNode:y.parent.formatter.editorManager.domNode.blockParentNode(y.startNode),o=!1,r=!1,s=(0===y.range.startOffset||0===y.range.endOffset||y.range.startContainer!==y.range.endContainer||!j.isNullOrUndefined(e.childNodes[0])&&("IMG"===e.childNodes[0].nodeName||0<e.querySelectorAll("img, audio, video").length)?0===y.range.startOffset&&0===y.range.endOffset&&(r=!0):160!==(s=y.range.startContainer.textContent.substring(0,y.range.startOffset)).charCodeAt(y.range.startOffset-1)&&0===s.trim().length&&(r=!0),y.removeBRElement(e),-1!==j.Browser.userAgent.indexOf("Firefox")&&0===y.range.startOffset&&y.range.startContainer===y.range.endContainer&&"#text"===y.range.startContainer.nodeName&&!y.parent.formatter.editorManager.domNode.isBlockNode(y.range.startContainer.previousSibling)&&y.range.startContainer.parentElement===y.range.startContainer.previousSibling.parentElement);if(!("#text"===y.range.startContainer.nodeName&&y.range.startContainer.textContent.includes("")&&""===y.range.startContainer.textContent.trim()||"#text"===y.range.startContainer.nodeName&&!j.isNullOrUndefined(y.range.startContainer.textContent[y.range.startOffset])&&y.range.startContainer.textContent[y.range.startOffset].includes("")&&""===y.range.startContainer.textContent[y.range.startOffset]&&""!==y.parent.inputElement.textContent[0])&&!s&&(0===y.range.startOffset&&0===y.range.endOffset||r)&&(j.isNullOrUndefined(y.range.startContainer.previousSibling)||"IMG"!==y.range.startContainer.previousSibling.nodeName&&"BR"!==y.range.startContainer.previousSibling.nodeName)){var s=void 0,a=void 0,s=j.isNullOrUndefined(y.range.startContainer.childNodes)||0!==y.range.startContainer.textContent.length&&("#text"===y.range.startContainer.nodeName||j.isNullOrUndefined(y.range.startContainer.querySelector(".e-video-clickelem"))||0!==y.range.startContainer.querySelector(".e-video-clickelem").textContent.length)||!(0<y.range.startContainer.querySelectorAll("img, audio, video").length)&&j.isNullOrUndefined(y.range.startContainer.querySelector(".e-video-clickelem"))&&"IMG"!==y.range.startContainer.nodeName&&"TABLE"!==y.range.startContainer.nodeName?0!==e.textContent.trim().length||"IMG"===e.childNodes[0].nodeName||""===e.textContent.trim()&&0<e.querySelectorAll("img, audio, video").length?(y.range.startOffset===y.range.endOffset&&0!==y.range.startOffset?a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,e,!1).cloneNode(!0):(a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,e,!0).cloneNode(!0),o=!0),!1):(a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,e,!0).cloneNode(!0),!0):(a=y.createInsertElement(C),!(o=!0)),l=void 0;for(l=y.formatTags.indexOf(a.nodeName.toLocaleLowerCase())<0?y.createInsertElement(C):y.parent.createElement(a.nodeName);a.firstChild;)l.appendChild(a.firstChild);if(e.parentElement.insertBefore(l,e),!s){var n=l,d=void 0;if(y.range.startOffset===y.range.endOffset&&0!==y.range.startOffset)for(;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName&&"BR"!==n.nodeName;)n=(d=n).lastChild;else d=n;d.innerHTML="<br>",o||j.detach(e)}y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),l.nextElementSibling,0)}else if(0!==e.textContent.length||(!j.isNullOrUndefined(e.childNodes[0])&&"IMG"===e.childNodes[0].nodeName||0<e.querySelectorAll("video").length||0<e.querySelectorAll("audio").length||0<e.querySelectorAll("img").length))if(y.range.startContainer===y.range.endContainer&&"SPAN"===y.range.startContainer.nodeName&&(y.range.startContainer.classList.contains("e-video-wrap")||y.range.startContainer.classList.contains("e-audio-wrap"))){if(0<e.textContent.trim().length){for(var a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,e,!0),r=j.isNullOrUndefined(a.previousSibling.querySelector(".e-video-wrap"))?a.previousSibling.querySelector(".e-audio-wrap"):a.previousSibling.querySelector(".e-video-wrap"),s=!1,c=r.previousSibling;!j.isNullOrUndefined(c)&&"#text"!==c.nodeName;)c=c.lastChild;j.isNullOrUndefined(c)&&(h=y.parent.createElement("br"),r.parentElement.appendChild(h),s=!0),s?y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),r.parentElement,0):y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),c,c.textContent.length),j.detach(r)}else{for(t=(a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,e,!0)).previousSibling;!j.isNullOrUndefined(t.firstChild);)j.detach(t.firstChild);var h=y.parent.createElement("br");t.appendChild(h),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),t,0)}j.isNullOrUndefined(y.parent.audioModule)||y.parent.audioModule.hideAudioQuickToolbar(),j.isNullOrUndefined(y.parent.videoModule)||y.parent.videoModule.hideVideoQuickToolbar()}else{a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,e,!0);if(j.isNullOrUndefined(a.childNodes[0])||"#text"!==a.childNodes[0].nodeName||0!==a.childNodes[0].textContent.length||j.detach(a.childNodes[0]),(0===a.textContent.trim().length||a.childNodes[0].textContent.trim().includes("")&&""===a.childNodes[0].textContent.trim())&&(h=y.parent.createElement("br"),"A"===y.startNode.nodeName?(o=y.startNode.parentElement,y.startNode.parentElement.insertBefore(h,y.startNode),j.detach(y.startNode),y.startNode=o):"BR"!==y.startNode.nodeName&&y.startNode.appendChild(h),"\n"===a.childNodes[0].textContent&&j.detach(a.childNodes[0]),a.childNodes[0].textContent.trim().includes("")&&""===a.childNodes[0].textContent.trim()&&j.detach(a.childNodes[0]),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),y.startNode,0)),("P"===y.parent.enterKey||"DIV"===y.parent.enterKey)&&!C||("DIV"===y.parent.shiftEnterKey||"P"===y.parent.shiftEnterKey)&&C){s=y.formatTags.indexOf(a.nodeName.toLocaleLowerCase());if(s<0||0<=s&&0===a.textContent.trim().length){for(var p=y.createInsertElement(C);a.firstChild;)p.appendChild(a.firstChild);y.parent.formatter.editorManager.domNode.insertAfter(p,a),j.detach(a),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),y.parent.formatter.editorManager.domNode.isBlockNode(y.startNode)?p:y.startNode,0)}}}else j.isNullOrUndefined(e.children[0])||"BR"===e.children[0].tagName?((l=y.createInsertElement(C)).innerHTML="<br>",y.parent.formatter.editorManager.domNode.insertAfter(l,e),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),l,0)):(a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,e,!1).cloneNode(!0),y.parent.formatter.editorManager.domNode.insertAfter(a,e),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),a,0<=a.textContent.length?0:1))}b.args.preventDefault()}if("BR"===y.parent.enterKey&&!C||"BR"===y.parent.shiftEnterKey&&C){r=void 0;if(y.parent.formatter.editorManager.domNode.isBlockNode(y.startNode))r=y.startNode;else{for(var u=y.startNode,m=u;!y.parent.formatter.editorManager.domNode.isBlockNode(u);)u=(m=u).parentElement;r=u===y.parent.inputElement?m:u}for(var o=window.getComputedStyle(r),g=(y.removeBRElement(r),r.lastChild);!j.isNullOrUndefined(g)&&"#text"!==g.nodeName&&"BR"!==g.nodeName&&"IMG"!==g.nodeName;)g=g.lastChild;h=(y.range.startContainer===g?y.range.startContainer:r).textContent.length,s="IMG"===y.range.startContainer.nodeName||0<y.range.startContainer.childNodes.length&&"IMG"===y.range.startContainer.childNodes[y.range.startOffset].nodeName;if(r!==y.parent.inputElement&&y.parent.formatter.editorManager.domNode.isBlockNode(r)&&y.range.startOffset===y.range.endOffset&&(y.range.startOffset===h||0===r.textContent.trim().length&&s)){e=y.parent.createElement("br");0===y.range.startOffset&&"TABLE"===y.range.startContainer.nodeName?y.range.startContainer.parentElement.insertBefore(e,y.range.startContainer):"BR"===g.nodeName&&0===r.textContent.length?y.parent.formatter.editorManager.domNode.insertAfter(e,g):0===y.range.startOffset&&0===y.range.endOffset&&s?(h="IMG"===y.range.startContainer.nodeName?y.range.startContainer:y.range.startContainer.childNodes[y.range.startOffset],r.insertBefore(e,h),e=h):(s=y.parent.createElement("br"),h=j.isNullOrUndefined(y.range.startContainer.parentElement)||"A"!==y.range.startContainer.parentElement.nodeName||y.range.startContainer.parentElement.textContent.length!==y.range.startOffset?y.range.startContainer:y.range.startContainer.parentElement,y.parent.formatter.editorManager.domNode.insertAfter(e,h),y.parent.formatter.editorManager.domNode.insertAfter(s,h),s=h.nextElementSibling,h=j.isNullOrUndefined(s)?null:s.nextElementSibling,j.isNullOrUndefined(s)||j.isNullOrUndefined(h)||j.isNullOrUndefined(h.nextElementSibling)||"BR"!==s.nodeName||"BR"!==h.nodeName||"BR"!==h.nextElementSibling.nodeName||h.nextElementSibling.remove()),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),e,0)}else if(j.isNullOrUndefined(r)||r===y.parent.inputElement||"BR"===r.nodeName)y.insertBRElement();else if(0===r.textContent.trim().length||1===r.textContent.trim().length&&8203===r.textContent.charCodeAt(0)){var a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,r,!0).cloneNode(!0),f=(y.parent.formatter.editorManager.domNode.insertAfter(a,r),y.parent.createElement("br"));a.parentElement.insertBefore(f,a),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),a,0)}else{a=void 0,f=y.parent.createElement("br");if(0!==y.range.startOffset||0!==y.range.endOffset||j.isNullOrUndefined(r.previousSibling)||"BR"!==r.previousSibling.nodeName||"P"===r.nodeName||"DIV"===r.nodeName)r===y.parent.inputElement||"inline"!==o.display&&"inline-block"!==o.display?y.insertBRElement():(a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,r,!0).cloneNode(!0),r.parentElement.insertBefore(f,r),y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),r,0),y.insertFocusContent());else{a=y.parent.formatter.editorManager.nodeCutter.SplitNode(y.range,r,!1).cloneNode(!0),y.parent.formatter.editorManager.domNode.insertAfter(f,r),y.insertFocusContent();for(n=f.nextSibling;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName;)n=n.lastChild;y.parent.formatter.editorManager.nodeSelection.setCursorPoint(y.parent.contentModule.getDocument(),n,0)}}b.args.preventDefault()}y.triggerActionComplete(b,C)}}))}else this.handleEnterKeyAtImageSide(b,e.start,e.end);else this.handleCursorAtTableSide(b,e.start,e.end)},wh.prototype.removeBRElement=function(e){-1!==j.Browser.userAgent.indexOf("Firefox")&&this.range.endOffset===e.textContent.length&&(0!==e.textContent.length||1<e.querySelectorAll("BR").length)&&!j.isNullOrUndefined(e.lastChild)&&"BR"===e.lastChild.nodeName&&j.detach(e.lastChild)},wh.prototype.insertBRElement=function(){for(var e=!1,t=!0,n=(0===this.range.endContainer.textContent.length&&"BR"===this.range.startContainer.nodeName&&(t=!1),this.parent.createElement("br")),i=this.startNode;i.lastChild;)i=i.lastChild;var o="A"===this.startNode.nodeName&&"A"===this.endNode.nodeName&&!j.isNullOrUndefined(this.range.startContainer.parentElement)&&this.range.startOffset===this.range.endOffset&&this.range.startContainer.textContent.trim().length===i.textContent.trim().length;"BR"===this.startNode.nodeName&&"BR"===this.endNode.nodeName&&0===this.range.startOffset&&this.range.startOffset===this.range.endOffset?(this.parent.formatter.editorManager.domNode.insertAfter(n,this.startNode),e=!0):(this.startNode!==this.parent.inputElement||j.isNullOrUndefined(this.range.startContainer.previousSibling)||"BR"!==this.range.startContainer.previousSibling.nodeName||0!==this.range.startContainer.textContent.length||(e=!0),o?this.parent.formatter.editorManager.domNode.insertAfter(n,this.startNode):this.range.insertNode(n)),e||!j.isNullOrUndefined(n.nextElementSibling)&&"BR"===n.nextElementSibling.tagName||!j.isNullOrUndefined(n.nextSibling)&&(0<n.nextSibling.textContent.length||"#text"===n.nextSibling.nodeName&&0===n.nextSibling.textContent.trim().length&&!j.isNullOrUndefined(n.nextSibling.nextSibling)&&0<n.nextSibling.nextSibling.textContent.trim().length)?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),!j.isNullOrUndefined(n.nextSibling)&&t?n.nextSibling:n,0):(e=this.parent.createElement("br"),o?this.parent.formatter.editorManager.domNode.insertAfter(e,this.startNode):this.range.insertNode(e),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),n,0))},wh.prototype.insertFocusContent=function(){0===this.range.startContainer.textContent.length&&("#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement.innerHTML="&#8203;":this.range.startContainer.innerHTML="&#8203;")},wh.prototype.createInsertElement=function(e){"DIV"===this.parent.enterKey&&!e||"DIV"===this.parent.shiftEnterKey&&e?t=this.parent.createElement("div"):("P"===this.parent.enterKey&&!e||"P"===this.parent.shiftEnterKey&&e)&&(t=this.parent.createElement("p"));var t,e=this.parent.formatter.editorManager.domNode.blockNodes()[0].previousSibling,n=this.parent.formatter.editorManager.domNode.blockNodes()[0].nextSibling;return!j.isNullOrUndefined(e)&&"#text"!==e.nodeName&&e.hasAttribute("style")&&"TABLE"!==e.nodeName&&t.setAttribute("style",e.getAttribute("style")),j.isNullOrUndefined(e)&&!j.isNullOrUndefined(n)&&"#text"!==n.nodeName&&n.hasAttribute("style")&&"TABLE"!==n.nodeName&&t.setAttribute("style",n.getAttribute("style")),t},wh.prototype.triggerActionComplete=function(e,t){this.parent.trigger(Le,{requestType:t?"ShiftEnterAction":"EnterAction",args:e.args})},wh.prototype.handleCursorAtTableSide=function(n,i,o){var r,e,s=this;"BR"!==this.parent.enterKey&&(r=n.args.shiftKey,e={cancel:!1,name:Oe,requestType:r?"ShiftEnterAction":"EnterAction",originalEvent:n.args},this.parent.trigger(Oe,e,function(e){var t;e.cancel||(t=void((e=s.parent.createElement(s.parent.enterKey)).innerHTML="<br>"),i&&(t=s.range.startContainer.childNodes[s.range.startOffset]).parentElement.insertBefore(e,t),o&&(t=s.range.startContainer.childNodes[s.range.startOffset-1],j.isNullOrUndefined(t.nextSibling)?j.isNullOrUndefined(t.nextSibling)&&t.parentElement.appendChild(e):t.parentElement.insertBefore(e,t.nextSibling)),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),e,0),n.args.preventDefault(),s.triggerActionComplete(n,r))}))},wh.prototype.handleEnterKeyAtImageSide=function(i,o,r){var s=this,e={cancel:!1,name:Oe,requestType:i.args.shiftKey?"ShiftEnterAction":"EnterAction",originalEvent:i.args},a=!1;"IMG"===this.range.startContainer.nodeName&&0===this.range.startOffset&&(a=!0),this.parent.trigger(Oe,e,function(e){var t,n;e.cancel||"BR"===s.parent.enterKey&&(e=s.parent.createElement("BR"),n=void 0,a&&((n=s.range.startContainer).parentElement.insertBefore(e,n),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),n,0)),o&&((n=s.range.startContainer.childNodes[s.range.startOffset]).parentElement.insertBefore(e,n),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),n,0)),r&&(n=s.range.startContainer.childNodes[s.range.startOffset-1],j.isNullOrUndefined(n.nextSibling)?j.isNullOrUndefined(n.nextSibling)&&(n.parentElement.appendChild(e),t=s.parent.createElement("BR"),n.parentElement.appendChild(t),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),t,0)):(n.parentElement.insertBefore(e,n.nextSibling),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),e.nextSibling,0))),i.args.preventDefault(),s.triggerActionComplete(i,i.args.shiftKey))})},wh.prototype.isTableOrImageStart=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t]&&-1<["IMG","TABLE"].indexOf(e.childNodes[t].nodeName);return n?{start:n,startNodeName:e.childNodes[t].nodeName}:{start:!1,startNodeName:""}},wh.prototype.isTableOrImageEnd=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t-1]&&-1<["IMG","TABLE"].indexOf(e.childNodes[t-1].nodeName);return n?{end:n,endNodeName:e.childNodes[t-1].nodeName}:{end:!1,endNodeName:""}},wh.prototype.processedTableImageCursor=function(){var e=this.isTableOrImageStart(),t=e.start,e=e.startNodeName,n=this.isTableOrImageEnd();return{start:t,startName:e,end:n.end,endName:n.endNodeName}};var Lh=wh;function wh(e){this.parent=e,this.addEventListener()}kh=function(e,t){return(kh=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var kh,xh,yh=function(e,t){function n(){this.constructor=e}kh(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Dh=function(){return(Dh=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},B=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},yh=(xh=j.Component,yh(R,xh),R.prototype.requiredModules=function(){var e=[];return this.toolbarSettings.enable&&(e.push({member:"toolbar",args:[this,this.serviceLocator]}),e.push({member:"link",args:[this,this.serviceLocator]}),e.push({member:"table",args:[this,this.serviceLocator]}),e.push({member:"image",args:[this,this.serviceLocator]}),e.push({member:"audio",args:[this,this.serviceLocator]}),e.push({member:"video",args:[this,this.serviceLocator]}),this.quickToolbarSettings.enable)&&e.push({member:"quickToolbar",args:[this,this.serviceLocator]}),"HTML"===this.editorMode&&this.slashMenuSettings.enable&&e.push({member:"slashMenu",args:[this,this.serviceLocator]}),this.showCharCount&&e.push({member:"count",args:[this,this.serviceLocator]}),"Markdown"===this.editorMode&&e.push({member:"markdownEditor",args:[this,this.serviceLocator]}),"HTML"===this.editorMode&&(e.push({member:"htmlEditor",args:[this,this.serviceLocator]}),e.push({member:"pasteCleanup",args:[this,this.serviceLocator]}),e.push({member:"importExport",args:[this,this.serviceLocator]}),e.push({member:"formatPainter",args:[this]}),e.push({member:"emojiPicker",args:[this,this.serviceLocator]})),this.fileManagerSettings.enable&&e.push({member:"fileManager",args:[this,this.serviceLocator]}),this.enableResize&&e.push({member:"resize",args:[this]}),e},R.prototype.updateEnable=function(){this.enabled?(j.removeClass([this.element],En),this.element.setAttribute("aria-disabled","false"),j.isNullOrUndefined(this.htmlAttributes.tabindex)?this.inputElement.setAttribute("tabindex","0"):this.inputElement.setAttribute("tabindex",this.htmlAttributes.tabindex)):(this.getToolbar()&&(j.removeClass(this.getToolbar().querySelectorAll("."+Ci),Ci),j.removeClass([this.getToolbar().parentElement],[kn])),j.addClass([this.element],En),this.element.tabIndex=-1,this.element.setAttribute("aria-disabled","true"),this.inputElement.setAttribute("tabindex","-1"))},R.prototype.setEnable=function(){this.updateEnable(),this.enabled?this.eventInitializer():this.unWireEvents()},R.prototype.initializeValue=function(){this.isFocusOut=!1,this.isRTE=!1,this.isBlur=!0,this.defaultResetValue=null,this.isResizeInitialized=!1},R.prototype.preRender=function(){this.initializeValue(),this.clickPoints={clientX:0,clientY:0},this.initialValue=this.value,this.serviceLocator=new cc,this.initializeServices(),this.setContainer(),this.persistData(),j.setStyleAttribute(this.element,{width:j.formatUnit(this.width)}),j.attributes(this.element,{role:"application","aria-label":"Rich Text Editor"}),this.beforeRenderClassValue=this.element.getAttribute("class")},R.prototype.persistData=function(){var e;this.enablePersistence&&"TEXTAREA"===this.originalElement.tagName&&(this.element.id=this.originalElement.id+"_wrapper",e=window.localStorage.getItem(this.getModuleName()+this.element.id),j.isNullOrUndefined(e)||""===e||this.setProperties(JSON.parse(e),!0))},R.prototype.setContainer=function(){this.originalElement=this.element.cloneNode(!0),null!==this.value&&null===this.valueTemplate||this.setValue(),this.element.hasAttribute("tabindex")&&(this.htmlAttributes={tabindex:this.element.getAttribute("tabindex")},this.element.removeAttribute("tabindex")),this.element.innerHTML="";for(var e,t=["class","style","id","ejs-for"],n={},i=0;i<this.element.attributes.length;i++)-1!==t.indexOf(this.element.attributes[i].name)||/^data-val/.test(this.element.attributes[i].name)||(n[this.element.attributes[i].name]=this.element.getAttribute(this.element.attributes[i].name));if(j.extend(n,this.htmlAttributes,n),this.setProperties({htmlAttributes:n},!0),j.isNullOrUndefined(this.htmlAttributes.id)||(this.element.id=this.htmlAttributes.id),this.internalID=this.element.id,"TEXTAREA"===this.element.tagName?(e=this.createElement("div",{className:this.element.getAttribute("class")}),this.element.innerHTML="",this.element.parentElement.insertBefore(e,this.element),this.valueContainer=this.element,j.removeClass([this.valueContainer],this.element.getAttribute("class").split(" ")),this.element=e):this.valueContainer=this.createElement("textarea",{id:this.getID()+"-value",attrs:{"aria-labelledby":this.getID()}}),this.valueContainer.name=this.getID(),j.addClass([this.valueContainer],Yi),!j.isNullOrUndefined(this.cssClass))for(var o=this.cssClass.split(" "),r=0;r<o.length;r++)j.addClass([this.valueContainer],o[r]);this.rootContainer=this.createElement("div",{className:On,attrs:{role:"presentation"}}),this.element.appendChild(this.rootContainer),this.rootContainer.appendChild(this.valueContainer)},R.prototype.getPersistData=function(){return this.addOnPersist(["value"])},R.prototype.focusIn=function(){this.enabled&&(this.inputElement.focus(),this.focusHandler({}))},R.prototype.focusOut=function(){this.enabled&&(this.inputElement.blur(),this.blurHandler({}))},R.prototype.selectAll=function(){this.notify(tt,{})},R.prototype.selectRange=function(e){this.notify(nt,{range:e})},R.prototype.getSelection=function(){var t="";return this.notify(it,{callBack:function(e){t=e}}),t},R.prototype.showEmojiPicker=function(e,t){this.readonly||this.notify(rn,{x:e,y:t})},R.prototype.executeCommand=function(e,t,n){t=this.htmlPurifier(e,t),"HTML"===this.editorMode&&(i=this.getRange(),this.iframeSettings.enable&&this.formatter.editorManager.nodeSelection.Clear(this.element.ownerDocument),this.iframeSettings.enable&&i.startContainer===this.inputElement||!this.inputElement.contains(i.startContainer))&&this.focusIn();var i=dc[""+e];if(n&&n.undo&&n.undo&&0===this.formatter.getUndoRedoStack().length&&this.formatter.saveData(),-1!==this.maxLength&&!j.isNullOrUndefined(i.command)){var e=0,o=("Links"===i.command&&(e=(0===t.text.length?t.url:t.text).length),"Images"!==i.command&&"Table"!==i.command&&"Files"!==i.command||(e=1),"InsertHTML"===i.command&&(j.isNullOrUndefined(t)?j.isNullOrUndefined(i.value)||"<hr/>"!==i.value&&"<br/>"!==i.value||(e=1):((o=this.createElement("div")).innerHTML=t,e=o.textContent.length)),"InsertText"===i.command&&(e=t.length),this.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length),r=this.getSelection().length;if(!(-1===this.maxLength||o-r+e<=this.maxLength))return}o=t,"FormatPainter"===i.command&&(j.isNullOrUndefined(t)||(this.formatPainterSettings=t),o={formatPainterAction:i.value}),this.formatter.editorManager.execCommand(i.command,i.subCommand||o||i.value,null,null,o||i.value,o||("UL"===i.value||"OL"===i.value?null:i.value),null,this.enterKey),n&&n.undo&&(this.formatter.saveData(),this.formatter.enableUndo(this)),this.setPlaceHolder(),this.notify(W,{})},R.prototype.htmlPurifier=function(e,t){if("HTML"===this.editorMode)switch(e){case"insertHTML":this.enableHtmlSanitizer&&(t="string"==typeof t?this.htmlEditorModule.sanitizeHelper(t):this.htmlEditorModule.sanitizeHelper(t.outerHTML));break;case"insertTable":j.isNullOrUndefined(t.width)&&(t.width={minWidth:this.tableSettings.minWidth,maxWidth:this.tableSettings.maxWidth,width:this.tableSettings.width});break;case"insertImage":var n=(o=this.createElement("img",{attrs:{src:t.url}})).outerHTML,n=""!==(n=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(o.outerHTML):n)&&this.createElement("div",{innerHTML:n}).firstElementChild.getAttribute("src")||null;n=j.isNullOrUndefined(n)?"":n,t.url=n,j.isNullOrUndefined(t.width)&&(t.width={minWidth:this.insertImageSettings.minWidth,maxWidth:this.insertImageSettings.maxWidth,width:this.insertImageSettings.width}),j.isNullOrUndefined(t.height)&&(t.height={minHeight:this.insertImageSettings.minHeight,maxHeight:this.insertImageSettings.maxHeight,height:this.insertImageSettings.height});break;case"insertAudio":var i=this.createElement("audio",{attrs:{controls:""}}),o=this.createElement("source",{attrs:{src:t.url,type:t.url&&0<t.url.split(".").length?"audio/"+t.url.split(".")[t.url.split(".").length-1]:""}}),r=(i.appendChild(o),i.outerHTML),n=""!==(r=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(i.outerHTML):r)&&this.createElement("div",{innerHTML:r}).firstElementChild.firstElementChild.getAttribute("src")||null;n=j.isNullOrUndefined(n)?"":n,t.url=n;break;case"insertVideo":i=this.createElement("video",{attrs:{controls:""}}),o=this.createElement("source",{attrs:{src:t.url,type:t.url&&0<t.url.split(".").length?"video/"+t.url.split(".")[t.url.split(".").length-1]:""}}),r=(i.appendChild(o),i.outerHTML),n=""!==(r=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(o.outerHTML):r)&&this.createElement("div",{innerHTML:r}).firstElementChild.getAttribute("src")||null;n=j.isNullOrUndefined(n)?"":n,t.url=n,j.isNullOrUndefined(t.width)&&(t.width={minWidth:this.insertVideoSettings.minWidth,maxWidth:this.insertVideoSettings.maxWidth,width:this.insertVideoSettings.width}),j.isNullOrUndefined(t.height)&&(t.height={minHeight:this.insertVideoSettings.minHeight,maxHeight:this.insertVideoSettings.maxHeight,height:this.insertVideoSettings.height});break;case"createLink":i=this.createElement("a",{attrs:{href:t.url}}),o=i.outerHTML,r=""!==(o=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(i.outerHTML):o)&&this.createElement("div",{innerHTML:o}).firstElementChild.getAttribute("href")||null,r=j.isNullOrUndefined(r)?"":r;t.url=r}return t},R.prototype.encode=function(e){var t=this.createElement("div");return t.innerText=e.trim(),t.innerHTML.replace(/<br\s*[\/]?>/gi,"\n")},R.prototype.render=function(){this.value&&!this.valueTemplate&&this.setProperties({value:this.serializeValue(this.value)},!0),this.value="Markdown"===this.editorMode||j.isNullOrUndefined(this.value)?this.value:this.addAnchorAriaLabel(this.value),this.renderModule=new Fr(this,this.serviceLocator),this.sourceCodeModule=new pa(this,this.serviceLocator),this.notify(Q,{}),this.trigger(V),this.RTERender();new Ga(this);this.notify(n,{}),this.enableXhtml&&this.setProperties({value:this.getXhtml()},!0),this.toolbarSettings.enable&&("Expand"===this.toolbarSettings.type||"MultiRow"===this.toolbarSettings.type||"Scrollable"===this.toolbarSettings.type)&&!j.isNullOrUndefined(this.getToolbar())&&-1<this.toolbarSettings.items.indexOf("Undo")&&-1<this.toolbarSettings.items.indexOf("Redo")&&this.disableToolbarItem(["Undo","Redo"]),null!==this.value&&(this.valueContainer.defaultValue=this.value),this.enabled&&!this.readonly?this.eventInitializer():this.unWireEvents(),this.notify(tn,{cssClass:this.getCssClass()}),this.addAudioVideoWrapper(),this.notify(_,{}),this.autoResize(),this.renderComplete()},R.prototype.addAudioVideoWrapper=function(){for(var e,t,n,i=this,o=this.element.querySelectorAll("audio"),r=0;r<o.length;r++)o[r].classList.contains("e-rte-audio")||(o[r].classList.add("e-rte-audio"),o[r].classList.add(mi)),o[r].parentElement.classList.contains(ri)||o[r].parentElement.classList.contains(ai)||((t=this.createElement("span",{className:ai})).setAttribute("style","width:300px; margin:0 auto;"),t.contentEditable="false",n=this.createElement("span",{className:ri}),t.appendChild(n),o[r].parentNode.insertBefore(t,o[r].nextSibling),n.appendChild(o[r]),null===t.nextElementSibling&&(e=this.createElement("br"),t.parentNode.insertBefore(e,t.nextSibling)));for(var s,a=this.element.querySelectorAll("video"),r=0;r<a.length;r++)a[r].classList.contains("e-rte-video")||(a[r].classList.add("e-rte-video"),a[r].classList.add(gi)),a[r].parentElement.classList.contains(ri)||a[r].parentElement.classList.contains(li)||((s=this.createElement("span",{className:li})).contentEditable="false",a[r].parentNode.insertBefore(s,a[r].nextSibling),s.appendChild(a[r]),null===s.nextElementSibling&&(e=this.createElement("br"),s.parentNode.insertBefore(e,s.nextSibling))),-1!==j.Browser.userAgent.indexOf("Firefox")&&(a[r].addEventListener("play",function(e){i.notify(Ke,{args:e}),i.notify("editAreaClick",{args:e})}),a[r].addEventListener("pause",function(e){i.notify(Ke,{args:e}),i.notify("editAreaClick",{args:e})}))},R.prototype.eventInitializer=function(){this.wireEvents()},R.prototype.cleanList=function(e){var t=this.getRange(),n=t.startContainer,i=t.endContainer,o=t.startOffset,r=n===i,s=(i.textContent.length,"#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer),a=j.closest(s,"LI"),l=!1,d=t.endOffset;if(i.nodeType===Node.TEXT_NODE&&"\ufeff"===i.textContent.charAt(d-1)&&d--,!j.isNullOrUndefined(a)&&s.textContent.trim().length===d&&!t.collapsed&&j.isNullOrUndefined(s.nextElementSibling)){for(var c=0;c<a.childNodes.length;c++)"#text"===a.childNodes[c].nodeName&&0===a.childNodes[c].textContent.trim().length&&(j.detach(a.childNodes[c]),l=!0,c--);for(var h=a;null!==h.lastChild&&"#text"!==h.nodeName;)h=h.lastChild;l&&(i="BR"!==h.nodeName||j.isNullOrUndefined(h.previousSibling)?h:h.previousSibling,this.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),r?i:n,i,o,"BR"===i.nodeName?0:i.textContent.length))}},R.prototype.keyDown=function(e){if(this.inputElement.classList.contains("e-mention")){var t=this.inputElement.ownerDocument.getElementById(this.inputElement.id+"_popup");if(-1!==Ps.indexOf(e.key)&&t&&t.classList.contains("e-popup-open"))return}if(this.notify(h,{member:"keydown",args:e}),this.restrict(e),"HTML"===this.editorMode&&this.cleanList(e),"HTML"===this.editorMode&&(8===e.which&&"Backspace"===e.code||46===e.which&&"Delete"===e.code)){t="#text"===(l=this.getRange()).startContainer.nodeName?l.startContainer.parentElement:l.startContainer;if(j.closest(t,"pre")&&8===e.which&&8203===l.startContainer.textContent.charCodeAt(l.startOffset-1)||46===e.which&&8203===l.startContainer.textContent.charCodeAt(l.startOffset)){var t=new RegExp("","g"),n=8===e.which?l.startOffset-1:l.startOffset;l.startContainer.textContent=l.startContainer.textContent.replace(t,""),this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),l.startContainer,n)}else if("Backspace"===e.code&&8===e.which&&8203===l.startContainer.textContent.charCodeAt(0)&&l.collapsed){for(var i=l.startContainer.parentElement,o=void 0,r=void 0,r=0;r<i.childNodes.length;r++)i.childNodes[r]===l.startContainer&&(o=r);var s=!0,a=[];for(r=o;0<=r;r--)3===i.childNodes[r].nodeType&&8203===i.childNodes[r].textContent.charCodeAt(0)&&s?a.push(r):s=!1;if(0<a.length)for(r=a.length-1;0<r;r--)i.childNodes[a[r]].textContent="";this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),l.startContainer,l.startOffset)}}var l,t=!!j.isNullOrUndefined(e.action)||"format-copy"!==e.action,n=(0===this.formatter.getUndoRedoStack().length&&t&&!(e.altKey||e.shiftKey||e.altKey&&e.shiftKey&&67===e.which)&&this.formatter.saveData(),!1);"HTML"===this.editorMode&&(l=this.getRange(),n=!j.isNullOrUndefined(l.startContainer)&&l.startContainer===l.endContainer&&1<l.endContainer.childNodes.length&&!j.isNullOrUndefined(l.startContainer.childNodes[l.startOffset-1])&&"#text"===l.startContainer.childNodes[l.startOffset-1].nodeName&&!j.isNullOrUndefined(l.startContainer.childNodes[l.startOffset-1].previousSibling)&&32===l.startContainer.childNodes[l.startOffset-1].textContent.charCodeAt(0)&&l.startContainer.childNodes[l.startOffset-1].previousSibling.classList.contains("e-mention-chip"));if(-1===["insert-link","format-copy","format-paste","insert-image","insert-table","insert-audio","insert-video"].indexOf(e.action)&&(!e.target||!e.target.classList.contains("e-mention")||j.isNullOrUndefined(document.querySelector("#"+e.target.id+"_popup.e-popup-open"))||"Tab"!==e.code)&&(e.action&&"paste"!==e.action&&"space"!==e.action||9===e.which||"Backspace"===e.code&&8===e.which)&&!n){var d,c,t=!1;switch((t=j.isNullOrUndefined(this.formatPainterModule)?t:"escape"===this.formatPainterModule.previousAction)||("HTML"!==this.editorMode||"increase-fontsize"!==e.action&&"decrease-fontsize"!==e.action?this.formatter.process(this,null,e):this.notify(vn,{member:"onHandleFontsizeChange",args:e})),e.action){case"toolbar-focus":this.toolbarSettings.enable&&this.getToolbarElement()&&(d=this.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]"),d=(c=this.getRenderedQuickToolbarElem())?c.querySelector(".e-toolbar-item:not(.e-overlay)[title]"):d)&&((c=d.firstElementChild).removeAttribute("tabindex"),c.focus());break;case"escape":this.contentModule.getEditPanel().focus()}}this.notify(dn,{member:"afterKeyDown",args:e}),this.autoResize(),j.isNullOrUndefined(this.placeholder)||this.setPlaceHolder(),j.isNullOrUndefined(e)||j.isNullOrUndefined(e.code)||"Backspace"!==e.code&&"Delete"!==e.code||(l=this.contentModule.getDocument().getSelection().getRangeAt(0),(n=document.createElement("div")).appendChild(l.cloneContents()),n.innerHTML===this.inputElement.innerHTML&&(this.isCopyAll=!0))},R.prototype.keyUp=function(e){"HTML"===this.editorMode&&(t=this.getRange(),j.isNullOrUndefined(e)||j.isNullOrUndefined(e.code)||"Backspace"!==e.code&&"Delete"!==e.code||(i=this.getRange(),n=(this.iframeSettings.enable?this.contentModule.getPanel().ownerDocument:this.contentModule.getDocument()).getSelection(),this.isCopyAll&&(this.inputElement.innerHTML="BR"!==this.enterKey?"<"+this.enterKey+"><br></"+this.enterKey+">":"<br>",this.isCopyAll=!1),0<n.rangeCount&&"INPUT"!==this.contentModule.getDocument().activeElement.tagName&&this.inputElement.contains(this.contentModule.getDocument().activeElement)&&"<br>"===t.startContainer.innerHTML&&""===t.startContainer.textContent&&(n.removeAllRanges(),n.addRange(i))),-1!==j.Browser.userAgent.indexOf("Firefox"))&&"#text"===t.startContainer.nodeName&&t.startContainer.parentElement===this.inputElement&&"BR"!==this.enterKey&&(n=this.getRange(),i=this.createElement(this.enterKey),n.startContainer.parentElement.insertBefore(i,n.startContainer),i.appendChild(n.startContainer),this.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),i.childNodes[0],i.childNodes[0],i.childNodes[0].textContent.length,i.childNodes[0].textContent.length)),this.notify(ne,{member:"keyup",args:e}),this.notify(te,{member:"tableModulekeyUp",args:e}),"KeyX"!==e.code||88!==e.which||88!==e.keyCode||!e.ctrlKey||""!==this.inputElement.innerHTML&&"<br>"!==this.inputElement.innerHTML||(this.inputElement.innerHTML=xr(Mr(this),this));var t=32===e.which||13===e.which||8===e.which||46===e.which,n="C"===e.key&&e.altKey&&e.shiftKey,i="V"===e.key&&e.altKey&&e.shiftKey;(!n&&!i&&("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||t)||"Markdown"===this.editorMode&&("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||t)||this.autoSaveOnIdle&&j.Browser.isDevice&&!this.inlineMode.enable)&&this.formatter.onKeyHandler(this,e),(this.inputElement&&0!==this.inputElement.textContent.length||0<this.element.querySelectorAll(".e-toolbar-item.e-active").length||0<this.formatter.getUndoRedoStack().length)&&this.notify(X,{args:e}),this.setPlaceHolder()},R.prototype.serializeValue=function(e){return e="HTML"!==this.editorMode||j.isNullOrUndefined(e)?e:this.enableHtmlEncode?(e=this.htmlEditorModule.sanitizeHelper(Rr(e)),this.encode(e)):(e=this.htmlEditorModule.sanitizeHelper(e),this.enableXhtml?this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e):e)},R.prototype.sanitizeHtml=function(e){return this.serializeValue(e)},R.prototype.updateValue=function(e){var t;j.isNullOrUndefined(e)?(t=this.inputElement.innerHTML,this.setProperties({value:Br(t)?null:t})):this.setProperties({value:e})},R.prototype.triggerEditArea=function(e){var t;br()&&(t=e.touches?e.changedTouches[0]:e,this.clickPoints.clientX!==t.clientX||this.clickPoints.clientY!==t.clientY)||this.notify(Xe,{member:"editAreaClick",args:e})},R.prototype.notifyMouseUp=function(e){var t=e.touches?e.changedTouches[0]:e;this.notify(re,{member:"mouseUp",args:e,touchData:{prevClientX:this.clickPoints.clientX,prevClientY:this.clickPoints.clientY,clientX:t.clientX,clientY:t.clientY}}),(this.inputElement&&("HTML"===this.editorMode&&(0!==this.inputElement.textContent.length||e.target&&!j.isNullOrUndefined(e.target.querySelector("li")))||"Markdown"===this.editorMode&&0!==this.inputElement.value.length)||e.target&&!j.isNullOrUndefined(j.closest(e.target,"table"))||e.target&&!j.isNullOrUndefined(e.target.querySelector("img"))||e.target&&("VIDEO"===e.target.nodeName||0<e.target.querySelectorAll("."+li).length)||e.target&&"BR"!==e.target.nodeName&&(e.target.classList.contains(ai)||e.target.classList.contains(ri)||e.target.classList.contains(si)))&&this.notify(X,{args:e}),this.triggerEditArea(e)},R.prototype.mouseUp=function(e){if(this.quickToolbarSettings.showOnRightClick&&j.Browser.isDevice){var t=e.target,n=j.closest(t,"table");if(t&&"A"===t.nodeName||"IMG"===t.nodeName||"TD"===t.nodeName||"TH"===t.nodeName||"TABLE"===t.nodeName||n&&this.contentModule.getEditPanel().contains(n))return}this.notifyMouseUp(e),this.setPlaceHolder(),this.autoResize()},R.prototype.ensureModuleInjected=function(e){return 0<=this.getInjectedModules().indexOf(e)},R.prototype.onCopy=function(){this.contentModule.getDocument().execCommand("copy",!1,null)},R.prototype.onCut=function(){this.contentModule.getDocument().execCommand("cut",!1,null)},R.prototype.onPaste=function(s){var a=this;this.trigger(Oe,{originalEvent:s,cancel:!1,requestType:"Paste"},function(e){var t,n,i,o,r=a.getText().replace(/\u200B/g,"").replace("HTML"===a.editorMode?/(\r\n|\n|\r|\t)/gm:"","").length-a.getSelection().length+(j.isNullOrUndefined(s)||j.isNullOrUndefined(s.clipboardData)?0:s.clipboardData.getData("text/plain").replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length);"Markdown"===a.editorMode?(t={requestType:"Paste",editorMode:a.editorMode,event:s},setTimeout(function(){a.formatter.onSuccess(a,t)},0),-1===a.maxLength||r<=a.maxLength||s.preventDefault()):!e.cancel&&"true"===a.inputElement.contentEditable&&(-1===a.maxLength||r<=a.maxLength)?(e=a.contentModule.getDocument().querySelector(".e-rte-img-dialog"),j.isNullOrUndefined(a.pasteCleanupModule)?(console.warn('[WARNING] :: Module "pasteCleanup" is not available in RichTextEditor component! You either misspelled the module name or forgot to load it.'),r=null,i=!(n={requestType:"Paste",editorMode:a.editorMode,event:s}),s&&!j.isNullOrUndefined(s.clipboardData)&&(r=s.clipboardData.getData("text/plain"),i=0<s.clipboardData.getData("text/html").indexOf("MsoNormal")),o=s&&s.clipboardData&&0<s.clipboardData.items.length?s.clipboardData.items[0].getAsFile():null,null!==r&&a.notify(rt,{file:o,args:s,text:r,isWordPaste:i}),setTimeout(function(){a.formatter.onSuccess(a,n)},0)):j.isNullOrUndefined(e)&&a.notify(pt,{args:s})):s.preventDefault()})},R.prototype.clipboardAction=function(e,t){switch(e.toLowerCase()){case"cut":this.onCut(),this.formatter.onSuccess(this,{requestType:"Cut",editorMode:this.editorMode,event:t});break;case"copy":this.onCopy(),this.formatter.onSuccess(this,{requestType:"Copy",editorMode:this.editorMode,event:t});break;case"paste":this.onPaste(t)}},R.prototype.destroy=function(){if(!this.isDestroyed&&this.isRendered){if(this.element.className=this.beforeRenderClassValue,this.removeHtmlAttributes(),this.removeAttributes(),this.beforeRenderClassValue=null,j.isNullOrUndefined(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null),j.isNullOrUndefined(this.autoSaveTimeOut)||(clearTimeout(this.autoSaveTimeOut),this.autoSaveTimeOut=null),j.isNullOrUndefined(this.idleInterval)||(clearTimeout(this.idleInterval),this.idleInterval=null),this.notify(o,{}),this.destroyDependentModules(),this.unWireEvents(),"TEXTAREA"===this.originalElement.tagName){this.element.parentElement.insertBefore(this.valueContainer,this.element),this.valueContainer.id=this.getID(),this.valueContainer.removeAttribute("name"),j.detach(this.element),""!==this.originalElement.innerHTML.trim()?(this.valueContainer.value=this.originalElement.innerHTML.trim(),this.setProperties({value:j.isNullOrUndefined(this.initialValue)?null:this.initialValue},!0)):this.valueContainer.value=this.valueContainer.defaultValue,this.element=this.valueContainer;for(var e=0;e<this.originalElement.classList.length;e++)j.addClass([this.element],this.originalElement.classList[e]);if(!j.isNullOrUndefined(this.cssClass))for(var t=this.cssClass.split(" "),e=0;e<t.length;e++)j.addClass([this.element],t[e]);j.removeClass([this.element],Yi)}else""!==this.originalElement.innerHTML.trim()?(this.element.innerHTML=this.originalElement.innerHTML.trim(),this.setProperties({value:j.isNullOrUndefined(this.initialValue)?null:this.initialValue},!0)):this.element.innerHTML="";var n=document.querySelector(".e-dialog.e-rte-elements");if(n&&j.detach(n),this.placeholder&&this.placeHolderWrapper&&(this.placeHolderWrapper=null),!j.isNullOrUndefined(this.cssClass))for(var i=this.cssClass.split(" "),e=0;e<i.length;e++)""!==i[e].trim()&&j.removeClass([this.element],i[e]);this.rootContainer&&(this.rootContainer=null),this.valueContainer&&(this.valueContainer=null),this.originalElement&&(this.originalElement=null),this.currentTarget=null,this.scrollParentElements=[],this.isRendered=!1,xh.prototype.destroy.call(this)}},R.prototype.removeHtmlAttributes=function(){if(this.htmlAttributes)for(var e=Object.keys(this.htmlAttributes),t=0;t<e.length&&this.element.hasAttribute(e[t]);t++)this.element.removeAttribute(e[t])},R.prototype.removeAttributes=function(){this.enabled||j.removeClass([this.element],En),this.enableRtl&&j.removeClass([this.element],Nn),this.readonly&&j.removeClass([this.element],qi),""!==this.element.style.width&&""===this.originalElement.style.width&&this.element.style.removeProperty("width"),""!==this.element.style.height&&""===this.originalElement.style.height&&this.element.style.removeProperty("height"),this.element.removeAttribute("aria-disabled"),this.element.removeAttribute("role"),this.element.removeAttribute("tabindex"),this.element.removeAttribute("aria-label")},R.prototype.destroyDependentModules=function(){this.renderModule.destroy(),this.formatter.editorManager.destroy()},R.prototype.getContent=function(){return this.contentModule.getPanel()},R.prototype.getText=function(){return this.contentModule.getText()},R.prototype.getSelectedHtml=function(){var e=this.createElement("div"),t=this.contentModule.getDocument().getSelection();return 0<t.rangeCount&&(t=t.getRangeAt(0).cloneContents(),e.appendChild(t)),e.innerHTML},R.prototype.showInlineToolbar=function(){var e,t,n;this.inlineMode.enable&&(e="#text"===(n=this.getRange()).endContainer.nodeName?n.endContainer.parentElement:n.endContainer,t=n.getClientRects()[0].left,n=n.getClientRects()[0].top,this.quickToolbarModule.showInlineQTBar(t,n,e))},R.prototype.hideInlineToolbar=function(){this.quickToolbarModule.hideInlineQTBar()},R.prototype.getModuleName=function(){return"richtexteditor"},R.prototype.onPropertyChanged=function(e,t){for(var n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];switch(o){case"enterKey":case"value":var r=void 0,r="enterKey"===o?null===this.value||"<div><br></div>"===this.value||"<p><br></p>"===this.value||"<br>"===this.value?null:this.value:e[o],s=(r=this.serializeValue(r),"HTML"===this.editorMode?xr(r,this):r);(j.isNullOrUndefined(r)||""===r)&&"enterKey"!==o||this.setProperties({value:this.enableHtmlEncode?this.encode(Rr(s)):s},!0),this.updatePanelValue(),this.inputElement&&this.notify(_,{}),this.setPlaceHolder(),this.notify(It,{module:"XhtmlValidation",newProp:e,oldProp:t}),this.enableXhtml&&this.setProperties({value:this.getXhtml()},!0),this.showCharCount&&this.countModule.refresh(),this.addAudioVideoWrapper();break;case"valueTemplate":this.setValue(!0),this.showCharCount&&this.countModule.refresh();break;case"width":this.setWidth(e[o]),this.toolbarSettings.enable&&!this.inlineMode.enable&&(this.toolbarModule.refreshToolbarOverflow(),this.resizeHandler());break;case"height":this.setHeight(e[o]),this.autoResize();break;case"readonly":this.setReadOnly(!1);break;case"cssClass":this.element.classList.remove(t[o]),this.setCssClass(e[o]),this.notify(tn,{cssClass:e[o],oldCssClass:t[o]});break;case"enabled":this.setEnable();break;case"enableRtl":this.updateRTL();break;case"placeholder":this.placeholder=e[o],this.setPlaceHolder();break;case"htmlAttributes":nc(this.htmlAttributes,this,!1,!1);break;case"iframeSettings":var a,r=t[o];r.resources&&(s=this.contentModule.getDocument().querySelector("head"),a=void 0,r.resources.scripts&&(a=s.querySelectorAll("."+Sn),this.removeSheets(a)),r.resources.styles)&&(a=s.querySelectorAll("."+Tn),this.removeSheets(a)),this.setIframeSettings();break;case"locale":xh.prototype.refresh.call(this);break;case"inlineMode":this.notify(l,{module:"quickToolbar",newProp:e,oldProp:t});break;case"toolbarSettings":this.notify(l,{module:"toolbar",newProp:e,oldProp:t});break;case"maxLength":this.showCharCount&&this.countModule.refresh();break;case"showCharCount":e[o]&&this.countModule?this.countModule.renderCount():!1===e[o]&&this.countModule&&this.countModule.destroy();break;case"enableHtmlEncode":this.updateValueData(),this.updatePanelValue(),this.setPlaceHolder(),this.showCharCount&&this.countModule.refresh();break;case"undoRedoSteps":case"undoRedoTimer":this.formatter.editorManager.observer.notify(Js,{newProp:e,oldProp:t});break;case"enableXhtml":this.notify(It,{module:"XhtmlValidation",newProp:e,oldProp:t});break;case"quickToolbarSettings":e.quickToolbarSettings.showOnRightClick?this.wireContextEvent():this.unWireContextEvent(),this.notify(l,{newProp:e,oldProp:t});break;case"formatPainterSettings":this.formatter.editorManager.observer.notify(Js,{module:"formatPainter",newProp:e});break;default:this.notify(l,{newProp:e,oldProp:t})}this.autoResize()}},R.prototype.updateValueData=function(){this.enableHtmlEncode?this.setProperties({value:this.encode(Rr(this.inputElement.innerHTML))},!0):this.setProperties({value:/<[a-z][\s\S]*>/i.test(this.inputElement.innerHTML)?this.inputElement.innerHTML:Rr(this.inputElement.innerHTML)})},R.prototype.removeSheets=function(e){for(var t=0;t<e.length;t++)j.detach(e[t])},R.prototype.updatePanelValue=function(){var e="HTML"===this.editorMode?this.listOrderCorrection(this.value):this.value,e=this.enableHtmlEncode&&this.value?Rr(e):e,t=this.element.querySelector("."+wo);e?(!j.isNullOrUndefined(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(t.value=this.value),this.valueContainer&&(this.valueContainer.value=this.enableHtmlEncode?this.value:e),"HTML"===this.editorMode&&this.inputElement&&this.inputElement.innerHTML.trim()!==e.trim()?this.inputElement.innerHTML=e:"Markdown"===this.editorMode&&this.inputElement&&this.inputElement.value.trim()!==e.trim()&&(this.inputElement.value=e)):(!j.isNullOrUndefined(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(t.value=""),"HTML"===this.editorMode?"DIV"===this.enterKey?this.inputElement.innerHTML="<div><br/></div>":"BR"===this.enterKey?this.inputElement.innerHTML="<br/>":this.inputElement.innerHTML="<p><br/></p>":this.inputElement.value="",this.valueContainer&&(this.valueContainer.value="")),this.showCharCount&&this.countModule.refresh()},R.prototype.listOrderCorrection=function(e){for(var t=this.createElement("div"),n=(t.innerHTML=e,t.querySelectorAll("UL, OL")),i=0;i<n.length;i++)j.isNullOrUndefined(n[i])||j.isNullOrUndefined(n[i].parentElement)||j.isNullOrUndefined(n[i].previousElementSibling)||"UL"!==n[i].parentElement.nodeName&&"OL"!==n[i].parentElement.nodeName||n[i].previousElementSibling.appendChild(n[i]);return t.innerHTML},R.prototype.setHeight=function(e){this.element.style.height="auto"!==e?j.formatUnit(e):"auto","Expand"===this.toolbarSettings.type&&("string"==typeof this.height&&-1<this.height.indexOf("px")||"number"==typeof this.height)?this.element.classList.add(To):this.element.classList.remove(To)},R.prototype.setPlaceHolder=function(){this.inputElement&&this.placeholder&&!0!==this.iframeSettings.enable&&("Markdown"!==this.editorMode?(this.placeHolderWrapper||(this.placeHolderWrapper=this.createElement("span",{className:"rte-placeholder e-rte-placeholder "+this.getCssClass()}),this.fontSize.default&&(this.placeHolderWrapper.style.fontSize=this.fontSize.default),this.inputElement&&this.inputElement.parentElement.insertBefore(this.placeHolderWrapper,this.inputElement)),this.placeHolderWrapper.innerHTML=this.placeholder,!(0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2)||j.isNullOrUndefined(this.inputElement.firstChild)||"BR"!==this.inputElement.firstChild.nodeName&&("P"!==this.inputElement.firstChild.nodeName&&"DIV"!==this.inputElement.firstChild.nodeName||j.isNullOrUndefined(this.inputElement.firstChild.firstChild)||"BR"!==this.inputElement.firstChild.firstChild.nodeName)?this.placeHolderWrapper.classList.remove("enabled"):this.placeHolderWrapper.classList.add("enabled")):this.inputElement.setAttribute("placeholder",this.placeholder)),this.placeholder&&this.iframeSettings.enable&&this.inputElement&&(!(0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2)||j.isNullOrUndefined(this.inputElement.firstChild)||"BR"!==this.inputElement.firstChild.nodeName&&("P"!==this.inputElement.firstChild.nodeName&&"DIV"!==this.inputElement.firstChild.nodeName||j.isNullOrUndefined(this.inputElement.firstChild.firstChild)||"BR"!==this.inputElement.firstChild.firstChild.nodeName)?j.removeClass([this.inputElement],"e-rte-placeholder"):(j.addClass([this.inputElement],"e-rte-placeholder"),this.inputElement.setAttribute("placeholder",this.placeholder)))},R.prototype.setWidth=function(e){"auto"!==e?j.setStyleAttribute(this.element,{width:j.formatUnit(this.width)}):this.element.style.width="auto"},R.prototype.setCssClass=function(e){if(!j.isNullOrUndefined(e))for(var t=e.split(" "),n=0;n<t.length;n++)""!==t[n].trim()&&this.element.classList.add(t[n])},R.prototype.updateRTL=function(){this.notify(st,{enableRtl:this.enableRtl}),this.enableRtl?(this.element.classList.add(Nn),this.inputElement.classList.add(Nn)):(this.element.classList.remove(Nn),this.inputElement.classList.remove(Nn))},R.prototype.updateReadOnly=function(){this.notify(ht,{editPanel:this.inputElement,mode:this.readonly})},R.prototype.setReadOnly=function(e){this.updateReadOnly(),e||(this.readonly&&this.enabled?(this.unbindEvents(),this.unWireEvents()):this.enabled&&this.wireEvents())},R.prototype.print=function(){var t,n=this,e={element:this.inputElement,requestType:"print",cancel:!1};this.trigger(Oe,e,function(e){t=window.open("","print","height="+window.outerHeight+",width="+window.outerWidth),"msie"===j.Browser.info.name&&t.resizeTo(screen.availWidth,screen.availHeight),t=j.print(n.inputElement,t),e.cancel||n.trigger(Le,{requestType:"print"})})},R.prototype.refreshUI=function(){this.renderModule.refresh()},R.prototype.showFullScreen=function(){this.fullScreenModule.showFullScreen()},R.prototype.enableToolbarItem=function(e,t){this.toolbarModule.enableTBarItems(this.getBaseToolbarObject(),e,!0,t)},R.prototype.disableToolbarItem=function(e,t){this.toolbarModule.enableTBarItems(this.getBaseToolbarObject(),e,!1,t)},R.prototype.removeToolbarItem=function(e){this.toolbarModule.removeTBarItems(e)},R.prototype.getRange=function(){return this.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument())},R.prototype.initializeServices=function(){this.serviceLocator.register("rendererFactory",new pc),this.serviceLocator.register("rteLocale",this.localeObj=new j.L10n(this.getModuleName(),sr,this.locale)),this.serviceLocator.register("dialogRenderObject",new ma(this))},R.prototype.RTERender=function(){var e=this.serviceLocator.getService("rendererFactory");this.contentModule=e.getRenderer(c.RenderType.Content),this.fullScreenModule=new ec(this),this.enterKeyModule=new Lh(this),this.renderModule.render(),this.inputElement=this.contentModule.getEditPanel(),this.setHeight(this.height),nc(this.htmlAttributes,this,!1,!0),this.iframeSettings&&this.setIframeSettings(),this.setCssClass(this.cssClass),this.updateEnable(),this.setPlaceHolder(),this.updateRTL(),this.updateReadOnly(),this.updatePanelValue(),this.enableHtmlEncode&&!j.isNullOrUndefined(this.value)&&this.setProperties({value:this.encode(Rr(this.value))})},R.prototype.setIframeSettings=function(){var e,t;this.iframeSettings.resources&&(e=this.iframeSettings.resources.styles,t=this.iframeSettings.resources.scripts,!j.isNullOrUndefined(this.iframeSettings.resources.scripts)&&0<this.iframeSettings.resources.scripts.length&&this.InjectSheet(!0,t),!j.isNullOrUndefined(this.iframeSettings.resources.styles))&&0<this.iframeSettings.resources.styles.length&&this.InjectSheet(!1,e),this.iframeSettings.attributes&&nc(this.iframeSettings.attributes,this,!0,!1)},R.prototype.InjectSheet=function(e,t){try{if(t&&0<t.length)for(var n,i,o=this.contentModule.getDocument().querySelector("head"),r=0;r<t.length;r++)e?((n=this.createScriptElement()).src=t[r],o.appendChild(n)):((i=this.createStyleElement()).href=t[r],o.appendChild(i))}catch(e){}},R.prototype.createScriptElement=function(){var e=this.createElement("script",{className:Sn});return e.type="text/javascript",e},R.prototype.createStyleElement=function(){var e=this.createElement("link",{className:Tn});return e.rel="stylesheet",e},R.prototype.setValue=function(e){var t=this;if(this.valueTemplate){var n=new RegExp(/<(?=.*? .*?\/ ?>|br|hr|input|!--|wbr)[a-z]+.*?>|<([a-z]+).*?<\/\1>/i);if("string"==typeof this.valueTemplate&&n.test(this.valueTemplate))this.setProperties({value:this.valueTemplate});else{var i=j.compile(this.valueTemplate)("",this,"valueTemplate");if("string"!=typeof this.valueTemplate&&this.isReact){this.displayTempElem=this.createElement("div");for(var o=0;o<i.length;o++){var r=i[o];j.append([r],this.displayTempElem)}this.renderTemplates(function(){t.inputElement.innerHTML=t.displayTempElem.childNodes[0].innerHTML,t.setProperties({value:t.inputElement.innerHTML.trim()})})}else{var s=this.element;e&&(this.inputElement.innerHTML="",s=this.inputElement);for(o=0;o<i.length;o++){r=i[o];j.append([r],s)}this.setProperties({value:s.innerHTML.trim()}),this.renderReactTemplates()}}}else{n=!j.isNullOrUndefined(this.element.innerHTML)&&this.element.innerHTML.replace(/<(\/?|\!?)(!--!--)>/g,"").trim();""!==n&&("TEXTAREA"===this.element.tagName?this.setProperties({value:Rr(n)}):this.setProperties({value:n}))}},R.prototype.renderTemplates=function(e){this.renderReactTemplates(e)},R.prototype.updateResizeFlag=function(){this.isResizeInitialized=!0},R.prototype.getInsertImgMaxWidth=function(){var e=this.insertImageSettings.maxWidth,t=this.contentModule.getEditPanel(),n=("HTML"!==this.editorMode||j.isNullOrUndefined(this.formatter.editorManager.nodeSelection)||j.isNullOrUndefined(this.formatter.editorManager.nodeSelection.range)||3!==(n=this.formatter.editorManager.nodeSelection.range).startContainer.nodeType&&n.startContainer.closest&&!j.isNullOrUndefined(n.startContainer.closest("TD"))&&(t=n.startContainer),window.getComputedStyle(t)),t=t.offsetWidth-(14+parseFloat(n.paddingLeft.split("px")[0])+parseFloat(n.paddingRight.split("px")[0])+parseFloat(n.marginLeft.split("px")[0])+parseFloat(n.marginRight.split("px")[0]));return j.isNullOrUndefined(e)?t:e},R.prototype.getInsertVidMaxWidth=function(){var e=this.insertVideoSettings.maxWidth,t=this.contentModule.getEditPanel(),n=window.getComputedStyle(t),t=t.offsetWidth-(14+parseFloat(n.paddingLeft.split("px")[0])+parseFloat(n.paddingRight.split("px")[0])+parseFloat(n.marginLeft.split("px")[0])+parseFloat(n.marginRight.split("px")[0]));return j.isNullOrUndefined(e)?t:e},R.prototype.getHtml=function(){var e=this.removeResizeElement(this.contentModule.getEditPanel().innerHTML);return!this.enableXhtml||"<p><br></p>"!==e&&"<div><br></div>"!==e&&"<br>"!==e?this.serializeValue(e):null},R.prototype.getXhtml=function(){var e=this.removeResizeElement(this.value);return e=!j.isNullOrUndefined(e)&&this.enableXhtml?this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e):e},R.prototype.showSourceCode=function(){this.readonly||this.notify(qe,{})},R.prototype.getCharCount=function(){var e=("Markdown"===this.editorMode?this.inputElement.value:this.inputElement.textContent).trim(),e=("Markdown"!==this.editorMode&&-1!==e.indexOf("")?e.replace(/\u200B/g,""):e).length;return e},R.prototype.showDialog=function(e){e===c.DialogType.InsertLink?this.notify(Qt,{}):e===c.DialogType.InsertImage?this.notify(Kt,{}):e===c.DialogType.InsertAudio?this.notify(Gt,{}):e===c.DialogType.InsertVideo?this.notify(Xt,{}):e===c.DialogType.InsertTable&&this.notify(Zt,{})},R.prototype.closeDialog=function(e){e===c.DialogType.InsertLink?this.notify(Wt,{}):e===c.DialogType.InsertImage?this.notify(Yt,{}):e===c.DialogType.InsertAudio?this.notify(Jt,{}):e===c.DialogType.InsertVideo?this.notify($t,{}):e===c.DialogType.InsertTable&&this.notify(en,{})},R.prototype.getBaseToolbarObject=function(){var e=!this.inlineMode.enable||j.Browser.isDevice&&!br()?this.toolbarModule&&this.toolbarModule.getBaseToolbar():this.quickToolbarModule&&this.quickToolbarModule.getInlineBaseToolbar();return e},R.prototype.getToolbar=function(){return this.toolbarModule?this.toolbarModule.getToolbarElement():null},R.prototype.getToolbarElement=function(){return this.toolbarModule&&this.toolbarModule.getToolbarElement()},R.prototype.getID=function(){return this.internalID},R.prototype.getCssClass=function(e){return j.isNullOrUndefined(this.cssClass)?"":e?" "+this.cssClass:this.cssClass},R.prototype.mouseDownHandler=function(e){var t=e.touches?e.changedTouches[0]:e;j.addClass([this.element],[$n]),this.preventDefaultResize(e),this.notify(Ke,{args:e}),this.formatter.editorManager.observer.notify(Ke,{args:e}),this.clickPoints={clientX:t.clientX,clientY:t.clientY}},R.prototype.preventImgResize=function(e){"img"===e.target.nodeName.toLocaleLowerCase()&&e.preventDefault()},R.prototype.preventDefaultResize=function(e){"msie"===j.Browser.info.name?this.contentModule.getEditPanel().addEventListener("mscontrolselect",this.preventImgResize):"mozilla"===j.Browser.info.name&&(this.contentModule.getDocument().execCommand("enableObjectResizing",!1,"false"),this.contentModule.getDocument().execCommand("enableInlineTableEditing",!1,"false"))},R.prototype.defaultResize=function(e){"msie"===j.Browser.info.name?this.contentModule.getEditPanel().removeEventListener("mscontrolselect",this.preventImgResize):"mozilla"===j.Browser.info.name&&(this.contentModule.getDocument().execCommand("enableObjectResizing",!0,"true"),this.contentModule.getDocument().execCommand("enableInlineTableEditing",!0,"true"))},R.prototype.resizeHandler=function(){document.body.contains(this.element)?(this.toolbarSettings.enable&&!this.inlineMode.enable&&this.toolbarModule.refreshToolbarOverflow(),this.notify(be,null),this.autoResize()):(document.defaultView.removeEventListener("resize",this.resizeHandler,!0),this.onResizeHandler=null)},R.prototype.scrollHandler=function(e){this.element&&this.notify(Ye,{args:e})},R.prototype.contentScrollHandler=function(e){this.notify(Je,{args:e})},R.prototype.focusHandler=function(e){if(!this.isRTE||this.isFocusOut){this.isRTE=!this.isFocusOut,this.isFocusOut=!1,j.addClass([this.element],[$n]),"HTML"===this.editorMode?this.cloneValue="<p><br></p>"===this.inputElement.innerHTML||"<div><br></div>"===this.inputElement.innerHTML||"<br>"===this.inputElement.innerHTML?null:this.enableHtmlEncode?this.encode(Rr(this.inputElement.innerHTML)):this.inputElement.innerHTML:this.cloneValue=""===this.inputElement.value?null:this.inputElement.value;var t=document.activeElement;if((t===this.element||t===this.getToolbarElement()||t===this.contentModule.getEditPanel()||this.iframeSettings.enable&&t===this.contentModule.getPanel()&&e.target&&!e.target.classList.contains("e-img-inner")&&e.target&&e.target.parentElement&&!e.target.parentElement.classList.contains("e-img-wrap")||j.closest(t,".e-rte-toolbar")===this.getToolbarElement())&&(this.contentModule.getEditPanel().focus(),!j.isNullOrUndefined(this.getToolbarElement()))){this.getToolbarElement().setAttribute("tabindex","-1");for(var n=this.getToolbarElement().querySelectorAll('[tabindex="0"]'),i=0;i<n.length;i++)n[i].setAttribute("tabindex","-1")}this.preventDefaultResize(e),this.trigger("focus",{event:e,isInteracted:0!==Object.keys(e).length}),!j.isNullOrUndefined(this.saveInterval)&&0<this.saveInterval&&!this.autoSaveOnIdle&&j.isNullOrUndefined(this.timeInterval)&&(this.timeInterval=setInterval(this.updateValueOnIdle.bind(this),this.saveInterval)),j.EventHandler.add(document,"mousedown",this.onDocumentClick,this)}this.readonly||"editArea"!==(t=this.getCurrentFocus(e))&&"textArea"!==t&&"sourceCode"!==t||this.resetToolbarTabIndex()},R.prototype.getUpdatedValue=function(){var e,t=this.element.querySelector("."+wo);return"HTML"===this.editorMode?(e="<p><br></p>"===this.inputElement.innerHTML||"<div><br></div>"===this.inputElement.innerHTML||"<br>"===this.inputElement.innerHTML?null:this.enableHtmlEncode?this.encode(Rr(this.removeResizeElement(this.inputElement.innerHTML))):this.inputElement.innerHTML,!j.isNullOrUndefined(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(e=t.value)):e=""===this.inputElement.value?null:this.inputElement.value,e=null==e||this.enableHtmlEncode?e:this.removeResizeElement(e)},R.prototype.updateValueOnIdle=function(){(j.isNullOrUndefined(this.tableModule)||j.isNullOrUndefined(this.inputElement.querySelector(".e-table-box.e-rbox-select")))&&(this.setProperties({value:this.getUpdatedValue()},!0),this.valueContainer.value=this.value,this.isValueChangeBlurhandler=!1,this.invokeChangeEvent())},R.prototype.updateIntervalValue=function(){clearTimeout(this.idleInterval),this.idleInterval=setTimeout(this.updateValueOnIdle.bind(this),0)},R.prototype.cleanupResizeElements=function(e){var t=this.removeResizeElement(e.value);e.callBack(t)},R.prototype.addAnchorAriaLabel=function(e){var t=document.createElement("div"),n=(t.innerHTML=e,t.querySelectorAll("a"));if(0<n.length)for(var i=0;i<n.length;i++)n[i].hasAttribute("target")&&"_blank"===n[i].getAttribute("target")&&n[i].setAttribute("aria-label",this.serviceLocator.getService("rteLocale").getConstant("linkAriaLabel"));return t.innerHTML},R.prototype.removeResizeElement=function(e){var t=document.createElement("div");if("HTML"===this.editorMode){t.innerHTML=e;var n=t.querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box, .e-table-rhelper, .e-img-resize");if(0<n.length)for(var i=0;i<n.length;i++)j.detach(n[i]);this.removeSelectionClassStates(t)}else t.textContent=e;return"Markdown"===this.editorMode?t.innerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t.innerHTML},R.prototype.updateStatus=function(e){var t;j.isNullOrUndefined(e.html)&&j.isNullOrUndefined(e.markdown)||(t={undo:(t=this.formatter.editorManager.undoRedoManager.getUndoStatus()).undo,redo:t.redo,html:e.html,markdown:e.markdown},this.trigger(we,t))},R.prototype.onDocumentClick=function(e){var t=e.target,n=j.closest(t,"."+Cn),n=(this.element.contains(e.target)||document===e.target||n===this.element||j.closest(t,'[aria-owns="'+this.getID()+'"]')||(this.isBlur=!0,this.isRTE=!1),this.notify(lt,{args:e}),this.quickToolbarModule&&!this.inlineMode.enable&&j.isNullOrUndefined(this.quickToolbarModule.inlineQTBar));(!n||j.isNullOrUndefined(j.closest(t,".e-toolbar-wrapper")))&&(!n||j.isNullOrUndefined(j.closest(t,".e-rte-table-resize"))&&j.isNullOrUndefined(j.closest(t,".e-table-box")))||this.quickToolbarModule.hideQuickToolbars(),"msie"!==j.Browser.info.name&&3<e.detail&&e.preventDefault()},R.prototype.blurHandler=function(e){var t,n,i=e.relatedTarget;i&&((t=!(t=j.closest(i,"."+Cn))&&this.iframeSettings.enable&&(n=this.element.querySelector("#"+this.getID()+"_rte-view"))&&n.contentWindow.document.body.contains(i)?j.closest(n,"."+Cn):t)&&t===this.element?(this.isBlur=!1,i===this.getToolbarElement()&&i.setAttribute("tabindex","-1")):j.closest(i,'[aria-owns="'+this.getID()+'"]')||j.closest(i,"."+Ei)?this.isBlur=!1:(this.isBlur=!0,i=null)),this.isBlur&&j.isNullOrUndefined(i)?(j.removeClass([this.element],[$n]),this.removeSelectionClassStates(this.inputElement),this.notify(et,{}),n=this.getUpdatedValue(),this.setProperties({value:n}),this.valueContainer.value=this.value,this.notify(X,{args:e,documentNode:document}),this.isValueChangeBlurhandler=!0,this.invokeChangeEvent(),this.isFocusOut=!0,this.isBlur=!1,Or(this.valueContainer,"focusout"),this.defaultResize(e),this.trigger("blur",{event:e,isInteracted:0!==Object.keys(e).length}),j.isNullOrUndefined(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null),!j.isNullOrUndefined(this.placeHolderWrapper)&&this.element.querySelector("[title = Preview]")&&(this.placeHolderWrapper.style.display="none"),j.EventHandler.remove(document,"mousedown",this.onDocumentClick)):this.isRTE=!0,this.readonly||"outside"!==this.getCurrentFocus(e)||this.resetToolbarTabIndex()},R.prototype.contentChanged=function(){!this.autoSaveOnIdle||j.isNullOrUndefined(this.saveInterval)||(clearTimeout(this.autoSaveTimeOut),this.autoSaveTimeOut=setTimeout(this.updateIntervalValue.bind(this),this.saveInterval))},R.prototype.invokeChangeEvent=function(){var e=this.enableXhtml?this.getXhtml():this.value,e={value:e,isInteracted:this.isValueChangeBlurhandler};this.value!==this.cloneValue&&(this.trigger("change",e),this.cloneValue=this.value)},R.prototype.wireScrollElementsEvents=function(){this.scrollParentElements=U.getScrollableParent(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];j.EventHandler.add(n,"scroll",this.scrollHandler,this)}this.iframeSettings.enable||j.EventHandler.add(this.inputElement,"scroll",this.contentScrollHandler,this)},R.prototype.wireContextEvent=function(){this.quickToolbarSettings.showOnRightClick&&(j.EventHandler.add(this.inputElement,"contextmenu",this.contextHandler,this),j.Browser.isDevice)&&(this.touchModule=new j.Touch(this.inputElement,{tapHold:this.touchHandler.bind(this),tapHoldThreshold:500}))},R.prototype.unWireContextEvent=function(){j.EventHandler.remove(this.inputElement,"contextmenu",this.contextHandler),j.Browser.isDevice&&this.touchModule&&this.touchModule.destroy()},R.prototype.unWireScrollElementsEvents=function(){this.scrollParentElements=U.getScrollableParent(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];j.EventHandler.remove(n,"scroll",this.scrollHandler)}this.iframeSettings.enable||j.EventHandler.remove(this.inputElement,"scroll",this.contentScrollHandler)},R.prototype.touchHandler=function(e){this.notifyMouseUp(e.originalEvent),this.triggerEditArea(e.originalEvent)},R.prototype.contextHandler=function(e){var t=j.closest(e.target,"a, table, img, video, audio");!t&&e.target&&e.target.classList&&(e.target.classList.contains(ai)||e.target.classList.contains(ri))&&(t=e.target.querySelector("audio")),!1!==this.inlineMode.onSelection&&(j.isNullOrUndefined(t)||!this.inputElement.contains(t)||"IMG"!==t.tagName&&"TABLE"!==t.tagName&&"A"!==t.tagName&&"video"!==t.tagName.toLowerCase()&&"audio"!==t.tagName.toLowerCase())||e.preventDefault()},R.prototype.resetHandler=function(){var e=this.valueContainer.defaultValue.trim();this.setProperties({value:""===e?null:e})},R.prototype.autoResize=function(){var e,t;this.element&&this.originalElement&&this.valueContainer&&("auto"===this.height?"Markdown"===this.editorMode?this.setAutoHeight(this.inputElement):this.iframeSettings.enable&&(e=this.element.querySelector("#"+this.getID()+"_rte-view"))&&(this.setAutoHeight(e),this.inputElement.style.overflow="hidden"):"Markdown"===this.editorMode?(e=this.inputElement,t=this.enableResize||this.showCharCount?20:0,e&&(e.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+t+3)+"px")):this.iframeSettings.enable&&(e=this.element.querySelector("#"+this.getID()+"_rte-view"),t=this.enableResize||this.showCharCount?20:0,e)&&(e.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+t+3)+"px"))},R.prototype.setAutoHeight=function(e){j.isNullOrUndefined(e)||(e.style.height="auto",e.style.height=this.inputElement.scrollHeight+16+"px",e.style.overflow="hidden")},R.prototype.wireEvents=function(){this.onBlurHandler=this.blurHandler.bind(this),this.onFocusHandler=this.focusHandler.bind(this),this.onResizeHandler=this.resizeHandler.bind(this),this.element.addEventListener("focusin",this.onFocusHandler,!0),this.element.addEventListener("focusout",this.onBlurHandler,!0),this.on(W,this.contentChanged,this),this.on(Ht,this.updateResizeFlag,this),this.on(Vt,this.updateStatus,this),this.on(ln,this.cleanupResizeElements,this),this.on(cn,this.updateValueOnIdle,this),this.on(mn,this.autoResize,this),this.iframeSettings.enable&&(this.onLoadHandler=this.iframeEditableElemLoad.bind(this),this.contentModule.getEditPanel().addEventListener("load",this.onLoadHandler,!0)),this.readonly&&this.enabled||this.bindEvents()},R.prototype.restrict=function(e){if(0<=this.maxLength){var t="Markdown"===this.editorMode?this.contentModule.getText():this.getText().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"");if(t){for(var n=[8,16,17,37,38,39,40,46,65],i=void 0,o=0;o<=n.length-1;o++)if(e.which===n[o]){if(e.ctrlKey&&65===e.which)return;if(65!==e.which)return void(i=n[o])}t.length>=this.maxLength&&-1!==this.maxLength&&e.which!==i&&e.preventDefault()}}},R.prototype.bindEvents=function(){this.keyboardModule=new ca(this.inputElement,{keyAction:this.keyDown.bind(this),keyConfigs:Dh({},this.formatter.keyConfig,this.keyConfig),eventName:"keydown"});var e=j.closest(this.valueContainer,"form");e&&j.EventHandler.add(e,"reset",this.resetHandler,this),j.EventHandler.add(this.inputElement,"keyup",this.keyUp,this),j.EventHandler.add(this.inputElement,"paste",this.onPaste,this),j.EventHandler.add(this.inputElement,"content-changed",this.contentChanged,this),this.mouseDownDebListener=j.debounce(this.mouseUp,30),j.EventHandler.add(this.inputElement,j.Browser.touchEndEvent,this.mouseDownDebListener,this),j.EventHandler.add(this.inputElement,j.Browser.touchStartEvent,this.mouseDownHandler,this),j.EventHandler.add(this.inputElement,"input",this.inputHandler,this),this.wireContextEvent(),this.formatter.editorManager.observer.on(m,this.editorKeyDown,this),this.element.ownerDocument.defaultView.addEventListener("resize",this.onResizeHandler,!0),this.iframeSettings.enable&&(j.EventHandler.add(this.inputElement,"focusin",this.focusHandler,this),j.EventHandler.add(this.inputElement,"focusout",this.blurHandler,this),j.EventHandler.add(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler,this),j.EventHandler.add(this.inputElement.ownerDocument,j.Browser.touchStartEvent,this.onIframeMouseDown,this),j.EventHandler.add(this.contentModule.getPanel(),"load",this.iframeLoadHandler,this)),this.wireScrollElementsEvents()},R.prototype.onIframeMouseDown=function(e){this.isBlur=!1,this.currentTarget=e.target,this.notify(K,e)},R.prototype.inputHandler=function(){this.autoResize()},R.prototype.editorKeyDown=function(e){switch(e.event.action){case"copy":this.onCopy();break;case"cut":this.onCut();break;case"tab":this.iframeSettings.enable&&(this.isBlur=!0)}!e.callBack||"copy"!==e.event.action&&"cut"!==e.event.action&&"delete"!==e.event.action||e.callBack({requestType:e.event.action,editorMode:"HTML",event:e.event})},R.prototype.unWireEvents=function(){this.element.removeEventListener("focusin",this.onFocusHandler,!0),this.onFocusHandler=null,this.element.removeEventListener("focusout",this.onBlurHandler,!0),this.onBlurHandler=null,this.off(W,this.contentChanged),this.off(Ht,this.updateResizeFlag),this.off(Vt,this.updateStatus),this.off(ln,this.cleanupResizeElements),this.off(cn,this.updateValueOnIdle),this.off(mn,this.autoResize),this.iframeSettings.enable&&(this.contentModule.getEditPanel().removeEventListener("load",this.onLoadHandler,!0),this.onLoadHandler=null),this.readonly&&this.enabled||this.unbindEvents()},R.prototype.unbindEvents=function(){this.keyboardModule&&!this.keyboardModule.isDestroyed&&(this.keyboardModule.destroy(),this.keyboardModule=null);var e=j.closest(this.valueContainer,"form");e&&j.EventHandler.remove(e,"reset",this.resetHandler),j.EventHandler.remove(this.inputElement,"keyup",this.keyUp),j.EventHandler.remove(this.inputElement,"paste",this.onPaste),j.EventHandler.remove(this.inputElement,"content-changed",this.contentChanged),j.EventHandler.remove(this.inputElement,j.Browser.touchEndEvent,this.mouseDownDebListener),this.mouseDownDebListener=null,j.EventHandler.remove(this.inputElement,j.Browser.touchStartEvent,this.mouseDownHandler),j.EventHandler.remove(this.inputElement,"input",this.inputHandler),j.EventHandler.remove(document,"mousedown",this.onDocumentClick),this.unWireContextEvent(),this.formatter&&this.formatter.editorManager.observer.off(m,this.editorKeyDown),this.element.ownerDocument.defaultView.removeEventListener("resize",this.onResizeHandler,!0),this.onResizeHandler=null,this.iframeSettings.enable&&(j.EventHandler.remove(this.inputElement,"focusin",this.focusHandler),j.EventHandler.remove(this.inputElement,"focusout",this.blurHandler),j.EventHandler.remove(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler),j.EventHandler.remove(this.inputElement.ownerDocument,j.Browser.touchStartEvent,this.onIframeMouseDown),j.EventHandler.remove(this.contentModule.getPanel(),"load",this.iframeLoadHandler)),this.unWireScrollElementsEvents()},R.prototype.getCurrentFocus=function(e){return e.target===this.inputElement&&document.activeElement===this.inputElement?"editArea":e.target===this.getToolbarElement()||!j.isNullOrUndefined(e.relatedTarget)&&j.closest(e.relatedTarget,".e-rte-toolbar")===this.getToolbarElement()?"toolbar":e.target===this.valueContainer&&document.activeElement===this.valueContainer?"textArea":!j.isNullOrUndefined(e.target)&&e.target.classList.contains(wo)&&document.activeElement===e.target?"sourceCode":"outside"},R.prototype.resetToolbarTabIndex=function(){if(this.getToolbarElement())for(var e=this.getToolbarElement().querySelectorAll("input,select,button,a,[tabindex]"),t=0;t<e.length;t++)e[t].classList.contains("e-rte-dropdown-btn")||e[t].classList.contains("e-insert-table-btn")||e[t].hasAttribute("tabindex")&&"-1"===e[t].getAttribute("tabindex")||e[t].setAttribute("tabindex","-1")},R.prototype.removeSelectionClassStates=function(e){for(var t=[ao,zi,Vi,_i,co,lo],n=0;n<t.length;n++){var i=e.querySelectorAll("."+t[n]);if(j.removeClass(i,t[n]),0!==i.length)for(var o=0;o<i.length;o++)0===i[o].classList.length&&i[o].removeAttribute("class"),"IMG"===i[o].nodeName&&""!==i[o].style.outline&&(i[o].style.outline="")}},R.prototype.getRenderedQuickToolbarElem=function(){for(var e=this.quickToolbarModule.getQuickToolbarInstance(),t=0;t<e.length;t++)if(e[t]&&e[t].isRendered)return e[t].element;return null},R.prototype.iframeLoadHandler=function(){this.autoResize()},R.prototype.iframeEditableElemLoad=function(){this.autoResize()},B([j.Complex({},e)],R.prototype,"toolbarSettings",void 0),B([j.Complex({enable:!1,items:["Paragraph","Heading 1","Heading 2","Heading 3","Heading 4","OrderedList","UnorderedList","CodeBlock","Blockquote"],popupWidth:"300px",popupHeight:"320px"},la)],R.prototype,"slashMenuSettings",void 0),B([j.Complex({},_c)],R.prototype,"quickToolbarSettings",void 0),B([j.Complex({},Jc)],R.prototype,"pasteCleanupSettings",void 0),B([j.Complex({},Wc)],R.prototype,"formatPainterSettings",void 0),B([j.Complex({},rr)],R.prototype,"emojiPickerSettings",void 0),B([j.Complex({},M)],R.prototype,"iframeSettings",void 0),B([j.Complex({},kc)],R.prototype,"insertImageSettings",void 0),B([j.Complex({},vc)],R.prototype,"importWord",void 0),B([j.Complex({},Ec)],R.prototype,"exportWord",void 0),B([j.Complex({},Oc)],R.prototype,"exportPdf",void 0),B([j.Complex({},Mc)],R.prototype,"insertAudioSettings",void 0),B([j.Complex({},Ac)],R.prototype,"insertVideoSettings",void 0),B([j.Complex({},Fc)],R.prototype,"tableSettings",void 0),B([j.Property(0)],R.prototype,"floatingToolbarOffset",void 0),B([j.Complex({},vh)],R.prototype,"inlineMode",void 0),B([j.Complex({},Pc)],R.prototype,"fileManagerSettings",void 0),B([j.Property("100%")],R.prototype,"width",void 0),B([j.Property(!1)],R.prototype,"enablePersistence",void 0),B([j.Property(!0)],R.prototype,"showTooltip",void 0),B([j.Property(!1)],R.prototype,"enableResize",void 0),B([j.Property({})],R.prototype,"htmlAttributes",void 0),B([j.Property(null)],R.prototype,"placeholder",void 0),B([j.Property(!1)],R.prototype,"autoSaveOnIdle",void 0),B([j.Property(!1)],R.prototype,"readonly",void 0),B([j.Property(!0)],R.prototype,"enabled",void 0),B([j.Property(!0)],R.prototype,"enableHtmlSanitizer",void 0),B([j.Property(!1)],R.prototype,"enableHtmlEncode",void 0),B([j.Property(!1)],R.prototype,"enableXhtml",void 0),B([j.Property("auto")],R.prototype,"height",void 0),B([j.Property(null)],R.prototype,"cssClass",void 0),B([j.Property(null)],R.prototype,"value",void 0),B([j.Property("P")],R.prototype,"enterKey",void 0),B([j.Property("BR")],R.prototype,"shiftEnterKey",void 0),B([j.Property(30)],R.prototype,"undoRedoSteps",void 0),B([j.Property(300)],R.prototype,"undoRedoTimer",void 0),B([j.Property("HTML")],R.prototype,"editorMode",void 0),B([j.Property(null)],R.prototype,"keyConfig",void 0),B([j.Property(!1)],R.prototype,"showCharCount",void 0),B([j.Property(!1)],R.prototype,"enableTabKey",void 0),B([j.Property(!1)],R.prototype,"enableAutoUrl",void 0),B([j.Property(-1)],R.prototype,"maxLength",void 0),B([j.Complex({},rh)],R.prototype,"format",void 0),B([j.Complex({},ph)],R.prototype,"numberFormatList",void 0),B([j.Complex({},fc)],R.prototype,"bulletFormatList",void 0),B([j.Complex({},eh)],R.prototype,"fontFamily",void 0),B([j.Complex({},Jo)],R.prototype,"fontSize",void 0),B([j.Complex({},Zo)],R.prototype,"fontColor",void 0),B([j.Complex({},er)],R.prototype,"backgroundColor",void 0),B([j.Property(null)],R.prototype,"valueTemplate",void 0),B([j.Property(1e4)],R.prototype,"saveInterval",void 0),B([j.Event()],R.prototype,"actionBegin",void 0),B([j.Event()],R.prototype,"actionComplete",void 0),B([j.Event()],R.prototype,"beforeDialogOpen",void 0),B([j.Event()],R.prototype,"dialogOpen",void 0),B([j.Event()],R.prototype,"beforeDialogClose",void 0),B([j.Event()],R.prototype,"dialogClose",void 0),B([j.Event()],R.prototype,"beforeQuickToolbarOpen",void 0),B([j.Event()],R.prototype,"quickToolbarOpen",void 0),B([j.Event()],R.prototype,"quickToolbarClose",void 0),B([j.Event()],R.prototype,"toolbarStatusUpdate",void 0),B([j.Event()],R.prototype,"updatedToolbarStatus",void 0),B([j.Event()],R.prototype,"imageSelected",void 0),B([j.Event()],R.prototype,"beforeImageUpload",void 0),B([j.Event()],R.prototype,"imageUploading",void 0),B([j.Event()],R.prototype,"imageUploadSuccess",void 0),B([j.Event()],R.prototype,"imageUploadFailed",void 0),B([j.Event()],R.prototype,"imageRemoving",void 0),B([j.Event()],R.prototype,"afterImageDelete",void 0),B([j.Event()],R.prototype,"fileSelected",void 0),B([j.Event()],R.prototype,"beforeFileUpload",void 0),B([j.Event()],R.prototype,"fileUploading",void 0),B([j.Event()],R.prototype,"fileUploadSuccess",void 0),B([j.Event()],R.prototype,"fileUploadFailed",void 0),B([j.Event()],R.prototype,"fileRemoving",void 0),B([j.Event()],R.prototype,"afterMediaDelete",void 0),B([j.Event()],R.prototype,"created",void 0),B([j.Event()],R.prototype,"destroyed",void 0),B([j.Event()],R.prototype,"beforeSanitizeHtml",void 0),B([j.Event()],R.prototype,"blur",void 0),B([j.Event()],R.prototype,"toolbarClick",void 0),B([j.Event()],R.prototype,"focus",void 0),B([j.Event()],R.prototype,"change",void 0),B([j.Event()],R.prototype,"resizing",void 0),B([j.Event()],R.prototype,"resizeStart",void 0),B([j.Event()],R.prototype,"resizeStop",void 0),B([j.Event()],R.prototype,"beforePasteCleanup",void 0),B([j.Event()],R.prototype,"afterPasteCleanup",void 0),B([j.Event()],R.prototype,"beforeImageDrop",void 0),B([j.Property(null)],R.prototype,"formatter",void 0),B([j.Event()],R.prototype,"slashMenuItemSelect",void 0),B([j.NotifyPropertyChanges],R));function R(e,t){e=xh.call(this,e,t)||this;return e.needsID=!0,e.isCopyAll=!1,e}c.ACTION=Qs,c.ALIGNMENT_TYPE=rs,c.ALLOWED_ACTIONKEYS=ko,c.AUDIO=Vr,c.Alignments=Fl,c.Audio=js,c.AudioCommand=md,c.BLOCKQUOTE_LIST_HANDLE=ia,c.BLOCK_TAGS=ls,c.BaseQuickToolbar=ja,c.BaseToolbar=Ma,c.CLASS_AUDIO=od,c.CLASS_AUDIO_BREAK=Jl,c.CLASS_AUDIO_FOCUS=dd,c.CLASS_AUDIO_INLINE=td,c.CLASS_AUDIO_WRAP=sd,c.CLASS_CAPTION=T,c.CLASS_CAPTION_INLINE=Zl,c.CLASS_CLICK_ELEM=nd,c.CLASS_EMBED_VIDEO_WRAP=ld,c.CLASS_IMAGE_BREAK=Yl,c.CLASS_IMAGE_CENTER=Wl,c.CLASS_IMAGE_INLINE=ed,c.CLASS_IMAGE_LEFT=Ql,c.CLASS_IMAGE_RIGHT=Vl,c.CLASS_RTE_CAPTION="e-rte-img-caption",c.CLASS_VIDEO=rd,c.CLASS_VIDEO_BREAK=$l,c.CLASS_VIDEO_CENTER=Xl,c.CLASS_VIDEO_CLICK_ELEM=id,c.CLASS_VIDEO_FOCUS=cd,c.CLASS_VIDEO_INLINE=hd,c.CLASS_VIDEO_LEFT=Gl,c.CLASS_VIDEO_RIGHT=Kl,c.CLASS_VIDEO_WRAP=ad,c.CLEAR_COMMAND=tl,c.CLEAR_TYPE=ms,c.CLS_ACTIVE=Ci,c.CLS_ALIGN_TB_BTN=Bi,c.CLS_AUDIOBREAK=oi,c.CLS_AUDIOINLINE=mi,c.CLS_AUDIOWRAP=ai,c.CLS_AUD_FOCUS=lo,c.CLS_BACK="e-back",c.CLS_BACKGROUND_COLOR_DROPDOWN=Pi,c.CLS_BACKGROUND_COLOR_PICKER=Fi,c.CLS_BACKGROUND_COLOR_TARGET=Ai,c.CLS_BULLETFORMATLIST_TB_BTN=ki,c.CLS_CAPINLINE=pi,c.CLS_CAPTION=ci,c.CLS_CLICKELEM=ri,c.CLS_COLOR_CONTENT=Ii,c.CLS_COLOR_PALETTE=Hi,c.CLS_CONTENT="e-content",c.CLS_COUNT=fi,c.CLS_CUSTOM_TILE=Co,c.CLS_DISABLED=En,c.CLS_DROPAREA=go,c.CLS_DROPDOWN_BTN=Qn,c.CLS_DROPDOWN_ICONS=_n,c.CLS_DROPDOWN_ITEMS=Vn,c.CLS_DROPDOWN_POPUP=zn,c.CLS_ERROR=yi,c.CLS_EXPAND_OPEN=Ni,c.CLS_FOCUS=$n,c.CLS_FONT_COLOR_DROPDOWN=Ui,c.CLS_FONT_COLOR_PICKER=ji,c.CLS_FONT_COLOR_TARGET=Ri,c.CLS_FONT_NAME_TB_BTN=Di,c.CLS_FONT_SIZE_TB_BTN=Mi,c.CLS_FORMATS_TB_BTN=xi,c.CLS_FULL_SCREEN=Mn,c.CLS_HIDE=Yn,c.CLS_HR_SEPARATOR=Ti,c.CLS_ICONS=vi,c.CLS_IMAGE_POP=Hn,c.CLS_IMGBREAK=ii,c.CLS_IMGCENTER=ni,c.CLS_IMGINLINE=ui,c.CLS_IMGLEFT=ti,c.CLS_IMGRIGHT=ei,c.CLS_IMG_FOCUS=ao,c.CLS_IMG_INNER=fo,c.CLS_IMG_RESIZE=mo,c.CLS_INLINE=xn,c.CLS_INLINE_DROPDOWN=qn,c.CLS_INLINE_POP=Fn,c.CLS_LIST_PRIMARY_CONTENT=Li,c.CLS_MAXIMIZE="e-maximize",c.CLS_MINIMIZE="e-minimize",c.CLS_NOCOLOR_ITEM=No,c.CLS_NUMBERFORMATLIST_TB_BTN=wi,c.CLS_POP=An,c.CLS_POPUP="e-popup",c.CLS_POPUP_OPEN=uo,c.CLS_QUICK_DROPDOWN=Pn,c.CLS_QUICK_POP=Un,c.CLS_QUICK_TB=Bn,c.CLS_RESIZE=so,c.CLS_RM_WHITE_SPACE=Zn,c.CLS_RTE=Cn,c.CLS_RTE_CAPTION=hi,c.CLS_RTE_CONTAINER=On,c.CLS_RTE_CONTENT=Wn,c.CLS_RTE_DIALOG_MIN_HEIGHT=no,c.CLS_RTE_DIALOG_UPLOAD=yo,c.CLS_RTE_DRAG_IMAGE=ho,c.CLS_RTE_ELEMENTS=Ei,c.CLS_RTE_EXPAND_TB=Dn,c.CLS_RTE_FIXED_TB_EXPAND=To,c.CLS_RTE_HIDDEN=Yi,c.CLS_RTE_IMAGE=ro,c.CLS_RTE_PASTE_CANCEL=to,c.CLS_RTE_PASTE_KEEP_FORMAT=Ji,c.CLS_RTE_PASTE_OK=eo,c.CLS_RTE_PASTE_PLAIN_FORMAT=Zi,c.CLS_RTE_PASTE_REMOVE_FORMAT=$i,c.CLS_RTE_READONLY=qi,c.CLS_RTE_RES_CNT=vo,c.CLS_RTE_RES_EAST=oo,c.CLS_RTE_RES_HANDLE=io,c.CLS_RTE_RES_WEST=Lo,c.CLS_RTE_SOURCE_CODE_TXTAREA=wo,c.CLS_RTE_TABLE_RESIZE=So,c.CLS_RTE_TB_ENABLED=Oo,c.CLS_RTE_UPLOAD_POPUP=po,c.CLS_RTL=Nn,c.CLS_SCRIPT_SHEET=Sn,c.CLS_SEPARATOR="e-separator",c.CLS_SHOW=Xn,c.CLS_STYLE_SHEET=Tn,c.CLS_TABLE="e-rte-table",c.CLS_TABLE_BORDER=Eo,c.CLS_TABLE_MULTI_CELL=Vi,c.CLS_TABLE_SEL=zi,c.CLS_TABLE_SEL_END=_i,c.CLS_TB_ALT_BOR=Wi,c.CLS_TB_BOX_RES=Xi,c.CLS_TB_BTN=Si,c.CLS_TB_COL_RES=Ki,c.CLS_TB_DASH_BOR=Qi,c.CLS_TB_EXTENDED="e-toolbar-extended",c.CLS_TB_FIXED=wn,c.CLS_TB_FLOAT=kn,c.CLS_TB_INLINE="e-rte-tb-inline",c.CLS_TB_IOS_FIX=Oi,c.CLS_TB_ITEM=Kn,c.CLS_TB_ROW_RES=Gi,c.CLS_TB_STATIC=In,c.CLS_TB_WRAP=Gn,c.CLS_TEXT_POP=jn,c.CLS_TEXT_QUICK_TB=Rn,c.CLS_TOOLBAR=Ln,c.CLS_UPLOAD_FILES=bo,c.CLS_VIDEOBREAK=di,c.CLS_VIDEOINLINE=gi,c.CLS_VIDEOWRAP=li,c.CLS_VID_CLICK_ELEM=si,c.CLS_VID_FOCUS=co,c.CLS_VISIBLE=Jn,c.CLS_WARNING=bi,c.ClearFormat=gl,c.ClearFormatExec=kd,c.ColorPickerInput=Ua,c.ContentRender=Hr,c.Count=za,c.DEFAULT_TAG=as,c.DELETECOLUMN=Jr,c.DELETEROW=Yr,c.DESTROY=sa,c.DOMNode=xl,c.DialogRenderer=ma,c.DropDownButtons=Ra,c.EMOJI_PICKER_ACTIONS=oa,c.EditorManager=Hd,c.EmojiPicker=rc,c.EmojiPickerAction=Id,c.ExecCommandCallBack=Ga,c.FORMAT_PAINTER_ACTIONS=na,c.FORMAT_TYPE=Ws,c.FileManager=$d,c.FormatPainter=ic,c.FormatPainterActions=Pd,c.Formats=Al,c.Formatter=Ya,c.FullScreen=ec,c.HTMLFormatter=zd,c.HtmlEditor=Gd,c.HtmlToolbarStatus=Vd,c.IGNORE_BLOCK_TAGS=ds,c.IMAGE=_r,c.INDENT_TYPE=ss,c.INSERTHTML_TYPE=ps,c.INSERT_COLUMN=Xr,c.INSERT_ROW=Gr,c.INSERT_TEXT_COMMAND=il,c.INSERT_TEXT_TYPE=us,c.INTERNAL_DESTROY=f,c.IframeContentRender=ya,c.Image=Hs,c.ImageCommand=pd,c.ImportExport=ac,c.Indents=zl,c.InsertHtml=Ul,c.InsertHtmlExec=Td,c.InsertMethods=F,c.InsertTextExec=Rd,c.IsFormatted=zr,c.KEY_DOWN=Vs,c.KEY_DOWN_HANDLER=m,c.KEY_UP=Xs,c.KEY_UP_HANDLER=Gs,c.KeyboardEvents=ca,c.LINK=Kr,c.LINK_COMMAND=el,c.LISTS_COMMAND=$a,c.LIST_TYPE=Ks,c.Link=ks,c.LinkCommand=Hl,c.Lists=Dl,c.MDFormats=sl,c.MDLink=pl,c.MDLists=ol,c.MDSelectionFormats=ll,c.MDTable=ml,c.MD_TABLE=nl,c.MODEL_CHANGED=Js,c.MODEL_CHANGED_PLUGIN=Ys,c.MOUSE_DOWN=ra,c.MS_WORD_CLEANUP=Zs,c.MS_WORD_CLEANUP_PLUGIN=$s,c.MarkdownEditor=Ol,c.MarkdownFormatter=Sl,c.MarkdownParser=vl,c.MarkdownRender=Ca,c.MarkdownSelection=Va,c.MarkdownToolbarStatus=Wa,c.MsWordPaste=Bd,c.NodeCutter=Bl,c.NodeSelection=bs,c.ON_BEGIN=ea,c.PASTE_SOURCE=fs,c.PasteCleanup=Xd,c.PopupRenderer=Ea,c.QuickToolbar=qa,c.REMOVETABLE=$r,c.Render=Fr,c.RendererFactory=pc,c.Resize=Yd,c.RichTextEditor=yh,c.SELECTION_TYPE=hs,c.SELF_CLOSING_TAGS=gs,c.SPACE_ACTION=ta,c.SelectionBasedExec=Ed,c.SelectionCommands=Cd,c.ServiceLocator=cc,c.SlashMenu=La,c.TABLE=Wr,c.TABLEHEADER=Zr,c.TABLE_BLOCK_TAGS=cs,c.TABLE_HORIZONTAL_SPLIT=is,c.TABLE_MERGE=ts,c.TABLE_MOVE=os,c.TABLE_VERTICAL_ALIGN=es,c.TABLE_VERTICAL_SPLIT=ns,c.Table=aa,c.TableCommand=yd,c.Toolbar=Ha,c.ToolbarAction=Aa,c.ToolbarRenderer=ws,c.ToolbarStatus=Os,c.UndoRedoCommands=cl,c.UndoRedoManager=Dd,c.VIDEO=Qr,c.Video=Fs,c.VideoCommand=fd,c.ViewSource=pa,c.XhtmlValidation=Wd,c.actionBegin=Oe,c.actionComplete=Le,c.actionSuccess="actionSuccess",c.afterImageDelete=Bt,c.afterKeyDown=dn,c.afterMediaDelete=Rt,c.afterPasteCleanup=_t,c.audioDelete=Ue,c.audioToolbarAction=me,c.autoResize=mn,c.beforeDialogClose=bt,c.beforeDialogOpen=mt,c.beforeDropDownItemRender=he,c.beforeDropDownOpen=_e,c.beforeFileUpload=Pt,c.beforeImageDrop=Ft,c.beforeImageUpload=Ut,c.beforePasteCleanup=zt,c.beforeQuickToolbarOpen=vt,c.bindCssClass=tn,c.bindOnEnd=$,c.blockEmptyNodes=gn,c.checkUndo=ct,c.cleanupResizeElements=ln,c.clearDialogObj=gt,c.closeAudioDialog=Jt,c.closeImageDialog=Yt,c.closeLinkDialog=Wt,c.closeTableDialog=en,c.closeTooltip=un,c.closeVideoDialog=$t,c.colorPickerChanged=$e,c.contentBlur="contentBlur",c.contentChanged=W,c.contentFocus="contentFocus",c.contentscroll=Je,c.conversionFactors=yn,c.convertToBlob=Ir,c.count=We,c.createTable=at,c.created="create",c.decode=Rr,c.destroy=o,c.destroyTooltip=sn,c.destroyed="destroy",c.dialogClose=yt,c.dialogOpen=ft,c.disableFullScreen=de,c.dispatchEvent=Or,c.docClick=lt,c.documentClickClosedBy=hn,c.drop=At,c.dropDownSelect=ce,c.dynamicModule=qt,c.editAreaClick=Xe,c.editLink=Se,c.emojiPicker=rn,c.enableFullScreen=le,c.enterHandler=ut,c.execCommandCallBack=pe,c.executeGroup=dc,c.expandPopupClick="expandPopupClick",c.fileRemoving=Mt,c.fileSelected=wt,c.fileUploadFailed=Dt,c.fileUploadSuccess=xt,c.fileUploading=kt,c.focusChange=et,c.formatPainterClick=nn,c.formatPainterDoubleClick=on,c.getCollection=Er,c.getDefaultValue=Mr,c.getDropDownValue=fr,c.getEditValue=xr,c.getFormattedFontSize=yr,c.getIndex=gr,c.getLocaleFontFormat=Ur,c.getSelectedHtml=it,c.getTBarItemsIndex=Sr,c.getTextNodesUnder=wr,c.getTooltipText=Cr,c.hasClass=p,c.hidePopup=an,c.htmlKeyConfig=Bs,c.htmlToolbarClick=Z,c.iframeMouseDown=K,c.imageAlt=Ae,c.imageBreak="break",c.imageCaption=He,c.imageCenter="justifyCenter",c.imageDelete=Ie,c.imageInline="inline",c.imageLeft="justifyLeft",c.imageLink=Re,c.imageRemoving=Lt,c.imageResizeFactor=Us,c.imageRight="justifyRight",c.imageSelected=Et,c.imageSize=je,c.imageToolbarAction=ue,c.imageUploadFailed=Ot,c.imageUploadSuccess=Tt,c.imageUploading=St,c.imgModule="imageModule",c.initialEnd=n,c.initialLoad=Q,c.inlineEmptyNodes=fn,c.insertAudio=De,c.insertCompleted=Be,c.insertImage=xe,c.insertLink=Ne,c.insertVideo=Me,c.isEditableValueEmpty=Br,c.isIDevice=br,c.keyDown=h,c.keyUp=ne,c.linkToolbarAction=fe,c.listConversionFilters={first:"MsoListParagraphCxSpFirst",middle:"MsoListParagraphCxSpMiddle",last:"MsoListParagraphCxSpLast"},c.load=V,c.markdownFormatTags=xs,c.markdownKeyConfig=Rs,c.markdownListsTags=Ms,c.markdownSelectionTags=Ds,c.markdownToolbarClick=ee,c.markerClassName=L,c.mentionRestrictKeys=Ps,c.modelChanged=l,c.mouseDown=Ke,c.mouseUp=re,c.onExport=oe,c.onHandleFontsizeChange=vn,c.onImport=ie,c.onResize=ve,c.openLink=Te,c.pageYOffset=vr,c.parseHtml=Lr,c.paste=rt,c.pasteClean=pt,c.pasteCleanupGroupingTags=As,c.popupHide="popupHide",c.quickToolbarClose=Nt,c.quickToolbarOpen=Ct,c.readOnlyMode=ht,c.redo="redo",c.refreshBegin=Y,c.renderFileManager=jt,c.renderInlineToolbar=ot,c.resizeInitialized=Ht,c.resizeStart=ye,c.resizeStop=Ce,c.rtlMode=st,c.sanitizeHelper=Ar,c.scroll=Ye,c.selectAll=tt,c.selectRange=nt,c.selectionCommand=Za,c.selectionRestore=Qe,c.selectionSave=Ve,c.selfClosingTags=Is,c.setAttributes=nc,c.setToolbarStatus=Nr,c.showAudioDialog=Gt,c.showColorPicker=pn,c.showImageDialog=Kt,c.showLinkDialog=Qt,c.showTableDialog=Zt,c.showVideoDialog=Xt,c.sourceCode=qe,c.sourceCodeMouseDown=Ge,c.statusCollection=Ts,c.supportedUnits=bn,c.tableColorPickerChanged=Ze,c.tableModulekeyUp=te,c.tableToolbarAction=dt,c.tableclass=_,c.toObjectLowerCase=kr,c.toolbarClick=G,c.toolbarCreated=se,c.toolbarOpen="toolbarOpen",c.toolbarRefresh=X,c.toolbarRenderComplete=ae,c.toolbarUpdated=J,c.unLink=Ee,c.undo="undo",c.updateDropDownFontFormatLocale=Pr,c.updateSource=ze,c.updateTbItemsStatus=Vt,c.updateTextNode=Dr,c.updateToolbarItem=ke,c.updateUndoRedoStatus=Tr,c.updateValueOnIdle=cn,c.updatedToolbarStatus=we,c.videoDelete=Pe,c.videoSize=Fe,c.videoToolbarAction=ge,c.windowResize=be,c.xhtmlValidation=It,Object.defineProperty(c,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-richtexteditor.umd.min.js.map
